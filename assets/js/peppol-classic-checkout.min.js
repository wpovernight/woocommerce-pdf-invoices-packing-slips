jQuery(function(a){function b(){const b=n&&n.visibilityMode?n.visibilityMode:"always";let c=a();if("toggle"===b){c=a(".wpo-ips-peppol-conditional").closest(".form-row");const b=a("#peppol_invoice");return b.length?void c.toggle(b.is(":checked")):void 0}if("company"===b){c=a(".wpo-ips-peppol-company-conditional").closest(".form-row");const b=a("#billing_company");return b.length?void c.toggle(0<a.trim(b.val()).length):void 0}}function c(...a){p&&console.log("[WPO IPS Peppol]",...a)}function d(a){return((a||"")+"").replace(/\s+/g,"").toUpperCase().trim()}function e(a){const b=((a||"")+"").toUpperCase();return o.includes(b)}function f(){const b=a(q).val();return((b||"")+"").toUpperCase().trim()}function g(){const b=a(r).val();return((b||"")+"").trim()}function h(){if(s){const b=a(s),c=b.find("input").first();if(c.length)return{$wrapper:b,$input:c}}const b=a("#peppol_endpoint_id").first().add(a("input[name=\"peppol_endpoint_id\"]").first()).add(a("input[name*=\"peppol\"][name*=\"endpoint\"]").first()).filter(function(){return a(this).length}).first();return b.length?{$wrapper:b.closest(".form-row"),$input:b}:{$wrapper:a(),$input:a()}}function i(a,b){if(!a||!a.length)return!1;const c=(b??"")+"";return(a.val()??"")+""===c||(a.val(c),a.trigger("input"),a.trigger("change"),!0)}function j(a,b,c){a.prop("readonly",!!c),a.css("pointer-events",c?"none":""),a.attr("aria-disabled",c?"true":"false"),a.toggleClass("wpo-is-locked",!!c),b&&b.length&&b.toggleClass("wpo-ips-locked-wrap",!!c)}function k(b,c,d){if(!b||!b.length||!c||!c.length)return;let e=b.find(".wpo-ips-override").first();return d?void(e.length||(e=a("<a />",{href:"#",class:"wpo-ips-override",text:n.override_link_text||"Override (edit manually)"}),e.on("click",function(a){a.preventDefault();const b=(c.val()||"")+"";w=!0,x=b,m("override-click"),b&&setTimeout(function(){i(c,b)},0),c.focus()}),c.after(e))):void(e.length&&e.remove())}function l(b,c){const d=window.wp&&window.wp.apiFetch?window.wp.apiFetch:null;if(d)return d({path:t,method:"POST",data:{billing_country:((b||"")+"").toUpperCase(),vat:(c||"")+""}});const e=window.wpApiSettings&&window.wpApiSettings.root?window.wpApiSettings.root+"":"",f=window.wpApiSettings&&window.wpApiSettings.nonce?window.wpApiSettings.nonce+"":"";if(e){const d=t.replace(/^\//,""),g=e.replace(/\/$/,"")+"/"+d;return a.ajax({url:g,method:"POST",dataType:"json",data:{billing_country:((b||"")+"").toUpperCase(),vat:(c||"")+""},beforeSend:function(a){f&&a.setRequestHeader("X-WP-Nonce",f)}})}return a.Deferred().resolve(null).promise()}function m(a){const{$wrapper:b,$input:m}=h();if(!m.length)return;const n=f(),o=g();(n!==z||o!==y)&&(w=!1,x="",z=n,y=o,v=null);const p=e(n)&&""!==o,q=p&&!w;if(p&&!w&&""!==o){const a=d(o),b=n+"|"+a;v&&v.key===b?v.value&&i(m,v.value):(u&&clearTimeout(u),u=setTimeout(function(){l(n,a).then(function(a){const c=((a&&a.id?a.id:"")+"").trim();v={key:b,value:c},c&&i(m,c)}).catch(function(){})},250))}k(b,m,q),j(m,b,q),c("lock state applied",{source:a,country:n,vatValue:o,locked:q,manualOverride:w,lastValue:v?v.value:"",manualOverrideValue:x})}const n=window.wpoIpsPeppol||{};if(b(),a(document).on("change","#peppol_invoice",b),a(document).on("input change","#billing_company",b),!n.endpoint_derivation)return;const o=Array.isArray(n.countries)?n.countries.map(a=>(a+"").toUpperCase()):[],p=!!n.debug,q=n.billing_country_selector&&(n.billing_country_selector+"").trim()?n.billing_country_selector:"#billing_country",r=n.vat_field_selector&&(n.vat_field_selector+"").trim()?n.vat_field_selector:"#billing_vat, input[name=\"billing_vat\"]",s=n.peppol_input_wrapper_selector&&(n.peppol_input_wrapper_selector+"").trim()?n.peppol_input_wrapper_selector:"",t=n.peppol_autofill_endpoint_route||"/wpo-ips/v1/peppol-endpoint";let u=null,v=null,w=!1,x="",y=null,z=null;a(document).on("input change",q+", "+r,function(){m("input")}),a(document.body).on("updated_checkout updated_shipping_method",function(){m("wc-updated")}),m("init")});