jQuery(function(a){function b(a){a&&(h.hide().filter(`[data-tax-class="${a}"]`).show(),g.removeClass("active").attr("aria-pressed","false").filter(`[data-tax-class="${a}"]`).addClass("active").attr("aria-pressed","true"))}function c(){const b=a(".edi-tax-class-group .doc-output-toggle.active").data("tax-class")||a(".edi-tax-class-group .doc-output-toggle").first().data("tax-class")||a(".edi-tax-class-table:visible").data("tax-class")||a(".edi-tax-class-table").first().data("tax-class");a.get(wpo_ips_edi.ajaxurl,{action:"wpo_ips_edi_reload_tax_table",nonce:wpo_ips_edi.nonce,tax_class:b},function(c){const d=a(`.edi-tax-class-table[data-tax-class="${b}"]`);d.html(c)})}function d(){const b=a("#edi-customer-order-id"),c=b.val(),d=b.closest("table"),f=d.find("tbody");if(!c)return f.empty().append(`<tr><td colspan="2">${wpo_ips_edi.enter_order_id}</td></tr>`),!1;const g=a.trim(c);return isNaN(g)||""===g?(f.empty().append(`<tr><td colspan="2">${wpo_ips_edi.valid_number}</td></tr>`),!1):(f.empty().append(`<tr><td colspan="2">${wpo_ips_edi.loading}</td></tr>`),a.get(wpo_ips_edi.ajaxurl,{action:"wpo_ips_edi_load_customer_order_identifiers",nonce:wpo_ips_edi.nonce,order_id:c},function(b){if(f.empty(),b.success&&b.data&&b.data.data&&0<Object.keys(b.data.data).length){const c=b.data.data;a.each(c,function(a,b){let c=b.label||a,d=b.value,g="",h="";("undefined"==typeof d||null===d||""===d)&&(g=b.required?"#d63638":"#996800",d=`<span style="color:${g};">${b.required?wpo_ips_edi.missing:wpo_ips_edi.optional}</span>`),"vat_number"===a&&b.value&&!e(b.value)&&(h=`<br><small style="color:#996800;">${wpo_ips_edi.vat_warning}</small>`),f.append(`
						<tr>
							<td>${c}</td>
							<td>${d}${h}</td>
						</tr>
					`)})}else{const a=b.data||wpo_ips_edi.no_identifiers_found;f.append(`<tr><td colspan="2">${a}</td></tr>`)}}),!1)}function e(a){return /^[A-Z]{2}/.test(a)}a(`select[name^="wpo_ips_edi_tax_settings"][name$="[scheme]"],
		select[name^="wpo_ips_edi_tax_settings"][name$="[category]"],
		select[name^="wpo_ips_edi_tax_settings"][name$="[reason]"]`).on("change",function(){let b=a(this).data("current"),c=a(this).find("option:selected").val(),d=a(this).closest("td, th, div").find(".current"),e=`${wpo_ips_edi.new}: <code>${c}</code> <strong>(${wpo_ips_edi.unsaved})</strong>`,f=`${wpo_ips_edi.code}: <code>${b}</code>`;if(c===b?d.html(f):d.html(e),""===c||null===c?d.addClass("hidden"):d.removeClass("hidden"),a(this).attr("name").endsWith("[reason]")){let b=wpo_ips_edi.remarks.reason[c];b?a(this).closest("tr").find(".remark").html(b):a(this).closest("tr").find(".remark").html("")}});const f=a(".edi-tax-class-group"),g=f.find(".doc-output-toggle"),h=a(".edi-tax-class-table");f.on("click",".doc-output-toggle",function(c){c.preventDefault(),b(a(this).data("tax-class"))});const i=g.filter(".active").data("tax-class")||g.first().data("tax-class")||h.first().data("tax-class");b(i),a("button.button-edi-save-taxes").on("click",function(b){b.preventDefault();const d=a(this),e=d.data("nonce"),f=d.data("action"),g=d.closest("form#wpo-wcpdf-settings"),h=g.serialize(),i=h+"&action="+encodeURIComponent(f)+"&nonce="+encodeURIComponent(e),j=a("#edi-tax-save-notice");g.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.post(wpo_ips_edi.ajaxurl,i,function(a){const b=a.data||"Unknown response.";let d="notice";d+=a.success?" notice-success":" notice-error",j.removeClass().addClass(d).html(`<p><strong>${b}</strong></p>`).slideDown(),setTimeout(function(){j.slideUp()},8e3),a.success&&c(),g.unblock()})}),a("#edi-customer-order-id").on("keydown",function(a){("Enter"===a.key||13===a.keyCode)&&(a.preventDefault(),d())}),a("#edi-customer-order-id-search-button").on("click",function(a){a.preventDefault(),d()})});