jQuery(function(a){function b(){const b=a("#due_date").val(),c=a("#due_date_custom_days"),d=a("#due_date_base_date");""===b?(c.closest("tr").hide(),d.closest("tr").hide()):"custom"===b?(c.closest("tr").show(),d.closest("tr").show()):(c.closest("tr").hide(),d.closest("tr").show())}function c(){o=y.val(),p=z.val(),q=A.val(),r=B.val(),s=C.serialize()}function d(){z.val(z.data("default")).trigger("change")}function e(){y.val("").trigger("change")}function f(){!1==w.attr("data-preview-states-lock")&&(1200>=a(this).width()&&(1200<v||a(this).width()==v)?"full"==w.attr("data-preview-state")?(w.find(".preview-document").show(),w.find(".sidebar").hide(),w.find(".slide-left").hide(),w.find(".slide-right").show(),w.attr("data-preview-states",2),w.attr("data-preview-state","full"),w.attr("data-from-preview-state","")):(w.find(".preview-document").hide(),w.find(".sidebar").show(),w.find(".slide-left").show(),w.find(".slide-right").hide(),w.attr("data-preview-states",2),w.attr("data-preview-state","closed"),w.attr("data-from-preview-state","")):1200<a(this).width()&&(1200>=v||a(this).width()==v)&&("full"==w.attr("data-preview-state")?(w.find(".preview-document").show(),w.find(".sidebar").hide(),w.find(".slide-left").hide(),w.find(".slide-right").show(),w.attr("data-preview-states",3),w.attr("data-preview-state","full"),w.attr("data-from-preview-state","sidebar"),w.addClass("static")):"closed"==w.attr("data-preview-state")&&a(this).width()!==v?(w.find(".preview-document").hide(),w.find(".sidebar").show(),w.find(".slide-left").show(),w.find(".slide-right").hide(),w.attr("data-preview-states",3),w.attr("data-preview-state","closed"),w.attr("data-from-preview-state",""),w.removeClass("static")):(w.find(".preview-document, .sidebar").show(),w.find(".slide-left, .slide-right").show(),w.attr("data-preview-states",3),w.attr("data-preview-state","sidebar"),w.attr("data-from-preview-state",""),w.removeClass("static")))),v=a(this).width()}function g(a){window.scrollTo(0,0);let b=a;setTimeout(function(){b.addClass("static")},300)}function h(b,c){i();let d=a(b.target);if(!k(d.attr("name"))){if(d.hasClass("remove-requirement")||"disable_for"==d.attr("id"))return;if(-1!==jQuery.inArray(b.type,["keyup","paste"])){if(d.is("input[type=\"checkbox\"], select"))return;c="keyup"==b.type?1e3:0}j(c)}}function i(b){a(".preview-data-wrapper .save-settings p").css("margin-right","0")}function j(a){a="number"==typeof a?a:0,c(),clearTimeout(t),t=setTimeout(function(){l()},a)}function k(b){let c=!1;if(!b)return c;let d=b.includes("[")?b.match(/\[(.*?)\]/)[1]:b;return-1!==a.inArray(d,wpo_wcpdf_admin.preview_excluded_settings)&&(c=!0),c}function l(){let b=wpo_wcpdf_admin.pdfjs_worker,c="preview-canvas",d={action:"wpo_wcpdf_preview",security:r,order_id:o,document_type:p,output_format:q,data:s};x.children(".notice").remove(),x.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),D=a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:d,beforeSend:function(a,b){null!=D&&D.abort()},success:function(d,e,f){if(d.data.error)a("#"+c).remove(),x.append("<div class=\"notice notice-error inline\"><p>"+d.data.error+"</p></div>");else if(d.data.preview_data&&d.data.output_format)switch(a("#"+c).remove(),d.data.output_format){default:case"pdf":x.append("<canvas id=\""+c+"\" style=\"width:100%;\"></canvas>"),m(b,c,d.data.preview_data);break;case"ubl":let a=d.data.preview_data,e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");x.html("<div id=\"preview-ubl\">"+e+"</div>")}x.unblock()},error:function(b,d,e){if("abort"!=d){let d=b.status+": "+b.statusText;a("#"+c).remove(),x.append("<div class=\"notice notice-error inline\"><p>"+d+"</p></div>"),x.unblock()}}})}function m(a,b,c){c=window.atob(c);let d=window["pdfjs-dist/build/pdf"];d.GlobalWorkerOptions.workerSrc=a;let e=d.getDocument({data:c});e.promise.then(function(a){let c=1;a.getPage(1).then(function(a){let c=2,d=a.getViewport({scale:2}),e=document.getElementById(b),f=e.getContext("2d");e.height=d.height,e.width=d.width;let g={canvasContext:f,viewport:d},h=a.render(g);h.promise.then(function(){})})},function(a){console.error(a)})}function n(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d=b.val(),e=b.data("nonce"),f="wpo_wcpdf_preview_order_search",g={security:e,action:f,search:d,document_type:p};c.parent().find("img.preview-order-search-clear").hide(),c.children(".error").remove(),c.children("a").remove(),c.hide(),a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:g,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order_id=\""+a+"\"><span class=\"order-number\">#"+b.order_number+"</span> - "+b.billing_first_name+" "+b.billing_last_name;0<b.billing_company.length&&(d=d+", "+b.billing_company);let e="<br><span class=\"date\">"+b.date_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}a(".wcpdf-extensions .more").hide(),a(".wcpdf-extensions > li").on("click",function(b){a(this).toggleClass("expanded"),a(this).find(".more").slideToggle()}),a(".edit-next-number").on("click",function(b){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(b){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");let c=$input.val();if(0<c.length&&2147483647<c)return alert(wpo_wcpdf_admin.mysql_int_size_limit),void $input.removeClass("ajax-waiting");let d={security:$input.data("nonce"),action:"wpo_wcpdf_set_next_number",store:$input.data("store"),number:c};xhr=a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:d,success:function(a){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo_wcpdf_documents_settings_invoice[display_number]']").on("change",function(b){"order_number"==a(this).val()?(a(this).closest("td").find(".description").slideDown(),a(this).closest("tr").next("tr").hide()):(a(this).closest("td").find(".description").hide(),a(this).closest("tr").next("tr").show())}).trigger("change"),a(".wcpdf_document_settings_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")}),a.each(wpo_wcpdf_admin.pointers,function(b,c){a(c.target).pointer({content:c.content,position:{edge:c.position.edge,align:c.position.align},pointerClass:c.pointer_class,pointerWidth:c.pointer_width,close:function(){jQuery.post(wpo_wcpdf_admin.ajaxurl,{pointer:b,action:"dismiss-wp-pointer"})}}),-1===a.inArray(b,wpo_wcpdf_admin.dismissed_pointers.split(","))&&a(c.target).pointer("open")}),a(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),b(),a("#due_date").change(b);let o,p,q,r,s,t,u,v,w=a("#wpo-wcpdf-preview-wrapper"),x=a("#wpo-wcpdf-preview-wrapper .preview"),y=a("#wpo-wcpdf-preview-wrapper input[name=\"order_id\"]"),z=a("#wpo-wcpdf-preview-wrapper input[name=\"document_type\"]"),A=a("#wpo-wcpdf-preview-wrapper input[name=\"output_format\"]"),B=a("#wpo-wcpdf-preview-wrapper input[name=\"nonce\"]"),C=a("#wpo-wcpdf-settings"),D=null;a(document).ready(function(){d(),e(),c(),v=a(window).width(),f()}),a(window).on("resize",f),a(".slide-left").on("click",function(){let a=w.attr("data-preview-states"),b=w.attr("data-preview-state");w.find(".preview-data-wrapper ul").removeClass("active"),3==a?"closed"==b?(w.find(".preview-document").show(),w.find(".slide-right").show(),w.attr("data-preview-state","sidebar"),w.attr("data-from-preview-state","closed")):(w.find(".slide-left").hide(),w.find(".sidebar").delay(300).hide(0),w.attr("data-preview-state","full"),w.attr("data-from-preview-state","sidebar"),g(w)):(w.find(".preview-document").show(),w.find(".slide-left").hide(),w.find(".slide-right").show(),w.attr("data-preview-state","full"),w.attr("data-from-preview-state","closed"),g(w))}),a(".slide-right").on("click",function(){let a=w.attr("data-preview-states"),b=w.attr("data-preview-state");w.find(".preview-data-wrapper ul").removeClass("active"),3==a?"full"==b?(w.find(".slide-left").delay(400).show(0),w.find(".sidebar").show(),w.attr("data-preview-state","sidebar"),w.attr("data-from-preview-state","full")):(w.find(".preview-document").hide(300),w.find(".slide-right").hide(),w.attr("data-preview-state","closed"),w.attr("data-from-preview-state","sidebar")):(w.find(".preview-document").hide(300),w.find(".slide-left").show(),w.find(".slide-right").hide(),w.attr("data-preview-state","closed"),w.attr("data-from-preview-state","full")),w.removeClass("static")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.siblings(".preview-data").find("ul").removeClass("active"),b.find("ul").toggleClass("active")}),a(".preview-document .preview-data ul > li").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active"),a(this).hasClass("order-search")?(b.find("p.last-order").hide(),b.find("input[name=\"preview-order-search\"]").addClass("active"),b.find("p.order-search").show().find(".order-search-label").text(a(this).text())):(b.find("p.last-order").show(),b.find("p.order-search").hide(),b.find("input[name=\"preview-order-search\"]").removeClass("active").val(""),b.find("#preview-order-search-results").hide(),b.find("img.preview-order-search-clear").hide(),e(),j())}),a(document).ready(j()),a(document).on("wpo-wcpdf-settings-changed",function(a,b){i(),j(b)}),a(document).on("wpo-wcpdf-refresh-preview wpo_wcpdf_refresh_preview",function(a,b){j(b)}),a(document).on("click","#preview-order-search-results a",function(b){b.preventDefault(),a(".preview-document .order-search-label").text("#"+a(this).data("order_id")),y.val(a(this).data("order_id")).change(),a(this).closest("div").hide(),a(this).closest("div").children("a").remove(),j()}),a(document).on("keyup paste","#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea",h),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"], #wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(a){a.isTrigger||h(a)}),a(document).on("select2:select select2:unselect","#wpo-wcpdf-settings select.wc-enhanced-select",h),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",h),a(document).on("click",".wpo_remove_image_button, #wpo-wcpdf-settings .remove-requirement",h),a(document).on("click",".preview-data-wrapper .save-settings p input",function(b){a("#wpo-wcpdf-settings input#submit").click()}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault(),a(this).closest("div").find("input#preview-order-search").val(""),a(this).closest(".preview-data").find("#preview-order-search-results").children("a").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").hide(),a(this).hide()}),a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list li").on("click",function(){let b=a(this).closest("ul").data("input-name"),c=a("#wpo-wcpdf-preview-wrapper :input[name="+b+"]");c.val(a(this).data("value")).trigger("change")}),z.on("change",function(){let b=a(this).val();if(b.length){let c=a(this).attr("name"),d=a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list[data-input-name="+c+"]"),e=d.find("li[data-value="+b+"]");d.parent().find(".current-label").text(e.text()),j()}}).trigger("change"),y.on("change",function(){j()}).trigger("change"),a("#preview-order-search").on("keyup paste",function(b){let d=a(this);d.addClass("ajax-waiting");let e="keyup"==b.type?1e3:0;c(),clearTimeout(u),u=setTimeout(function(){n(d)},e)})});