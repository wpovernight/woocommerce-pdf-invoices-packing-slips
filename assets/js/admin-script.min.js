jQuery(function(a){function b(b,d){let f=a("#wpo-wcpdf-preview-wrapper .preview"),g=f.data("order_id"),h=a("#wpo-wcpdf-preview-wrapper input[name=\"preview-order-number\"]").val();0<h.length&&(g=h);let i=f.data("nonce"),j=wpo_wcpdf_admin.pdfjs_worker,k="preview-canvas",l={security:i,action:"wpo_wcpdf_preview",order_id:g,data:b};if(f.children(".notice").remove(),e(d)){let a=f.data("save_settings");return f.find("canvas").remove(),void f.append("<div class=\"notice notice-warning inline\"><p>"+a+"</p></div>")}if(0===g.length){let a=f.data("no_order");return f.find("canvas").remove(),void f.append("<div class=\"notice notice-error inline\"><p>"+a+"</p></div>")}f.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:l,success:function(b){b.data.error?(a("#"+k).remove(),f.append("<div class=\"notice notice-error inline\"><p>"+b.data.error+"</p></div>")):b.data.pdf_data&&(a("#"+k).remove(),f.append("<canvas id=\""+k+"\" style=\"width:100%;\"></canvas>"),c(j,k,b.data.pdf_data)),f.unblock()}})}function c(a,b,c){var d=atob(c),e=window["pdfjs-dist/build/pdf"];e.GlobalWorkerOptions.workerSrc=a;var f=e.getDocument({data:d});f.promise.then(function(a){console.log("PDF loaded");a.getPage(1).then(function(a){console.log("Page loaded");var c=a.getViewport({scale:2}),d=document.getElementById(b),e=d.getContext("2d");d.height=c.height,d.width=c.width;var f=a.render({canvasContext:e,viewport:c});f.promise.then(function(){console.log("Page rendered")})})},function(a){console.error(a)})}function d(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d={security:b.data("nonce"),action:"wpo_wcpdf_preview_order_search",search:b.val()};a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:d,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order_id=\""+a+"\"><span class=\"order-number\">#"+b.order_number+"</span> - "+b.billing_first_name+" "+b.billing_last_name;0<b.billing_company.length&&(d=d+", "+b.billing_company);let e="<br><span class=\"date\">"+b.date_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}function e(b){let c=b.attr("id"),d=b.prop("tagName");return"OPTION"==d&&(c=b.parent().attr("id")),-1!==a.inArray(c,["enabled","paper_size","test_mode","header_logo","header_logo_height","display_shipping_address","display_email","display_phone","display_customer_notes","display_date","display_number","number_format","title"])}a(".edit-next-number").on("click",function(){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");var b={security:$input.data("nonce"),action:"wpo_wcpdf_set_next_number",store:$input.data("store"),number:$input.val()};xhr=a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:b,success:function(){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo_wcpdf_documents_settings_invoice[display_number]']").on("change",function(){"order_number"==a(this).val()?a(this).closest("td").find(".description").slideDown():a(this).closest("td").find(".description").hide()}).trigger("change"),a(".wcpdf_document_settings_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")});let f=a("#wpo-wcpdf-preview-wrapper").attr("data-preview-states");a(".slide-left").on("click",function(){let b=a(this).closest("#wpo-wcpdf-preview-wrapper"),c=b.attr("data-preview-state");3==f?"closed"==c?b.attr("data-preview-state","sidebar"):b.attr("data-preview-state","full"):b.attr("data-preview-state","full")}),a(".slide-right").on("click",function(){let b=a(this).closest("#wpo-wcpdf-preview-wrapper"),c=b.attr("data-preview-state");3==f?"full"==c?b.attr("data-preview-state","sidebar"):b.attr("data-preview-state","closed"):b.attr("data-preview-state","closed")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active")}),a(".preview-document .preview-data li").on("click",function(){let c=a(this).closest(".preview-data");c.find("ul").toggleClass("active"),a(this).hasClass("order-number")?(c.find("p.last-order").hide(),c.find("p.order-search").hide(),c.find("p.order-number").show(),c.find("input[name=\"preview-order-number\"]").addClass("active"),c.find("input[name=\"preview-order-search\"]").removeClass("active"),c.find("#preview-order-search-results").hide(),c.find("img.preview-order-search-clear").hide()):a(this).hasClass("order-search")?(c.find("p.last-order").hide(),c.find("p.order-number").hide(),c.find("p.order-search").show(),c.find("input[name=\"preview-order-search\"]").addClass("active"),c.find("input[name=\"preview-order-number\"]").removeClass("active").val("")):(c.find("p.last-order").show(),c.find("p.order-number").hide(),c.find("p.order-search").hide(),c.find("input[name=\"preview-order-number\"]").removeClass("active").val(""),c.find("input[name=\"preview-order-search\"]").removeClass("active"),c.find("#preview-order-search-results").hide(),c.find("img.preview-order-search-clear").hide(),b(a("#wpo-wcpdf-settings").serialize(),a("#wpo-wcpdf-preview-wrapper .preview")))});let g;a(document).ready(b(a("#wpo-wcpdf-settings").serialize(),a("#wpo-wcpdf-preview-wrapper .preview"))),a("#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea, #wpo-wcpdf-settings select, #preview-order-number").on("keyup paste",function(c){let d=a(this),e=d.closest("#wpo-wcpdf-settings").serialize(),f="keyup"==c.type?1e3:0;clearTimeout(g),g=setTimeout(function(){b(e,d)},f)}),a("#wpo-wcpdf-settings select option").on("click",function(c){c.preventDefault();let d=a(this),e=d.closest("#wpo-wcpdf-settings").serialize(),f="click"==c.type?1e3:0;clearTimeout(g),g=setTimeout(function(){b(e,d)},f)}),a("#wpo-wcpdf-settings input[type=\"checkbox\"]").on("change",function(c){c.preventDefault();let d=a(this),e=d.closest("#wpo-wcpdf-settings").serialize(),f="click"==c.type?1e3:0;clearTimeout(g),g=setTimeout(function(){b(e,d)},f)}),a(document).on("click","#preview-order-search-results a",function(c){c.preventDefault();let d=a(this),e=d.data("order_id"),f=a("#wpo-wcpdf-preview-wrapper .preview");f.data("order_id",e),d.closest("div").hide(),d.closest("div").children("a").remove();let h=d.closest("#wpo-wcpdf-settings").serialize(),i="click"==c.type?1e3:0;clearTimeout(g),g=setTimeout(function(){b(h,d)},i)}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault();let c=a(this);c.closest("div").find("input#preview-order-search").val(""),c.closest(".preview-data").find("#preview-order-search-results").children("a").remove(),c.closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),c.closest(".preview-data").find("#preview-order-search-results").hide(),c.hide()});let h;a("#preview-order-search").on("keyup paste",function(b){let c=a(this);c.addClass("ajax-waiting");let e=c.closest(".preview-data").find("#preview-order-search-results");e.children("a").remove(),e.children(".error").remove(),c.closest(".preview-data").find("#preview-order-search-results").hide(),c.closest("div").find("img.preview-order-search-clear").hide();let f="keyup"==b.type?1e3:0;clearTimeout(h),h=setTimeout(function(){d(c)},f)})});