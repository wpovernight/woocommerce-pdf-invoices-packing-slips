jQuery(function(a){function b(){m=v.val(),n=w.val(),o=x.val(),p=y.serialize()}function c(){w.val(w.data("default")).trigger("change")}function d(){v.val("").trigger("change")}function e(){!1==t.attr("data-preview-states-lock")&&(1200>=a(this).width()&&(1200<s||a(this).width()==s)?"full"==t.attr("data-preview-state")?(t.find(".preview-document").show(),t.find(".sidebar").hide(),t.find(".slide-left").hide(),t.find(".slide-right").show(),t.attr("data-preview-states",2),t.attr("data-preview-state","full"),t.attr("data-from-preview-state","")):(t.find(".preview-document").hide(),t.find(".sidebar").show(),t.find(".slide-left").show(),t.find(".slide-right").hide(),t.attr("data-preview-states",2),t.attr("data-preview-state","closed"),t.attr("data-from-preview-state","")):1200<a(this).width()&&(1200>=s||a(this).width()==s)&&("full"==t.attr("data-preview-state")?(t.find(".preview-document").show(),t.find(".sidebar").hide(),t.find(".slide-left").hide(),t.find(".slide-right").show(),t.attr("data-preview-states",3),t.attr("data-preview-state","full"),t.attr("data-from-preview-state","sidebar"),t.addClass("static")):"closed"==t.attr("data-preview-state")&&a(this).width()!==s?(t.find(".preview-document").hide(),t.find(".sidebar").show(),t.find(".slide-left").show(),t.find(".slide-right").hide(),t.attr("data-preview-states",3),t.attr("data-preview-state","closed"),t.attr("data-from-preview-state",""),t.removeClass("static")):(t.find(".preview-document, .sidebar").show(),t.find(".slide-left, .slide-right").show(),t.attr("data-preview-states",3),t.attr("data-preview-state","sidebar"),t.attr("data-from-preview-state",""),t.removeClass("static")))),s=a(this).width()}function f(a){window.scrollTo(0,0);setTimeout(function(){a.addClass("static")},300)}function g(){a(".preview-data-wrapper .save-settings p").css("margin-right","0")}function h(a){a="number"==typeof a?a:0,b(),clearTimeout(q),q=setTimeout(function(){j()},a)}function i(b){let c=!1;if(!b)return c;let d=b.includes("[")?b.match(/\[(.*?)\]/)[1]:b;return-1!==a.inArray(d,wpo_wcpdf_admin.preview_excluded_settings)&&(c=!0),c}function j(){let b=wpo_wcpdf_admin.pdfjs_worker,c="preview-canvas",d={action:"wpo_wcpdf_preview",security:o,order_id:m,document_type:n,data:p};u.children(".notice").remove(),u.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),z=a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:d,beforeSend:function(){null!=z&&z.abort()},success:function(d){d.data.error?(a("#"+c).remove(),u.append("<div class=\"notice notice-error inline\"><p>"+d.data.error+"</p></div>")):d.data.pdf_data&&(a("#"+c).remove(),u.append("<canvas id=\""+c+"\" style=\"width:100%;\"></canvas>"),k(b,c,d.data.pdf_data)),u.unblock()},error:function(b,d){if("abort"!=d){let d=b.status+": "+b.statusText;a("#"+c).remove(),u.append("<div class=\"notice notice-error inline\"><p>"+d+"</p></div>"),u.unblock()}}})}function k(a,b,c){c=window.atob(c);let d=window["pdfjs-dist/build/pdf"];d.GlobalWorkerOptions.workerSrc=a;let e=d.getDocument({data:c});e.promise.then(function(a){a.getPage(1).then(function(a){let c=a.getViewport({scale:2}),d=document.getElementById(b),e=d.getContext("2d");d.height=c.height,d.width=c.width;let f=a.render({canvasContext:e,viewport:c});f.promise.then(function(){})})},function(a){console.error(a)})}function l(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d=b.val(),e=b.data("nonce"),f={security:e,action:"wpo_wcpdf_preview_order_search",search:d,document_type:n};c.parent().find("img.preview-order-search-clear").hide(),c.children(".error").remove(),c.children("a").remove(),c.hide(),a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:f,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order_id=\""+a+"\"><span class=\"order-number\">#"+b.order_number+"</span> - "+b.billing_first_name+" "+b.billing_last_name;0<b.billing_company.length&&(d=d+", "+b.billing_company);let e="<br><span class=\"date\">"+b.date_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}a(".wcpdf-extensions .more").hide(),a(".wcpdf-extensions > li").on("click",function(){a(this).toggleClass("expanded"),a(this).find(".more").slideToggle()}),a(".edit-next-number").on("click",function(){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");let b={security:$input.data("nonce"),action:"wpo_wcpdf_set_next_number",store:$input.data("store"),number:$input.val()};xhr=a.ajax({type:"POST",url:wpo_wcpdf_admin.ajaxurl,data:b,success:function(){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo_wcpdf_documents_settings_invoice[display_number]']").on("change",function(){"order_number"==a(this).val()?a(this).closest("td").find(".description").slideDown():a(this).closest("td").find(".description").hide()}).trigger("change"),a(".wcpdf_document_settings_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")});let m,n,o,p,q,r,s,t=a("#wpo-wcpdf-preview-wrapper"),u=a("#wpo-wcpdf-preview-wrapper .preview"),v=a("#wpo-wcpdf-preview-wrapper input[name=\"order_id\"]"),w=a("#wpo-wcpdf-preview-wrapper input[name=\"document_type\"]"),x=a("#wpo-wcpdf-preview-wrapper input[name=\"nonce\"]"),y=a("#wpo-wcpdf-settings"),z=null;a(document).ready(function(){c(),d(),b(),s=a(window).width(),e()}),a(window).on("resize",e),a(".slide-left").on("click",function(){let a=t.attr("data-preview-states"),b=t.attr("data-preview-state");t.find(".preview-data-wrapper ul").removeClass("active"),3==a?"closed"==b?(t.find(".preview-document").show(),t.find(".slide-right").show(),t.attr("data-preview-state","sidebar"),t.attr("data-from-preview-state","closed")):(t.find(".slide-left").hide(),t.find(".sidebar").delay(300).hide(0),t.attr("data-preview-state","full"),t.attr("data-from-preview-state","sidebar"),f(t)):(t.find(".preview-document").show(),t.find(".slide-left").hide(),t.find(".slide-right").show(),t.attr("data-preview-state","full"),t.attr("data-from-preview-state","closed"),f(t))}),a(".slide-right").on("click",function(){let a=t.attr("data-preview-states"),b=t.attr("data-preview-state");t.find(".preview-data-wrapper ul").removeClass("active"),3==a?"full"==b?(t.find(".slide-left").delay(400).show(0),t.find(".sidebar").show(),t.attr("data-preview-state","sidebar"),t.attr("data-from-preview-state","full")):(t.find(".preview-document").hide(300),t.find(".slide-right").hide(),t.attr("data-preview-state","closed"),t.attr("data-from-preview-state","sidebar")):(t.find(".preview-document").hide(300),t.find(".slide-left").show(),t.find(".slide-right").hide(),t.attr("data-preview-state","closed"),t.attr("data-from-preview-state","full")),t.removeClass("static")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.siblings(".preview-data").find("ul").removeClass("active"),b.find("ul").toggleClass("active")}),a(".preview-document .preview-data ul > li").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active"),a(this).hasClass("order-search")?(b.find("p.last-order").hide(),b.find("input[name=\"preview-order-search\"]").addClass("active"),b.find("p.order-search").show().find(".order-search-label").text(a(this).text())):(b.find("p.last-order").show(),b.find("p.order-search").hide(),b.find("input[name=\"preview-order-search\"]").removeClass("active").val(""),b.find("#preview-order-search-results").hide(),b.find("img.preview-order-search-clear").hide(),d(),h())}),a(document).ready(h()),a(document).on("keyup paste","#wpo-wcpdf-settings input:not([type=checkbox]), #wpo-wcpdf-settings textarea, #wpo-wcpdf-settings select:not(.dropdown-add-field)",function(b){if(!i(a(this).attr("name"))){let a="keyup"==b.type?1e3:0;h(a)}}),a(document).on("click","#wpo-wcpdf-settings select:not(.dropdown-add-field) option",function(){i(a(this).parent().attr("name"))||h()}),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"]",function(b){i(a(this).attr("name"))||b.isTrigger||h(1e3)}),a(document).on("change","#wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(b){i(a(this).attr("name"))||b.isTrigger||h()}),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",function(){h()}),a(document).on("click",".wpo_remove_image_button",function(){h()}),a(document).on("wpo-wcpdf-settings-changed",function(a,b){g(),h(b)}),a(document).on("wpo-wcpdf-refresh-preview wpo_wcpdf_refresh_preview",function(a,b){h(b)}),a(document).on("click","#preview-order-search-results a",function(b){b.preventDefault(),a(".preview-document .order-search-label").text("#"+a(this).data("order_id")),v.val(a(this).data("order_id")).change(),a(this).closest("div").hide(),a(this).closest("div").children("a").remove(),h()}),a(document).on("keyup paste","#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea",g),a(document).on("click",".wpo_remove_image_button",g),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"], #wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(a){a.isTrigger||g(a)}),a(document).on("select2:select select2:unselect","#wpo-wcpdf-settings select.wc-enhanced-select",g),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",g),a(document).on("click",".preview-data-wrapper .save-settings p input",function(){a("#wpo-wcpdf-settings input#submit").click()}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault(),a(this).closest("div").find("input#preview-order-search").val(""),a(this).closest(".preview-data").find("#preview-order-search-results").children("a").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").hide(),a(this).hide()}),a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list li").on("click",function(){let b=a(this).closest("ul").data("input-name"),c=a("#wpo-wcpdf-preview-wrapper :input[name="+b+"]");c.val(a(this).data("value")).trigger("change")}),w.on("change",function(){let b=a(this).val();if(b.length){let c=a(this).attr("name"),d=a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list[data-input-name="+c+"]"),e=d.find("li[data-value="+b+"]");d.parent().find(".current-label").text(e.text()),h()}}).trigger("change"),v.on("change",function(){h()}).trigger("change"),a("#preview-order-search").on("keyup paste",function(c){let d=a(this);d.addClass("ajax-waiting");let e="keyup"==c.type?1e3:0;b(),clearTimeout(r),r=setTimeout(function(){l(d)},e)})});