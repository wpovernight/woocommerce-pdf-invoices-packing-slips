/*! For license information please see pdf.js.LICENSE.txt */
(()=>{"use strict";var t,e,n,i,a,r,s,o,l,h,u,c,d=["textContentSource","container","viewport"];function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e,n){e||(e=[]);var i=e.length++;return Object.defineProperty({},"_",{set:function(a){e[i]=a,t.apply(n,e)}})}function g(){return g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(arguments.length<3?t:n):a.value}},g.apply(null,arguments)}function y(t){return function(t){if(Array.isArray(t))return P(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||L(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){b(t,e),e.add(t)}function k(t,e,n){b(t,e),e.set(t,n)}function b(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(t,e,n){return n(C(t,e))}function A(t,e){return t.get(C(t,e))}function _(t,e,n){return t.set(C(t,e),n),n}function x(t,e,n){return(e=D(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function E(){E=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var r=e&&e.prototype instanceof y?e:y,s=Object.create(r.prototype),o=new L(i||[]);return a(s,"_invoke",{value:S(t,n,o)}),s}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",f="suspendedYield",v="executing",p="completed",g={};function y(){}function m(){}function k(){}var b={};h(b,s,(function(){return this}));var w=Object.getPrototypeOf,A=w&&w(w(P([])));A&&A!==n&&i.call(A,s)&&(b=A);var _=k.prototype=y.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(a,r,s,o){var l=c(t[a],t,r);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==z(u)&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,s,o)}),(function(t){n("throw",t,s,o)})):e.resolve(u).then((function(t){h.value=t,s(h)}),(function(t){return n("throw",t,s,o)}))}o(l.arg)}var r;a(this,"_invoke",{value:function(t,i){function a(){return new e((function(e,a){n(t,i,e,a)}))}return r=r?r.then(a,a):a()}})}function S(e,n,i){var a=d;return function(r,s){if(a===v)throw Error("Generator is already running");if(a===p){if("throw"===r)throw s;return{value:t,done:!0}}for(i.method=r,i.arg=s;;){var o=i.delegate;if(o){var l=C(o,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===d)throw a=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=v;var h=c(e,n,i);if("normal"===h.type){if(a=i.done?p:f,h.arg===g)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(a=p,i.method="throw",i.arg=h.arg)}}}function C(e,n){var i=n.method,a=e.iterator[i];if(a===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var r=c(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var s=r.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function n(){for(;++a<e.length;)if(i.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(z(e)+" is not iterable")}return m.prototype=k,a(_,"constructor",{value:k,configurable:!0}),a(k,"constructor",{value:m,configurable:!0}),m.displayName=h(k,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,h(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},x(M.prototype),h(M.prototype,o,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,i,a,r){void 0===r&&(r=Promise);var s=new M(u(t,n,i,a),r);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},x(_),h(_,l,"Generator"),h(_,s,(function(){return this})),h(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=P,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(i,a){return o.type="throw",o.arg=e,n.next=i,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(l&&h){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!h)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=t,s.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;R(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:P(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}function M(t,e,n,i,a,r,s){try{var o=t[r](s),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,a)}function S(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var r=t.apply(e,n);function s(t){M(r,i,a,s,o,"next",t)}function o(t){M(r,i,a,s,o,"throw",t)}s(void 0)}))}}function C(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function T(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,a,r,s,o=[],l=!0,h=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,a=t}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(h)throw a}}return o}}(t,e)||L(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=L(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw r}}}}function L(t,e){if(t){if("string"==typeof t)return P(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(t,e):void 0}}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,D(i.key),i)}}function F(t,e,n){return e&&I(t.prototype,e),n&&I(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function D(t){var e=function(t,e){if("object"!=z(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=z(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==z(e)?e:e+""}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e,n){return e=B(e),function(t,e){if(e&&("object"==z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,W()?Reflect.construct(e,n||[],B(t).constructor):e.apply(t,n))}function W(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(W=function(){return!!t})()}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&j(t,e)}function j(t,e){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},j(t,e)}function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}var G={d:function(t,e){for(var n in e)G.o(e,n)&&!G.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},V=globalThis.pdfjsLib={};G.d(V,{AbortException:function(){return bt},AnnotationEditorLayer:function(){return lf},AnnotationEditorParamsType:function(){return J},AnnotationEditorType:function(){return Q},AnnotationEditorUIManager:function(){return oi},AnnotationLayer:function(){return kh},AnnotationMode:function(){return Y},CMapCompressionType:function(){return et},ColorPicker:function(){return Xu},DOMSVGFactory:function(){return ue},DrawLayer:function(){return bf},FeatureTest:function(){return xt},GlobalWorkerOptions:function(){return Ar},ImageKind:function(){return $},InvalidPDFException:function(){return gt},MissingPDFException:function(){return yt},OPS:function(){return nt},Outliner:function(){return Kh},PDFDataRangeTransport:function(){return lo},PDFDateString:function(){return Ae},PDFWorker:function(){return wo},PasswordResponses:function(){return it},PermissionFlag:function(){return Z},PixelsPerInch:function(){return Bt},RenderingCancelledException:function(){return de},TextLayer:function(){return js},UnexpectedResponseException:function(){return mt},Util:function(){return Mt},VerbosityLevel:function(){return tt},XfaLayer:function(){return Uo},build:function(){return zo},createValidAbsoluteUrl:function(){return ct},fetchData:function(){return se},getDocument:function(){return ao},getFilenameFromUrl:function(){return pe},getPdfFilenameFromUrl:function(){return ge},getXfaPageViewport:function(){return _e},isDataScheme:function(){return fe},isPdfFile:function(){return ve},noContextMenu:function(){return be},normalizeUnicode:function(){return Lt},renderTextLayer:function(){return Qs},setLayerDimensions:function(){return Se},shadow:function(){return dt},updateTextLayer:function(){return Js},version:function(){return jo}});var q=!("object"!==("undefined"==typeof process?"undefined":z(process))||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),U=[1,0,0,1,0,0],X=[.001,0,0,.001,0,0],K=1.35,Y={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Q={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},J={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},Z={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},$={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},tt={ERRORS:0,WARNINGS:1,INFOS:5},et={NONE:0,BINARY:1},nt={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},it={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},at=tt.WARNINGS;function rt(t){Number.isInteger(t)&&(at=t)}function st(){return at}function ot(t){at>=tt.INFOS&&console.log("Info: ".concat(t))}function lt(t){at>=tt.WARNINGS&&console.log("Warning: ".concat(t))}function ht(t){throw new Error(t)}function ut(t,e){t||ht(e)}function ct(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;try{if(n&&"string"==typeof t){if(n.addDefaultProtocol&&t.startsWith("www.")){var i=t.match(/\./g);(null==i?void 0:i.length)>=2&&(t="http://".concat(t))}if(n.tryConvertEncoding)try{t=decodeURIComponent(escape(t))}catch(t){}}var a=e?new URL(t,e):new URL(t);if(function(t){switch(null==t?void 0:t.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(a))return a}catch(t){}return null}function dt(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!0,writable:!1}),n}var ft=function(){function t(e,n){this.constructor===t&&ht("Cannot initialize BaseException."),this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t}(),vt=function(t){function e(t,n){var i;return N(this,e),(i=O(this,e,[t,"PasswordException"])).code=n,i}return H(e,t),F(e)}(ft),pt=function(t){function e(t,n){var i;return N(this,e),(i=O(this,e,[t,"UnknownErrorException"])).details=n,i}return H(e,t),F(e)}(ft),gt=function(t){function e(t){return N(this,e),O(this,e,[t,"InvalidPDFException"])}return H(e,t),F(e)}(ft),yt=function(t){function e(t){return N(this,e),O(this,e,[t,"MissingPDFException"])}return H(e,t),F(e)}(ft),mt=function(t){function e(t,n){var i;return N(this,e),(i=O(this,e,[t,"UnexpectedResponseException"])).status=n,i}return H(e,t),F(e)}(ft),kt=function(t){function e(t){return N(this,e),O(this,e,[t,"FormatError"])}return H(e,t),F(e)}(ft),bt=function(t){function e(t){return N(this,e),O(this,e,[t,"AbortException"])}return H(e,t),F(e)}(ft);function wt(t){"object"===z(t)&&void 0!==(null==t?void 0:t.length)||ht("Invalid argument for bytesToString");var e=t.length,n=8192;if(e<n)return String.fromCharCode.apply(null,t);for(var i=[],a=0;a<e;a+=n){var r=Math.min(a+n,e),s=t.subarray(a,r);i.push(String.fromCharCode.apply(null,s))}return i.join("")}function At(t){"string"!=typeof t&&ht("Invalid argument for stringToBytes");for(var e=t.length,n=new Uint8Array(e),i=0;i<e;++i)n[i]=255&t.charCodeAt(i);return n}function _t(t){var e,n=Object.create(null),i=R(t);try{for(i.s();!(e=i.n()).done;){var a=T(e.value,2),r=a[0],s=a[1];n[r]=s}}catch(t){i.e(t)}finally{i.f()}return n}var xt=function(){return F((function t(){N(this,t)}),null,[{key:"isLittleEndian",get:function(){return dt(this,"isLittleEndian",((t=new Uint8Array(4))[0]=1,1===new Uint32Array(t.buffer,0,1)[0]));var t}},{key:"isEvalSupported",get:function(){return dt(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(t){return!1}}())}},{key:"isOffscreenCanvasSupported",get:function(){return dt(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}},{key:"platform",get:function(){var t;return"undefined"!=typeof navigator&&"string"==typeof(null===(t=navigator)||void 0===t?void 0:t.platform)?dt(this,"platform",{isMac:navigator.platform.includes("Mac")}):dt(this,"platform",{isMac:!1})}},{key:"isCSSRoundSupported",get:function(){var t,e;return dt(this,"isCSSRoundSupported",null===(t=globalThis.CSS)||void 0===t||null===(e=t.supports)||void 0===e?void 0:e.call(t,"width: round(1.5px, 1px)"))}}])}(),Et=Array.from(Array(256).keys(),(function(t){return t.toString(16).padStart(2,"0")})),Mt=function(){function t(){N(this,t)}return F(t,null,[{key:"makeHexColor",value:function(t,e,n){return"#".concat(Et[t]).concat(Et[e]).concat(Et[n])}},{key:"scaleMinMax",value:function(t,e){var n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}},{key:"transform",value:function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}},{key:"applyTransform",value:function(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"applyInverseTransform",value:function(t,e){var n=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/n,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/n]}},{key:"getAxialAlignedBoundingBox",value:function(t,e){var n=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),a=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(n[0],i[0],a[0],r[0]),Math.min(n[1],i[1],a[1],r[1]),Math.max(n[0],i[0],a[0],r[0]),Math.max(n[1],i[1],a[1],r[1])]}},{key:"inverseTransform",value:function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}},{key:"singularValueDecompose2dScale",value:function(t){var e=[t[0],t[2],t[1],t[3]],n=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],a=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],s=(n+r)/2,o=Math.sqrt(Math.pow(n+r,2)-4*(n*r-a*i))/2,l=s+o||1,h=s-o||1;return[Math.sqrt(l),Math.sqrt(h)]}},{key:"normalizeRect",value:function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}},{key:"intersect",value:function(t,e){var n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>i)return null;var a=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return a>r?null:[n,a,i,r]}},{key:"bezierBoundingBox",value:function(e,n,i,a,r,s,o,l,h){return h?(h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],n,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],n,l)):h=[Math.min(e,o),Math.min(n,l),Math.max(e,o),Math.max(n,l)],C(t,this,Ct).call(this,e,i,r,o,n,a,s,l,3*(3*(i-r)-e+o),6*(e-2*i+r),3*(i-e),h),C(t,this,Ct).call(this,e,i,r,o,n,a,s,l,3*(3*(a-s)-n+l),6*(n-2*a+s),3*(a-n),h),h}}])}();function St(t,e,n,i,a,r,s,o,l,h){if(!(l<=0||l>=1)){var u=1-l,c=l*l,d=c*l,f=u*(u*(u*t+3*l*e)+3*c*n)+d*i,v=u*(u*(u*a+3*l*r)+3*c*s)+d*o;h[0]=Math.min(h[0],f),h[1]=Math.min(h[1],v),h[2]=Math.max(h[2],f),h[3]=Math.max(h[3],v)}}function Ct(e,n,i,a,r,s,o,l,h,u,c,d){if(Math.abs(h)<1e-12)Math.abs(u)>=1e-12&&C(t,this,St).call(this,e,n,i,a,r,s,o,l,-c/u,d);else{var f=Math.pow(u,2)-4*c*h;if(!(f<0)){var v=Math.sqrt(f),p=2*h;C(t,this,St).call(this,e,n,i,a,r,s,o,l,(-u+v)/p,d),C(t,this,St).call(this,e,n,i,a,r,s,o,l,(-u-v)/p,d)}}}t=Mt;var Tt=null,Rt=null;function Lt(t){return Tt||(Tt=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g,Rt=new Map([["ﬅ","ſt"]])),t.replaceAll(Tt,(function(t,e,n){return e?e.normalize("NFKC"):Rt.get(n)}))}var Pt="pdfjs_internal_id_",It=function(){return F((function t(){N(this,t),this.constructor===t&&ht("Cannot initialize BaseFilterFactory.")}),[{key:"addFilter",value:function(t){return"none"}},{key:"addHCMFilter",value:function(t,e){return"none"}},{key:"addAlphaFilter",value:function(t){return"none"}},{key:"addLuminosityFilter",value:function(t){return"none"}},{key:"addHighlightHCMFilter",value:function(t,e,n,i,a){return"none"}},{key:"destroy",value:function(){}}])}(),Ft=function(){return F((function t(){N(this,t),this.constructor===t&&ht("Cannot initialize BaseCanvasFactory.")}),[{key:"create",value:function(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");var n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d")}}},{key:"reset",value:function(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}},{key:"destroy",value:function(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}},{key:"_createCanvas",value:function(t,e){ht("Abstract method `_createCanvas` called.")}}])}(),Dt=function(){return F((function t(e){var n=e.baseUrl,i=void 0===n?null:n,a=e.isCompressed,r=void 0===a||a;N(this,t),this.constructor===t&&ht("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=i,this.isCompressed=r}),[{key:"fetch",value:(t=S(E().mark((function t(e){var n,i,a,r=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.name,this.baseUrl){t.next=3;break}throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');case 3:if(n){t.next=5;break}throw new Error("CMap name must be specified.");case 5:return i=this.baseUrl+n+(this.isCompressed?".bcmap":""),a=this.isCompressed?et.BINARY:et.NONE,t.abrupt("return",this._fetchData(i,a).catch((function(t){throw new Error("Unable to load ".concat(r.isCompressed?"binary ":"","CMap at: ").concat(i))})));case 8:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"_fetchData",value:function(t,e){ht("Abstract method `_fetchData` called.")}}]);var t}(),Nt=function(){return F((function t(e){var n=e.baseUrl,i=void 0===n?null:n;N(this,t),this.constructor===t&&ht("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=i}),[{key:"fetch",value:(t=S(E().mark((function t(e){var n,i;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.filename,this.baseUrl){t.next=3;break}throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');case 3:if(n){t.next=5;break}throw new Error("Font filename must be specified.");case 5:return i="".concat(this.baseUrl).concat(n),t.abrupt("return",this._fetchData(i).catch((function(t){throw new Error("Unable to load font data at: ".concat(i))})));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"_fetchData",value:function(t){ht("Abstract method `_fetchData` called.")}}]);var t}(),Ot=function(){return F((function t(){N(this,t),this.constructor===t&&ht("Cannot initialize BaseSVGFactory.")}),[{key:"create",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");var i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width","".concat(t,"px")),i.setAttribute("height","".concat(e,"px"))),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox","0 0 ".concat(t," ").concat(e)),i}},{key:"createElement",value:function(t){if("string"!=typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}},{key:"_createSVG",value:function(t){ht("Abstract method `_createSVG` called.")}}])}(),Wt="http://www.w3.org/2000/svg",Bt=F((function t(){N(this,t)}));e=Bt,x(Bt,"CSS",96),x(Bt,"PDF",72),x(Bt,"PDF_TO_CSS_UNITS",e.CSS/e.PDF);var Ht=new WeakMap,jt=new WeakMap,zt=new WeakMap,Gt=new WeakMap,Vt=new WeakMap,qt=new WeakMap,Ut=new WeakSet,Xt=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.docId,a=n.ownerDocument,r=void 0===a?globalThis.document:a;return N(this,e),m(t=O(this,e),Ut),k(t,Ht,void 0),k(t,jt,void 0),k(t,zt,void 0),k(t,Gt,void 0),k(t,Vt,void 0),k(t,qt,0),_(zt,t,i),_(Gt,t,r),t}return H(e,t),F(e,[{key:"addFilter",value:function(t){var e,n;if(!t)return"none";var i=w(Ut,this,Kt).get(t);if(i)return i;var a=T(C(Ut,this,Jt).call(this,t),3),r=a[0],s=a[1],o=a[2],l=1===t.length?r:"".concat(r).concat(s).concat(o);if(i=w(Ut,this,Kt).get(l))return w(Ut,this,Kt).set(t,i),i;var h="g_".concat(A(zt,this),"_transfer_map_").concat((_(qt,this,(e=A(qt,this),n=e++,e)),n)),u="url(#".concat(h,")");w(Ut,this,Kt).set(t,u),w(Ut,this,Kt).set(l,u);var c=C(Ut,this,te).call(this,h);return C(Ut,this,ne).call(this,r,s,o,c),u}},{key:"addHCMFilter",value:function(t,e){var n,i,a="".concat(t,"-").concat(e),r="base",s=w(Ut,this,Yt).get(r);if((null===(n=s)||void 0===n?void 0:n.key)===a)return s.url;if(s?(null===(i=s.filter)||void 0===i||i.remove(),s.key=a,s.url="none",s.filter=null):(s={key:a,url:"none",filter:null},w(Ut,this,Yt).set(r,s)),!t||!e)return s.url;var o=C(Ut,this,ae).call(this,t);t=Mt.makeHexColor.apply(Mt,y(o));var l=C(Ut,this,ae).call(this,e);if(e=Mt.makeHexColor.apply(Mt,y(l)),w(Ut,this,Qt).style.color="","#000000"===t&&"#ffffff"===e||t===e)return s.url;for(var h=new Array(256),u=0;u<=255;u++){var c=u/255;h[u]=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)}var d=h.join(","),f="g_".concat(A(zt,this),"_hcm_filter"),v=s.filter=C(Ut,this,te).call(this,f);C(Ut,this,ne).call(this,d,d,d,v),C(Ut,this,$t).call(this,v);var p=function(t,e){for(var n=o[t]/255,i=l[t]/255,a=new Array(e+1),r=0;r<=e;r++)a[r]=n+r/e*(i-n);return a.join(",")};return C(Ut,this,ne).call(this,p(0,5),p(1,5),p(2,5),v),s.url="url(#".concat(f,")"),s.url}},{key:"addAlphaFilter",value:function(t){var e,n,i=w(Ut,this,Kt).get(t);if(i)return i;var a=T(C(Ut,this,Jt).call(this,[t]),1)[0],r="alpha_".concat(a);if(i=w(Ut,this,Kt).get(r))return w(Ut,this,Kt).set(t,i),i;var s="g_".concat(A(zt,this),"_alpha_map_").concat((_(qt,this,(e=A(qt,this),n=e++,e)),n)),o="url(#".concat(s,")");w(Ut,this,Kt).set(t,o),w(Ut,this,Kt).set(r,o);var l=C(Ut,this,te).call(this,s);return C(Ut,this,ie).call(this,a,l),o}},{key:"addLuminosityFilter",value:function(t){var e,n,i,a,r=w(Ut,this,Kt).get(t||"luminosity");if(r)return r;if(t?(i=T(C(Ut,this,Jt).call(this,[t]),1)[0],a="luminosity_".concat(i)):a="luminosity",r=w(Ut,this,Kt).get(a))return w(Ut,this,Kt).set(t,r),r;var s="g_".concat(A(zt,this),"_luminosity_map_").concat((_(qt,this,(e=A(qt,this),n=e++,e)),n)),o="url(#".concat(s,")");w(Ut,this,Kt).set(t,o),w(Ut,this,Kt).set(a,o);var l=C(Ut,this,te).call(this,s);return C(Ut,this,Zt).call(this,l),t&&C(Ut,this,ie).call(this,i,l),o}},{key:"addHighlightHCMFilter",value:function(t,e,n,i,a){var r,s,o="".concat(e,"-").concat(n,"-").concat(i,"-").concat(a),l=w(Ut,this,Yt).get(t);if((null===(r=l)||void 0===r?void 0:r.key)===o)return l.url;if(l?(null===(s=l.filter)||void 0===s||s.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},w(Ut,this,Yt).set(t,l)),!e||!n)return l.url;var h=T([e,n].map(C(Ut,this,ae).bind(this)),2),u=h[0],c=h[1],d=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),v=T([i,a].map(C(Ut,this,ae).bind(this)),2),p=v[0],g=v[1];if(f<d){var y=[f,d,g,p];d=y[0],f=y[1],p=y[2],g=y[3]}w(Ut,this,Qt).style.color="";var m=function(t,e,n){for(var i=new Array(256),a=(f-d)/n,r=t/255,s=(e-t)/(255*n),o=0,l=0;l<=n;l++){for(var h=Math.round(d+l*a),u=r+l*s,c=o;c<=h;c++)i[c]=u;o=h+1}for(var v=o;v<256;v++)i[v]=i[o-1];return i.join(",")},k="g_".concat(A(zt,this),"_hcm_").concat(t,"_filter"),b=l.filter=C(Ut,this,te).call(this,k);return C(Ut,this,$t).call(this,b),C(Ut,this,ne).call(this,m(p[0],g[0],5),m(p[1],g[1],5),m(p[2],g[2],5),b),l.url="url(#".concat(k,")"),l.url}},{key:"destroy",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&0!==w(Ut,this,Yt).size||(A(jt,this)&&(A(jt,this).parentNode.parentNode.remove(),_(jt,this,null)),A(Ht,this)&&(A(Ht,this).clear(),_(Ht,this,null)),_(qt,this,0))}}])}(It);function Kt(t){return A(Ht,t)||_(Ht,t,new Map)}function Yt(t){return A(Vt,t)||_(Vt,t,new Map)}function Qt(t){if(!A(jt,t)){var e=A(Gt,t).createElement("div"),n=e.style;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;var i=A(Gt,t).createElementNS(Wt,"svg");i.setAttribute("width",0),i.setAttribute("height",0),_(jt,t,A(Gt,t).createElementNS(Wt,"defs")),e.append(i),i.append(A(jt,t)),A(Gt,t).body.append(e)}return A(jt,t)}function Jt(t){if(1===t.length){for(var e=t[0],n=new Array(256),i=0;i<256;i++)n[i]=e[i]/255;var a=n.join(",");return[a,a,a]}for(var r=T(t,3),s=r[0],o=r[1],l=r[2],h=new Array(256),u=new Array(256),c=new Array(256),d=0;d<256;d++)h[d]=s[d]/255,u[d]=o[d]/255,c[d]=l[d]/255;return[h.join(","),u.join(","),c.join(",")]}function Zt(t){var e=A(Gt,this).createElementNS(Wt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}function $t(t){var e=A(Gt,this).createElementNS(Wt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}function te(t){var e=A(Gt,this).createElementNS(Wt,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),w(Ut,this,Qt).append(e),e}function ee(t,e,n){var i=A(Gt,this).createElementNS(Wt,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),t.append(i)}function ne(t,e,n,i){var a=A(Gt,this).createElementNS(Wt,"feComponentTransfer");i.append(a),C(Ut,this,ee).call(this,a,"feFuncR",t),C(Ut,this,ee).call(this,a,"feFuncG",e),C(Ut,this,ee).call(this,a,"feFuncB",n)}function ie(t,e){var n=A(Gt,this).createElementNS(Wt,"feComponentTransfer");e.append(n),C(Ut,this,ee).call(this,n,"feFuncA",t)}function ae(t){return w(Ut,this,Qt).style.color=t,xe(getComputedStyle(w(Ut,this,Qt)).getPropertyValue("color"))}var re=function(t){function e(){var t,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ownerDocument,i=void 0===n?globalThis.document:n;return N(this,e),(t=O(this,e))._document=i,t}return H(e,t),F(e,[{key:"_createCanvas",value:function(t,e){var n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}])}(Ft);function se(t){return oe.apply(this,arguments)}function oe(){return oe=S(E().mark((function t(e){var n,i,a=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:"text",!ke(e,document.baseURI)){t.next=14;break}return t.next=4,fetch(e);case 4:if((i=t.sent).ok){t.next=7;break}throw new Error(i.statusText);case 7:t.t0=n,t.next="arraybuffer"===t.t0?10:"blob"===t.t0?11:"json"===t.t0?12:13;break;case 10:return t.abrupt("return",i.arrayBuffer());case 11:return t.abrupt("return",i.blob());case 12:return t.abrupt("return",i.json());case 13:return t.abrupt("return",i.text());case 14:return t.abrupt("return",new Promise((function(t,i){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=n,a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200!==a.status&&0!==a.status)i(new Error(a.statusText));else{switch(n){case"arraybuffer":case"blob":case"json":return void t(a.response)}t(a.responseText)}},a.send(null)})));case 15:case"end":return t.stop()}}),t)}))),oe.apply(this,arguments)}var le=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"_fetchData",value:function(t,e){return se(t,this.isCompressed?"arraybuffer":"text").then((function(t){return{cMapData:t instanceof ArrayBuffer?new Uint8Array(t):At(t),compressionType:e}}))}}])}(Dt),he=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"_fetchData",value:function(t){return se(t,"arraybuffer").then((function(t){return new Uint8Array(t)}))}}])}(Nt),ue=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"_createSVG",value:function(t){return document.createElementNS(Wt,t)}}])}(Ot),ce=function(){function t(e){var n=e.viewBox,i=e.scale,a=e.rotation,r=e.offsetX,s=void 0===r?0:r,o=e.offsetY,l=void 0===o?0:o,h=e.dontFlip,u=void 0!==h&&h;N(this,t),this.viewBox=n,this.scale=i,this.rotation=a,this.offsetX=s,this.offsetY=l;var c,d,f,v,p,g,y,m,k=(n[2]+n[0])/2,b=(n[3]+n[1])/2;switch((a%=360)<0&&(a+=360),a){case 180:c=-1,d=0,f=0,v=1;break;case 90:c=0,d=1,f=1,v=0;break;case 270:c=0,d=-1,f=-1,v=0;break;case 0:c=1,d=0,f=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}u&&(f=-f,v=-v),0===c?(p=Math.abs(b-n[1])*i+s,g=Math.abs(k-n[0])*i+l,y=(n[3]-n[1])*i,m=(n[2]-n[0])*i):(p=Math.abs(k-n[0])*i+s,g=Math.abs(b-n[1])*i+l,y=(n[2]-n[0])*i,m=(n[3]-n[1])*i),this.transform=[c*i,d*i,f*i,v*i,p-c*i*k-f*i*b,g-d*i*k-v*i*b],this.width=y,this.height=m}return F(t,[{key:"rawDims",get:function(){var t=this.viewBox;return dt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.scale,i=void 0===n?this.scale:n,a=e.rotation,r=void 0===a?this.rotation:a,s=e.offsetX,o=void 0===s?this.offsetX:s,l=e.offsetY,h=void 0===l?this.offsetY:l,u=e.dontFlip,c=void 0!==u&&u;return new t({viewBox:this.viewBox.slice(),scale:i,rotation:r,offsetX:o,offsetY:h,dontFlip:c})}},{key:"convertToViewportPoint",value:function(t,e){return Mt.applyTransform([t,e],this.transform)}},{key:"convertToViewportRectangle",value:function(t){var e=Mt.applyTransform([t[0],t[1]],this.transform),n=Mt.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],n[0],n[1]]}},{key:"convertToPdfPoint",value:function(t,e){return Mt.applyInverseTransform([t,e],this.transform)}}])}(),de=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N(this,e),(n=O(this,e,[t,"RenderingCancelledException"])).extraDelay=i,n}return H(e,t),F(e)}(ft);function fe(t){for(var e=t.length,n=0;n<e&&""===t[n].trim();)n++;return"data:"===t.substring(n,n+5).toLowerCase()}function ve(t){return"string"==typeof t&&/\.pdf$/i.test(t)}function pe(t){var e=t.split(/[#?]/,1);return(t=T(e,1)[0]).substring(t.lastIndexOf("/")+1)}function ge(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!=typeof t)return e;if(fe(t))return lt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;var n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(t),a=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(a&&(a=a[0]).includes("%"))try{a=n.exec(decodeURIComponent(a))[0]}catch(t){}return a||e}var ye,me=function(){return F((function t(){N(this,t),x(this,"started",Object.create(null)),x(this,"times",[])}),[{key:"time",value:function(t){t in this.started&&lt("Timer is already running for ".concat(t)),this.started[t]=Date.now()}},{key:"timeEnd",value:function(t){t in this.started||lt("Timer has not been started for ".concat(t)),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}},{key:"toString",value:function(){var t,e=[],n=0,i=R(this.times);try{for(i.s();!(t=i.n()).done;){var a=t.value.name;n=Math.max(a.length,n)}}catch(t){i.e(t)}finally{i.f()}var r,s=R(this.times);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=o.name,h=o.start,u=o.end;e.push("".concat(l.padEnd(n)," ").concat(u-h,"ms\n"))}}catch(t){s.e(t)}finally{s.f()}return e.join("")}}])}();function ke(t,e){try{var n=(e?new URL(t,e):new URL(t)).protocol;return"http:"===n||"https:"===n}catch(t){return!1}}function be(t){t.preventDefault()}function we(t){console.log("Deprecated API usage: "+t)}var Ae=function(){return F((function t(){N(this,t)}),null,[{key:"toDateObject",value:function(t){if(!t||"string"!=typeof t)return null;ye||(ye=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));var e=ye.exec(t);if(!e)return null;var n=parseInt(e[1],10),i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;var a=parseInt(e[3],10);a=a>=1&&a<=31?a:1;var r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;var s=parseInt(e[5],10);s=s>=0&&s<=59?s:0;var o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;var l=e[7]||"Z",h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;var u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,"-"===l?(r+=h,s+=u):"+"===l&&(r-=h,s-=u),new Date(Date.UTC(n,i,a,r,s,o))}}])}();function _e(t,e){var n=e.scale,i=void 0===n?1:n,a=e.rotation,r=void 0===a?0:a,s=t.attributes.style,o=s.width,l=s.height,h=[0,0,parseInt(o),parseInt(l)];return new ce({viewBox:h,scale:i,rotation:r})}function xe(t){if(t.startsWith("#")){var e=parseInt(t.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}return t.startsWith("rgb(")?t.slice(4,-1).split(",").map((function(t){return parseInt(t)})):t.startsWith("rgba(")?t.slice(5,-1).split(",").map((function(t){return parseInt(t)})).slice(0,3):(lt('Not a valid color format: "'.concat(t,'"')),[0,0,0])}function Ee(t){var e=t.getTransform();return[e.a,e.b,e.c,e.d,e.e,e.f]}function Me(t){var e=t.getTransform().invertSelf();return[e.a,e.b,e.c,e.d,e.e,e.f]}function Se(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e instanceof ce){var a=e.rawDims,r=a.pageWidth,s=a.pageHeight,o=t.style,l=xt.isCSSRoundSupported,h="var(--scale-factor) * ".concat(r,"px"),u="var(--scale-factor) * ".concat(s,"px"),c=l?"round(".concat(h,", 1px)"):"calc(".concat(h,")"),d=l?"round(".concat(u,", 1px)"):"calc(".concat(u,")");n&&e.rotation%180!=0?(o.width=d,o.height=c):(o.width=c,o.height=d)}i&&t.setAttribute("data-main-rotation",e.rotation)}var Ce=new WeakMap,Te=new WeakMap,Re=new WeakMap,Le=new WeakMap,Pe=new WeakSet,Ie=function(){return F((function t(e){N(this,t),m(this,Pe),k(this,Ce,null),k(this,Te,null),k(this,Re,void 0),k(this,Le,null),_(Re,this,e)}),[{key:"render",value:function(){var t=_(Ce,this,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",be),t.addEventListener("pointerdown",Fe);var e=_(Le,this,document.createElement("div"));e.className="buttons",t.append(e);var n=A(Re,this).toolbarPosition;if(n){var i=t.style,a="ltr"===A(Re,this)._uiManager.direction?1-n[0]:n[0];i.insetInlineEnd="".concat(100*a,"%"),i.top="calc(".concat(100*n[1],"% + var(--editor-toolbar-vert-offset))")}return C(Pe,this,We).call(this),t}},{key:"hide",value:function(){var t;A(Ce,this).classList.add("hidden"),null===(t=A(Te,this))||void 0===t||t.hideDropdown()}},{key:"show",value:function(){A(Ce,this).classList.remove("hidden")}},{key:"addAltTextButton",value:function(t){C(Pe,this,Oe).call(this,t),A(Le,this).prepend(t,w(Pe,this,Be))}},{key:"addColorPicker",value:function(t){_(Te,this,t);var e=t.renderButton();C(Pe,this,Oe).call(this,e),A(Le,this).prepend(e,w(Pe,this,Be))}},{key:"remove",value:function(){var t;A(Ce,this).remove(),null===(t=A(Te,this))||void 0===t||t.destroy(),_(Te,this,null)}}])}();function Fe(t){t.stopPropagation()}function De(t){A(Re,this)._focusEventsAllowed=!1,t.preventDefault(),t.stopPropagation()}function Ne(t){A(Re,this)._focusEventsAllowed=!0,t.preventDefault(),t.stopPropagation()}function Oe(t){t.addEventListener("focusin",C(Pe,this,De).bind(this),{capture:!0}),t.addEventListener("focusout",C(Pe,this,Ne).bind(this),{capture:!0}),t.addEventListener("contextmenu",be)}function We(){var t=this,e=document.createElement("button");e.className="delete",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-editor-remove-".concat(A(Re,this).editorType,"-button")),C(Pe,this,Oe).call(this,e),e.addEventListener("click",(function(e){A(Re,t)._uiManager.delete()})),A(Le,this).append(e)}function Be(t){var e=document.createElement("div");return e.className="divider",e}var He=new WeakMap,je=new WeakMap,ze=new WeakMap,Ge=new WeakSet,Ve=function(){return F((function t(e){N(this,t),m(this,Ge),k(this,He,null),k(this,je,null),k(this,ze,void 0),_(ze,this,e)}),[{key:"show",value:function(t,e,n){var i=T(C(Ge,this,Ue).call(this,e,n),2),a=i[0],r=i[1],s=(A(je,this)||_(je,this,C(Ge,this,qe).call(this))).style;t.append(A(je,this)),s.insetInlineEnd="".concat(100*a,"%"),s.top="calc(".concat(100*r,"% + var(--editor-toolbar-vert-offset))")}},{key:"hide",value:function(){A(je,this).remove()}}])}();function qe(){var t=_(je,this,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",be);var e=_(He,this,document.createElement("div"));return e.className="buttons",t.append(e),C(Ge,this,Xe).call(this),t}function Ue(t,e){var n,i=0,a=0,r=R(t);try{for(r.s();!(n=r.n()).done;){var s=n.value,o=s.y+s.height;if(!(o<i)){var l=s.x+(e?s.width:0);o>i?(a=l,i=o):e?l>a&&(a=l):l<a&&(a=l)}}}catch(t){r.e(t)}finally{r.f()}return[e?1-a:a,i]}function Xe(){var t=this,e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");var n=document.createElement("span");e.append(n),n.className="visuallyHidden",n.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label"),e.addEventListener("contextmenu",be),e.addEventListener("click",(function(){A(ze,t).highlightSelection("floating_button")})),A(He,this).append(e)}function Ke(t,e,n){var i,a=R(n);try{for(a.s();!(i=a.n()).done;){var r=i.value;e.addEventListener(r,t[r].bind(t))}}catch(t){a.e(t)}finally{a.f()}}var Ye=new WeakMap,Qe=function(){return F((function t(){N(this,t),k(this,Ye,0)}),[{key:"id",get:function(){var t,e;return"".concat("pdfjs_internal_editor_").concat((_(Ye,this,(t=A(Ye,this),e=t++,t)),e))}}])}(),Je=new WeakMap,Ze=new WeakMap,$e=new WeakMap,tn=new WeakSet,en=function(){return F((function t(){N(this,t),m(this,tn),k(this,Je,function(){var t,e;if("undefined"!=typeof crypto&&"function"==typeof(null===(t=crypto)||void 0===t?void 0:t.randomUUID))return crypto.randomUUID();var n=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof(null===(e=crypto)||void 0===e?void 0:e.getRandomValues))crypto.getRandomValues(n);else for(var i=0;i<32;i++)n[i]=Math.floor(255*Math.random());return wt(n)}()),k(this,Ze,0),k(this,$e,null)}),[{key:"getFromFile",value:(n=S(E().mark((function t(e){var n,i,a,r;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.lastModified,i=e.name,a=e.size,r=e.type,t.abrupt("return",C(tn,this,nn).call(this,"".concat(n,"_").concat(i,"_").concat(a,"_").concat(r),e));case 2:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"getFromUrl",value:(e=S(E().mark((function t(e){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",C(tn,this,nn).call(this,e,e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getFromId",value:(t=S(E().mark((function t(e){var n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(A($e,this)||_($e,this,new Map),n=A($e,this).get(e)){t.next=4;break}return t.abrupt("return",null);case 4:if(!n.bitmap){t.next=7;break}return n.refCounter+=1,t.abrupt("return",n);case 7:if(!n.file){t.next=9;break}return t.abrupt("return",this.getFromFile(n.file));case 9:return t.abrupt("return",this.getFromUrl(n.url));case 10:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSvgUrl",value:function(t){var e=A($e,this).get(t);return null!=e&&e.isSvg?e.svgUrl:null}},{key:"deleteId",value:function(t){A($e,this)||_($e,this,new Map);var e=A($e,this).get(t);e&&(e.refCounter-=1,0===e.refCounter&&(e.bitmap=null))}},{key:"isValidId",value:function(t){return t.startsWith("image_".concat(A(Je,this),"_"))}}],[{key:"_isSVGFittingCanvas",get:function(){var t=new OffscreenCanvas(1,3).getContext("2d"),e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',dt(this,"_isSVGFittingCanvas",e.decode().then((function(){return t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]})))}}]);var t,e,n}();function nn(t,e){return an.apply(this,arguments)}function an(){return(an=S(E().mark((function t(e,i){var a,r,s,o,l,h,u,c,d;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(A($e,this)||_($e,this,new Map),null!==(r=A($e,this).get(e))){t.next=4;break}return t.abrupt("return",null);case 4:if(null===(a=r)||void 0===a||!a.bitmap){t.next=7;break}return r.refCounter+=1,t.abrupt("return",r);case 7:if(t.prev=7,r||(r={bitmap:null,id:"image_".concat(A(Je,this),"_").concat((_(Ze,this,(s=A(Ze,this),o=s++,s)),o)),refCounter:0,isSvg:!1}),"string"!=typeof i){t.next=16;break}return r.url=i,t.next=13,se(i,"blob");case 13:l=t.sent,t.next=17;break;case 16:l=r.file=i;case 17:if("image/svg+xml"!==l.type){t.next=27;break}return h=n._isSVGFittingCanvas,u=new FileReader,c=new Image,d=new Promise((function(t,e){c.onload=function(){r.bitmap=c,r.isSvg=!0,t()},u.onload=S(E().mark((function t(){var e;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.svgUrl=u.result,t.next=3,h;case 3:if(!t.sent){t.next=7;break}t.t0="".concat(e,"#svgView(preserveAspectRatio(none))"),t.next=8;break;case 7:t.t0=e;case 8:c.src=t.t0;case 9:case"end":return t.stop()}}),t)}))),c.onerror=u.onerror=e})),u.readAsDataURL(l),t.next=25,d;case 25:t.next=30;break;case 27:return t.next=29,createImageBitmap(l);case 29:r.bitmap=t.sent;case 30:r.refCounter=1,t.next=37;break;case 33:t.prev=33,t.t0=t.catch(7),console.error(t.t0),r=null;case 37:return A($e,this).set(e,r),r&&A($e,this).set(r.id,r),t.abrupt("return",r);case 40:case"end":return t.stop()}}),t,this,[[7,33]])})))).apply(this,arguments)}n=en;var rn=new WeakMap,sn=new WeakMap,on=new WeakMap,ln=new WeakMap,hn=function(){return F((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;N(this,t),k(this,rn,[]),k(this,sn,!1),k(this,on,void 0),k(this,ln,-1),_(on,this,e)}),[{key:"add",value:function(t){var e=t.cmd,n=t.undo,i=t.post,a=t.mustExec,r=t.type,s=void 0===r?NaN:r,o=t.overwriteIfSameType,l=void 0!==o&&o,h=t.keepUndo,u=void 0!==h&&h;if(a&&e(),!A(sn,this)){var c={cmd:e,undo:n,post:i,type:s};if(-1===A(ln,this))return A(rn,this).length>0&&(A(rn,this).length=0),_(ln,this,0),void A(rn,this).push(c);if(l&&A(rn,this)[A(ln,this)].type===s)return u&&(c.undo=A(rn,this)[A(ln,this)].undo),void(A(rn,this)[A(ln,this)]=c);var d=A(ln,this)+1;d===A(on,this)?A(rn,this).splice(0,1):(_(ln,this,d),d<A(rn,this).length&&A(rn,this).splice(d)),A(rn,this).push(c)}}},{key:"undo",value:function(){if(-1!==A(ln,this)){_(sn,this,!0);var t=A(rn,this)[A(ln,this)],e=t.undo,n=t.post;e(),null==n||n(),_(sn,this,!1),_(ln,this,A(ln,this)-1)}}},{key:"redo",value:function(){if(A(ln,this)<A(rn,this).length-1){_(ln,this,A(ln,this)+1),_(sn,this,!0);var t=A(rn,this)[A(ln,this)],e=t.cmd,n=t.post;e(),null==n||n(),_(sn,this,!1)}}},{key:"hasSomethingToUndo",value:function(){return-1!==A(ln,this)}},{key:"hasSomethingToRedo",value:function(){return A(ln,this)<A(rn,this).length-1}},{key:"destroy",value:function(){_(rn,this,null)}}])}(),un=new WeakSet,cn=function(){return F((function t(e){N(this,t),m(this,un),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;var n,i=xt.platform.isMac,a=R(e);try{for(a.s();!(n=a.n()).done;){var r,s=T(n.value,3),o=s[0],l=s[1],h=s[2],u=void 0===h?{}:h,c=R(o);try{for(c.s();!(r=c.n()).done;){var d=r.value,f=d.startsWith("mac+");i&&f?(this.callbacks.set(d.slice(4),{callback:l,options:u}),this.allKeys.add(d.split("+").at(-1))):i||f||(this.callbacks.set(d,{callback:l,options:u}),this.allKeys.add(d.split("+").at(-1)))}}catch(t){c.e(t)}finally{c.f()}}}catch(t){a.e(t)}finally{a.f()}}),[{key:"exec",value:function(t,e){if(this.allKeys.has(e.key)){var n=this.callbacks.get(C(un,this,dn).call(this,e));if(n){var i=n.callback,a=n.options,r=a.bubbles,s=void 0!==r&&r,o=a.args,l=void 0===o?[]:o,h=a.checker,u=void 0===h?null:h;u&&!u(t,e)||(i.bind.apply(i,[t].concat(y(l),[e]))(),s||(e.stopPropagation(),e.preventDefault()))}}}}])}();function dn(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);var e=this.buffer.join("+");return this.buffer.length=0,e}var fn=function(){function t(){N(this,t)}return F(t,[{key:"_colors",get:function(){var t=new Map([["CanvasText",null],["Canvas",null]]);return function(t){var e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);var n,i=R(t.keys());try{for(i.s();!(n=i.n()).done;){var a=n.value;e.style.color=a;var r=window.getComputedStyle(e).color;t.set(a,xe(r))}}catch(t){i.e(t)}finally{i.f()}e.remove()}(t),dt(this,"_colors",t)}},{key:"convert",value:function(e){var n=xe(e);if(!window.matchMedia("(forced-colors: active)").matches)return n;var i,a=R(this._colors);try{for(a.s();!(i=a.n()).done;){var r=T(i.value,2),s=r[0];if(r[1].every((function(t,e){return t===n[e]})))return t._colorsMapping.get(s)}}catch(t){a.e(t)}finally{a.f()}return n}},{key:"getHexCode",value:function(t){var e=this._colors.get(t);return e?Mt.makeHexColor.apply(Mt,y(e)):t}}])}();x(fn,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var vn=new WeakMap,pn=new WeakMap,gn=new WeakMap,yn=new WeakMap,mn=new WeakMap,kn=new WeakMap,bn=new WeakMap,wn=new WeakMap,An=new WeakMap,_n=new WeakMap,xn=new WeakMap,En=new WeakMap,Mn=new WeakMap,Sn=new WeakMap,Cn=new WeakMap,Tn=new WeakMap,Rn=new WeakMap,Ln=new WeakMap,Pn=new WeakMap,In=new WeakMap,Fn=new WeakMap,Dn=new WeakMap,Nn=new WeakMap,On=new WeakMap,Wn=new WeakMap,Bn=new WeakMap,Hn=new WeakMap,jn=new WeakMap,zn=new WeakMap,Gn=new WeakMap,Vn=new WeakMap,qn=new WeakMap,Un=new WeakMap,Xn=new WeakMap,Kn=new WeakMap,Yn=new WeakMap,Qn=new WeakMap,Jn=new WeakMap,Zn=new WeakMap,$n=new WeakMap,ti=new WeakMap,ei=new WeakMap,ni=new WeakMap,ii=new WeakMap,ai=new WeakMap,ri=new WeakMap,si=new WeakSet,oi=function(){function t(e,n,i,a,r,s,o,l,h){N(this,t),m(this,si),k(this,vn,null),k(this,pn,new Map),k(this,gn,new Map),k(this,yn,null),k(this,mn,null),k(this,kn,null),k(this,bn,new hn),k(this,wn,0),k(this,An,new Set),k(this,_n,null),k(this,xn,null),k(this,En,new Set),k(this,Mn,!1),k(this,Sn,null),k(this,Cn,null),k(this,Tn,null),k(this,Rn,!1),k(this,Ln,null),k(this,Pn,new Qe),k(this,In,!1),k(this,Fn,!1),k(this,Dn,null),k(this,Nn,null),k(this,On,null),k(this,Wn,Q.NONE),k(this,Bn,new Set),k(this,Hn,null),k(this,jn,null),k(this,zn,null),k(this,Gn,this.blur.bind(this)),k(this,Vn,this.focus.bind(this)),k(this,qn,this.copy.bind(this)),k(this,Un,this.cut.bind(this)),k(this,Xn,this.paste.bind(this)),k(this,Kn,this.keydown.bind(this)),k(this,Yn,this.keyup.bind(this)),k(this,Qn,this.onEditingAction.bind(this)),k(this,Jn,this.onPageChanging.bind(this)),k(this,Zn,this.onScaleChanging.bind(this)),k(this,$n,C(si,this,ui).bind(this)),k(this,ti,this.onRotationChanging.bind(this)),k(this,ei,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}),k(this,ni,[0,0]),k(this,ii,null),k(this,ai,null),k(this,ri,null),_(ai,this,e),_(ri,this,n),_(yn,this,i),this._eventBus=a,this._eventBus._on("editingaction",A(Qn,this)),this._eventBus._on("pagechanging",A(Jn,this)),this._eventBus._on("scalechanging",A(Zn,this)),this._eventBus._on("rotationchanging",A(ti,this)),C(si,this,di).call(this),C(si,this,gi).call(this),_(mn,this,r.annotationStorage),_(Sn,this,r.filterFactory),_(jn,this,s),_(Tn,this,o||null),_(Mn,this,l),_(On,this,h||null),this.viewParameters={realScale:Bt.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}return F(t,[{key:"destroy",value:function(){var t,e;C(si,this,yi).call(this),C(si,this,pi).call(this),this._eventBus._off("editingaction",A(Qn,this)),this._eventBus._off("pagechanging",A(Jn,this)),this._eventBus._off("scalechanging",A(Zn,this)),this._eventBus._off("rotationchanging",A(ti,this));var n,i=R(A(gn,this).values());try{for(i.s();!(n=i.n()).done;)n.value.destroy()}catch(t){i.e(t)}finally{i.f()}A(gn,this).clear(),A(pn,this).clear(),A(En,this).clear(),_(vn,this,null),A(Bn,this).clear(),A(bn,this).destroy(),null===(t=A(yn,this))||void 0===t||t.destroy(),null===(e=A(Ln,this))||void 0===e||e.hide(),_(Ln,this,null),A(Cn,this)&&(clearTimeout(A(Cn,this)),_(Cn,this,null)),A(ii,this)&&(clearTimeout(A(ii,this)),_(ii,this,null)),C(si,this,fi).call(this)}},{key:"mlGuess",value:(e=S(E().mark((function t(e){var n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(n=A(On,this))||void 0===n?void 0:n.guess(e))||null);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"hasMLManager",get:function(){return!!A(On,this)}},{key:"hcmFilter",get:function(){return dt(this,"hcmFilter",A(jn,this)?A(Sn,this).addHCMFilter(A(jn,this).foreground,A(jn,this).background):"none")}},{key:"direction",get:function(){return dt(this,"direction",getComputedStyle(A(ai,this)).direction)}},{key:"highlightColors",get:function(){return dt(this,"highlightColors",A(Tn,this)?new Map(A(Tn,this).split(",").map((function(t){return t.split("=").map((function(t){return t.trim()}))}))):null)}},{key:"highlightColorNames",get:function(){return dt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(function(t){return t.reverse()}))):null)}},{key:"setMainHighlightColorPicker",value:function(t){_(Nn,this,t)}},{key:"editAltText",value:function(t){var e;null===(e=A(yn,this))||void 0===e||e.editAltText(this,t)}},{key:"onPageChanging",value:function(t){var e=t.pageNumber;_(wn,this,e-1)}},{key:"focusMainContainer",value:function(){A(ai,this).focus()}},{key:"findParent",value:function(t,e){var n,i=R(A(gn,this).values());try{for(i.s();!(n=i.n()).done;){var a=n.value,r=a.div.getBoundingClientRect(),s=r.x,o=r.y,l=r.width,h=r.height;if(t>=s&&t<=s+l&&e>=o&&e<=o+h)return a}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"disableUserSelect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];A(ri,this).classList.toggle("noUserSelect",t)}},{key:"addShouldRescale",value:function(t){A(En,this).add(t)}},{key:"removeShouldRescale",value:function(t){A(En,this).delete(t)}},{key:"onScaleChanging",value:function(t){var e=t.scale;this.commitOrRemove(),this.viewParameters.realScale=e*Bt.PDF_TO_CSS_UNITS;var n,i=R(A(En,this));try{for(i.s();!(n=i.n()).done;)n.value.onScaleChanging()}catch(t){i.e(t)}finally{i.f()}}},{key:"onRotationChanging",value:function(t){var e=t.pagesRotation;this.commitOrRemove(),this.viewParameters.rotation=e}},{key:"highlightSelection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=document.getSelection();if(e&&!e.isCollapsed){var n=e.anchorNode,i=e.anchorOffset,a=e.focusNode,r=e.focusOffset,s=e.toString(),o=C(si,this,li).call(this,e).closest(".textLayer"),l=this.getSelectionBoxes(o);if(l){e.empty(),A(Wn,this)===Q.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:Q.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));var h,u=R(A(gn,this).values());try{for(u.s();!(h=u.n()).done;){var c=h.value;if(c.hasTextLayer(o)){c.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:l,anchorNode:n,anchorOffset:i,focusNode:a,focusOffset:r,text:s});break}}}catch(t){u.e(t)}finally{u.f()}}}}},{key:"addToAnnotationStorage",value:function(t){t.isEmpty()||!A(mn,this)||A(mn,this).has(t.id)||A(mn,this).setValue(t.id,t)}},{key:"blur",value:function(){if(this.isShiftKeyDown=!1,A(Rn,this)&&(_(Rn,this,!1),C(si,this,ci).call(this,"main_toolbar")),this.hasSelection){var t,e=document.activeElement,n=R(A(Bn,this));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.div.contains(e)){_(Dn,this,[i,e]),i._focusEventsAllowed=!1;break}}}catch(t){n.e(t)}finally{n.f()}}}},{key:"focus",value:function(){if(A(Dn,this)){var t=T(A(Dn,this),2),e=t[0],n=t[1];_(Dn,this,null),n.addEventListener("focusin",(function(){e._focusEventsAllowed=!0}),{once:!0}),n.focus()}}},{key:"addEditListeners",value:function(){C(si,this,gi).call(this),C(si,this,mi).call(this)}},{key:"removeEditListeners",value:function(){C(si,this,yi).call(this),C(si,this,ki).call(this)}},{key:"copy",value:function(t){var e;if(t.preventDefault(),null===(e=A(vn,this))||void 0===e||e.commitOrRemove(),this.hasSelection){var n,i=[],a=R(A(Bn,this));try{for(a.s();!(n=a.n()).done;){var r=n.value.serialize(!0);r&&i.push(r)}}catch(t){a.e(t)}finally{a.f()}0!==i.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(i))}}},{key:"cut",value:function(t){this.copy(t),this.delete()}},{key:"paste",value:function(t){var e=this;t.preventDefault();var n,i=t.clipboardData,a=R(i.items);try{for(a.s();!(n=a.n()).done;){var r,s=n.value,o=R(A(xn,this));try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l.isHandlingMimeForPasting(s.type))return void l.paste(s,this.currentLayer)}}catch(t){o.e(t)}finally{o.f()}}}catch(t){a.e(t)}finally{a.f()}var h=i.getData("application/pdfjs");if(h){try{h=JSON.parse(h)}catch(t){return void lt('paste: "'.concat(t.message,'".'))}if(Array.isArray(h)){this.unselectAll();var u=this.currentLayer;try{var c,d=[],f=R(h);try{for(f.s();!(c=f.n()).done;){var v=c.value,p=u.deserialize(v);if(!p)return;d.push(p)}}catch(t){f.e(t)}finally{f.f()}this.addCommands({cmd:function(){for(var t=0,n=d;t<n.length;t++){var i=n[t];C(si,e,xi).call(e,i)}C(si,e,Si).call(e,d)},undo:function(){for(var t=0,e=d;t<e.length;t++)e[t].remove()},mustExec:!0})}catch(t){lt('paste: "'.concat(t.message,'".'))}}}}},{key:"keydown",value:function(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),A(Wn,this)===Q.NONE||this.isEditorHandlingKeyboard||t._keyboardManager.exec(this,e)}},{key:"keyup",value:function(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,A(Rn,this)&&(_(Rn,this,!1),C(si,this,ci).call(this,"main_toolbar")))}},{key:"onEditingAction",value:function(t){var e=t.name;switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu")}}},{key:"setEditingState",value:function(t){t?(C(si,this,vi).call(this),C(si,this,mi).call(this),C(si,this,bi).call(this,{isEditing:A(Wn,this)!==Q.NONE,isEmpty:C(si,this,Mi).call(this),hasSomethingToUndo:A(bn,this).hasSomethingToUndo(),hasSomethingToRedo:A(bn,this).hasSomethingToRedo(),hasSelectedEditor:!1})):(C(si,this,pi).call(this),C(si,this,ki).call(this),C(si,this,bi).call(this,{isEditing:!1}),this.disableUserSelect(!1))}},{key:"registerEditorTypes",value:function(t){if(!A(xn,this)){_(xn,this,t);var e,n=R(A(xn,this));try{for(n.s();!(e=n.n()).done;){var i=e.value;C(si,this,wi).call(this,i.defaultPropertiesToUpdate)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"getId",value:function(){return A(Pn,this).id}},{key:"currentLayer",get:function(){return A(gn,this).get(A(wn,this))}},{key:"getLayer",value:function(t){return A(gn,this).get(t)}},{key:"currentPageIndex",get:function(){return A(wn,this)}},{key:"addLayer",value:function(t){A(gn,this).set(t.pageIndex,t),A(In,this)?t.enable():t.disable()}},{key:"removeLayer",value:function(t){A(gn,this).delete(t.pageIndex)}},{key:"updateMode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(A(Wn,this)!==t){if(_(Wn,this,t),t===Q.NONE)return this.setEditingState(!1),void C(si,this,_i).call(this);this.setEditingState(!0),C(si,this,Ai).call(this),this.unselectAll();var i,a=R(A(gn,this).values());try{for(a.s();!(i=a.n()).done;)i.value.updateMode(t)}catch(t){a.e(t)}finally{a.f()}if(e||!n){if(e){var r,s=R(A(pn,this).values());try{for(s.s();!(r=s.n()).done;){var o=r.value;if(o.annotationElementId===e){this.setSelected(o),o.enterInEditMode();break}}}catch(t){s.e(t)}finally{s.f()}}}else this.addNewEditorFromKeyboard()}}},{key:"addNewEditorFromKeyboard",value:function(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}},{key:"updateToolbar",value:function(t){t!==A(Wn,this)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}},{key:"updateParams",value:function(t,e){var n;if(A(xn,this)){switch(t){case J.CREATE:return void this.currentLayer.addNewEditor();case J.HIGHLIGHT_DEFAULT_COLOR:null===(n=A(Nn,this))||void 0===n||n.updateColor(e);break;case J.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(A(zn,this)||_(zn,this,new Map)).set(t,e),this.showAllEditors("highlight",e)}var i,a=R(A(Bn,this));try{for(a.s();!(i=a.n()).done;)i.value.updateParams(t,e)}catch(t){a.e(t)}finally{a.f()}var r,s=R(A(xn,this));try{for(s.s();!(r=s.n()).done;)r.value.updateDefaultParams(t,e)}catch(t){s.e(t)}finally{s.f()}}}},{key:"showAllEditors",value:function(t,e){var n,i,a,r=R(A(pn,this).values());try{for(r.s();!(a=r.n()).done;){var s=a.value;s.editorType===t&&s.show(e)}}catch(t){r.e(t)}finally{r.f()}(null===(n=null===(i=A(zn,this))||void 0===i?void 0:i.get(J.HIGHLIGHT_SHOW_ALL))||void 0===n||n)!==e&&C(si,this,wi).call(this,[[J.HIGHLIGHT_SHOW_ALL,e]])}},{key:"enableWaiting",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(A(Fn,this)!==t){_(Fn,this,t);var e,n=R(A(gn,this).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;t?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",t)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"getEditors",value:function(t){var e,n=[],i=R(A(pn,this).values());try{for(i.s();!(e=i.n()).done;){var a=e.value;a.pageIndex===t&&n.push(a)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"getEditor",value:function(t){return A(pn,this).get(t)}},{key:"addEditor",value:function(t){A(pn,this).set(t.id,t)}},{key:"removeEditor",value:function(t){var e,n=this;t.div.contains(document.activeElement)&&(A(Cn,this)&&clearTimeout(A(Cn,this)),_(Cn,this,setTimeout((function(){n.focusMainContainer(),_(Cn,n,null)}),0))),A(pn,this).delete(t.id),this.unselect(t),t.annotationElementId&&A(An,this).has(t.annotationElementId)||null===(e=A(mn,this))||void 0===e||e.remove(t.id)}},{key:"addDeletedAnnotationElement",value:function(t){A(An,this).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}},{key:"isDeletedAnnotationElement",value:function(t){return A(An,this).has(t)}},{key:"removeDeletedAnnotationElement",value:function(t){A(An,this).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}},{key:"setActiveEditor",value:function(t){A(vn,this)!==t&&(_(vn,this,t),t&&C(si,this,wi).call(this,t.propertiesToUpdate))}},{key:"updateUI",value:function(t){w(si,this,Ei)===t&&C(si,this,wi).call(this,t.propertiesToUpdate)}},{key:"toggleSelected",value:function(t){if(A(Bn,this).has(t))return A(Bn,this).delete(t),t.unselect(),void C(si,this,bi).call(this,{hasSelectedEditor:this.hasSelection});A(Bn,this).add(t),t.select(),C(si,this,wi).call(this,t.propertiesToUpdate),C(si,this,bi).call(this,{hasSelectedEditor:!0})}},{key:"setSelected",value:function(t){var e,n=R(A(Bn,this));try{for(n.s();!(e=n.n()).done;){var i=e.value;i!==t&&i.unselect()}}catch(t){n.e(t)}finally{n.f()}A(Bn,this).clear(),A(Bn,this).add(t),t.select(),C(si,this,wi).call(this,t.propertiesToUpdate),C(si,this,bi).call(this,{hasSelectedEditor:!0})}},{key:"isSelected",value:function(t){return A(Bn,this).has(t)}},{key:"firstSelectedEditor",get:function(){return A(Bn,this).values().next().value}},{key:"unselect",value:function(t){t.unselect(),A(Bn,this).delete(t),C(si,this,bi).call(this,{hasSelectedEditor:this.hasSelection})}},{key:"hasSelection",get:function(){return 0!==A(Bn,this).size}},{key:"isEnterHandled",get:function(){return 1===A(Bn,this).size&&this.firstSelectedEditor.isEnterHandled}},{key:"undo",value:function(){A(bn,this).undo(),C(si,this,bi).call(this,{hasSomethingToUndo:A(bn,this).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:C(si,this,Mi).call(this)})}},{key:"redo",value:function(){A(bn,this).redo(),C(si,this,bi).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:A(bn,this).hasSomethingToRedo(),isEmpty:C(si,this,Mi).call(this)})}},{key:"addCommands",value:function(t){A(bn,this).add(t),C(si,this,bi).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:C(si,this,Mi).call(this)})}},{key:"delete",value:function(){var t=this;if(this.commitOrRemove(),this.hasSelection){var e=y(A(Bn,this));this.addCommands({cmd:function(){var t,n=R(e);try{for(n.s();!(t=n.n()).done;)t.value.remove()}catch(t){n.e(t)}finally{n.f()}},undo:function(){var n,i=R(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;C(si,t,xi).call(t,a)}}catch(t){i.e(t)}finally{i.f()}},mustExec:!0})}}},{key:"commitOrRemove",value:function(){var t;null===(t=A(vn,this))||void 0===t||t.commitOrRemove()}},{key:"hasSomethingToControl",value:function(){return A(vn,this)||this.hasSelection}},{key:"selectAll",value:function(){var t,e=R(A(Bn,this));try{for(e.s();!(t=e.n()).done;)t.value.commit()}catch(t){e.e(t)}finally{e.f()}C(si,this,Si).call(this,A(pn,this).values())}},{key:"unselectAll",value:function(){if((!A(vn,this)||(A(vn,this).commitOrRemove(),A(Wn,this)===Q.NONE))&&this.hasSelection){var t,e=R(A(Bn,this));try{for(e.s();!(t=e.n()).done;)t.value.unselect()}catch(t){e.e(t)}finally{e.f()}A(Bn,this).clear(),C(si,this,bi).call(this,{hasSelectedEditor:!1})}}},{key:"translateSelectedEditors",value:function(t,e){var n=this;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove(),this.hasSelection){A(ni,this)[0]+=t,A(ni,this)[1]+=e;var i=T(A(ni,this),2),a=i[0],r=i[1],s=y(A(Bn,this));A(ii,this)&&clearTimeout(A(ii,this)),_(ii,this,setTimeout((function(){_(ii,n,null),A(ni,n)[0]=A(ni,n)[1]=0,n.addCommands({cmd:function(){var t,e=R(s);try{for(e.s();!(t=e.n()).done;){var i=t.value;A(pn,n).has(i.id)&&i.translateInPage(a,r)}}catch(t){e.e(t)}finally{e.f()}},undo:function(){var t,e=R(s);try{for(e.s();!(t=e.n()).done;){var i=t.value;A(pn,n).has(i.id)&&i.translateInPage(-a,-r)}}catch(t){e.e(t)}finally{e.f()}},mustExec:!1})}),1e3));var o,l=R(s);try{for(l.s();!(o=l.n()).done;)o.value.translateInPage(t,e)}catch(t){l.e(t)}finally{l.f()}}}},{key:"setUpDragSession",value:function(){if(this.hasSelection){this.disableUserSelect(!0),_(_n,this,new Map);var t,e=R(A(Bn,this));try{for(e.s();!(t=e.n()).done;){var n=t.value;A(_n,this).set(n,{savedX:n.x,savedY:n.y,savedPageIndex:n.pageIndex,newX:0,newY:0,newPageIndex:-1})}}catch(t){e.e(t)}finally{e.f()}}}},{key:"endDragSession",value:function(){var t=this;if(!A(_n,this))return!1;this.disableUserSelect(!1);var e=A(_n,this);_(_n,this,null);var n,i=!1,a=R(e);try{for(a.s();!(n=a.n()).done;){var r=T(n.value,2),s=r[0],o=s.x,l=s.y,h=s.pageIndex,u=r[1];u.newX=o,u.newY=l,u.newPageIndex=h,i||(i=o!==u.savedX||l!==u.savedY||h!==u.savedPageIndex)}}catch(t){a.e(t)}finally{a.f()}if(!i)return!1;var c=function(e,n,i,a){if(A(pn,t).has(e.id)){var r=A(gn,t).get(a);r?e._setParentAndPosition(r,n,i):(e.pageIndex=a,e.x=n,e.y=i)}};return this.addCommands({cmd:function(){var t,n=R(e);try{for(n.s();!(t=n.n()).done;){var i=T(t.value,2),a=i[0],r=i[1],s=r.newX,o=r.newY,l=r.newPageIndex;c(a,s,o,l)}}catch(t){n.e(t)}finally{n.f()}},undo:function(){var t,n=R(e);try{for(n.s();!(t=n.n()).done;){var i=T(t.value,2),a=i[0],r=i[1],s=r.savedX,o=r.savedY,l=r.savedPageIndex;c(a,s,o,l)}}catch(t){n.e(t)}finally{n.f()}},mustExec:!0}),!0}},{key:"dragSelectedEditors",value:function(t,e){if(A(_n,this)){var n,i=R(A(_n,this).keys());try{for(i.s();!(n=i.n()).done;)n.value.drag(t,e)}catch(t){i.e(t)}finally{i.f()}}}},{key:"rebuild",value:function(t){if(null===t.parent){var e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}},{key:"isEditorHandlingKeyboard",get:function(){var t;return(null===(t=this.getActive())||void 0===t?void 0:t.shouldGetKeyboardEvents())||1===A(Bn,this).size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}},{key:"isActive",value:function(t){return A(vn,this)===t}},{key:"getActive",value:function(){return A(vn,this)}},{key:"getMode",value:function(){return A(Wn,this)}},{key:"imageManager",get:function(){return dt(this,"imageManager",new en)}},{key:"getSelectionBoxes",value:function(t){if(!t)return null;for(var e=document.getSelection(),n=0,i=e.rangeCount;n<i;n++)if(!t.contains(e.getRangeAt(n).commonAncestorContainer))return null;var a,r=t.getBoundingClientRect(),s=r.x,o=r.y,l=r.width,h=r.height;switch(t.getAttribute("data-main-rotation")){case"90":a=function(t,e,n,i){return{x:(e-o)/h,y:1-(t+n-s)/l,width:i/h,height:n/l}};break;case"180":a=function(t,e,n,i){return{x:1-(t+n-s)/l,y:1-(e+i-o)/h,width:n/l,height:i/h}};break;case"270":a=function(t,e,n,i){return{x:1-(e+i-o)/h,y:(t-s)/l,width:i/h,height:n/l}};break;default:a=function(t,e,n,i){return{x:(t-s)/l,y:(e-o)/h,width:n/l,height:i/h}}}for(var u=[],c=0,d=e.rangeCount;c<d;c++){var f=e.getRangeAt(c);if(!f.collapsed){var v,p=R(f.getClientRects());try{for(p.s();!(v=p.n()).done;){var g=v.value,y=g.x,m=g.y,k=g.width,b=g.height;0!==k&&0!==b&&u.push(a(y,m,k,b))}}catch(t){p.e(t)}finally{p.f()}}}return 0===u.length?null:u}},{key:"addChangedExistingAnnotation",value:function(t){var e=t.annotationElementId,n=t.id;(A(kn,this)||_(kn,this,new Map)).set(e,n)}},{key:"removeChangedExistingAnnotation",value:function(t){var e,n=t.annotationElementId;null===(e=A(kn,this))||void 0===e||e.delete(n)}},{key:"renderAnnotationElement",value:function(t){var e,n=null===(e=A(kn,this))||void 0===e?void 0:e.get(t.data.id);if(n){var i=A(mn,this).getRawValue(n);i&&(A(Wn,this)!==Q.NONE||i.hasBeenModified)&&i.renderAnnotationElement(t)}}}],[{key:"_keyboardManager",get:function(){var e=t.prototype,n=function(t){return A(ai,t).contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl()},i=function(t,e){var n=e.target;if(n instanceof HTMLInputElement){var i=n.type;return"text"!==i&&"number"!==i}return!0},a=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return dt(this,"_keyboardManager",new cn([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:function(t,e){var n=e.target;return!(n instanceof HTMLButtonElement)&&A(ai,t).contains(n)&&!t.isEnterHandled}}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:function(t,e){return!(e.target instanceof HTMLButtonElement)&&A(ai,t).contains(document.activeElement)}}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:n}]]))}}]);var e}();function li(t){var e=t.anchorNode;return e.nodeType===Node.TEXT_NODE?e.parentElement:e}function hi(){var t=document.getSelection();if(t&&!t.isCollapsed){var e=C(si,this,li).call(this,t).closest(".textLayer"),n=this.getSelectionBoxes(e);n&&(A(Ln,this)||_(Ln,this,new Ve(this)),A(Ln,this).show(e,n,"ltr"===this.direction))}}function ui(){var t,e=this,n=document.getSelection();if(n&&!n.isCollapsed){var i,a=n.anchorNode;if(a!==A(Hn,this))if(C(si,this,li).call(this,n).closest(".textLayer")){if(null===(t=A(Ln,this))||void 0===t||t.hide(),_(Hn,this,a),C(si,this,bi).call(this,{hasSelectedText:!0}),(A(Wn,this)===Q.HIGHLIGHT||A(Wn,this)===Q.NONE)&&(A(Wn,this)===Q.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(Rn,this,this.isShiftKeyDown),!this.isShiftKeyDown)){var r=function t(n){"pointerup"===n.type&&0!==n.button||(window.removeEventListener("pointerup",t),window.removeEventListener("blur",t),"pointerup"===n.type&&C(si,e,ci).call(e,"main_toolbar"))};window.addEventListener("pointerup",r),window.addEventListener("blur",r)}}else A(Hn,this)&&(null===(i=A(Ln,this))||void 0===i||i.hide(),_(Hn,this,null),C(si,this,bi).call(this,{hasSelectedText:!1}))}else{var s;A(Hn,this)&&(null===(s=A(Ln,this))||void 0===s||s.hide(),_(Hn,this,null),C(si,this,bi).call(this,{hasSelectedText:!1}))}}function ci(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";A(Wn,this)===Q.HIGHLIGHT?this.highlightSelection(t):A(Mn,this)&&C(si,this,hi).call(this)}function di(){document.addEventListener("selectionchange",A($n,this))}function fi(){document.removeEventListener("selectionchange",A($n,this))}function vi(){window.addEventListener("focus",A(Vn,this)),window.addEventListener("blur",A(Gn,this))}function pi(){window.removeEventListener("focus",A(Vn,this)),window.removeEventListener("blur",A(Gn,this))}function gi(){window.addEventListener("keydown",A(Kn,this)),window.addEventListener("keyup",A(Yn,this))}function yi(){window.removeEventListener("keydown",A(Kn,this)),window.removeEventListener("keyup",A(Yn,this))}function mi(){document.addEventListener("copy",A(qn,this)),document.addEventListener("cut",A(Un,this)),document.addEventListener("paste",A(Xn,this))}function ki(){document.removeEventListener("copy",A(qn,this)),document.removeEventListener("cut",A(Un,this)),document.removeEventListener("paste",A(Xn,this))}function bi(t){var e=this;Object.entries(t).some((function(t){var n=T(t,2),i=n[0],a=n[1];return A(ei,e)[i]!==a}))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(A(ei,this),t)}),A(Wn,this)===Q.HIGHLIGHT&&!1===t.hasSelectedEditor&&C(si,this,wi).call(this,[[J.HIGHLIGHT_FREE,!0]]))}function wi(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}function Ai(){if(!A(In,this)){_(In,this,!0);var t,e=R(A(gn,this).values());try{for(e.s();!(t=e.n()).done;)t.value.enable()}catch(t){e.e(t)}finally{e.f()}var n,i=R(A(pn,this).values());try{for(i.s();!(n=i.n()).done;)n.value.enable()}catch(t){i.e(t)}finally{i.f()}}}function _i(){if(this.unselectAll(),A(In,this)){_(In,this,!1);var t,e=R(A(gn,this).values());try{for(e.s();!(t=e.n()).done;)t.value.disable()}catch(t){e.e(t)}finally{e.f()}var n,i=R(A(pn,this).values());try{for(i.s();!(n=i.n()).done;)n.value.disable()}catch(t){i.e(t)}finally{i.f()}}}function xi(t){var e=A(gn,this).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}function Ei(t){var e,n=null,i=R(A(Bn,t));try{for(i.s();!(e=i.n()).done;)n=e.value}catch(t){i.e(t)}finally{i.f()}return n}function Mi(){if(0===A(pn,this).size)return!0;if(1===A(pn,this).size){var t,e=R(A(pn,this).values());try{for(e.s();!(t=e.n()).done;)return t.value.isEmpty()}catch(t){e.e(t)}finally{e.f()}}return!1}function Si(t){var e,n=R(A(Bn,this));try{for(n.s();!(e=n.n()).done;)e.value.unselect()}catch(t){n.e(t)}finally{n.f()}A(Bn,this).clear();var i,a=R(t);try{for(a.s();!(i=a.n()).done;){var r=i.value;r.isEmpty()||(A(Bn,this).add(r),r.select())}}catch(t){a.e(t)}finally{a.f()}C(si,this,bi).call(this,{hasSelectedEditor:this.hasSelection})}x(oi,"TRANSLATE_SMALL",1),x(oi,"TRANSLATE_BIG",10);var Ci=new WeakMap,Ti=new WeakMap,Ri=new WeakMap,Li=new WeakMap,Pi=new WeakMap,Ii=new WeakMap,Fi=new WeakMap,Di=new WeakSet,Ni=function(){function t(e){N(this,t),m(this,Di),k(this,Ci,""),k(this,Ti,!1),k(this,Ri,null),k(this,Li,null),k(this,Pi,null),k(this,Ii,!1),k(this,Fi,null),_(Fi,this,e)}return F(t,[{key:"render",value:(e=S(E().mark((function e(){var n,i,a,r=this;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=_(Ri,this,document.createElement("button"))).className="altText",e.next=4,t._l10nPromise.get("pdfjs-editor-alt-text-button-label");case 4:return i=e.sent,n.textContent=i,n.setAttribute("aria-label",i),n.tabIndex="0",n.addEventListener("contextmenu",be),n.addEventListener("pointerdown",(function(t){return t.stopPropagation()})),a=function(t){t.preventDefault(),A(Fi,r)._uiManager.editAltText(A(Fi,r))},n.addEventListener("click",a,{capture:!0}),n.addEventListener("keydown",(function(t){t.target===n&&"Enter"===t.key&&(_(Ii,r,!0),a(t))})),e.next=15,C(Di,this,Oi).call(this);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"finish",value:function(){A(Ri,this)&&(A(Ri,this).focus({focusVisible:A(Ii,this)}),_(Ii,this,!1))}},{key:"isEmpty",value:function(){return!A(Ci,this)&&!A(Ti,this)}},{key:"data",get:function(){return{altText:A(Ci,this),decorative:A(Ti,this)}},set:function(t){var e=t.altText,n=t.decorative;A(Ci,this)===e&&A(Ti,this)===n||(_(Ci,this,e),_(Ti,this,n),C(Di,this,Oi).call(this))}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];A(Ri,this)&&(!t&&A(Pi,this)&&(clearTimeout(A(Pi,this)),_(Pi,this,null)),A(Ri,this).disabled=!t)}},{key:"destroy",value:function(){var t;null===(t=A(Ri,this))||void 0===t||t.remove(),_(Ri,this,null),_(Li,this,null)}}],[{key:"initialize",value:function(e){t._l10nPromise||(t._l10nPromise=e)}}]);var e}();function Oi(){return Wi.apply(this,arguments)}function Wi(){return(Wi=S(E().mark((function t(){var e,n,a,r,s,o=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=A(Ri,this)){t.next=3;break}return t.abrupt("return");case 3:if(A(Ci,this)||A(Ti,this)){t.next=7;break}return e.classList.remove("done"),null===(n=A(Li,this))||void 0===n||n.remove(),t.abrupt("return");case 7:if(e.classList.add("done"),i._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then((function(t){e.setAttribute("aria-label",t)})),(a=A(Li,this))||(_(Li,this,a=document.createElement("span")),a.className="tooltip",a.setAttribute("role","tooltip"),r=a.id="alt-text-tooltip-".concat(A(Fi,this).id),e.setAttribute("aria-describedby",r),e.addEventListener("mouseenter",(function(){_(Pi,o,setTimeout((function(){_(Pi,o,null),A(Li,o).classList.add("show"),A(Fi,o)._reportTelemetry({action:"alt_text_tooltip"})}),100))})),e.addEventListener("mouseleave",(function(){var t;A(Pi,o)&&(clearTimeout(A(Pi,o)),_(Pi,o,null)),null===(t=A(Li,o))||void 0===t||t.classList.remove("show")}))),!A(Ti,this)){t.next=17;break}return t.next=14,i._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip");case 14:t.t0=t.sent,t.next=18;break;case 17:t.t0=A(Ci,this);case 18:a.innerText=t.t0,a.parentNode||e.append(a),null==(s=A(Fi,this).getImageForAltText())||s.setAttribute("aria-describedby",a.id);case 22:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}i=Ni,x(Ni,"_l10nPromise",null);var Bi=new WeakMap,Hi=new WeakMap,ji=new WeakMap,zi=new WeakMap,Gi=new WeakMap,Vi=new WeakMap,qi=new WeakMap,Ui=new WeakMap,Xi=new WeakMap,Ki=new WeakMap,Yi=new WeakMap,Qi=new WeakMap,Ji=new WeakMap,Zi=new WeakMap,$i=new WeakMap,ta=new WeakMap,ea=new WeakMap,na=new WeakMap,ia=new WeakMap,aa=new WeakMap,ra=new WeakMap,sa=new WeakSet,oa=function(){function t(e){N(this,t),m(this,sa),k(this,Bi,null),k(this,Hi,null),k(this,ji,!1),k(this,zi,!1),k(this,Gi,null),k(this,Vi,null),k(this,qi,this.focusin.bind(this)),k(this,Ui,this.focusout.bind(this)),k(this,Xi,null),k(this,Ki,""),k(this,Yi,!1),k(this,Qi,null),k(this,Ji,!1),k(this,Zi,!1),k(this,$i,!1),k(this,ta,null),k(this,ea,0),k(this,na,0),k(this,ia,null),x(this,"_initialOptions",Object.create(null)),x(this,"_isVisible",!0),x(this,"_uiManager",null),x(this,"_focusEventsAllowed",!0),x(this,"_l10nPromise",null),k(this,aa,!1),k(this,ra,t._zIndex++),this.constructor===t&&ht("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;var n=this.parent.viewport,i=n.rotation,a=n.rawDims,r=a.pageWidth,s=a.pageHeight,o=a.pageX,l=a.pageY;this.rotation=i,this.pageRotation=(360+i-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,s],this.pageTranslation=[o,l];var h=T(this.parentDimensions,2),u=h[0],c=h[1];this.x=e.x/u,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}return F(t,[{key:"editorType",get:function(){return Object.getPrototypeOf(this).constructor._type}},{key:"propertiesToUpdate",get:function(){return[]}},{key:"_isDraggable",get:function(){return A(aa,this)},set:function(t){var e;_(aa,this,t),null===(e=this.div)||void 0===e||e.classList.toggle("draggable",t)}},{key:"isEnterHandled",get:function(){return!0}},{key:"center",value:function(){var t=T(this.pageDimensions,2),e=t[0],n=t[1];switch(this.parentRotation){case 90:this.x-=this.height*n/(2*e),this.y+=this.width*e/(2*n);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*n/(2*e),this.y-=this.width*e/(2*n);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}},{key:"addCommands",value:function(t){this._uiManager.addCommands(t)}},{key:"currentLayer",get:function(){return this._uiManager.currentLayer}},{key:"setInBackground",value:function(){this.div.style.zIndex=0}},{key:"setInForeground",value:function(){this.div.style.zIndex=A(ra,this)}},{key:"setParent",value:function(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):C(sa,this,wa).call(this),this.parent=t}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(A(Yi,this)?_(Yi,this,!1):this.parent.setSelected(this))}},{key:"focusout",value:function(t){var e;if(this._focusEventsAllowed&&this.isAttachedToDOM){var n=t.relatedTarget;null!=n&&n.closest("#".concat(this.id))||(t.preventDefault(),null!==(e=this.parent)&&void 0!==e&&e.isMultipleSelection||this.commitOrRemove())}}},{key:"commitOrRemove",value:function(){this.isEmpty()?this.remove():this.commit()}},{key:"commit",value:function(){this.addToAnnotationStorage()}},{key:"addToAnnotationStorage",value:function(){this._uiManager.addToAnnotationStorage(this)}},{key:"setAt",value:function(t,e,n,i){var a=T(this.parentDimensions,2),r=a[0],s=a[1],o=T(this.screenToPageTranslation(n,i),2);n=o[0],i=o[1],this.x=(t+n)/r,this.y=(e+i)/s,this.fixAndSetPosition()}},{key:"translate",value:function(t,e){C(sa,this,la).call(this,this.parentDimensions,t,e)}},{key:"translateInPage",value:function(t,e){A(Qi,this)||_(Qi,this,[this.x,this.y]),C(sa,this,la).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}},{key:"drag",value:function(t,e){A(Qi,this)||_(Qi,this,[this.x,this.y]);var n=T(this.parentDimensions,2),i=n[0],a=n[1];if(this.x+=t/i,this.y+=e/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){var r=this.div.getBoundingClientRect(),s=r.x,o=r.y;this.parent.findNewParent(this,s,o)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}var l=this.x,h=this.y,u=T(this.getBaseTranslation(),2);l+=u[0],h+=u[1],this.div.style.left="".concat((100*l).toFixed(2),"%"),this.div.style.top="".concat((100*h).toFixed(2),"%"),this.div.scrollIntoView({block:"nearest"})}},{key:"_hasBeenMoved",get:function(){return!!A(Qi,this)&&(A(Qi,this)[0]!==this.x||A(Qi,this)[1]!==this.y)}},{key:"getBaseTranslation",value:function(){var e=T(this.parentDimensions,2),n=e[0],i=e[1],a=t._borderLineWidth,r=a/n,s=a/i;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}},{key:"_mustFixPosition",get:function(){return!0}},{key:"fixAndSetPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation,e=T(this.pageDimensions,2),n=e[0],i=e[1],a=this.x,r=this.y,s=this.width,o=this.height;if(s*=n,o*=i,a*=n,r*=i,this._mustFixPosition)switch(t){case 0:a=Math.max(0,Math.min(n-s,a)),r=Math.max(0,Math.min(i-o,r));break;case 90:a=Math.max(0,Math.min(n-o,a)),r=Math.min(i,Math.max(s,r));break;case 180:a=Math.min(n,Math.max(s,a)),r=Math.min(i,Math.max(o,r));break;case 270:a=Math.min(n,Math.max(o,a)),r=Math.max(0,Math.min(i-s,r))}this.x=a/=n,this.y=r/=i;var l=T(this.getBaseTranslation(),2);a+=l[0],r+=l[1];var h=this.div.style;h.left="".concat((100*a).toFixed(2),"%"),h.top="".concat((100*r).toFixed(2),"%"),this.moveInDOM()}},{key:"screenToPageTranslation",value:function(e,n){return ha.call(t,e,n,this.parentRotation)}},{key:"pageTranslationToScreen",value:function(e,n){return ha.call(t,e,n,360-this.parentRotation)}},{key:"parentScale",get:function(){return this._uiManager.viewParameters.realScale}},{key:"parentRotation",get:function(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}},{key:"parentDimensions",get:function(){var t=this.parentScale,e=T(this.pageDimensions,2),n=e[0]*t,i=e[1]*t;return xt.isCSSRoundSupported?[Math.round(n),Math.round(i)]:[n,i]}},{key:"setDims",value:function(t,e){var n=T(this.parentDimensions,2),i=n[0],a=n[1];this.div.style.width="".concat((100*t/i).toFixed(2),"%"),A(zi,this)||(this.div.style.height="".concat((100*e/a).toFixed(2),"%"))}},{key:"fixDims",value:function(){var t=this.div.style,e=t.height,n=t.width,i=n.endsWith("%"),a=!A(zi,this)&&e.endsWith("%");if(!i||!a){var r=T(this.parentDimensions,2),s=r[0],o=r[1];i||(t.width="".concat((100*parseFloat(n)/s).toFixed(2),"%")),A(zi,this)||a||(t.height="".concat((100*parseFloat(e)/o).toFixed(2),"%"))}}},{key:"getInitialTranslation",value:function(){return[0,0]}},{key:"altTextFinish",value:function(){var t;null===(t=A(Hi,this))||void 0===t||t.finish()}},{key:"addEditToolbar",value:(n=S(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A(Xi,this)&&!A(Zi,this)){t.next=2;break}return t.abrupt("return",A(Xi,this));case 2:if(_(Xi,this,new Ie(this)),this.div.append(A(Xi,this).render()),!A(Hi,this)){t.next=10;break}return t.t0=A(Xi,this),t.next=8,A(Hi,this).render();case 8:t.t1=t.sent,t.t0.addAltTextButton.call(t.t0,t.t1);case 10:return t.abrupt("return",A(Xi,this));case 11:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"removeEditToolbar",value:function(){var t;A(Xi,this)&&(A(Xi,this).remove(),_(Xi,this,null),null===(t=A(Hi,this))||void 0===t||t.destroy())}},{key:"getClientDimensions",value:function(){return this.div.getBoundingClientRect()}},{key:"addAltTextButton",value:(e=S(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!A(Hi,this)){e.next=2;break}return e.abrupt("return");case 2:return Ni.initialize(t._l10nPromise),_(Hi,this,new Ni(this)),e.next=6,this.addEditToolbar();case 6:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"altTextData",get:function(){var t;return null===(t=A(Hi,this))||void 0===t?void 0:t.data},set:function(t){A(Hi,this)&&(A(Hi,this).data=t)}},{key:"hasAltText",value:function(){var t;return!(null!==(t=A(Hi,this))&&void 0!==t&&t.isEmpty())}},{key:"render",value:function(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=A(ji,this)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.div.addEventListener("focusin",A(qi,this)),this.div.addEventListener("focusout",A(Ui,this));var t=T(this.parentDimensions,2),e=t[0],n=t[1];this.parentRotation%180!=0&&(this.div.style.maxWidth="".concat((100*n/e).toFixed(2),"%"),this.div.style.maxHeight="".concat((100*e/n).toFixed(2),"%"));var i=T(this.getInitialTranslation(),2),a=i[0],r=i[1];return this.translate(a,r),Ke(this,this.div,["pointerdown"]),this.div}},{key:"pointerdown",value:function(t){var e=xt.platform.isMac;0!==t.button||t.ctrlKey&&e?t.preventDefault():(_(Yi,this,!0),this._isDraggable?C(sa,this,ga).call(this,t):C(sa,this,pa).call(this,t))}},{key:"moveInDOM",value:function(){var t=this;A(ta,this)&&clearTimeout(A(ta,this)),_(ta,this,setTimeout((function(){var e;_(ta,t,null),null===(e=t.parent)||void 0===e||e.moveEditorInDOM(t)}),0))}},{key:"_setParentAndPosition",value:function(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition()}},{key:"getRect",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation,i=this.parentScale,a=T(this.pageDimensions,2),r=a[0],s=a[1],o=T(this.pageTranslation,2),l=o[0],h=o[1],u=t/i,c=e/i,d=this.x*r,f=this.y*s,v=this.width*r,p=this.height*s;switch(n){case 0:return[d+u+l,s-f-c-p+h,d+u+v+l,s-f-c+h];case 90:return[d+c+l,s-f+u+h,d+c+p+l,s-f+u+v+h];case 180:return[d-u-v+l,s-f+c+h,d-u+l,s-f+c+p+h];case 270:return[d-c-p+l,s-f-u-v+h,d-c+l,s-f-u+h];default:throw new Error("Invalid rotation")}}},{key:"getRectInCurrentCoords",value:function(t,e){var n=T(t,4),i=n[0],a=n[1],r=n[2],s=n[3],o=r-i,l=s-a;switch(this.rotation){case 0:return[i,e-s,o,l];case 90:return[i,e-a,l,o];case 180:return[r,e-a,o,l];case 270:return[r,e-s,l,o];default:throw new Error("Invalid rotation")}}},{key:"onceAdded",value:function(){}},{key:"isEmpty",value:function(){return!1}},{key:"enableEditMode",value:function(){_(Zi,this,!0)}},{key:"disableEditMode",value:function(){_(Zi,this,!1)}},{key:"isInEditMode",value:function(){return A(Zi,this)}},{key:"shouldGetKeyboardEvents",value:function(){return A($i,this)}},{key:"needsToBeRebuilt",value:function(){return this.div&&!this.isAttachedToDOM}},{key:"rebuild",value:function(){var t,e;null===(t=this.div)||void 0===t||t.addEventListener("focusin",A(qi,this)),null===(e=this.div)||void 0===e||e.addEventListener("focusout",A(Ui,this))}},{key:"rotate",value:function(t){}},{key:"serialize",value:function(){ht("An editor must be serializable")}},{key:"hasBeenModified",get:function(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}},{key:"remove",value:function(){if(this.div.removeEventListener("focusin",A(qi,this)),this.div.removeEventListener("focusout",A(Ui,this)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),A(ta,this)&&(clearTimeout(A(ta,this)),_(ta,this,null)),C(sa,this,wa).call(this),this.removeEditToolbar(),A(ia,this)){var t,e=R(A(ia,this).values());try{for(e.s();!(t=e.n()).done;){var n=t.value;clearTimeout(n)}}catch(t){e.e(t)}finally{e.f()}_(ia,this,null)}this.parent=null}},{key:"isResizable",get:function(){return!1}},{key:"makeResizable",value:function(){this.isResizable&&(C(sa,this,ca).call(this),A(Gi,this).classList.remove("hidden"),Ke(this,this.div,["keydown"]))}},{key:"toolbarPosition",get:function(){return null}},{key:"keydown",value:function(e){var n=this;if(this.isResizable&&e.target===this.div&&"Enter"===e.key){this._uiManager.setSelected(this),_(Vi,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});var i=A(Gi,this).children;if(!A(Bi,this)){_(Bi,this,Array.from(i));var a,r=C(sa,this,ya).bind(this),s=C(sa,this,ma).bind(this),o=R(A(Bi,this));try{var l=function(){var e=a.value,i=e.getAttribute("data-resizer-name");e.setAttribute("role","spinbutton"),e.addEventListener("keydown",r),e.addEventListener("blur",s),e.addEventListener("focus",C(sa,n,ka).bind(n,i)),t._l10nPromise.get("pdfjs-editor-resizer-label-".concat(i)).then((function(t){return e.setAttribute("aria-label",t)}))};for(o.s();!(a=o.n()).done;)l()}catch(t){o.e(t)}finally{o.f()}}var h,u=A(Bi,this)[0],c=0,d=R(i);try{for(d.s();!(h=d.n()).done&&h.value!==u;)c++}catch(t){d.e(t)}finally{d.f()}var f=(360-this.rotation+this.parentRotation)%360/90*(A(Bi,this).length/4);if(f!==c){if(f<c)for(var v=0;v<c-f;v++)A(Gi,this).append(A(Gi,this).firstChild);else if(f>c)for(var p=0;p<f-c;p++)A(Gi,this).firstChild.before(A(Gi,this).lastChild);var g,y=0,m=R(i);try{var k=function(){var e=g.value,i=A(Bi,n)[y++].getAttribute("data-resizer-name");t._l10nPromise.get("pdfjs-editor-resizer-label-".concat(i)).then((function(t){return e.setAttribute("aria-label",t)}))};for(m.s();!(g=m.n()).done;)k()}catch(t){m.e(t)}finally{m.f()}}C(sa,this,ba).call(this,0),_($i,this,!0),A(Gi,this).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}}},{key:"_resizeWithKeyboard",value:function(t,e){A($i,this)&&C(sa,this,va).call(this,A(Ki,this),{movementX:t,movementY:e})}},{key:"_stopResizingWithKeyboard",value:function(){C(sa,this,wa).call(this),this.div.focus()}},{key:"select",value:function(){var t,e,n=this;this.makeResizable(),null===(t=this.div)||void 0===t||t.classList.add("selectedEditor"),A(Xi,this)?null===(e=A(Xi,this))||void 0===e||e.show():this.addEditToolbar().then((function(){var t,e;null!==(t=n.div)&&void 0!==t&&t.classList.contains("selectedEditor")&&(null===(e=A(Xi,n))||void 0===e||e.show())}))}},{key:"unselect",value:function(){var t,e,n,i;null===(t=A(Gi,this))||void 0===t||t.classList.add("hidden"),null===(e=this.div)||void 0===e||e.classList.remove("selectedEditor"),null!==(n=this.div)&&void 0!==n&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),null===(i=A(Xi,this))||void 0===i||i.hide()}},{key:"updateParams",value:function(t,e){}},{key:"disableEditing",value:function(){}},{key:"enableEditing",value:function(){}},{key:"enterInEditMode",value:function(){}},{key:"getImageForAltText",value:function(){return null}},{key:"contentDiv",get:function(){return this.div}},{key:"isEditing",get:function(){return A(Ji,this)},set:function(t){_(Ji,this,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}},{key:"setAspectRatio",value:function(t,e){_(zi,this,!0);var n=t/e,i=this.div.style;i.aspectRatio=n,i.height="auto"}},{key:"telemetryInitialData",get:function(){return{action:"added"}}},{key:"telemetryFinalData",get:function(){return null}},{key:"_reportTelemetry",value:function(e){var n=this;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){A(ia,this)||_(ia,this,new Map);var i=e.action,a=A(ia,this).get(i);return a&&clearTimeout(a),a=setTimeout((function(){n._reportTelemetry(e),A(ia,n).delete(i),0===A(ia,n).size&&_(ia,n,null)}),t._telemetryTimeout),void A(ia,this).set(i,a)}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!t),this._isVisible=t}},{key:"enable",value:function(){this.div&&(this.div.tabIndex=0),_(ji,this,!1)}},{key:"disable",value:function(){this.div&&(this.div.tabIndex=-1),_(ji,this,!0)}},{key:"renderAnnotationElement",value:function(t){var e=t.container.querySelector(".annotationContent");if(e){if("CANVAS"===e.nodeName){var n=e;(e=document.createElement("div")).classList.add("annotationContent",this.editorType),n.before(e)}}else(e=document.createElement("div")).classList.add("annotationContent",this.editorType),t.container.prepend(e);return e}},{key:"resetAnnotationElement",value:function(t){var e=t.container.firstChild;"DIV"===e.nodeName&&e.classList.contains("annotationContent")&&e.remove()}}],[{key:"_resizerKeyboardManager",get:function(){var e=t.prototype._resizeWithKeyboard,n=oi.TRANSLATE_SMALL,i=oi.TRANSLATE_BIG;return dt(this,"_resizerKeyboardManager",new cn([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-n,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[n,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-n]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,n]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],t.prototype._stopResizingWithKeyboard]]))}},{key:"_defaultLineColor",get:function(){return dt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}},{key:"deleteAnnotationElement",value:function(t){var e=new Aa({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}},{key:"initialize",value:function(e,n,i){if(t._l10nPromise||(t._l10nPromise=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map((function(t){return[t,e.get(t.replaceAll(/([A-Z])/g,(function(t){return"-".concat(t.toLowerCase())})))]})))),null!=i&&i.strings){var a,r=R(i.strings);try{for(r.s();!(a=r.n()).done;){var s=a.value;t._l10nPromise.set(s,e.get(s))}}catch(t){r.e(t)}finally{r.f()}}if(-1===t._borderLineWidth){var o=getComputedStyle(document.documentElement);t._borderLineWidth=parseFloat(o.getPropertyValue("--outline-width"))||0}}},{key:"updateDefaultParams",value:function(t,e){}},{key:"defaultPropertiesToUpdate",get:function(){return[]}},{key:"isHandlingMimeForPasting",value:function(t){return!1}},{key:"paste",value:function(t,e){ht("Not implemented")}},{key:"deserialize",value:function(t,e,n){var i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n});i.rotation=t.rotation;var a=T(i.pageDimensions,2),r=a[0],s=a[1],o=T(i.getRectInCurrentCoords(t.rect,s),4),l=o[0],h=o[1],u=o[2],c=o[3];return i.x=l/r,i.y=h/s,i.width=u/r,i.height=c/s,i}},{key:"MIN_SIZE",get:function(){return 16}},{key:"canCreateNewEmptyEditor",value:function(){return!0}}]);var e,n}();function la(t,e,n){var i=T(t,2),a=i[0],r=i[1],s=T(this.screenToPageTranslation(e,n),2);e=s[0],n=s[1],this.x+=e/a,this.y+=n/r,this.fixAndSetPosition()}function ha(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}function ua(t){switch(t){case 90:var e=T(this.pageDimensions,2),n=e[0],i=e[1];return[0,-n/i,i/n,0];case 180:return[-1,0,0,-1];case 270:var a=T(this.pageDimensions,2),r=a[0],s=a[1];return[0,r/s,-s/r,0];default:return[1,0,0,1]}}function ca(){if(!A(Gi,this)){_(Gi,this,document.createElement("div")),A(Gi,this).classList.add("resizers");for(var t=0,e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];t<e.length;t++){var n=e[t],i=document.createElement("div");A(Gi,this).append(i),i.classList.add("resizer",n),i.setAttribute("data-resizer-name",n),i.addEventListener("pointerdown",C(sa,this,da).bind(this,n)),i.addEventListener("contextmenu",be),i.tabIndex=-1}this.div.prepend(A(Gi,this))}}function da(t,e){var n,i=this;e.preventDefault();var a=xt.platform.isMac;if(!(0!==e.button||e.ctrlKey&&a)){null===(n=A(Hi,this))||void 0===n||n.toggle(!1);var r=C(sa,this,va).bind(this,t),s=this._isDraggable;this._isDraggable=!1;var o={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",r,o),window.addEventListener("contextmenu",be);var l=this.x,h=this.y,u=this.width,c=this.height,d=this.parent.div.style.cursor,f=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;var v=function t(){var e;i.parent.togglePointerEvents(!0),null===(e=A(Hi,i))||void 0===e||e.toggle(!0),i._isDraggable=s,window.removeEventListener("pointerup",t),window.removeEventListener("blur",t),window.removeEventListener("pointermove",r,o),window.removeEventListener("contextmenu",be),i.parent.div.style.cursor=d,i.div.style.cursor=f,C(sa,i,fa).call(i,l,h,u,c)};window.addEventListener("pointerup",v),window.addEventListener("blur",v)}}function fa(t,e,n,i){var a=this,r=this.x,s=this.y,o=this.width,l=this.height;r===t&&s===e&&o===n&&l===i||this.addCommands({cmd:function(){a.width=o,a.height=l,a.x=r,a.y=s;var t=T(a.parentDimensions,2),e=t[0],n=t[1];a.setDims(e*o,n*l),a.fixAndSetPosition()},undo:function(){a.width=n,a.height=i,a.x=t,a.y=e;var r=T(a.parentDimensions,2),s=r[0],o=r[1];a.setDims(s*n,o*i),a.fixAndSetPosition()},mustExec:!0})}function va(t,e){var n,i,r=T(this.parentDimensions,2),s=r[0],o=r[1],l=this.x,h=this.y,u=this.width,c=this.height,d=a.MIN_SIZE/s,f=a.MIN_SIZE/o,v=function(t){return Math.round(1e4*t)/1e4},p=C(sa,this,ua).call(this,this.rotation),g=function(t,e){return[p[0]*t+p[2]*e,p[1]*t+p[3]*e]},m=C(sa,this,ua).call(this,360-this.rotation),k=!1,b=!1;switch(t){case"topLeft":k=!0,n=function(t,e){return[0,0]},i=function(t,e){return[t,e]};break;case"topMiddle":n=function(t,e){return[t/2,0]},i=function(t,e){return[t/2,e]};break;case"topRight":k=!0,n=function(t,e){return[t,0]},i=function(t,e){return[0,e]};break;case"middleRight":b=!0,n=function(t,e){return[t,e/2]},i=function(t,e){return[0,e/2]};break;case"bottomRight":k=!0,n=function(t,e){return[t,e]},i=function(t,e){return[0,0]};break;case"bottomMiddle":n=function(t,e){return[t/2,e]},i=function(t,e){return[t/2,0]};break;case"bottomLeft":k=!0,n=function(t,e){return[0,e]},i=function(t,e){return[t,0]};break;case"middleLeft":b=!0,n=function(t,e){return[0,e/2]},i=function(t,e){return[t,e/2]}}var w,A,_=n(u,c),x=i(u,c),E=g.apply(void 0,y(x)),M=v(l+E[0]),S=v(h+E[1]),R=1,L=1,P=T(this.screenToPageTranslation(e.movementX,e.movementY),2),I=P[0],F=P[1],D=T((w=I/s,A=F/o,[m[0]*w+m[2]*A,m[1]*w+m[3]*A]),2);if(I=D[0],F=D[1],k){var N=Math.hypot(u,c);R=L=Math.max(Math.min(Math.hypot(x[0]-_[0]-I,x[1]-_[1]-F)/N,1/u,1/c),d/u,f/c)}else b?R=Math.max(d,Math.min(1,Math.abs(x[0]-_[0]-I)))/u:L=Math.max(f,Math.min(1,Math.abs(x[1]-_[1]-F)))/c;var O=v(u*R),W=v(c*L),B=M-(E=g.apply(void 0,y(i(O,W))))[0],H=S-E[1];this.width=O,this.height=W,this.x=B,this.y=H,this.setDims(s*O,o*W),this.fixAndSetPosition()}function pa(t){var e=xt.platform.isMac;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}function ga(t){var e,n,i=this,a=this._uiManager.isSelected(this);this._uiManager.setUpDragSession(),a&&(this.div.classList.add("moving"),e={passive:!0,capture:!0},_(ea,this,t.clientX),_(na,this,t.clientY),n=function(t){var e=t.clientX,n=t.clientY,a=T(i.screenToPageTranslation(e-A(ea,i),n-A(na,i)),2),r=a[0],s=a[1];_(ea,i,e),_(na,i,n),i._uiManager.dragSelectedEditors(r,s)},window.addEventListener("pointermove",n,e));var r=function r(){window.removeEventListener("pointerup",r),window.removeEventListener("blur",r),a&&(i.div.classList.remove("moving"),window.removeEventListener("pointermove",n,e)),_(Yi,i,!1),i._uiManager.endDragSession()||C(sa,i,pa).call(i,t)};window.addEventListener("pointerup",r),window.addEventListener("blur",r)}function ya(t){a._resizerKeyboardManager.exec(this,t)}function ma(t){var e;A($i,this)&&(null===(e=t.relatedTarget)||void 0===e?void 0:e.parentNode)!==A(Gi,this)&&C(sa,this,wa).call(this)}function ka(t){_(Ki,this,A($i,this)?t:"")}function ba(t){if(A(Bi,this)){var e,n=R(A(Bi,this));try{for(n.s();!(e=n.n()).done;)e.value.tabIndex=t}catch(t){n.e(t)}finally{n.f()}}}function wa(){if(_($i,this,!1),C(sa,this,ba).call(this,-1),A(Vi,this)){var t=A(Vi,this),e=t.savedX,n=t.savedY,i=t.savedWidth,a=t.savedHeight;C(sa,this,fa).call(this,e,n,i,a),_(Vi,this,null)}}a=oa,x(oa,"_borderLineWidth",-1),x(oa,"_colorManager",new fn),x(oa,"_zIndex",1),x(oa,"_telemetryTimeout",1e3);var Aa=function(t){function e(t){var n;return N(this,e),(n=O(this,e,[t])).annotationElementId=t.annotationElementId,n.deleted=!0,n}return H(e,t),F(e,[{key:"serialize",value:function(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}])}(oa),_a=3285377520,xa=4294901760,Ea=65535,Ma=function(){return F((function t(e){N(this,t),this.h1=e?4294967295&e:_a,this.h2=e?4294967295&e:_a}),[{key:"update",value:function(t){var e,n;if("string"==typeof t){e=new Uint8Array(2*t.length),n=0;for(var i=0,a=t.length;i<a;i++){var r=t.charCodeAt(i);r<=255?e[n++]=r:(e[n++]=r>>>8,e[n++]=255&r)}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");n=(e=t.slice()).byteLength}for(var s=n>>2,o=n-4*s,l=new Uint32Array(e.buffer,0,s),h=0,u=0,c=this.h1,d=this.h2,f=3432918353,v=461845907,p=11601,g=13715,y=0;y<s;y++)1&y?c=5*(c=(c^=h=(h=(h=(h=l[y])*f&xa|h*p&Ea)<<15|h>>>17)*v&xa|h*g&Ea)<<13|c>>>19)+3864292196:d=5*(d=(d^=u=(u=(u=(u=l[y])*f&xa|u*p&Ea)<<15|u>>>17)*v&xa|u*g&Ea)<<13|d>>>19)+3864292196;switch(h=0,o){case 3:h^=e[4*s+2]<<16;case 2:h^=e[4*s+1]<<8;case 1:h=(h=(h=(h^=e[4*s])*f&xa|h*p&Ea)<<15|h>>>17)*v&xa|h*g&Ea,1&s?c^=h:d^=h}this.h1=c,this.h2=d}},{key:"hexdigest",value:function(){var t=this.h1,e=this.h2;return t=3981806797*(t^=e>>>1)&xa|36045*t&Ea,t=444984403*(t^=(e=4283543511*e&xa|(2950163797*(e<<16|t>>>16)&xa)>>>16)>>>1)&xa|60499*t&Ea,((t^=(e=3301882366*e&xa|(3120437893*(e<<16|t>>>16)&xa)>>>16)>>>1)>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}])}(),Sa=Object.freeze({map:null,hash:"",transfer:void 0}),Ca=new WeakMap,Ta=new WeakMap,Ra=new WeakSet,La=function(){return F((function t(){N(this,t),m(this,Ra),k(this,Ca,!1),k(this,Ta,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}),[{key:"getValue",value:function(t,e){var n=A(Ta,this).get(t);return void 0===n?e:Object.assign(e,n)}},{key:"getRawValue",value:function(t){return A(Ta,this).get(t)}},{key:"remove",value:function(t){if(A(Ta,this).delete(t),0===A(Ta,this).size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){var e,n=R(A(Ta,this).values());try{for(n.s();!(e=n.n()).done;)if(e.value instanceof oa)return}catch(t){n.e(t)}finally{n.f()}this.onAnnotationEditor(null)}}},{key:"setValue",value:function(t,e){var n=A(Ta,this).get(t),i=!1;if(void 0!==n)for(var a=0,r=Object.entries(e);a<r.length;a++){var s=T(r[a],2),o=s[0],l=s[1];n[o]!==l&&(i=!0,n[o]=l)}else i=!0,A(Ta,this).set(t,e);i&&C(Ra,this,Pa).call(this),e instanceof oa&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}},{key:"has",value:function(t){return A(Ta,this).has(t)}},{key:"getAll",value:function(){return A(Ta,this).size>0?_t(A(Ta,this)):null}},{key:"setAll",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var i=T(n[e],2),a=i[0],r=i[1];this.setValue(a,r)}}},{key:"size",get:function(){return A(Ta,this).size}},{key:"resetModified",value:function(){A(Ca,this)&&(_(Ca,this,!1),"function"==typeof this.onResetModified&&this.onResetModified())}},{key:"print",get:function(){return new Fa(this)}},{key:"serializable",get:function(){if(0===A(Ta,this).size)return Sa;var t,e=new Map,n=new Ma,i=[],a=Object.create(null),r=!1,s=R(A(Ta,this));try{for(s.s();!(t=s.n()).done;){var o=T(t.value,2),l=o[0],h=o[1],u=h instanceof oa?h.serialize(!1,a):h;u&&(e.set(l,u),n.update("".concat(l,":").concat(JSON.stringify(u))),r||(r=!!u.bitmap))}}catch(t){s.e(t)}finally{s.f()}if(r){var c,d=R(e.values());try{for(d.s();!(c=d.n()).done;){var f=c.value;f.bitmap&&i.push(f.bitmap)}}catch(t){d.e(t)}finally{d.f()}}return e.size>0?{map:e,hash:n.hexdigest(),transfer:i}:Sa}},{key:"editorStats",get:function(){var t,e=null,n=new Map,i=R(A(Ta,this).values());try{for(i.s();!(t=i.n()).done;){var a,r=t.value;if(r instanceof oa){var s=r.telemetryFinalData;if(s){var o=s.type;n.has(o)||n.set(o,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));for(var l=(a=e)[o]||(a[o]=new Map),h=0,u=Object.entries(s);h<u.length;h++){var c,d=T(u[h],2),f=d[0],v=d[1];if("type"!==f){var p=l.get(f);p||(p=new Map,l.set(f,p));var g=null!==(c=p.get(v))&&void 0!==c?c:0;p.set(v,g+1)}}}}}}catch(t){i.e(t)}finally{i.f()}var y,m=R(n);try{for(m.s();!(y=m.n()).done;){var k=T(y.value,2),b=k[0],w=k[1];e[b]=w.computeTelemetryFinalData(e[b])}}catch(t){m.e(t)}finally{m.f()}return e}}])}();function Pa(){A(Ca,this)||(_(Ca,this,!0),"function"==typeof this.onSetModified&&this.onSetModified())}var Ia=new WeakMap,Fa=function(t){function e(t){var n;N(this,e),k(n=O(this,e),Ia,void 0);var i=t.serializable,a=i.map,r=i.hash,s=i.transfer,o=structuredClone(a,s?{transfer:s}:null);return _(Ia,n,{map:o,hash:r,transfer:s}),n}return H(e,t),F(e,[{key:"print",get:function(){ht("Should not call PrintAnnotationStorage.print")}},{key:"serializable",get:function(){return A(Ia,this)}}])}(La),Da=new WeakMap,Na=function(){return F((function t(e){var n=e.ownerDocument,i=void 0===n?globalThis.document:n;e.styleElement,N(this,t),k(this,Da,new Set),this._document=i,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}),[{key:"addNativeFontFace",value:function(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}},{key:"removeNativeFontFace",value:function(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}},{key:"insertRule",value:function(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));var e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}},{key:"clear",value:function(){var t,e=R(this.nativeFontFaces);try{for(e.s();!(t=e.n()).done;){var n=t.value;this._document.fonts.delete(n)}}catch(t){e.e(t)}finally{e.f()}this.nativeFontFaces.clear(),A(Da,this).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}},{key:"loadSystemFont",value:(e=S(E().mark((function t(e){var n,i,a,r,s,o;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.systemFontInfo,i=e._inspectFont,n&&!A(Da,this).has(n.loadedName)){t.next=3;break}return t.abrupt("return");case 3:if(ut(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),!this.isFontLoadingAPISupported){t.next=20;break}return a=n.loadedName,r=n.src,s=n.style,o=new FontFace(a,r,s),this.addNativeFontFace(o),t.prev=8,t.next=11,o.load();case 11:A(Da,this).add(a),null==i||i(n),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(8),lt("Cannot load system font: ".concat(n.baseFontName,", installing it could help to improve PDF rendering.")),this.removeNativeFontFace(o);case 19:return t.abrupt("return");case 20:ht("Not implemented: loadSystemFont without the Font Loading API.");case 21:case"end":return t.stop()}}),t,this,[[8,15]])}))),function(t){return e.apply(this,arguments)})},{key:"bind",value:(t=S(E().mark((function t(e){var n,i,a=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.attached||e.missingFile&&!e.systemFontInfo)){t.next=2;break}return t.abrupt("return");case 2:if(e.attached=!0,!e.systemFontInfo){t.next=7;break}return t.next=6,this.loadSystemFont(e);case 6:case 21:return t.abrupt("return");case 7:if(!this.isFontLoadingAPISupported){t.next=22;break}if(!(n=e.createNativeFontFace())){t.next=21;break}return this.addNativeFontFace(n),t.prev=11,t.next=14,n.loaded;case 14:t.next=21;break;case 16:throw t.prev=16,t.t0=t.catch(11),lt("Failed to load font '".concat(n.family,"': '").concat(t.t0,"'.")),e.disableFontFace=!0,t.t0;case 22:if(!(i=e.createFontFaceRule())){t.next=29;break}if(this.insertRule(i),!this.isSyncFontLoadingSupported){t.next=27;break}return t.abrupt("return");case 27:return t.next=29,new Promise((function(t){var n=a._queueLoadingCallback(t);a._prepareFontLoadEvent(e,n)}));case 29:case"end":return t.stop()}}),t,this,[[11,16]])}))),function(e){return t.apply(this,arguments)})},{key:"isFontLoadingAPISupported",get:function(){var t;return dt(this,"isFontLoadingAPISupported",!(null===(t=this._document)||void 0===t||!t.fonts))}},{key:"isSyncFontLoadingSupported",get:function(){var t,e=!1;return(q||"undefined"!=typeof navigator&&"string"==typeof(null===(t=navigator)||void 0===t?void 0:t.userAgent)&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),dt(this,"isSyncFontLoadingSupported",e)}},{key:"_queueLoadingCallback",value:function(t){var e=this.loadingRequests,n={done:!1,complete:function(){for(ut(!n.done,"completeRequest() cannot be called twice."),n.done=!0;e.length>0&&e[0].done;){var t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(n),n}},{key:"_loadTestFont",get:function(){return dt(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}},{key:"_prepareFontLoadEvent",value:function(t,e){function n(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function i(t,e,n,i){return t.substring(0,e)+i+t.substring(e+n)}var a,r,s=this._document.createElement("canvas");s.width=1,s.height=1;var o,l=s.getContext("2d"),h=0,u="lt".concat(Date.now()).concat(this.loadTestFontId++),c=this._loadTestFont,d=1482184792,f=n(c=i(c,976,u.length,u),16);for(a=0,r=u.length-3;a<r;a+=4)f=f-d+n(u,a)|0;a<u.length&&(f=f-d+n(u+"XXX",a)|0),c=i(c,16,4,(o=f,String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o)));var v="url(data:font/opentype;base64,".concat(btoa(c),");"),p='@font-face {font-family:"'.concat(u,'";src:').concat(v,"}");this.insertRule(p);var g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(var y=0,m=[t.loadedName,u];y<m.length;y++){var k=m[y],b=this._document.createElement("span");b.textContent="Hi",b.style.fontFamily=k,g.append(b)}this._document.body.append(g),function t(e,n){if(++h>30)return lt("Load test font never loaded."),void n();l.font="30px "+e,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?n():setTimeout(t.bind(null,e,n))}(u,(function(){g.remove(),e.complete()}))}}]);var t,e}(),Oa=function(){return F((function t(e,n){var i=n.disableFontFace,a=void 0!==i&&i,r=n.inspectFont,s=void 0===r?null:r;for(var o in N(this,t),this.compiledGlyphs=Object.create(null),e)this[o]=e[o];this.disableFontFace=!0===a,this._inspectFont=s}),[{key:"createNativeFontFace",value:function(){var t,e;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){var n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}else e=new FontFace(this.loadedName,this.data,{});return null===(t=this._inspectFont)||void 0===t||t.call(this,this),e}},{key:"createFontFaceRule",value:function(){var t;if(!this.data||this.disableFontFace)return null;var e,n=wt(this.data),i="url(data:".concat(this.mimetype,";base64,").concat(btoa(n),");");if(this.cssFontInfo){var a="font-weight: ".concat(this.cssFontInfo.fontWeight,";");this.cssFontInfo.italicAngle&&(a+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")),e='@font-face {font-family:"'.concat(this.cssFontInfo.fontFamily,'";').concat(a,"src:").concat(i,"}")}else e='@font-face {font-family:"'.concat(this.loadedName,'";src:').concat(i,"}");return null===(t=this._inspectFont)||void 0===t||t.call(this,this,i),e}},{key:"getPathGenerator",value:function(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];var n;try{n=t.get(this.loadedName+"_path_"+e)}catch(t){lt('getPathGenerator - ignoring character: "'.concat(t,'".'))}if(!Array.isArray(n)||0===n.length)return this.compiledGlyphs[e]=function(t,e){};for(var i=[],a=function(t){switch(n[t++]){case 0:var e=T(n.slice(t,t+6),6),a=e[0],s=e[1],o=e[2],l=e[3],h=e[4],u=e[5];i.push((function(t){return t.bezierCurveTo(a,s,o,l,h,u)})),t+=6;break;case 1:var c=T(n.slice(t,t+2),2),d=c[0],f=c[1];i.push((function(t){return t.moveTo(d,f)})),t+=2;break;case 2:var v=T(n.slice(t,t+2),2),p=v[0],g=v[1];i.push((function(t){return t.lineTo(p,g)})),t+=2;break;case 3:var y=T(n.slice(t,t+4),4),m=y[0],k=y[1],b=y[2],w=y[3];i.push((function(t){return t.quadraticCurveTo(m,k,b,w)})),t+=4;break;case 4:i.push((function(t){return t.restore()}));break;case 5:i.push((function(t){return t.save()}));break;case 6:ut(2===i.length,"Scale command is only valid at the third position.");break;case 7:var A=T(n.slice(t,t+6),6),_=A[0],x=A[1],E=A[2],M=A[3],S=A[4],C=A[5];i.push((function(t){return t.transform(_,x,E,M,S,C)})),t+=6;break;case 8:var R=T(n.slice(t,t+2),2),L=R[0],P=R[1];i.push((function(t){return t.translate(L,P)})),t+=2}r=t},r=0,s=n.length;r<s;)a(r);return this.compiledGlyphs[e]=function(t,e){i[0](t),i[1](t),t.scale(e,-e);for(var n=2,a=i.length;n<a;n++)i[n](t)}}}])}();if(q){var Wa=Promise.withResolvers(),Ba=null;(function(){var t=S(E().mark((function t(){var e,n,i,a;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,import("fs");case 2:return e=t.sent,t.next=5,import("http");case 5:return n=t.sent,t.next=8,import("https");case 8:return i=t.sent,t.next=11,import("url");case 11:return a=t.sent,t.abrupt("return",new Map(Object.entries({fs:e,http:n,https:i,url:a,canvas:void 0,path2d:void 0})));case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()().then((function(t){Ba=t,Wa.resolve()}),(function(t){lt("loadPackages: ".concat(t)),Ba=new Map,Wa.resolve()}))}var Ha=function(){return F((function t(){N(this,t)}),null,[{key:"promise",get:function(){return Wa.promise}},{key:"get",value:function(t){var e;return null===(e=Ba)||void 0===e?void 0:e.get(t)}}])}(),ja=function(t){return Ha.get("fs").promises.readFile(t).then((function(t){return new Uint8Array(t)}))},za=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e)}(It),Ga=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"_createCanvas",value:function(t,e){return Ha.get("canvas").createCanvas(t,e)}}])}(Ft),Va=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"_fetchData",value:function(t,e){return ja(t).then((function(t){return{cMapData:t,compressionType:e}}))}}])}(Dt),qa=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"_fetchData",value:function(t){return ja(t)}}])}(Nt),Ua="Fill",Xa="Stroke",Ka="Shading";function Ya(t,e){if(e){var n=e[2]-e[0],i=e[3]-e[1],a=new Path2D;a.rect(e[0],e[1],n,i),t.clip(a)}}var Qa=function(){return F((function t(){N(this,t),this.constructor===t&&ht("Cannot initialize BaseShadingPattern.")}),[{key:"getPattern",value:function(){ht("Abstract method `getPattern` called.")}}])}(),Ja=function(t){function e(t){var n;return N(this,e),(n=O(this,e))._type=t[1],n._bbox=t[2],n._colorStops=t[3],n._p0=t[4],n._p1=t[5],n._r0=t[6],n._r1=t[7],n.matrix=null,n}return H(e,t),F(e,[{key:"_createGradient",value:function(t){var e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));var n,i=R(this._colorStops);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.addColorStop(a[0],a[1])}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"getPattern",value:function(t,e,n,i){var a;if(i===Xa||i===Ua){var r=e.current.getClippedPathBoundingBox(i,Ee(t))||[0,0,0,0],s=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=e.cachedCanvases.getCanvas("pattern",s,o,!0),h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),n=Mt.transform(n,[1,0,0,1,r[0],r[1]]),h.transform.apply(h,y(e.baseTransform)),this.matrix&&h.transform.apply(h,y(this.matrix)),Ya(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),a=t.createPattern(l.canvas,"no-repeat");var u=new DOMMatrix(n);a.setTransform(u)}else Ya(t,this._bbox),a=this._createGradient(t);return a}}])}(Qa);function Za(t,e,n,i,a,r,s,o){var l,h=e.coords,u=e.colors,c=t.data,d=4*t.width;h[n+1]>h[i+1]&&(l=n,n=i,i=l,l=r,r=s,s=l),h[i+1]>h[a+1]&&(l=i,i=a,a=l,l=s,s=o,o=l),h[n+1]>h[i+1]&&(l=n,n=i,i=l,l=r,r=s,s=l);var f=(h[n]+e.offsetX)*e.scaleX,v=(h[n+1]+e.offsetY)*e.scaleY,p=(h[i]+e.offsetX)*e.scaleX,g=(h[i+1]+e.offsetY)*e.scaleY,y=(h[a]+e.offsetX)*e.scaleX,m=(h[a+1]+e.offsetY)*e.scaleY;if(!(v>=m))for(var k,b,w,A,_,x,E,M,S=u[r],C=u[r+1],T=u[r+2],R=u[s],L=u[s+1],P=u[s+2],I=u[o],F=u[o+1],D=u[o+2],N=Math.round(v),O=Math.round(m),W=N;W<=O;W++){if(W<g){var B=W<v?0:(v-W)/(v-g);k=f-(f-p)*B,b=S-(S-R)*B,w=C-(C-L)*B,A=T-(T-P)*B}else{var H;k=p-(p-y)*(H=W>m?1:g===m?0:(g-W)/(g-m)),b=R-(R-I)*H,w=L-(L-F)*H,A=P-(P-D)*H}var j=void 0;_=f-(f-y)*(j=W<v?0:W>m?1:(v-W)/(v-m)),x=S-(S-I)*j,E=C-(C-F)*j,M=T-(T-D)*j;for(var z=Math.round(Math.min(k,_)),G=Math.round(Math.max(k,_)),V=d*W+4*z,q=z;q<=G;q++)(j=(k-q)/(k-_))<0?j=0:j>1&&(j=1),c[V++]=b-(b-x)*j|0,c[V++]=w-(w-E)*j|0,c[V++]=A-(A-M)*j|0,c[V++]=255}}function $a(t,e,n){var i,a,r=e.coords,s=e.colors;switch(e.type){case"lattice":var o=e.verticesPerRow,l=Math.floor(r.length/o)-1,h=o-1;for(i=0;i<l;i++)for(var u=i*o,c=0;c<h;c++,u++)Za(t,n,r[u],r[u+1],r[u+o],s[u],s[u+1],s[u+o]),Za(t,n,r[u+o+1],r[u+1],r[u+o],s[u+o+1],s[u+1],s[u+o]);break;case"triangles":for(i=0,a=r.length;i<a;i+=3)Za(t,n,r[i],r[i+1],r[i+2],s[i],s[i+1],s[i+2]);break;default:throw new Error("illegal figure")}}var tr=function(t){function e(t){var n;return N(this,e),(n=O(this,e))._coords=t[2],n._colors=t[3],n._figures=t[4],n._bounds=t[5],n._bbox=t[7],n._background=t[8],n.matrix=null,n}return H(e,t),F(e,[{key:"_createMeshCanvas",value:function(t,e,n){var i=Math.floor(this._bounds[0]),a=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-i,s=Math.ceil(this._bounds[3])-a,o=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*t[1]*1.1)),3e3),h=r/o,u=s/l,c={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-a,scaleX:1/h,scaleY:1/u},d=o+4,f=l+4,v=n.getCanvas("mesh",d,f,!1),p=v.context,g=p.createImageData(o,l);if(e)for(var y=g.data,m=0,k=y.length;m<k;m+=4)y[m]=e[0],y[m+1]=e[1],y[m+2]=e[2],y[m+3]=255;var b,w=R(this._figures);try{for(w.s();!(b=w.n()).done;)$a(g,b.value,c)}catch(t){w.e(t)}finally{w.f()}return p.putImageData(g,2,2),{canvas:v.canvas,offsetX:i-2*h,offsetY:a-2*u,scaleX:h,scaleY:u}}},{key:"getPattern",value:function(t,e,n,i){var a;if(Ya(t,this._bbox),i===Ka)a=Mt.singularValueDecompose2dScale(Ee(t));else if(a=Mt.singularValueDecompose2dScale(e.baseTransform),this.matrix){var r=Mt.singularValueDecompose2dScale(this.matrix);a=[a[0]*r[0],a[1]*r[1]]}var s=this._createMeshCanvas(a,i===Ka?null:this._background,e.cachedCanvases);return i!==Ka&&(t.setTransform.apply(t,y(e.baseTransform)),this.matrix&&t.transform.apply(t,y(this.matrix))),t.translate(s.offsetX,s.offsetY),t.scale(s.scaleX,s.scaleY),t.createPattern(s.canvas,"no-repeat")}}])}(Qa),er=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"getPattern",value:function(){return"hotpink"}}])}(Qa),nr=function(){function t(e,n,i,a,r){N(this,t),this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=n,this.ctx=i,this.canvasGraphicsFactory=a,this.baseTransform=r}return F(t,[{key:"createPatternCanvas",value:function(t){var e=this.operatorList,n=this.bbox,i=this.xstep,a=this.ystep,r=this.paintType,s=this.tilingType,o=this.color,l=this.canvasGraphicsFactory;ot("TilingType: "+s);var h=n[0],u=n[1],c=n[2],d=n[3],f=Mt.singularValueDecompose2dScale(this.matrix),v=Mt.singularValueDecompose2dScale(this.baseTransform),p=[f[0]*v[0],f[1]*v[1]],g=this.getSizeAndScale(i,this.ctx.canvas.width,p[0]),y=this.getSizeAndScale(a,this.ctx.canvas.height,p[1]),m=t.cachedCanvases.getCanvas("pattern",g.size,y.size,!0),k=m.context,b=l.createCanvasGraphics(k);b.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(b,r,o);var w=h,A=u,_=c,x=d;return h<0&&(w=0,_+=Math.abs(h)),u<0&&(A=0,x+=Math.abs(u)),k.translate(-g.scale*w,-y.scale*A),b.transform(g.scale,0,0,y.scale,0,0),k.save(),this.clipBbox(b,w,A,_,x),b.baseTransform=Ee(b.ctx),b.executeOperatorList(e),b.endDrawing(),{canvas:m.canvas,scaleX:g.scale,scaleY:y.scale,offsetX:w,offsetY:A}}},{key:"getSizeAndScale",value:function(e,n,i){e=Math.abs(e);var a=Math.max(t.MAX_PATTERN_SIZE,n),r=Math.ceil(e*i);return r>=a?r=a:i=r/e,{scale:i,size:r}}},{key:"clipBbox",value:function(t,e,n,i,a){var r=i-e,s=a-n;t.ctx.rect(e,n,r,s),t.current.updateRectMinMax(Ee(t.ctx),[e,n,i,a]),t.clip(),t.endPath()}},{key:"setFillAndStrokeStyleToContext",value:function(t,e,n){var i=t.ctx,a=t.current;switch(e){case 1:var r=this.ctx;i.fillStyle=r.fillStyle,i.strokeStyle=r.strokeStyle,a.fillColor=r.fillStyle,a.strokeColor=r.strokeStyle;break;case 2:var s=Mt.makeHexColor(n[0],n[1],n[2]);i.fillStyle=s,i.strokeStyle=s,a.fillColor=s,a.strokeColor=s;break;default:throw new kt("Unsupported paint type: ".concat(e))}}},{key:"getPattern",value:function(t,e,n,i){var a=n;i!==Ka&&(a=Mt.transform(a,e.baseTransform),this.matrix&&(a=Mt.transform(a,this.matrix)));var r=this.createPatternCanvas(e),s=new DOMMatrix(a);s=(s=s.translate(r.offsetX,r.offsetY)).scale(1/r.scaleX,1/r.scaleY);var o=t.createPattern(r.canvas,"repeat");return o.setTransform(s),o}}])}();function ir(t){var e=t.src,n=t.srcPos,i=void 0===n?0:n,a=t.dest,r=t.width,s=t.height,o=t.nonBlackColor,l=void 0===o?4294967295:o,h=t.inverseDecode,u=void 0!==h&&h,c=xt.isLittleEndian?4278190080:255,d=T(u?[l,c]:[c,l],2),f=d[0],v=d[1],p=r>>3,g=7&r,y=e.length;a=new Uint32Array(a.buffer);for(var m=0,k=0;k<s;k++){for(var b=i+p;i<b;i++){var w=i<y?e[i]:255;a[m++]=128&w?v:f,a[m++]=64&w?v:f,a[m++]=32&w?v:f,a[m++]=16&w?v:f,a[m++]=8&w?v:f,a[m++]=4&w?v:f,a[m++]=2&w?v:f,a[m++]=1&w?v:f}if(0!==g)for(var A=i<y?e[i++]:255,_=0;_<g;_++)a[m++]=A&1<<7-_?v:f}return{srcPos:i,destPos:m}}x(nr,"MAX_PATTERN_SIZE",3e3);var ar=16,rr=function(){return F((function t(e){N(this,t),this.canvasFactory=e,this.cache=Object.create(null)}),[{key:"getCanvas",value:function(t,e,n){var i;return void 0!==this.cache[t]?(i=this.cache[t],this.canvasFactory.reset(i,e,n)):(i=this.canvasFactory.create(e,n),this.cache[t]=i),i}},{key:"delete",value:function(t){delete this.cache[t]}},{key:"clear",value:function(){for(var t in this.cache){var e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}])}();function sr(t,e,n,i,a,r,s,o,l,h){var u=T(Ee(t),6),c=u[0],d=u[1],f=u[2],v=u[3],p=u[4],g=u[5];if(0===d&&0===f){var y=s*c+p,m=Math.round(y),k=o*v+g,b=Math.round(k),w=(s+l)*c+p,A=Math.abs(Math.round(w)-m)||1,_=(o+h)*v+g,x=Math.abs(Math.round(_)-b)||1;return t.setTransform(Math.sign(c),0,0,Math.sign(v),m,b),t.drawImage(e,n,i,a,r,0,0,A,x),t.setTransform(c,d,f,v,p,g),[A,x]}if(0===c&&0===v){var E=o*f+p,M=Math.round(E),S=s*d+g,C=Math.round(S),R=(o+h)*f+p,L=Math.abs(Math.round(R)-M)||1,P=(s+l)*d+g,I=Math.abs(Math.round(P)-C)||1;return t.setTransform(0,Math.sign(d),Math.sign(f),0,M,C),t.drawImage(e,n,i,a,r,0,0,I,L),t.setTransform(c,d,f,v,p,g),[I,L]}return t.drawImage(e,n,i,a,r,s,o,l,h),[Math.hypot(c,d)*l,Math.hypot(f,v)*h]}var or=function(){return F((function t(e,n){N(this,t),this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=U,this.textMatrixScale=1,this.fontMatrix=X,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=0,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,n])}),[{key:"clone",value:function(){var t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}},{key:"setCurrentPoint",value:function(t,e){this.x=t,this.y=e}},{key:"updatePathMinMax",value:function(t,e,n){var i=T(Mt.applyTransform([e,n],t),2);e=i[0],n=i[1],this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,n)}},{key:"updateRectMinMax",value:function(t,e){var n=Mt.applyTransform(e,t),i=Mt.applyTransform(e.slice(2),t),a=Mt.applyTransform([e[0],e[3]],t),r=Mt.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,n[0],i[0],a[0],r[0]),this.minY=Math.min(this.minY,n[1],i[1],a[1],r[1]),this.maxX=Math.max(this.maxX,n[0],i[0],a[0],r[0]),this.maxY=Math.max(this.maxY,n[1],i[1],a[1],r[1])}},{key:"updateScalingPathMinMax",value:function(t,e){Mt.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}},{key:"updateCurvePathMinMax",value:function(t,e,n,i,a,r,s,o,l,h){var u=Mt.bezierBoundingBox(e,n,i,a,r,s,o,l,h);h||this.updateRectMinMax(t,u)}},{key:"getPathBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ua,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[this.minX,this.minY,this.maxX,this.maxY];if(t===Xa){e||ht("Stroke bounding box must include transform.");var i=Mt.singularValueDecompose2dScale(e),a=i[0]*this.lineWidth/2,r=i[1]*this.lineWidth/2;n[0]-=a,n[1]-=r,n[2]+=a,n[3]+=r}return n}},{key:"updateClipFromPath",value:function(){var t=Mt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}},{key:"isEmptyClip",value:function(){return this.minX===1/0}},{key:"startNewPathAndClipBox",value:function(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}},{key:"getClippedPathBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ua,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Mt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}])}();function lr(t,e){if("undefined"!=typeof ImageData&&e instanceof ImageData)t.putImageData(e,0,0);else{var n,i,a,r,s,o=e.height,l=e.width,h=o%ar,u=(o-h)/ar,c=0===h?u:u+1,d=t.createImageData(l,ar),f=0,v=e.data,p=d.data;if(e.kind===$.GRAYSCALE_1BPP){var g=v.byteLength,y=new Uint32Array(p.buffer,0,p.byteLength>>2),m=y.length,k=l+7>>3,b=4294967295,w=xt.isLittleEndian?4278190080:255;for(i=0;i<c;i++){for(r=i<u?ar:h,n=0,a=0;a<r;a++){for(var A=g-f,_=0,x=A>k?l:8*A-7,E=-8&x,M=0,S=0;_<E;_+=8)S=v[f++],y[n++]=128&S?b:w,y[n++]=64&S?b:w,y[n++]=32&S?b:w,y[n++]=16&S?b:w,y[n++]=8&S?b:w,y[n++]=4&S?b:w,y[n++]=2&S?b:w,y[n++]=1&S?b:w;for(;_<x;_++)0===M&&(S=v[f++],M=128),y[n++]=S&M?b:w,M>>=1}for(;n<m;)y[n++]=0;t.putImageData(d,0,i*ar)}}else if(e.kind===$.RGBA_32BPP){for(a=0,s=l*ar*4,i=0;i<u;i++)p.set(v.subarray(f,f+s)),f+=s,t.putImageData(d,0,a),a+=ar;i<c&&(s=l*h*4,p.set(v.subarray(f,f+s)),t.putImageData(d,0,a))}else{if(e.kind!==$.RGB_24BPP)throw new Error("bad image kind: ".concat(e.kind));for(s=l*(r=ar),i=0;i<c;i++){for(i>=u&&(s=l*(r=h)),n=0,a=s;a--;)p[n++]=v[f++],p[n++]=v[f++],p[n++]=v[f++],p[n++]=255;t.putImageData(d,0,i*ar)}}}}function hr(t,e){if(e.bitmap)t.drawImage(e.bitmap,0,0);else for(var n=e.height,i=e.width,a=n%ar,r=(n-a)/ar,s=0===a?r:r+1,o=t.createImageData(i,ar),l=0,h=e.data,u=o.data,c=0;c<s;c++)l=ir({src:h,srcPos:l,dest:u,width:i,height:c<r?ar:a,nonBlackColor:0}).srcPos,t.putImageData(o,0,c*ar)}function ur(t,e){for(var n=0,i=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];n<i.length;n++){var a=i[n];void 0!==t[a]&&(e[a]=t[a])}void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function cr(t){if(t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0),!q){var e=t.filter;"none"!==e&&""!==e&&(t.filter="none")}}function dr(t,e){if(e)return!0;var n=Mt.singularValueDecompose2dScale(t);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);var i=Math.fround((globalThis.devicePixelRatio||1)*Bt.PDF_TO_CSS_UNITS);return n[0]<=i&&n[1]<=i}var fr=["butt","round","square"],vr=["miter","round","bevel"],pr={},gr={},yr=new WeakSet,mr=function(){function t(e,n,i,a,r,s,o,l){var h=s.optionalContentConfig,u=s.markedContentStack,c=void 0===u?null:u;N(this,t),m(this,yr),this.ctx=e,this.current=new or(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=i,this.canvasFactory=a,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=h,this.cachedCanvases=new rr(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}return F(t,[{key:"getObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof t?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}},{key:"beginDrawing",value:function(t){var e,n,i=t.transform,a=t.viewport,r=t.transparency,s=void 0!==r&&r,o=t.background,l=void 0===o?null:o,h=this.ctx.canvas.width,u=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=l||"#ffffff",this.ctx.fillRect(0,0,h,u),this.ctx.fillStyle=c,s){var d,f=this.cachedCanvases.getCanvas("transparent",h,u);this.compositeCtx=this.ctx,this.transparentCanvas=f.canvas,this.ctx=f.context,this.ctx.save(),(d=this.ctx).transform.apply(d,y(Ee(this.compositeCtx)))}this.ctx.save(),cr(this.ctx),i&&((n=this.ctx).transform.apply(n,y(i)),this.outputScaleX=i[0],this.outputScaleY=i[0]),(e=this.ctx).transform.apply(e,y(a.transform)),this.viewportScale=a.scale,this.baseTransform=Ee(this.ctx)}},{key:"executeOperatorList",value:function(t,e,n,i){var a=t.argsArray,r=t.fnArray,s=e||0,o=a.length;if(o===s)return s;for(var l,h=o-s>10&&"function"==typeof n,u=h?Date.now()+15:0,c=0,d=this.commonObjs,f=this.objs;;){if(void 0!==i&&s===i.nextBreakPoint)return i.breakIt(s,n),s;if((l=r[s])!==nt.dependency)this[l].apply(this,a[s]);else{var v,p=R(a[s]);try{for(p.s();!(v=p.n()).done;){var g=v.value,y=g.startsWith("g_")?d:f;if(!y.has(g))return y.get(g,n),s}}catch(t){p.e(t)}finally{p.f()}}if(++s===o)return s;if(h&&++c>10){if(Date.now()>u)return n(),s;c=0}}}},{key:"endDrawing",value:function(){C(yr,this,kr).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();var t,e=R(this._cachedBitmapsMap.values());try{for(e.s();!(t=e.n()).done;){var n,i=t.value,a=R(i.values());try{for(a.s();!(n=a.n()).done;){var r=n.value;"undefined"!=typeof HTMLCanvasElement&&r instanceof HTMLCanvasElement&&(r.width=r.height=0)}}catch(t){a.e(t)}finally{a.f()}i.clear()}}catch(t){e.e(t)}finally{e.f()}this._cachedBitmapsMap.clear(),C(yr,this,br).call(this)}},{key:"_scaleImage",value:function(t,e){for(var n,i,a=t.width,r=t.height,s=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),l=a,h=r,u="prescale1";s>2&&l>1||o>2&&h>1;){var c=l,d=h;s>2&&l>1&&(s/=l/(c=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2))),o>2&&h>1&&(o/=h/(d=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2)),(i=(n=this.cachedCanvases.getCanvas(u,c,d)).context).clearRect(0,0,c,d),i.drawImage(t,0,0,l,h,0,0,c,d),t=n.canvas,l=c,h=d,u="prescale1"===u?"prescale2":"prescale1"}return{img:t,paintWidth:l,paintHeight:h}}},{key:"_createMaskCanvas",value:function(t){var e,n,i,a,r=this.ctx,s=t.width,o=t.height,l=this.current.fillColor,h=this.current.patternFill,u=Ee(r);if((t.bitmap||t.data)&&t.count>1){var c=t.bitmap||t.data.buffer;n=JSON.stringify(h?u:[u.slice(0,4),l]),(e=this._cachedBitmapsMap.get(c))||(e=new Map,this._cachedBitmapsMap.set(c,e));var d=e.get(n);if(d&&!h)return{canvas:d,offsetX:Math.round(Math.min(u[0],u[2])+u[4]),offsetY:Math.round(Math.min(u[1],u[3])+u[5])};i=d}i||hr((a=this.cachedCanvases.getCanvas("maskCanvas",s,o)).context,t);var f=Mt.transform(u,[1/s,0,0,-1/o,0,0]);f=Mt.transform(f,[1,0,0,1,0,-o]);var v=T(Mt.getAxialAlignedBoundingBox([0,0,s,o],f),4),p=v[0],g=v[1],m=v[2],k=v[3],b=Math.round(m-p)||1,w=Math.round(k-g)||1,A=this.cachedCanvases.getCanvas("fillCanvas",b,w),_=A.context,x=p,E=g;_.translate(-x,-E),_.transform.apply(_,y(f)),i||(i=(i=this._scaleImage(a.canvas,Me(_))).img,e&&h&&e.set(n,i)),_.imageSmoothingEnabled=dr(Ee(_),t.interpolate),sr(_,i,0,0,i.width,i.height,0,0,s,o),_.globalCompositeOperation="source-in";var M=Mt.transform(Me(_),[1,0,0,1,-x,-E]);return _.fillStyle=h?l.getPattern(r,this,M,Ua):l,_.fillRect(0,0,s,o),e&&!h&&(this.cachedCanvases.delete("fillCanvas"),e.set(n,A.canvas)),{canvas:A.canvas,offsetX:Math.round(x),offsetY:Math.round(E)}}},{key:"setLineWidth",value:function(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}},{key:"setLineCap",value:function(t){this.ctx.lineCap=fr[t]}},{key:"setLineJoin",value:function(t){this.ctx.lineJoin=vr[t]}},{key:"setMiterLimit",value:function(t){this.ctx.miterLimit=t}},{key:"setDash",value:function(t,e){var n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(t),n.lineDashOffset=e)}},{key:"setRenderingIntent",value:function(t){}},{key:"setFlatness",value:function(t){}},{key:"setGState",value:function(t){var e,n=R(t);try{for(n.s();!(e=n.n()).done;){var i=T(e.value,2),a=i[0],r=i[1];switch(a){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r,this.ctx.globalAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r)}}}catch(t){n.e(t)}finally{n.f()}}},{key:"inSMaskMode",get:function(){return!!this.suspendedCtx}},{key:"checkSMaskState",value:function(){var t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}},{key:"beginSMaskMode",value:function(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");var t=this.ctx.canvas.width,e=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,e);this.suspendedCtx=this.ctx,this.ctx=i.context;var a=this.ctx;a.setTransform.apply(a,y(Ee(this.suspendedCtx))),ur(this.suspendedCtx,a),function(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=function(){t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){e.save(),this.__originalSave()},t.restore=function(){e.restore(),this.__originalRestore()},t.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},t.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},t.transform=function(t,n,i,a,r,s){e.transform(t,n,i,a,r,s),this.__originalTransform(t,n,i,a,r,s)},t.setTransform=function(t,n,i,a,r,s){e.setTransform(t,n,i,a,r,s),this.__originalSetTransform(t,n,i,a,r,s)},t.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){e.rotate(t),this.__originalRotate(t)},t.clip=function(t){e.clip(t),this.__originalClip(t)},t.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},t.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},t.bezierCurveTo=function(t,n,i,a,r,s){e.bezierCurveTo(t,n,i,a,r,s),this.__originalBezierCurveTo(t,n,i,a,r,s)},t.rect=function(t,n,i,a){e.rect(t,n,i,a),this.__originalRect(t,n,i,a)},t.closePath=function(){e.closePath(),this.__originalClosePath()},t.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}},{key:"endSMaskMode",value:function(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ur(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}},{key:"compose",value:function(t){if(this.current.activeSMask){t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];var e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}}},{key:"composeSMask",value:function(t,e,n,i){var a=i[0],r=i[1],s=i[2]-a,o=i[3]-r;0!==s&&0!==o&&(this.genericComposeSMask(e.context,n,s,o,e.subtype,e.backdrop,e.transferMap,a,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}},{key:"genericComposeSMask",value:function(t,e,n,i,a,r,s,o,l,h,u){var c=t.canvas,d=o-h,f=l-u;if(r)if(d<0||f<0||d+n>c.width||f+i>c.height){var v=this.cachedCanvases.getCanvas("maskExtension",n,i),p=v.context;p.drawImage(c,-d,-f),r.some((function(t){return 0!==t}))&&(p.globalCompositeOperation="destination-atop",p.fillStyle=Mt.makeHexColor.apply(Mt,y(r)),p.fillRect(0,0,n,i),p.globalCompositeOperation="source-over"),c=v.canvas,d=f=0}else if(r.some((function(t){return 0!==t}))){t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);var g=new Path2D;g.rect(d,f,n,i),t.clip(g),t.globalCompositeOperation="destination-atop",t.fillStyle=Mt.makeHexColor.apply(Mt,y(r)),t.fillRect(d,f,n,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),"Alpha"===a&&s?e.filter=this.filterFactory.addAlphaFilter(s):"Luminosity"===a&&(e.filter=this.filterFactory.addLuminosityFilter(s));var m=new Path2D;m.rect(o,l,n,i),e.clip(m),e.globalCompositeOperation="destination-in",e.drawImage(c,d,f,n,i,o,l,n,i),e.restore()}},{key:"save",value:function(){this.inSMaskMode?(ur(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();var t=this.current;this.stateStack.push(t),this.current=t.clone()}},{key:"restore",value:function(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ur(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}},{key:"transform",value:function(t,e,n,i,a,r){this.ctx.transform(t,e,n,i,a,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}},{key:"constructPath",value:function(t,e,n){for(var i,a,r=this.ctx,s=this.current,o=s.x,l=s.y,h=Ee(r),u=0===h[0]&&0===h[3]||0===h[1]&&0===h[2],c=u?n.slice(0):null,d=0,f=0,v=t.length;d<v;d++)switch(0|t[d]){case nt.rectangle:o=e[f++],l=e[f++];var p=e[f++],g=e[f++],y=o+p,m=l+g;r.moveTo(o,l),0===p||0===g?r.lineTo(y,m):(r.lineTo(y,l),r.lineTo(y,m),r.lineTo(o,m)),u||s.updateRectMinMax(h,[o,l,y,m]),r.closePath();break;case nt.moveTo:o=e[f++],l=e[f++],r.moveTo(o,l),u||s.updatePathMinMax(h,o,l);break;case nt.lineTo:o=e[f++],l=e[f++],r.lineTo(o,l),u||s.updatePathMinMax(h,o,l);break;case nt.curveTo:i=o,a=l,o=e[f+4],l=e[f+5],r.bezierCurveTo(e[f],e[f+1],e[f+2],e[f+3],o,l),s.updateCurvePathMinMax(h,i,a,e[f],e[f+1],e[f+2],e[f+3],o,l,c),f+=6;break;case nt.curveTo2:i=o,a=l,r.bezierCurveTo(o,l,e[f],e[f+1],e[f+2],e[f+3]),s.updateCurvePathMinMax(h,i,a,o,l,e[f],e[f+1],e[f+2],e[f+3],c),o=e[f+2],l=e[f+3],f+=4;break;case nt.curveTo3:i=o,a=l,o=e[f+2],l=e[f+3],r.bezierCurveTo(e[f],e[f+1],o,l,o,l),s.updateCurvePathMinMax(h,i,a,e[f],e[f+1],o,l,o,l,c),f+=4;break;case nt.closePath:r.closePath()}u&&s.updateScalingPathMinMax(h,c),s.setCurrentPoint(o,l)}},{key:"closePath",value:function(){this.ctx.closePath()}},{key:"stroke",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.ctx,n=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"===z(n)&&null!=n&&n.getPattern?(e.save(),e.strokeStyle=n.getPattern(e,this,Me(e),Xa),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}},{key:"closeStroke",value:function(){this.closePath(),this.stroke()}},{key:"fill",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.ctx,n=this.current.fillColor,i=!1;this.current.patternFill&&(e.save(),e.fillStyle=n.getPattern(e,this,Me(e),Ua),i=!0);var a=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==a&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),i&&e.restore(),t&&this.consumePath(a)}},{key:"eoFill",value:function(){this.pendingEOFill=!0,this.fill()}},{key:"fillStroke",value:function(){this.fill(!1),this.stroke(!1),this.consumePath()}},{key:"eoFillStroke",value:function(){this.pendingEOFill=!0,this.fillStroke()}},{key:"closeFillStroke",value:function(){this.closePath(),this.fillStroke()}},{key:"closeEOFillStroke",value:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}},{key:"endPath",value:function(){this.consumePath()}},{key:"clip",value:function(){this.pendingClip=pr}},{key:"eoClip",value:function(){this.pendingClip=gr}},{key:"beginText",value:function(){this.current.textMatrix=U,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"endText",value:function(){var t=this.pendingTextPaths,e=this.ctx;if(void 0!==t){e.save(),e.beginPath();var n,i=R(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.setTransform.apply(e,y(a.transform)),e.translate(a.x,a.y),a.addToPath(e,a.fontSize)}}catch(t){i.e(t)}finally{i.f()}e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}else e.beginPath()}},{key:"setCharSpacing",value:function(t){this.current.charSpacing=t}},{key:"setWordSpacing",value:function(t){this.current.wordSpacing=t}},{key:"setHScale",value:function(t){this.current.textHScale=t/100}},{key:"setLeading",value:function(t){this.current.leading=-t}},{key:"setFont",value:function(t,e){var n,i=this.commonObjs.get(t),a=this.current;if(!i)throw new Error("Can't find font for ".concat(t));if(a.fontMatrix=i.fontMatrix||X,0!==a.fontMatrix[0]&&0!==a.fontMatrix[3]||lt("Invalid font matrix for font "+t),e<0?(e=-e,a.fontDirection=-1):a.fontDirection=1,this.current.font=i,this.current.fontSize=e,!i.isType3Font){var r=i.loadedName||"sans-serif",s=(null===(n=i.systemFontInfo)||void 0===n?void 0:n.css)||'"'.concat(r,'", ').concat(i.fallbackName),o="normal";i.black?o="900":i.bold&&(o="bold");var l=i.italic?"italic":"normal",h=e;e<16?h=16:e>100&&(h=100),this.current.fontSizeScale=e/h,this.ctx.font="".concat(l," ").concat(o," ").concat(h,"px ").concat(s)}}},{key:"setTextRenderingMode",value:function(t){this.current.textRenderingMode=t}},{key:"setTextRise",value:function(t){this.current.textRise=t}},{key:"moveText",value:function(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}},{key:"setLeadingMoveText",value:function(t,e){this.setLeading(-e),this.moveText(t,e)}},{key:"setTextMatrix",value:function(t,e,n,i,a,r){this.current.textMatrix=[t,e,n,i,a,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"nextLine",value:function(){this.moveText(0,this.current.leading)}},{key:"paintChar",value:function(t,e,n,i){var a,r=this.ctx,s=this.current,o=s.font,l=s.textRenderingMode,h=s.fontSize/s.fontSizeScale,u=3&l,c=!!(4&l),d=s.patternFill&&!o.missingFile;(o.disableFontFace||c||d)&&(a=o.getPathGenerator(this.commonObjs,t)),o.disableFontFace||d?(r.save(),r.translate(e,n),r.beginPath(),a(r,h),i&&r.setTransform.apply(r,y(i)),0!==u&&2!==u||r.fill(),1!==u&&2!==u||r.stroke(),r.restore()):(0!==u&&2!==u||r.fillText(t,e,n),1!==u&&2!==u||r.strokeText(t,e,n)),c&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ee(r),x:e,y:n,fontSize:h,addToPath:a})}},{key:"isFontSubpixelAAEnabled",get:function(){var t=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10).context;t.scale(1.5,1),t.fillText("I",0,10);for(var e=t.getImageData(0,0,10,10).data,n=!1,i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){n=!0;break}return dt(this,"isFontSubpixelAAEnabled",n)}},{key:"showText",value:function(t){var e=this.current,n=e.font;if(n.isType3Font)return this.showType3Text(t);var i=e.fontSize;if(0!==i){var a,r=this.ctx,s=e.fontSizeScale,o=e.charSpacing,l=e.wordSpacing,h=e.fontDirection,u=e.textHScale*h,c=t.length,d=n.vertical,f=d?1:-1,v=n.defaultVMetrics,p=i*e.fontMatrix[0],g=0===e.textRenderingMode&&!n.disableFontFace&&!e.patternFill;if(r.save(),r.transform.apply(r,y(e.textMatrix)),r.translate(e.x,e.y+e.textRise),h>0?r.scale(u,-1):r.scale(u,1),e.patternFill){r.save();var m=e.fillColor.getPattern(r,this,Me(r),Ua);a=Ee(r),r.restore(),r.fillStyle=m}var k=e.lineWidth,b=e.textMatrixScale;if(0===b||0===k){var w=3&e.textRenderingMode;1!==w&&2!==w||(k=this.getSinglePixelWidth())}else k/=b;if(1!==s&&(r.scale(s,s),k/=s),r.lineWidth=k,n.isInvalidPDFjsFont){var A,_=[],x=0,E=R(t);try{for(E.s();!(A=E.n()).done;){var M=A.value;_.push(M.unicode),x+=M.width}}catch(t){E.e(t)}finally{E.f()}return r.fillText(_.join(""),0,0),e.x+=x*p*u,r.restore(),void this.compose()}var S,C=0;for(S=0;S<c;++S){var T=t[S];if("number"!=typeof T){var L=!1,P=(T.isSpace?l:0)+o,I=T.fontChar,F=T.accent,D=void 0,N=void 0,O=T.width;if(d){var W=T.vmetric||v,B=-(T.vmetric?W[1]:.5*O)*p,H=W[2]*p;O=W?-W[0]:O,D=B/s,N=(C+H)/s}else D=C/s,N=0;if(n.remeasure&&O>0){var j=1e3*r.measureText(I).width/i*s;if(O<j&&this.isFontSubpixelAAEnabled){var z=O/j;L=!0,r.save(),r.scale(z,1),D/=z}else O!==j&&(D+=(O-j)/2e3*i/s)}if(this.contentVisible&&(T.isInFont||n.missingFile))if(g&&!F)r.fillText(I,D,N);else if(this.paintChar(I,D,N,a),F){var G=D+i*F.offset.x/s,V=N-i*F.offset.y/s;this.paintChar(F.fontChar,G,V,a)}C+=d?O*p-P*h:O*p+P*h,L&&r.restore()}else C+=f*T*i/1e3}d?e.y-=C:e.x+=C*u,r.restore(),this.compose()}}},{key:"showType3Text",value:function(t){var e,n,i,a,r=this.ctx,s=this.current,o=s.font,l=s.fontSize,h=s.fontDirection,u=o.vertical?1:-1,c=s.charSpacing,d=s.wordSpacing,f=s.textHScale*h,v=s.fontMatrix||X,p=t.length;if(3!==s.textRenderingMode&&0!==l){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,r.save(),r.transform.apply(r,y(s.textMatrix)),r.translate(s.x,s.y),r.scale(f,h),e=0;e<p;++e)if("number"!=typeof(n=t[e])){var g=(n.isSpace?d:0)+c,m=o.charProcOperatorList[n.operatorListId];m?(this.contentVisible&&(this.processingType3=n,this.save(),r.scale(l,l),r.transform.apply(r,y(v)),this.executeOperatorList(m),this.restore()),i=Mt.applyTransform([n.width,0],v)[0]*l+g,r.translate(i,0),s.x+=i*f):lt('Type3 character "'.concat(n.operatorListId,'" is not available.'))}else a=u*n*l/1e3,this.ctx.translate(a,0),s.x+=a*f;r.restore(),this.processingType3=null}}},{key:"setCharWidth",value:function(t,e){}},{key:"setCharWidthAndBounds",value:function(t,e,n,i,a,r){this.ctx.rect(n,i,a-n,r-i),this.ctx.clip(),this.endPath()}},{key:"getColorN_Pattern",value:function(e){var n,i=this;if("TilingPattern"===e[0]){var a=e[1],r=this.baseTransform||Ee(this.ctx),s={createCanvasGraphics:function(e){return new t(e,i.commonObjs,i.objs,i.canvasFactory,i.filterFactory,{optionalContentConfig:i.optionalContentConfig,markedContentStack:i.markedContentStack})}};n=new nr(e,a,this.ctx,s,r)}else n=this._getPattern(e[1],e[2]);return n}},{key:"setStrokeColorN",value:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)}},{key:"setFillColorN",value:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}},{key:"setStrokeRGBColor",value:function(t,e,n){var i=Mt.makeHexColor(t,e,n);this.ctx.strokeStyle=i,this.current.strokeColor=i}},{key:"setFillRGBColor",value:function(t,e,n){var i=Mt.makeHexColor(t,e,n);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1}},{key:"_getPattern",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(t)?e=this.cachedPatterns.get(t):(e=function(t){switch(t[0]){case"RadialAxial":return new Ja(t);case"Mesh":return new tr(t);case"Dummy":return new er}throw new Error("Unknown IR type: ".concat(t[0]))}(this.getObject(t)),this.cachedPatterns.set(t,e)),n&&(e.matrix=n),e}},{key:"shadingFill",value:function(t){if(this.contentVisible){var e=this.ctx;this.save();var n=this._getPattern(t);e.fillStyle=n.getPattern(e,this,Me(e),Ka);var i=Me(e);if(i){var a=e.canvas,r=a.width,s=a.height,o=T(Mt.getAxialAlignedBoundingBox([0,0,r,s],i),4),l=o[0],h=o[1],u=o[2],c=o[3];this.ctx.fillRect(l,h,u-l,c-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}}},{key:"beginInlineImage",value:function(){ht("Should not call beginInlineImage")}},{key:"beginImageData",value:function(){ht("Should not call beginImageData")}},{key:"paintFormXObjectBegin",value:function(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform.apply(this,y(t)),this.baseTransform=Ee(this.ctx),e)){var n=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],n,i),this.current.updateRectMinMax(Ee(this.ctx),e),this.clip(),this.endPath()}}},{key:"paintFormXObjectEnd",value:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}},{key:"beginGroup",value:function(t){if(this.contentVisible){this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);var e=this.ctx;t.isolated||ot("TODO: Support non-isolated groups."),t.knockout&&lt("Knockout groups not supported.");var n=Ee(e);if(t.matrix&&e.transform.apply(e,y(t.matrix)),!t.bbox)throw new Error("Bounding box is required.");var i=Mt.getAxialAlignedBoundingBox(t.bbox,Ee(e)),a=[0,0,e.canvas.width,e.canvas.height];i=Mt.intersect(i,a)||[0,0,0,0];var r=Math.floor(i[0]),s=Math.floor(i[1]),o=Math.max(Math.ceil(i[2])-r,1),l=Math.max(Math.ceil(i[3])-s,1);this.current.startNewPathAndClipBox([0,0,o,l]);var h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);var u=this.cachedCanvases.getCanvas(h,o,l),c=u.context;c.translate(-r,-s),c.transform.apply(c,y(n)),t.smask?this.smaskStack.push({canvas:u.canvas,context:c,offsetX:r,offsetY:s,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,s),e.save()),ur(e,c),this.ctx=c,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}}},{key:"endGroup",value:function(t){if(this.contentVisible){this.groupLevel--;var e=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{var i;this.ctx.restore();var a=Ee(this.ctx);this.restore(),this.ctx.save(),(i=this.ctx).setTransform.apply(i,y(a));var r=Mt.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],a);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(r)}}}},{key:"beginAnnotation",value:function(t,e,n,i,a){var r;if(C(yr,this,kr).call(this),cr(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&(r=this.ctx).setTransform.apply(r,y(this.baseTransform)),e){var s=e[2]-e[0],o=e[3]-e[1];if(a&&this.annotationCanvasMap){(n=n.slice())[4]-=e[0],n[5]-=e[1],(e=e.slice())[0]=e[1]=0,e[2]=s,e[3]=o;var l=T(Mt.singularValueDecompose2dScale(Ee(this.ctx)),2),h=l[0],u=l[1],c=this.viewportScale,d=Math.ceil(s*this.outputScaleX*c),f=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,f);var v=this.annotationCanvas,p=v.canvas,g=v.context;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(h,0,0,-u,0,o*u),cr(this.ctx)}else cr(this.ctx),this.ctx.rect(e[0],e[1],s,o),this.ctx.clip(),this.endPath()}this.current=new or(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,y(n)),this.transform.apply(this,y(i))}},{key:"endAnnotation",value:function(){this.annotationCanvas&&(this.ctx.restore(),C(yr,this,br).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}},{key:"paintImageMaskXObject",value:function(t){if(this.contentVisible){var e=t.count;(t=this.getObject(t.data,t)).count=e;var n=this.ctx,i=this.processingType3;if(i&&(void 0===i.compiled&&(i.compiled=function(t){var e=t.width,n=t.height;if(e>1e3||n>1e3)return null;var i,a,r,s,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),l=e+1,h=new Uint8Array(l*(n+1)),u=e+7&-8,c=new Uint8Array(u*n),d=0,f=R(t.data);try{for(f.s();!(s=f.n()).done;)for(var v=s.value,p=128;p>0;)c[d++]=v&p?0:255,p>>=1}catch(t){f.e(t)}finally{f.f()}var g=0;for(0!==c[d=0]&&(h[0]=1,++g),a=1;a<e;a++)c[d]!==c[d+1]&&(h[a]=c[d]?2:1,++g),d++;for(0!==c[d]&&(h[a]=2,++g),i=1;i<n;i++){r=i*l,c[(d=i*u)-u]!==c[d]&&(h[r]=c[d]?1:8,++g);var y=(c[d]?4:0)+(c[d-u]?8:0);for(a=1;a<e;a++)o[y=(y>>2)+(c[d+1]?4:0)+(c[d-u+1]?8:0)]&&(h[r+a]=o[y],++g),d++;if(c[d-u]!==c[d]&&(h[r+a]=c[d]?2:4,++g),g>1e3)return null}for(r=i*l,0!==c[d=u*(n-1)]&&(h[r]=8,++g),a=1;a<e;a++)c[d]!==c[d+1]&&(h[r+a]=c[d]?4:8,++g),d++;if(0!==c[d]&&(h[r+a]=4,++g),g>1e3)return null;var m=new Int32Array([0,l,-1,0,-l,0,0,0,1]),k=new Path2D;for(i=0;g&&i<=n;i++){for(var b=i*l,w=b+e;b<w&&!h[b];)b++;if(b!==w){k.moveTo(b%l,i);var A=b,_=h[b];do{var x=m[_];do{b+=x}while(!h[b]);var E=h[b];5!==E&&10!==E?(_=E,h[b]=0):(_=E&51*_>>4,h[b]&=_>>2|_<<2),k.lineTo(b%l,b/l|0),h[b]||--g}while(A!==b);--i}}return c=null,h=null,function(t){t.save(),t.scale(1/e,-1/n),t.translate(0,-n),t.fill(k),t.beginPath(),t.restore()}}(t)),i.compiled))i.compiled(n);else{var a=this._createMaskCanvas(t),r=a.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,a.offsetX,a.offsetY),n.restore(),this.compose()}}}},{key:"paintImageMaskXObjectRepeat",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(this.contentVisible){t=this.getObject(t.data,t);var s=this.ctx;s.save();var o=Ee(s);s.transform(e,n,i,a,0,0);var l=this._createMaskCanvas(t);s.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(var h=0,u=r.length;h<u;h+=2){var c=Mt.transform(o,[e,n,i,a,r[h],r[h+1]]),d=T(Mt.applyTransform([0,0],c),2),f=d[0],v=d[1];s.drawImage(l.canvas,f,v)}s.restore(),this.compose()}}},{key:"paintImageMaskXObjectGroup",value:function(t){if(this.contentVisible){var e,n=this.ctx,i=this.current.fillColor,a=this.current.patternFill,r=R(t);try{for(r.s();!(e=r.n()).done;){var s=e.value,o=s.data,l=s.width,h=s.height,u=s.transform,c=this.cachedCanvases.getCanvas("maskCanvas",l,h),d=c.context;d.save(),hr(d,this.getObject(o,s)),d.globalCompositeOperation="source-in",d.fillStyle=a?i.getPattern(d,this,Me(n),Ua):i,d.fillRect(0,0,l,h),d.restore(),n.save(),n.transform.apply(n,y(u)),n.scale(1,-1),sr(n,c.canvas,0,0,l,h,0,-1,1,1),n.restore()}}catch(t){r.e(t)}finally{r.f()}this.compose()}}},{key:"paintImageXObject",value:function(t){if(this.contentVisible){var e=this.getObject(t);e?this.paintInlineImageXObject(e):lt("Dependent image isn't ready yet")}}},{key:"paintImageXObjectRepeat",value:function(t,e,n,i){if(this.contentVisible){var a=this.getObject(t);if(a){for(var r=a.width,s=a.height,o=[],l=0,h=i.length;l<h;l+=2)o.push({transform:[e,0,0,n,i[l],i[l+1]],x:0,y:0,w:r,h:s});this.paintInlineImageXObjectGroup(a,o)}else lt("Dependent image isn't ready yet")}}},{key:"applyTransferMapsToCanvas",value:function(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}},{key:"applyTransferMapsToBitmap",value:function(t){if("none"===this.current.transferMaps)return t.bitmap;var e=t.bitmap,n=t.width,i=t.height,a=this.cachedCanvases.getCanvas("inlineImage",n,i),r=a.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",a.canvas}},{key:"paintInlineImageXObject",value:function(t){if(this.contentVisible){var e,n=t.width,i=t.height,a=this.ctx;if(this.save(),!q){var r=a.filter;"none"!==r&&""!==r&&(a.filter="none")}if(a.scale(1/n,-1/i),t.bitmap)e=this.applyTransferMapsToBitmap(t);else if("function"==typeof HTMLElement&&t instanceof HTMLElement||!t.data)e=t;else{var s=this.cachedCanvases.getCanvas("inlineImage",n,i).context;lr(s,t),e=this.applyTransferMapsToCanvas(s)}var o=this._scaleImage(e,Me(a));a.imageSmoothingEnabled=dr(Ee(a),t.interpolate),sr(a,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,n,i),this.compose(),this.restore()}}},{key:"paintInlineImageXObjectGroup",value:function(t,e){if(this.contentVisible){var n,i=this.ctx;if(t.bitmap)n=t.bitmap;else{var a=t.width,r=t.height,s=this.cachedCanvases.getCanvas("inlineImage",a,r).context;lr(s,t),n=this.applyTransferMapsToCanvas(s)}var o,l=R(e);try{for(l.s();!(o=l.n()).done;){var h=o.value;i.save(),i.transform.apply(i,y(h.transform)),i.scale(1,-1),sr(i,n,h.x,h.y,h.w,h.h,0,-1,1,1),i.restore()}}catch(t){l.e(t)}finally{l.f()}this.compose()}}},{key:"paintSolidColorImageMask",value:function(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}},{key:"markPoint",value:function(t){}},{key:"markPointProps",value:function(t,e){}},{key:"beginMarkedContent",value:function(t){this.markedContentStack.push({visible:!0})}},{key:"beginMarkedContentProps",value:function(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}},{key:"endMarkedContent",value:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}},{key:"beginCompat",value:function(){}},{key:"endCompat",value:function(){}},{key:"consumePath",value:function(t){var e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);var n=this.ctx;this.pendingClip&&(e||(this.pendingClip===gr?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}},{key:"getSinglePixelWidth",value:function(){if(!this._cachedGetSinglePixelWidth){var t=Ee(this.ctx);if(0===t[1]&&0===t[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{var e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/e}}return this._cachedGetSinglePixelWidth}},{key:"getScaleForStroking",value:function(){if(-1===this._cachedScaleForStroking[0]){var t,e,n=this.current.lineWidth,i=this.ctx.getTransform(),a=i.a,r=i.b,s=i.c,o=i.d;if(0===r&&0===s){var l=Math.abs(a),h=Math.abs(o);if(l===h)if(0===n)t=e=1/l;else{var u=l*n;t=e=u<1?1/u:1}else if(0===n)t=1/l,e=1/h;else{var c=l*n,d=h*n;t=c<1?1/c:1,e=d<1?1/d:1}}else{var f=Math.abs(a*o-r*s),v=Math.hypot(a,r),p=Math.hypot(s,o);if(0===n)t=p/f,e=v/f;else{var g=n*f;t=p>g?p/g:1,e=v>g?v/g:1}}this._cachedScaleForStroking[0]=t,this._cachedScaleForStroking[1]=e}return this._cachedScaleForStroking}},{key:"rescaleAndStroke",value:function(t){var e=this.ctx,n=this.current.lineWidth,i=T(this.getScaleForStroking(),2),a=i[0],r=i[1];if(e.lineWidth=n||1,1!==a||1!==r){var s=e.getLineDash();if(t&&e.save(),e.scale(a,r),s.length>0){var o=Math.max(a,r);e.setLineDash(s.map((function(t){return t/o}))),e.lineDashOffset/=o}e.stroke(),t&&e.restore()}else e.stroke()}},{key:"isContentVisible",value:function(){for(var t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}])}();function kr(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}function br(){if(this.pageColors){var t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==t){var e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}for(var wr in nt)void 0!==mr.prototype[wr]&&(mr.prototype[nt[wr]]=mr.prototype[wr]);var Ar=function(){function t(){N(this,t)}return F(t,null,[{key:"workerPort",get:function(){return C(t,this,_r)._},set:function(e){if(!("undefined"!=typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");_r._=C(t,this,e)}},{key:"workerSrc",get:function(){return C(t,this,xr)._},set:function(e){if("string"!=typeof e)throw new Error("Invalid `workerSrc` type.");xr._=C(t,this,e)}}])}(),_r={_:null},xr={_:""};function Er(t){switch(t instanceof Error||"object"===z(t)&&null!==t||ht('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new bt(t.message);case"MissingPDFException":return new yt(t.message);case"PasswordException":return new vt(t.message,t.code);case"UnexpectedResponseException":return new mt(t.message,t.status);case"UnknownErrorException":return new pt(t.message,t.details);default:return new pt(t.message,t.toString())}}var Mr=new WeakSet,Sr=function(){return F((function t(e,n,i){var a=this;N(this,t),m(this,Mr),this.sourceName=e,this.targetName=n,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=function(t){var e=t.data;if(e.targetName===a.sourceName)if(e.stream)C(Mr,a,Tr).call(a,e);else if(e.callback){var n=e.callbackId,r=a.callbackCapabilities[n];if(!r)throw new Error("Cannot resolve callback ".concat(n));if(delete a.callbackCapabilities[n],1===e.callback)r.resolve(e.data);else{if(2!==e.callback)throw new Error("Unexpected callback case");r.reject(Er(e.reason))}}else{var s=a.actionHandler[e.action];if(!s)throw new Error("Unknown action from worker: ".concat(e.action));if(e.callbackId){var o=a.sourceName,l=e.sourceName;new Promise((function(t){t(s(e.data))})).then((function(t){i.postMessage({sourceName:o,targetName:l,callback:1,callbackId:e.callbackId,data:t})}),(function(t){i.postMessage({sourceName:o,targetName:l,callback:2,callbackId:e.callbackId,reason:Er(t)})}))}else e.streamId?C(Mr,a,Cr).call(a,e):s(e.data)}},i.addEventListener("message",this._onComObjOnMessage)}),[{key:"on",value:function(t,e){var n=this.actionHandler;if(n[t])throw new Error('There is already an actionName called "'.concat(t,'"'));n[t]=e}},{key:"send",value:function(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}},{key:"sendWithPromise",value:function(t,e,n){var i=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[i]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},n)}catch(t){a.reject(t)}return a.promise}},{key:"sendWithStream",value:function(t,e,n,i){var a=this,r=this.streamId++,s=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:function(n){var h=Promise.withResolvers();return a.streamControllers[r]={controller:n,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:s,targetName:o,action:t,streamId:r,data:e,desiredSize:n.desiredSize},i),h.promise},pull:function(t){var e=Promise.withResolvers();return a.streamControllers[r].pullCall=e,l.postMessage({sourceName:s,targetName:o,stream:6,streamId:r,desiredSize:t.desiredSize}),e.promise},cancel:function(t){ut(t instanceof Error,"cancel must have a valid reason");var e=Promise.withResolvers();return a.streamControllers[r].cancelCall=e,a.streamControllers[r].isClosed=!0,l.postMessage({sourceName:s,targetName:o,stream:1,streamId:r,reason:Er(t)}),e.promise}},n)}},{key:"destroy",value:function(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}])}();function Cr(t){var e=t.streamId,n=this.sourceName,i=t.sourceName,a=this.comObj,r=this,s=this.actionHandler[t.action],o={enqueue:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;if(!this.isCancelled){var o=this.desiredSize;this.desiredSize-=r,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:n,targetName:i,stream:4,streamId:e,chunk:t},s)}},close:function(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:i,stream:3,streamId:e}),delete r.streamSinks[e])},error:function(t){ut(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:i,stream:5,streamId:e,reason:Er(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,new Promise((function(e){e(s(t.data,o))})).then((function(){a.postMessage({sourceName:n,targetName:i,stream:8,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:n,targetName:i,stream:8,streamId:e,reason:Er(t)})}))}function Tr(t){var e=t.streamId,n=this.sourceName,i=t.sourceName,a=this.comObj,r=this.streamControllers[e],s=this.streamSinks[e];switch(t.stream){case 8:t.success?r.startCall.resolve():r.startCall.reject(Er(t.reason));break;case 7:t.success?r.pullCall.resolve():r.pullCall.reject(Er(t.reason));break;case 6:if(!s){a.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,success:!0});break}s.desiredSize<=0&&t.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=t.desiredSize,new Promise((function(t){var e;t(null===(e=s.onPull)||void 0===e?void 0:e.call(s))})).then((function(){a.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,reason:Er(t)})}));break;case 4:if(ut(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case 3:if(ut(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),C(Mr,this,Rr).call(this,r,e);break;case 5:ut(r,"error should have stream controller"),r.controller.error(Er(t.reason)),C(Mr,this,Rr).call(this,r,e);break;case 2:t.success?r.cancelCall.resolve():r.cancelCall.reject(Er(t.reason)),C(Mr,this,Rr).call(this,r,e);break;case 1:if(!s)break;new Promise((function(e){var n;e(null===(n=s.onCancel)||void 0===n?void 0:n.call(s,Er(t.reason)))})).then((function(){a.postMessage({sourceName:n,targetName:i,stream:2,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:n,targetName:i,stream:2,streamId:e,reason:Er(t)})})),s.sinkCapability.reject(Er(t.reason)),s.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}function Rr(t,e){return Lr.apply(this,arguments)}function Lr(){return(Lr=S(E().mark((function t(e,n){var i,a,r;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.allSettled([null===(i=e.startCall)||void 0===i?void 0:i.promise,null===(a=e.pullCall)||void 0===a?void 0:a.promise,null===(r=e.cancelCall)||void 0===r?void 0:r.promise]);case 2:delete this.streamControllers[n];case 3:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}var Pr=new WeakMap,Ir=new WeakMap,Fr=function(){return F((function t(e){var n=e.parsedData,i=e.rawData;N(this,t),k(this,Pr,void 0),k(this,Ir,void 0),_(Pr,this,n),_(Ir,this,i)}),[{key:"getRaw",value:function(){return A(Ir,this)}},{key:"get",value:function(t){var e;return null!==(e=A(Pr,this).get(t))&&void 0!==e?e:null}},{key:"getAll",value:function(){return _t(A(Pr,this))}},{key:"has",value:function(t){return A(Pr,this).has(t)}}])}(),Dr=Symbol("INTERNAL"),Nr=new WeakMap,Or=new WeakMap,Wr=new WeakMap,Br=new WeakMap,Hr=function(){return F((function t(e,n){var i=n.name,a=n.intent,r=n.usage;N(this,t),k(this,Nr,!1),k(this,Or,!1),k(this,Wr,!1),k(this,Br,!0),_(Nr,this,!!(2&e)),_(Or,this,!!(4&e)),this.name=i,this.intent=a,this.usage=r}),[{key:"visible",get:function(){if(A(Wr,this))return A(Br,this);if(!A(Br,this))return!1;var t=this.usage,e=t.print,n=t.view;return A(Nr,this)?"OFF"!==(null==n?void 0:n.viewState):!A(Or,this)||"OFF"!==(null==e?void 0:e.printState)}},{key:"_setVisible",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t!==Dr&&ht("Internal method `_setVisible` called."),_(Wr,this,n),_(Br,this,e)}}])}(),jr=new WeakMap,zr=new WeakMap,Gr=new WeakMap,Vr=new WeakMap,qr=new WeakSet,Ur=function(){return F((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(N(this,t),m(this,qr),k(this,jr,null),k(this,zr,new Map),k(this,Gr,null),k(this,Vr,null),this.renderingIntent=n,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,_(Vr,this,e.order);var i,a=R(e.groups);try{for(a.s();!(i=a.n()).done;){var r=i.value;A(zr,this).set(r.id,new Hr(n,r))}}catch(t){a.e(t)}finally{a.f()}if("OFF"===e.baseState){var s,o=R(A(zr,this).values());try{for(o.s();!(s=o.n()).done;)s.value._setVisible(Dr,!1)}catch(t){o.e(t)}finally{o.f()}}var l,h=R(e.on);try{for(h.s();!(l=h.n()).done;){var u=l.value;A(zr,this).get(u)._setVisible(Dr,!0)}}catch(t){h.e(t)}finally{h.f()}var c,d=R(e.off);try{for(d.s();!(c=d.n()).done;){var f=c.value;A(zr,this).get(f)._setVisible(Dr,!1)}}catch(t){d.e(t)}finally{d.f()}_(Gr,this,this.getHash())}}),[{key:"isVisible",value:function(t){if(0===A(zr,this).size)return!0;if(!t)return ot("Optional content group not defined."),!0;if("OCG"===t.type)return A(zr,this).has(t.id)?A(zr,this).get(t.id).visible:(lt("Optional content group not found: ".concat(t.id)),!0);if("OCMD"===t.type){if(t.expression)return C(qr,this,Xr).call(this,t.expression);if(!t.policy||"AnyOn"===t.policy){var e,n=R(t.ids);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!A(zr,this).has(i))return lt("Optional content group not found: ".concat(i)),!0;if(A(zr,this).get(i).visible)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}if("AllOn"===t.policy){var a,r=R(t.ids);try{for(r.s();!(a=r.n()).done;){var s=a.value;if(!A(zr,this).has(s))return lt("Optional content group not found: ".concat(s)),!0;if(!A(zr,this).get(s).visible)return!1}}catch(t){r.e(t)}finally{r.f()}return!0}if("AnyOff"===t.policy){var o,l=R(t.ids);try{for(l.s();!(o=l.n()).done;){var h=o.value;if(!A(zr,this).has(h))return lt("Optional content group not found: ".concat(h)),!0;if(!A(zr,this).get(h).visible)return!0}}catch(t){l.e(t)}finally{l.f()}return!1}if("AllOff"===t.policy){var u,c=R(t.ids);try{for(c.s();!(u=c.n()).done;){var d=u.value;if(!A(zr,this).has(d))return lt("Optional content group not found: ".concat(d)),!0;if(A(zr,this).get(d).visible)return!1}}catch(t){c.e(t)}finally{c.f()}return!0}return lt("Unknown optional content policy ".concat(t.policy,".")),!0}return lt("Unknown group type ".concat(t.type,".")),!0}},{key:"setVisibility",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=A(zr,this).get(t);n?(n._setVisible(Dr,!!e,!0),_(jr,this,null)):lt("Optional content group not found: ".concat(t))}},{key:"setOCGState",value:function(t){var e,n,i=t.state,a=(t.preserveRB,R(i));try{for(a.s();!(n=a.n()).done;){var r=n.value;switch(r){case"ON":case"OFF":case"Toggle":e=r;continue}var s=A(zr,this).get(r);if(s)switch(e){case"ON":s._setVisible(Dr,!0);break;case"OFF":s._setVisible(Dr,!1);break;case"Toggle":s._setVisible(Dr,!s.visible)}}}catch(t){a.e(t)}finally{a.f()}_(jr,this,null)}},{key:"hasInitialVisibility",get:function(){return null===A(Gr,this)||this.getHash()===A(Gr,this)}},{key:"getOrder",value:function(){return A(zr,this).size?A(Vr,this)?A(Vr,this).slice():y(A(zr,this).keys()):null}},{key:"getGroups",value:function(){return A(zr,this).size>0?_t(A(zr,this)):null}},{key:"getGroup",value:function(t){return A(zr,this).get(t)||null}},{key:"getHash",value:function(){if(null!==A(jr,this))return A(jr,this);var t,e=new Ma,n=R(A(zr,this));try{for(n.s();!(t=n.n()).done;){var i=T(t.value,2),a=i[0],r=i[1];e.update("".concat(a,":").concat(r.visible))}}catch(t){n.e(t)}finally{n.f()}return _(jr,this,e.hexdigest())}}])}();function Xr(t){var e=t.length;if(e<2)return!0;for(var n=t[0],i=1;i<e;i++){var a=t[i],r=void 0;if(Array.isArray(a))r=C(qr,this,Xr).call(this,a);else{if(!A(zr,this).has(a))return lt("Optional content group not found: ".concat(a)),!0;r=A(zr,this).get(a).visible}switch(n){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return"And"===n}var Kr=function(){return F((function t(e,n){var i=this,a=n.disableRange,r=void 0!==a&&a,s=n.disableStream,o=void 0!==s&&s;N(this,t),ut(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');var l=e.length,h=e.initialData,u=e.progressiveDone,c=e.contentDispositionFilename;if(this._queuedChunks=[],this._progressiveDone=u,this._contentDispositionFilename=c,(null==h?void 0:h.length)>0){var d=h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!o,this._isRangeSupported=!r,this._contentLength=l,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((function(t,e){i._onReceiveData({begin:t,chunk:e})})),e.addProgressListener((function(t,e){i._onProgress({loaded:t,total:e})})),e.addProgressiveReadListener((function(t){i._onReceiveData({chunk:t})})),e.addProgressiveDoneListener((function(){i._onProgressiveDone()})),e.transportReady()}),[{key:"_onReceiveData",value:function(t){var e=t.begin,n=t.chunk,i=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;void 0===e?this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i):ut(this._rangeReaders.some((function(t){return t._begin===e&&(t._enqueue(i),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}},{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"_onProgress",value:function(t){var e,n,i,a;void 0===t.total?null===(e=this._rangeReaders[0])||void 0===e||null===(n=e.onProgress)||void 0===n||n.call(e,{loaded:t.loaded}):null===(i=this._fullRequestReader)||void 0===i||null===(a=i.onProgress)||void 0===a||a.call(i,{loaded:t.loaded,total:t.total})}},{key:"_onProgressiveDone",value:function(){var t;null===(t=this._fullRequestReader)||void 0===t||t.progressiveDone(),this._progressiveDone=!0}},{key:"_removeRangeReader",value:function(t){var e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}},{key:"getFullReader",value:function(){ut(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var t=this._queuedChunks;return this._queuedChunks=null,new Yr(this,t,this._progressiveDone,this._contentDispositionFilename)}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var n=new Qr(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=R(this._rangeReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}this._pdfDataRangeTransport.abort()}}])}(),Yr=function(){return F((function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;N(this,t),this._stream=e,this._done=i||!1,this._filename=ve(a)?a:null,this._queuedChunks=n||[],this._loaded=0;var r,s=R(this._queuedChunks);try{for(s.s();!(r=s.n()).done;){var o=r.value;this._loaded+=o.byteLength}}catch(t){s.e(t)}finally{s.f()}this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}),[{key:"_enqueue",value:function(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}},{key:"headersReady",get:function(){return this._headersReady}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._stream._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._stream._isStreamingSupported}},{key:"contentLength",get:function(){return this._stream._contentLength}},{key:"read",value:(t=S(E().mark((function t(){var e,n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._queuedChunks.length>0)){t.next=3;break}return e=this._queuedChunks.shift(),t.abrupt("return",{value:e,done:!1});case 3:if(!this._done){t.next=5;break}return t.abrupt("return",{value:void 0,done:!0});case 5:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 8:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0;var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0}},{key:"progressiveDone",value:function(){this._done||(this._done=!0)}}]);var t}(),Qr=function(){return F((function t(e,n,i){N(this,t),this._stream=e,this._begin=n,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}),[{key:"_enqueue",value:function(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:(t=S(E().mark((function t(){var e,n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._queuedChunk){t.next=4;break}return e=this._queuedChunk,this._queuedChunk=null,t.abrupt("return",{value:e,done:!1});case 4:if(!this._done){t.next=6;break}return t.abrupt("return",{value:void 0,done:!0});case 6:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 9:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0;var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._stream._removeRangeReader(this)}}]);var t}();function Jr(t){var e=t.getResponseHeader,n=t.isHttp,i=t.rangeChunkSize,a=t.disableRange,r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(e("Content-Length"),10);return Number.isInteger(s)?(r.suggestedLength=s,s<=2*i||a||!n||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r):r}function Zr(t){var e=t("Content-Disposition");if(e){var n=function(t){var e=!0,n=r("filename\\*","i").exec(t);if(n){var i=l(n=n[1]);return o(i=u(i=h(i=unescape(i))))}if(n=function(t){for(var e,n=[],i=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");null!==(e=i.exec(t));){var a=T(e,4),s=a[1],o=a[2],u=a[3];if((s=parseInt(s,10))in n){if(0===s)break}else n[s]=[o,u]}for(var c=[],d=0;d<n.length&&d in n;++d){var f=T(n[d],2),v=f[0],p=f[1];p=l(p),v&&(p=unescape(p),0===d&&(p=h(p))),c.push(p)}return c.join("")}(t))return o(u(n));if(n=r("filename","i").exec(t)){var a=l(n=n[1]);return o(a=u(a))}function r(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function s(t,n){if(t){if(!/^[\x00-\xFF]+$/.test(n))return n;try{var i=new TextDecoder(t,{fatal:!0}),a=At(n);n=i.decode(a),e=!1}catch(t){}}return n}function o(t){return e&&/[\x80-\xff]/.test(t)&&(t=s("utf-8",t),e&&(t=s("iso-8859-1",t))),t}function l(t){if(t.startsWith('"')){for(var e=t.slice(1).split('\\"'),n=0;n<e.length;++n){var i=e[n].indexOf('"');-1!==i&&(e[n]=e[n].slice(0,i),e.length=n+1),e[n]=e[n].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function h(t){var e=t.indexOf("'");return-1===e?t:s(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function u(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(t,e,n,i){if("q"===n||"Q"===n)return s(e,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt(e,16))})));try{i=atob(i)}catch(t){}return s(e,i)}))}return""}(e);if(n.includes("%"))try{n=decodeURIComponent(n)}catch(t){}if(ve(n))return n}return null}function $r(t,e){return 404===t||0===t&&e.startsWith("file:")?new yt('Missing PDF "'+e+'".'):new mt("Unexpected server response (".concat(t,') while retrieving PDF "').concat(e,'".'),t)}function ts(t){return 200===t||206===t}function es(t,e,n){return{method:"GET",headers:t,signal:n.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function ns(t){var e=new Headers;for(var n in t){var i=t[n];void 0!==i&&e.append(n,i)}return e}function is(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:(lt("getArrayBuffer - unexpected data format: ".concat(t)),new Uint8Array(t).buffer)}var as=function(){return F((function t(e){N(this,t),this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}),[{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"getFullReader",value:function(){return ut(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new rs(this),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var n=new ss(this,t,e);return this._rangeRequestReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=R(this._rangeRequestReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}}}])}(),rs=function(){return F((function t(e){var n=this;N(this,t),this._stream=e,this._reader=null,this._loaded=0,this._filename=null;var i=e.source;this._withCredentials=i.withCredentials||!1,this._contentLength=i.length,this._headersCapability=Promise.withResolvers(),this._disableRange=i.disableRange||!1,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange,this._headers=ns(this._stream.httpHeaders);var a=i.url;fetch(a,es(this._headers,this._withCredentials,this._abortController)).then((function(t){if(!ts(t.status))throw $r(t.status,a);n._reader=t.body.getReader(),n._headersCapability.resolve();var e=function(e){return t.headers.get(e)},i=Jr({getResponseHeader:e,isHttp:n._stream.isHttp,rangeChunkSize:n._rangeChunkSize,disableRange:n._disableRange}),r=i.allowRangeRequests,s=i.suggestedLength;n._isRangeSupported=r,n._contentLength=s||n._contentLength,n._filename=Zr(e),!n._isStreamingSupported&&n._isRangeSupported&&n.cancel(new bt("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}),[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=S(E().mark((function t(){var e,n,i,a;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._headersCapability.promise;case 2:return t.next=4,this._reader.read();case 4:if(n=t.sent,i=n.value,!(a=n.done)){t.next=9;break}return t.abrupt("return",{value:i,done:a});case 9:return this._loaded+=i.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),t.abrupt("return",{value:is(i),done:!1});case 12:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){var e;null===(e=this._reader)||void 0===e||e.cancel(t),this._abortController.abort()}}]);var t}(),ss=function(){return F((function t(e,n,i){var a=this;N(this,t),this._stream=e,this._reader=null,this._loaded=0;var r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController,this._headers=ns(this._stream.httpHeaders),this._headers.append("Range","bytes=".concat(n,"-").concat(i-1));var s=r.url;fetch(s,es(this._headers,this._withCredentials,this._abortController)).then((function(t){if(!ts(t.status))throw $r(t.status,s);a._readCapability.resolve(),a._reader=t.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}),[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=S(E().mark((function t(){var e,n,i,a;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:return t.next=4,this._reader.read();case 4:if(n=t.sent,i=n.value,!(a=n.done)){t.next=9;break}return t.abrupt("return",{value:i,done:a});case 9:return this._loaded+=i.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),t.abrupt("return",{value:is(i),done:!1});case 12:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){var e;null===(e=this._reader)||void 0===e||e.cancel(t),this._abortController.abort()}}]);var t}(),os=function(){return F((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};N(this,t),this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&n.httpHeaders||Object.create(null),this.withCredentials=n.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}),[{key:"requestRange",value:function(t,e,n){var i={begin:t,end:e};for(var a in n)i[a]=n[a];return this.request(i)}},{key:"requestFull",value:function(t){return this.request(t)}},{key:"request",value:function(t){var e=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:e};for(var a in e.open("GET",this.url),e.withCredentials=this.withCredentials,this.httpHeaders){var r=this.httpHeaders[a];void 0!==r&&e.setRequestHeader(a,r)}return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range","bytes=".concat(t.begin,"-").concat(t.end-1)),i.expectedStatus=206):i.expectedStatus=200,e.responseType="arraybuffer",t.onError&&(e.onerror=function(n){t.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),n}},{key:"onProgress",value:function(t,e){var n,i=this.pendingRequests[t];i&&(null===(n=i.onProgress)||void 0===n||n.call(i,e))}},{key:"onStateChange",value:function(t,e){var n=this.pendingRequests[t];if(n){var i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4===i.readyState&&t in this.pendingRequests)if(delete this.pendingRequests[t],0===i.status&&this.isHttp){var a;null===(a=n.onError)||void 0===a||a.call(n,i.status)}else{var r=i.status||200;if(200===r&&206===n.expectedStatus||r===n.expectedStatus){var s=function(t){var e=t.response;return"string"!=typeof e?e:At(e).buffer}(i);if(206===r){var o=i.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);n.onDone({begin:parseInt(l[1],10),chunk:s})}else if(s)n.onDone({begin:0,chunk:s});else{var h;null===(h=n.onError)||void 0===h||h.call(n,i.status)}}else{var u;null===(u=n.onError)||void 0===u||u.call(n,i.status)}}}}},{key:"getRequestXhr",value:function(t){return this.pendingRequests[t].xhr}},{key:"isPendingRequest",value:function(t){return t in this.pendingRequests}},{key:"abortRequest",value:function(t){var e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}])}(),ls=function(){return F((function t(e){N(this,t),this._source=e,this._manager=new os(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}),[{key:"_onRangeRequestReaderClosed",value:function(t){var e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}},{key:"getFullReader",value:function(){return ut(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new hs(this._manager,this._source),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){var n=new us(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=R(this._rangeRequestReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}}}])}(),hs=function(){return F((function t(e,n){N(this,t),this._manager=e;var i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=n.url,this._fullRequestId=e.requestFull(i),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=n.disableRange||!1,this._contentLength=n.length,this._rangeChunkSize=n.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}),[{key:"_onHeadersReceived",value:function(){var t=this._fullRequestId,e=this._manager.getRequestXhr(t),n=function(t){return e.getResponseHeader(t)},i=Jr({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),a=i.allowRangeRequests,r=i.suggestedLength;a&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Zr(n),this._isRangeSupported&&this._manager.abortRequest(t),this._headersReceivedCapability.resolve()}},{key:"_onDone",value:function(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0}}},{key:"_onError",value:function(t){this._storedError=$r(t,this._url),this._headersReceivedCapability.reject(this._storedError);var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.reject(this._storedError)}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._cachedChunks.length=0}},{key:"_onProgress",value:function(t){var e;null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"contentLength",get:function(){return this._contentLength}},{key:"headersReady",get:function(){return this._headersReceivedCapability.promise}},{key:"read",value:(t=S(E().mark((function t(){var e,n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._storedError){t.next=2;break}throw this._storedError;case 2:if(!(this._cachedChunks.length>0)){t.next=5;break}return e=this._cachedChunks.shift(),t.abrupt("return",{value:e,done:!1});case 5:if(!this._done){t.next=7;break}return t.abrupt("return",{value:void 0,done:!0});case 7:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 10:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0,this._headersReceivedCapability.reject(t);var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}]);var t}(),us=function(){return F((function t(e,n,i){N(this,t),this._manager=e;var a={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(n,i,a),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}),[{key:"_close",value:function(){var t;null===(t=this.onClosed)||void 0===t||t.call(this,this)}},{key:"_onDone",value:function(t){var e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;var n,i=R(this._requests);try{for(i.s();!(n=i.n()).done;)n.value.resolve({value:void 0,done:!0})}catch(t){i.e(t)}finally{i.f()}this._requests.length=0,this._close()}},{key:"_onError",value:function(t){this._storedError=$r(t,this._url);var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.reject(this._storedError)}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._queuedChunk=null}},{key:"_onProgress",value:function(t){var e;this.isStreamingSupported||null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:t.loaded})}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:(t=S(E().mark((function t(){var e,n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._storedError){t.next=2;break}throw this._storedError;case 2:if(null===this._queuedChunk){t.next=6;break}return e=this._queuedChunk,this._queuedChunk=null,t.abrupt("return",{value:e,done:!1});case 6:if(!this._done){t.next=8;break}return t.abrupt("return",{value:void 0,done:!0});case 8:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 11:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0;var e,n=R(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}]);var t}(),cs=/^file:\/\/\/[a-zA-Z]:\//,ds=function(){return F((function t(e){var n,i,a;N(this,t),this.source=e,this.url=(n=e.url,"file:"===(a=(i=Ha.get("url")).parse(n)).protocol||a.host?a:/^[a-z]:[/\\]/i.test(n)?i.parse("file:///".concat(n)):(a.host||(a.protocol="file:"),a)),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}),[{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"getFullReader",value:function(){return ut(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new ms(this):new gs(this),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var n=this.isFsUrl?new ks(this,t,e):new ys(this,t,e);return this._rangeRequestReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=R(this._rangeRequestReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}}}])}(),fs=function(){return F((function t(e){N(this,t),this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;var n=e.source;this._contentLength=n.length,this._loaded=0,this._filename=null,this._disableRange=n.disableRange||!1,this._rangeChunkSize=n.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!n.disableStream,this._isRangeSupported=!n.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}),[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=S(E().mark((function t(){var e,n,i;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:if(!this._done){t.next=4;break}return t.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){t.next=6;break}throw this._storedError;case 6:if(null!==(n=this._readableStream.read())){t.next=10;break}return this._readCapability=Promise.withResolvers(),t.abrupt("return",this.read());case 10:return this._loaded+=n.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),i=new Uint8Array(n).buffer,t.abrupt("return",{value:i,done:!1});case 14:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}},{key:"_error",value:function(t){this._storedError=t,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(t){var e=this;this._readableStream=t,t.on("readable",(function(){e._readCapability.resolve()})),t.on("end",(function(){t.destroy(),e._done=!0,e._readCapability.resolve()})),t.on("error",(function(t){e._error(t)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new bt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}]);var t}(),vs=function(){return F((function t(e){N(this,t),this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();var n=e.source;this._isStreamingSupported=!n.disableStream}),[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=S(E().mark((function t(){var e,n,i;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:if(!this._done){t.next=4;break}return t.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){t.next=6;break}throw this._storedError;case 6:if(null!==(n=this._readableStream.read())){t.next=10;break}return this._readCapability=Promise.withResolvers(),t.abrupt("return",this.read());case 10:return this._loaded+=n.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),i=new Uint8Array(n).buffer,t.abrupt("return",{value:i,done:!1});case 14:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}},{key:"_error",value:function(t){this._storedError=t,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(t){var e=this;this._readableStream=t,t.on("readable",(function(){e._readCapability.resolve()})),t.on("end",(function(){t.destroy(),e._done=!0,e._readCapability.resolve()})),t.on("error",(function(t){e._error(t)})),this._storedError&&this._readableStream.destroy(this._storedError)}}]);var t}();function ps(t,e){return{protocol:t.protocol,auth:t.auth,host:t.hostname,port:t.port,path:t.path,method:"GET",headers:e}}var gs=function(t){function e(t){var n;N(this,e);var i=function(e){if(404===e.statusCode){var i=new yt('Missing PDF "'.concat(n._url,'".'));return n._storedError=i,void n._headersCapability.reject(i)}n._headersCapability.resolve(),n._setReadableStream(e);var a=function(t){return n._readableStream.headers[t.toLowerCase()]},r=Jr({getResponseHeader:a,isHttp:t.isHttp,rangeChunkSize:n._rangeChunkSize,disableRange:n._disableRange}),s=r.allowRangeRequests,o=r.suggestedLength;n._isRangeSupported=s,n._contentLength=o||n._contentLength,n._filename=Zr(a)};if((n=O(this,e,[t]))._request=null,"http:"===n._url.protocol){var a=Ha.get("http");n._request=a.request(ps(n._url,t.httpHeaders),i)}else{var r=Ha.get("https");n._request=r.request(ps(n._url,t.httpHeaders),i)}return n._request.on("error",(function(t){n._storedError=t,n._headersCapability.reject(t)})),n._request.end(),n}return H(e,t),F(e)}(fs),ys=function(t){function e(t,n,i){var a;for(var r in N(this,e),(a=O(this,e,[t]))._httpHeaders={},t.httpHeaders){var s=t.httpHeaders[r];void 0!==s&&(a._httpHeaders[r]=s)}a._httpHeaders.Range="bytes=".concat(n,"-").concat(i-1);var o=function(t){if(404!==t.statusCode)a._setReadableStream(t);else{var e=new yt('Missing PDF "'.concat(a._url,'".'));a._storedError=e}};if(a._request=null,"http:"===a._url.protocol){var l=Ha.get("http");a._request=l.request(ps(a._url,a._httpHeaders),o)}else{var h=Ha.get("https");a._request=h.request(ps(a._url,a._httpHeaders),o)}return a._request.on("error",(function(t){a._storedError=t})),a._request.end(),a}return H(e,t),F(e)}(vs),ms=function(t){function e(t){var n;N(this,e),n=O(this,e,[t]);var i=decodeURIComponent(n._url.path);cs.test(n._url.href)&&(i=i.replace(/^\//,""));var a=Ha.get("fs");return a.promises.lstat(i).then((function(t){n._contentLength=t.size,n._setReadableStream(a.createReadStream(i)),n._headersCapability.resolve()}),(function(t){"ENOENT"===t.code&&(t=new yt('Missing PDF "'.concat(i,'".'))),n._storedError=t,n._headersCapability.reject(t)})),n}return H(e,t),F(e)}(fs),ks=function(t){function e(t,n,i){var a;N(this,e),a=O(this,e,[t]);var r=decodeURIComponent(a._url.path);cs.test(a._url.href)&&(r=r.replace(/^\//,""));var s=Ha.get("fs");return a._setReadableStream(s.createReadStream(r,{start:n,end:i-1})),a}return H(e,t),F(e)}(vs),bs=30,ws=.8,As=new WeakMap,_s=new WeakMap,xs=new WeakMap,Es=new WeakMap,Ms=new WeakMap,Ss=new WeakMap,Cs=new WeakMap,Ts=new WeakMap,Rs=new WeakMap,Ls=new WeakMap,Ps=new WeakMap,Is=new WeakMap,Fs=new WeakMap,Ds=new WeakMap,Ns=new WeakMap,Os=new WeakMap,Ws=new WeakMap,Bs=new WeakMap,Hs=new WeakSet,js=function(){function t(e){var n,i=this,a=e.textContentSource,r=e.container,s=e.viewport;if(N(this,t),m(this,Hs),k(this,As,Promise.withResolvers()),k(this,_s,null),k(this,xs,!1),k(this,Es,!(null===(n=globalThis.FontInspector)||void 0===n||!n.enabled)),k(this,Ms,null),k(this,Ss,null),k(this,Cs,0),k(this,Ts,0),k(this,Rs,null),k(this,Ls,null),k(this,Ps,0),k(this,Is,0),k(this,Fs,Object.create(null)),k(this,Ds,[]),k(this,Ns,null),k(this,Os,[]),k(this,Ws,new WeakMap),k(this,Bs,null),a instanceof ReadableStream)_(Ns,this,a);else{if("object"!==z(a))throw new Error('No "textContentSource" parameter specified.');_(Ns,this,new ReadableStream({start:function(t){t.enqueue(a),t.close()}}))}_(_s,this,_(Ls,this,r)),_(Is,this,s.scale*(globalThis.devicePixelRatio||1)),_(Ps,this,s.rotation),_(Ss,this,{prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null});var o=s.rawDims,l=o.pageWidth,h=o.pageHeight,u=o.pageX,c=o.pageY;_(Bs,this,[1,0,0,-1,-u,c+h]),_(Ts,this,l),_(Cs,this,h),Se(r,s),A(As,this).promise.catch((function(){})).then((function(){Ys._.delete(i),_(Ss,i,null),_(Fs,i,null)}))}return F(t,[{key:"render",value:function(){var t=this;return _(Rs,this,A(Ns,this).getReader()),Ys._.add(this),function e(){A(Rs,t).read().then((function(n){var i,a=n.value;n.done?A(As,t).resolve():(null!==(i=A(Ms,t))&&void 0!==i||_(Ms,t,a.lang),Object.assign(A(Fs,t),a.styles),C(Hs,t,zs).call(t,a.items),e())}),A(As,t).reject)}(),A(As,this).promise}},{key:"update",value:function(e){var n=e.viewport,i=e.onBefore,a=void 0===i?null:i,r=n.scale*(globalThis.devicePixelRatio||1),s=n.rotation;if(s!==A(Ps,this)&&(null==a||a(),_(Ps,this,s),Se(A(Ls,this),{rotation:s})),r!==A(Is,this)){null==a||a(),_(Is,this,r);var o,l={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:qs.call(t,A(Ms,this))},h=R(A(Os,this));try{for(h.s();!(o=h.n()).done;){var u=o.value;l.properties=A(Ws,this).get(u),l.div=u,C(Hs,this,Vs).call(this,l)}}catch(t){h.e(t)}finally{h.f()}}}},{key:"cancel",value:function(){var t,e=new bt("TextLayer task cancelled.");null===(t=A(Rs,this))||void 0===t||t.cancel(e).catch((function(){})),_(Rs,this,null),A(As,this).reject(e)}},{key:"textDivs",get:function(){return A(Os,this)}},{key:"textContentItemsStr",get:function(){return A(Ds,this)}}],[{key:"cleanup",value:function(){if(!(C(t,this,Ys)._.size>0)){C(t,this,Xs)._.clear();var e,n=R(C(t,this,Ks)._.values());try{for(n.s();!(e=n.n()).done;)e.value.canvas.remove()}catch(t){n.e(t)}finally{n.f()}C(t,this,Ks)._.clear()}}}])}();function zs(t){var e;if(!A(xs,this)){(e=A(Ss,this)).ctx||(e.ctx=qs.call(r,A(Ms,this)));var n,i=A(Os,this),a=A(Ds,this),s=R(t);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(i.length>1e5)return lt("Ignoring additional textDivs for performance reasons."),void _(xs,this,!0);if(void 0!==o.str)a.push(o.str),C(Hs,this,Gs).call(this,o);else if("beginMarkedContentProps"===o.type||"beginMarkedContent"===o.type){var l=A(_s,this);_(_s,this,document.createElement("span")),A(_s,this).classList.add("markedContent"),null!==o.id&&A(_s,this).setAttribute("id","".concat(o.id)),l.append(A(_s,this))}else"endMarkedContent"===o.type&&_(_s,this,A(_s,this).parentNode)}}catch(t){s.e(t)}finally{s.f()}}}function Gs(t){var e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};A(Os,this).push(e);var i=Mt.transform(A(Bs,this),t.transform),a=Math.atan2(i[1],i[0]),s=A(Fs,this)[t.fontName];s.vertical&&(a+=Math.PI/2);var o,l,h=A(Es,this)&&s.fontSubstitution||s.fontFamily,u=Math.hypot(i[2],i[3]),c=u*Us.call(r,h,A(Ms,this));0===a?(o=i[4],l=i[5]-c):(o=i[4]+c*Math.sin(a),l=i[5]-c*Math.cos(a));var d="calc(var(--scale-factor)*",f=e.style;A(_s,this)===A(Ls,this)?(f.left="".concat((100*o/A(Ts,this)).toFixed(2),"%"),f.top="".concat((100*l/A(Cs,this)).toFixed(2),"%")):(f.left="".concat(d).concat(o.toFixed(2),"px)"),f.top="".concat(d).concat(l.toFixed(2),"px)")),f.fontSize="".concat(d).concat(u.toFixed(2),"px)"),f.fontFamily=h,n.fontSize=u,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,A(Es,this)&&(e.dataset.fontName=s.fontSubstitutionLoadedName||t.fontName),0!==a&&(n.angle=a*(180/Math.PI));var v=!1;if(t.str.length>1)v=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){var p=Math.abs(t.transform[0]),g=Math.abs(t.transform[3]);p!==g&&Math.max(p,g)/Math.min(p,g)>1.5&&(v=!0)}if(v&&(n.canvasWidth=s.vertical?t.height:t.width),A(Ws,this).set(e,n),A(Ss,this).div=e,A(Ss,this).properties=n,C(Hs,this,Vs).call(this,A(Ss,this)),n.hasText&&A(_s,this).append(e),n.hasEOL){var y=document.createElement("br");y.setAttribute("role","presentation"),A(_s,this).append(y)}}function Vs(t){var e=t.div,n=t.properties,i=t.ctx,a=t.prevFontSize,r=t.prevFontFamily,s=e.style,o="";if(0!==n.canvasWidth&&n.hasText){var l=s.fontFamily,h=n.canvasWidth,u=n.fontSize;a===u&&r===l||(i.font="".concat(u*A(Is,this),"px ").concat(l),t.prevFontSize=u,t.prevFontFamily=l);var c=i.measureText(e.textContent).width;c>0&&(o="scaleX(".concat(h*A(Is,this)/c,")"))}0!==n.angle&&(o="rotate(".concat(n.angle,"deg) ").concat(o)),o.length>0&&(s.transform=o)}function qs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=C(r,this,Ks)._.get(t||(t=""));if(!e){var n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1}),C(r,this,Ks)._.set(t,e)}return e}function Us(t,e){var n=C(r,this,Xs)._.get(t);if(n)return n;var i=C(r,this,qs).call(this,e),a=i.font;i.canvas.width=i.canvas.height=bs,i.font="".concat(bs,"px ").concat(t);var s=i.measureText(""),o=s.fontBoundingBoxAscent,l=Math.abs(s.fontBoundingBoxDescent);if(o){var h=o/(o+l);return C(r,this,Xs)._.set(t,h),i.canvas.width=i.canvas.height=0,i.font=a,h}i.strokeStyle="red",i.clearRect(0,0,bs,bs),i.strokeText("g",0,0);var u=i.getImageData(0,0,bs,bs).data;l=0;for(var c=u.length-1-3;c>=0;c-=4)if(u[c]>0){l=Math.ceil(c/4/bs);break}i.clearRect(0,0,bs,bs),i.strokeText("A",0,bs),o=0;for(var d=0,f=(u=i.getImageData(0,0,bs,bs).data).length;d<f;d+=4)if(u[d]>0){o=bs-Math.floor(d/4/bs);break}i.canvas.width=i.canvas.height=0,i.font=a;var v=o?o/(o+l):ws;return C(r,this,Xs)._.set(t,v),v}r=js;var Xs={_:new Map},Ks={_:new Map},Ys={_:new Set};function Qs(){we("`renderTextLayer`, please use `TextLayer` instead.");var t=arguments[0],e=t.textContentSource,n=t.container,i=t.viewport,a=function(t,e){if(null==t)return{};var n,i,a=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(e.indexOf(i)>=0)continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||{}.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}(t,d),r=Object.keys(a);r.length>0&&lt("Ignoring `renderTextLayer` parameters: "+r.join(", "));var s=new js({textContentSource:e,container:n,viewport:i}),o=s.textDivs,l=s.textContentItemsStr;return{promise:s.render(),textDivs:o,textContentItemsStr:l}}function Js(){we("`updateTextLayer`, please use `TextLayer` instead.")}var Zs=function(){function t(){N(this,t)}return F(t,null,[{key:"textContent",value:function(e){var n=[],i={items:n,styles:Object.create(null)};return function e(i){var a;if(i){var r=null,s=i.name;if("#text"===s)r=i.value;else{if(!t.shouldBuildText(s))return;null!=i&&null!==(a=i.attributes)&&void 0!==a&&a.textContent?r=i.attributes.textContent:i.value&&(r=i.value)}if(null!==r&&n.push({str:r}),i.children){var o,l=R(i.children);try{for(l.s();!(o=l.n()).done;)e(o.value)}catch(t){l.e(t)}finally{l.f()}}}}(e),i}},{key:"shouldBuildText",value:function(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}])}(),$s=65536,to=q?Ga:re,eo=q?Va:le,no=q?za:Xt,io=q?qa:he;function ao(t){var e,n;if("string"==typeof t||t instanceof URL?t={url:t}:(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t}),"object"!==z(t))throw new Error("Invalid parameter in getDocument, need parameter object.");if(!t.url&&!t.data&&!t.range)throw new Error("Invalid parameter object: need either .data, .range or .url");var i=new so,a=i.docId,r=t.url?function(t){if(t instanceof URL)return t.href;try{return new URL(t,window.location).href}catch(e){if(q&&"string"==typeof t)return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(t.url):null,s=t.data?function(t){if(q&&"undefined"!=typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"==typeof t)return At(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"===z(t)&&!isNaN(null==t?void 0:t.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(t.data):null,o=t.httpHeaders||null,l=!0===t.withCredentials,h=null!==(e=t.password)&&void 0!==e?e:null,u=t.range instanceof lo?t.range:null,c=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:$s,d=t.worker instanceof wo?t.worker:null,f=t.verbosity,v="string"!=typeof t.docBaseUrl||fe(t.docBaseUrl)?null:t.docBaseUrl,p="string"==typeof t.cMapUrl?t.cMapUrl:null,g=!1!==t.cMapPacked,y=t.CMapReaderFactory||eo,m="string"==typeof t.standardFontDataUrl?t.standardFontDataUrl:null,k=t.StandardFontDataFactory||io,b=!0!==t.stopAtErrors,w=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1,A=!1!==t.isEvalSupported,_="boolean"==typeof t.isOffscreenCanvasSupported?t.isOffscreenCanvasSupported:!q,x=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,E="boolean"==typeof t.disableFontFace?t.disableFontFace:q,M=!0===t.fontExtraProperties,S=!0===t.enableXfa,C=t.ownerDocument||globalThis.document,T=!0===t.disableRange,R=!0===t.disableStream,L=!0===t.disableAutoFetch,P=!0===t.pdfBug,I=u?u.length:null!==(n=t.length)&&void 0!==n?n:NaN,F="boolean"==typeof t.useSystemFonts?t.useSystemFonts:!q&&!E,D="boolean"==typeof t.useWorkerFetch?t.useWorkerFetch:y===le&&k===he&&p&&m&&ke(p,document.baseURI)&&ke(m,document.baseURI),N=t.canvasFactory||new to({ownerDocument:C}),O=t.filterFactory||new no({docId:a,ownerDocument:C});rt(f);var W={canvasFactory:N,filterFactory:O};if(D||(W.cMapReaderFactory=new y({baseUrl:p,isCompressed:g}),W.standardFontDataFactory=new k({baseUrl:m})),!d){var B={verbosity:f,port:Ar.workerPort};d=B.port?wo.fromPort(B):new wo(B),i._worker=d}var H={docId:a,apiVersion:"4.3.136",data:s,password:h,disableAutoFetch:L,rangeChunkSize:c,length:I,docBaseUrl:v,enableXfa:S,evaluatorOptions:{maxImageSize:w,disableFontFace:E,ignoreErrors:b,isEvalSupported:A,isOffscreenCanvasSupported:_,canvasMaxAreaInBytes:x,fontExtraProperties:M,useSystemFonts:F,cMapUrl:D?p:null,standardFontDataUrl:D?m:null}},j={disableFontFace:E,fontExtraProperties:M,ownerDocument:C,pdfBug:P,styleElement:null,loadingParams:{disableAutoFetch:L,enableXfa:S}};return d.promise.then((function(){if(i.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var t,e,n=d.messageHandler.sendWithPromise("GetDocRequest",H,s?[s.buffer]:null);return u?t=new Kr(u,{disableRange:T,disableStream:R}):s||(e={url:r,length:I,httpHeaders:o,withCredentials:l,rangeChunkSize:c,disableRange:T,disableStream:R},t=q?"undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype&&ke(e.url)?new as(e):new ds(e):ke(e.url)?new as(e):new ls(e)),n.then((function(e){if(i.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var n=new Sr(a,e,d.port),r=new Ro(n,i,t,j,W);i._transport=r,n.send("Ready",null)}))})).catch(i._capability.reject),i}function ro(t){return"object"===z(t)&&Number.isInteger(null==t?void 0:t.num)&&t.num>=0&&Number.isInteger(null==t?void 0:t.gen)&&t.gen>=0}var so=function(){return F((function t(){var e,n;N(this,t),this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d".concat((oo._=(e=oo._,n=e++,e),n)),this.destroyed=!1,this.onPassword=null,this.onProgress=null}),[{key:"promise",get:function(){return this._capability.promise}},{key:"destroy",value:(t=S(E().mark((function t(){var e,n,i;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.destroyed=!0,t.prev=1,null!==(e=this._worker)&&void 0!==e&&e.port&&(this._worker._pendingDestroy=!0),t.next=5,null===(n=this._transport)||void 0===n?void 0:n.destroy();case 5:t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),null!==(i=this._worker)&&void 0!==i&&i.port&&delete this._worker._pendingDestroy,t.t0;case 11:this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null);case 13:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(){return t.apply(this,arguments)})}]);var t}(),oo={_:0},lo=function(){return F((function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;N(this,t),this.length=e,this.initialData=n,this.progressiveDone=i,this.contentDispositionFilename=a,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}),[{key:"addRangeListener",value:function(t){this._rangeListeners.push(t)}},{key:"addProgressListener",value:function(t){this._progressListeners.push(t)}},{key:"addProgressiveReadListener",value:function(t){this._progressiveReadListeners.push(t)}},{key:"addProgressiveDoneListener",value:function(t){this._progressiveDoneListeners.push(t)}},{key:"onDataRange",value:function(t,e){var n,i=R(this._rangeListeners);try{for(i.s();!(n=i.n()).done;)(0,n.value)(t,e)}catch(t){i.e(t)}finally{i.f()}}},{key:"onDataProgress",value:function(t,e){var n=this;this._readyCapability.promise.then((function(){var i,a=R(n._progressListeners);try{for(a.s();!(i=a.n()).done;)(0,i.value)(t,e)}catch(t){a.e(t)}finally{a.f()}}))}},{key:"onDataProgressiveRead",value:function(t){var e=this;this._readyCapability.promise.then((function(){var n,i=R(e._progressiveReadListeners);try{for(i.s();!(n=i.n()).done;)(0,n.value)(t)}catch(t){i.e(t)}finally{i.f()}}))}},{key:"onDataProgressiveDone",value:function(){var t=this;this._readyCapability.promise.then((function(){var e,n=R(t._progressiveDoneListeners);try{for(n.s();!(e=n.n()).done;)(0,e.value)()}catch(t){n.e(t)}finally{n.f()}}))}},{key:"transportReady",value:function(){this._readyCapability.resolve()}},{key:"requestDataRange",value:function(t,e){ht("Abstract method PDFDataRangeTransport.requestDataRange")}},{key:"abort",value:function(){}}])}(),ho=function(){return F((function t(e,n){N(this,t),this._pdfInfo=e,this._transport=n}),[{key:"annotationStorage",get:function(){return this._transport.annotationStorage}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"numPages",get:function(){return this._pdfInfo.numPages}},{key:"fingerprints",get:function(){return this._pdfInfo.fingerprints}},{key:"isPureXfa",get:function(){return dt(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"allXfaHtml",get:function(){return this._transport._htmlForXfa}},{key:"getPage",value:function(t){return this._transport.getPage(t)}},{key:"getPageIndex",value:function(t){return this._transport.getPageIndex(t)}},{key:"getDestinations",value:function(){return this._transport.getDestinations()}},{key:"getDestination",value:function(t){return this._transport.getDestination(t)}},{key:"getPageLabels",value:function(){return this._transport.getPageLabels()}},{key:"getPageLayout",value:function(){return this._transport.getPageLayout()}},{key:"getPageMode",value:function(){return this._transport.getPageMode()}},{key:"getViewerPreferences",value:function(){return this._transport.getViewerPreferences()}},{key:"getOpenAction",value:function(){return this._transport.getOpenAction()}},{key:"getAttachments",value:function(){return this._transport.getAttachments()}},{key:"getJSActions",value:function(){return this._transport.getDocJSActions()}},{key:"getOutline",value:function(){return this._transport.getOutline()}},{key:"getOptionalContentConfig",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).intent,e=void 0===t?"display":t,n=this._transport.getRenderingIntent(e).renderingIntent;return this._transport.getOptionalContentConfig(n)}},{key:"getPermissions",value:function(){return this._transport.getPermissions()}},{key:"getMetadata",value:function(){return this._transport.getMetadata()}},{key:"getMarkInfo",value:function(){return this._transport.getMarkInfo()}},{key:"getData",value:function(){return this._transport.getData()}},{key:"saveDocument",value:function(){return this._transport.saveDocument()}},{key:"getDownloadInfo",value:function(){return this._transport.downloadInfoCapability.promise}},{key:"cleanup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(t||this.isPureXfa)}},{key:"destroy",value:function(){return this.loadingTask.destroy()}},{key:"cachedPageNumber",value:function(t){return this._transport.cachedPageNumber(t)}},{key:"loadingParams",get:function(){return this._transport.loadingParams}},{key:"loadingTask",get:function(){return this._transport.loadingTask}},{key:"getFieldObjects",value:function(){return this._transport.getFieldObjects()}},{key:"hasJSActions",value:function(){return this._transport.hasJSActions()}},{key:"getCalculationOrderIds",value:function(){return this._transport.getCalculationOrderIds()}}])}(),uo=new WeakMap,co=new WeakMap,fo=new WeakSet,vo=function(){return F((function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];N(this,t),m(this,fo),k(this,uo,null),k(this,co,!1),this._pageIndex=e,this._pageInfo=n,this._transport=i,this._stats=a?new me:null,this._pdfBug=a,this.commonObjs=i.commonObjs,this.objs=new Do,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}),[{key:"pageNumber",get:function(){return this._pageIndex+1}},{key:"rotate",get:function(){return this._pageInfo.rotate}},{key:"ref",get:function(){return this._pageInfo.ref}},{key:"userUnit",get:function(){return this._pageInfo.userUnit}},{key:"view",get:function(){return this._pageInfo.view}},{key:"getViewport",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.scale,n=t.rotation,i=void 0===n?this.rotate:n,a=t.offsetX,r=void 0===a?0:a,s=t.offsetY,o=void 0===s?0:s,l=t.dontFlip,h=void 0!==l&&l;return new ce({viewBox:this.view,scale:e,rotation:i,offsetX:r,offsetY:o,dontFlip:h})}},{key:"getAnnotations",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).intent,e=void 0===t?"display":t,n=this._transport.getRenderingIntent(e).renderingIntent;return this._transport.getAnnotations(this._pageIndex,n)}},{key:"getJSActions",value:function(){return this._transport.getPageJSActions(this._pageIndex)}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"isPureXfa",get:function(){return dt(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"getXfa",value:(t=S(E().mark((function t(){var e;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(e=this._transport._htmlForXfa)||void 0===e?void 0:e.children[this._pageIndex])||null);case 1:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(t){var e,n,i=this,a=t.canvasContext,r=t.viewport,s=t.intent,o=void 0===s?"display":s,l=t.annotationMode,h=void 0===l?Y.ENABLE:l,u=t.transform,c=void 0===u?null:u,d=t.background,f=void 0===d?null:d,v=t.optionalContentConfigPromise,p=void 0===v?null:v,g=t.annotationCanvasMap,y=void 0===g?null:g,m=t.pageColors,k=void 0===m?null:m,b=t.printAnnotationStorage,w=void 0===b?null:b;null===(e=this._stats)||void 0===e||e.time("Overall");var A=this._transport.getRenderingIntent(o,h,w),x=A.renderingIntent,E=A.cacheKey;_(co,this,!1),C(fo,this,go).call(this),p||(p=this._transport.getOptionalContentConfig(x));var M=this._intentStates.get(E);M||(M=Object.create(null),this._intentStates.set(E,M)),M.streamReaderCancelTimeout&&(clearTimeout(M.streamReaderCancelTimeout),M.streamReaderCancelTimeout=null);var S,R=!!(4&x);M.displayReadyCapability||(M.displayReadyCapability=Promise.withResolvers(),M.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(S=this._stats)||void 0===S||S.time("Page Request"),this._pumpOperatorList(A));var L=function(t){var e;M.renderTasks.delete(P),(i._maybeCleanupAfterRender||R)&&_(co,i,!0),C(fo,i,po).call(i,!R),t?(P.capability.reject(t),i._abortOperatorList({intentState:M,reason:t instanceof Error?t:new Error(t)})):P.capability.resolve(),i._stats&&(i._stats.timeEnd("Rendering"),i._stats.timeEnd("Overall"),null!==(e=globalThis.Stats)&&void 0!==e&&e.enabled&&globalThis.Stats.add(i.pageNumber,i._stats))},P=new Bo({callback:L,params:{canvasContext:a,viewport:r,transform:c,background:f},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:y,operatorList:M.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!R,pdfBug:this._pdfBug,pageColors:k});((n=M).renderTasks||(n.renderTasks=new Set)).add(P);var I=P.task;return Promise.all([M.displayReadyCapability.promise,p]).then((function(t){var e,n=T(t,2),a=n[0],r=n[1];if(i.destroyed)L();else{if(null===(e=i._stats)||void 0===e||e.time("Rendering"),!(r.renderingIntent&x))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");P.initializeGraphics({transparency:a,optionalContentConfig:r}),P.operatorListChanged()}})).catch(L),I}},{key:"getOperatorList",value:function(){var t,e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=i.intent,r=void 0===a?"display":a,s=i.annotationMode,o=void 0===s?Y.ENABLE:s,l=i.printAnnotationStorage,h=void 0===l?null:l,u=this._transport.getRenderingIntent(r,o,h,!0),c=this._intentStates.get(u.cacheKey);return c||(c=Object.create(null),this._intentStates.set(u.cacheKey,c)),c.opListReadCapability||((t=Object.create(null)).operatorListChanged=function(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(t))},c.opListReadCapability=Promise.withResolvers(),((e=c).renderTasks||(e.renderTasks=new Set)).add(t),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(n=this._stats)||void 0===n||n.time("Page Request"),this._pumpOperatorList(u)),c.opListReadCapability.promise}},{key:"streamTextContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.includeMarkedContent,n=void 0!==e&&e,i=t.disableNormalization,a=void 0!==i&&i;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===n,disableNormalization:!0===a},{highWaterMark:100,size:function(t){return t.items.length}})}},{key:"getTextContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((function(t){return Zs.textContent(t)}));var e=this.streamTextContent(t);return new Promise((function(t,n){var i=e.getReader(),a={items:[],styles:Object.create(null),lang:null};!function e(){i.read().then((function(n){var i,r,s=n.value;n.done?t(a):(null!==(i=a.lang)&&void 0!==i||(a.lang=s.lang),Object.assign(a.styles,s.styles),(r=a.items).push.apply(r,y(s.items)),e())}),n)}()}))}},{key:"getStructTree",value:function(){return this._transport.getStructTree(this._pageIndex)}},{key:"_destroy",value:function(){this.destroyed=!0;var t,e=[],n=R(this._intentStates.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this._abortOperatorList({intentState:i,reason:new Error("Page was destroyed."),force:!0}),!i.opListReadCapability){var a,r=R(i.renderTasks);try{for(r.s();!(a=r.n()).done;){var s=a.value;e.push(s.completed),s.cancel()}}catch(t){r.e(t)}finally{r.f()}}}}catch(t){n.e(t)}finally{n.f()}return this.objs.clear(),_(co,this,!1),C(fo,this,go).call(this),Promise.all(e)}},{key:"cleanup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_(co,this,!0);var e=C(fo,this,po).call(this,!1);return t&&e&&this._stats&&(this._stats=new me),e}},{key:"_startRenderPage",value:function(t,e){var n,i,a=this._intentStates.get(e);a&&(null===(n=this._stats)||void 0===n||n.timeEnd("Page Request"),null===(i=a.displayReadyCapability)||void 0===i||i.resolve(t))}},{key:"_renderPageChunk",value:function(t,e){for(var n=0,i=t.length;n<i;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;var a,r=R(e.renderTasks);try{for(r.s();!(a=r.n()).done;)a.value.operatorListChanged()}catch(t){r.e(t)}finally{r.f()}t.lastChunk&&C(fo,this,po).call(this,!0)}},{key:"_pumpOperatorList",value:function(t){var e=this,n=t.renderingIntent,i=t.cacheKey,a=t.annotationStorageSerializable,r=a.map,s=a.transfer,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:n,cacheKey:i,annotationStorage:r},s).getReader(),l=this._intentStates.get(i);l.streamReader=o,function t(){o.read().then((function(n){var i=n.value;n.done?l.streamReader=null:e._transport.destroyed||(e._renderPageChunk(i,l),t())}),(function(t){if(l.streamReader=null,!e._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;var n,i=R(l.renderTasks);try{for(i.s();!(n=i.n()).done;)n.value.operatorListChanged()}catch(t){i.e(t)}finally{i.f()}C(fo,e,po).call(e,!0)}if(l.displayReadyCapability)l.displayReadyCapability.reject(t);else{if(!l.opListReadCapability)throw t;l.opListReadCapability.reject(t)}}}))}()}},{key:"_abortOperatorList",value:function(t){var e=this,n=t.intentState,i=t.reason,a=t.force,r=void 0!==a&&a;if(n.streamReader){if(n.streamReaderCancelTimeout&&(clearTimeout(n.streamReaderCancelTimeout),n.streamReaderCancelTimeout=null),!r){if(n.renderTasks.size>0)return;if(i instanceof de){var s=100;return i.extraDelay>0&&i.extraDelay<1e3&&(s+=i.extraDelay),void(n.streamReaderCancelTimeout=setTimeout((function(){n.streamReaderCancelTimeout=null,e._abortOperatorList({intentState:n,reason:i,force:!0})}),s))}}if(n.streamReader.cancel(new bt(i.message)).catch((function(){})),n.streamReader=null,!this._transport.destroyed){var o,l=R(this._intentStates);try{for(l.s();!(o=l.n()).done;){var h=T(o.value,2),u=h[0];if(h[1]===n){this._intentStates.delete(u);break}}}catch(t){l.e(t)}finally{l.f()}this.cleanup()}}}},{key:"stats",get:function(){return this._stats}}]);var t}();function po(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(C(fo,this,go).call(this),!A(co,this)||this.destroyed)return!1;if(e)return _(uo,this,setTimeout((function(){_(uo,t,null),C(fo,t,po).call(t,!1)}),5e3)),!1;var n,i=R(this._intentStates.values());try{for(i.s();!(n=i.n()).done;){var a=n.value,r=a.renderTasks,s=a.operatorList;if(r.size>0||!s.lastChunk)return!1}}catch(t){i.e(t)}finally{i.f()}return this._intentStates.clear(),this.objs.clear(),_(co,this,!1),!0}function go(){A(uo,this)&&(clearTimeout(A(uo,this)),_(uo,this,null))}var yo=new WeakMap,mo=new WeakMap,ko=function(){return F((function t(){N(this,t),k(this,yo,new Set),k(this,mo,Promise.resolve())}),[{key:"postMessage",value:function(t,e){var n=this,i={data:structuredClone(t,e?{transfer:e}:null)};A(mo,this).then((function(){var t,e=R(A(yo,n));try{for(e.s();!(t=e.n()).done;)t.value.call(n,i)}catch(t){e.e(t)}finally{e.f()}}))}},{key:"addEventListener",value:function(t,e){A(yo,this).add(e)}},{key:"removeEventListener",value:function(t,e){A(yo,this).delete(e)}},{key:"terminate",value:function(){A(yo,this).clear()}}])}(),bo={isWorkerDisabled:!1,fakeWorkerId:0};q&&(bo.isWorkerDisabled=!0,Ar.workerSrc||(Ar.workerSrc="./pdf.worker.mjs")),bo.isSameOrigin=function(t,e){var n;try{if(!(n=new URL(t)).origin||"null"===n.origin)return!1}catch(t){return!1}var i=new URL(e,n);return n.origin===i.origin},bo.createCDNWrapper=function(t){var e='await import("'.concat(t,'");');return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var wo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.name,i=void 0===n?null:n,a=e.port,r=void 0===a?null:a,s=e.verbosity,o=void 0===s?st():s;if(N(this,t),this.name=i,this.destroyed=!1,this.verbosity=o,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,r){var l;if(null!==(l=_o._)&&void 0!==l&&l.has(r))throw new Error("Cannot use more than one PDFWorker per port.");return(_o._||(_o._=new WeakMap)).set(r,this),void this._initializeFromPort(r)}this._initialize()}return F(t,[{key:"promise",get:function(){return q?Promise.all([Ha.promise,this._readyCapability.promise]):this._readyCapability.promise}},{key:"port",get:function(){return this._port}},{key:"messageHandler",get:function(){return this._messageHandler}},{key:"_initializeFromPort",value:function(t){this._port=t,this._messageHandler=new Sr("main","worker",t),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}},{key:"_initialize",value:function(){var e=this;if(!bo.isWorkerDisabled&&!Ao()){var n=t.workerSrc;try{bo.isSameOrigin(window.location.href,n)||(n=bo.createCDNWrapper(new URL(n,window.location).href));var i=new Worker(n,{type:"module"}),a=new Sr("main","worker",i),r=function(){i.removeEventListener("error",s),a.destroy(),i.terminate(),e.destroyed?e._readyCapability.reject(new Error("Worker was destroyed")):e._setupFakeWorker()},s=function(){e._webWorker||r()};i.addEventListener("error",s),a.on("test",(function(t){i.removeEventListener("error",s),e.destroyed?r():t?(e._messageHandler=a,e._port=i,e._webWorker=i,e._readyCapability.resolve(),a.send("configure",{verbosity:e.verbosity})):(e._setupFakeWorker(),a.destroy(),i.terminate())})),a.on("ready",(function(t){if(i.removeEventListener("error",s),e.destroyed)r();else try{o()}catch(t){e._setupFakeWorker()}}));var o=function(){var t=new Uint8Array;a.send("test",t,[t.buffer])};return void o()}catch(t){ot("The worker has been disabled.")}}this._setupFakeWorker()}},{key:"_setupFakeWorker",value:function(){var e=this;bo.isWorkerDisabled||(lt("Setting up fake worker."),bo.isWorkerDisabled=!0),t._setupFakeWorkerGlobal.then((function(t){if(e.destroyed)e._readyCapability.reject(new Error("Worker was destroyed"));else{var n=new ko;e._port=n;var i="fake".concat(bo.fakeWorkerId++),a=new Sr(i+"_worker",i,n);t.setup(a,n);var r=new Sr(i,i+"_worker",n);e._messageHandler=r,e._readyCapability.resolve(),r.send("configure",{verbosity:e.verbosity})}})).catch((function(t){e._readyCapability.reject(new Error('Setting up fake worker failed: "'.concat(t.message,'".')))}))}},{key:"destroy",value:function(){var t;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),null===(t=_o._)||void 0===t||t.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}}],[{key:"fromPort",value:function(e){var n;if(null==e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");var i=null===(n=C(t,this,_o)._)||void 0===n?void 0:n.get(e.port);if(i){if(i._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return i}return new t(e)}},{key:"workerSrc",get:function(){if(Ar.workerSrc)return Ar.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}},{key:"_setupFakeWorkerGlobal",get:function(){var e=this,n=function(){var n=S(E().mark((function n(){var i;return E().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!w(t,e,Ao)){n.next=2;break}return n.abrupt("return",w(t,e,Ao));case 2:return n.next=4,import(e.workerSrc);case 4:return i=n.sent,n.abrupt("return",i.WorkerMessageHandler);case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return dt(this,"_setupFakeWorkerGlobal",n())}}])}();function Ao(t){try{var e;return(null===(e=globalThis.pdfjsWorker)||void 0===e?void 0:e.WorkerMessageHandler)||null}catch(t){return null}}var _o={_:void 0},xo=new WeakMap,Eo=new WeakMap,Mo=new WeakMap,So=new WeakMap,Co=new WeakMap,To=new WeakSet,Ro=function(){return F((function t(e,n,i,a,r){N(this,t),m(this,To),k(this,xo,new Map),k(this,Eo,new Map),k(this,Mo,new Map),k(this,So,new Map),k(this,Co,null),this.messageHandler=e,this.loadingTask=n,this.commonObjs=new Do,this.fontLoader=new Na({ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this.loadingParams=a.loadingParams,this._params=a,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}),[{key:"annotationStorage",get:function(){return dt(this,"annotationStorage",new La)}},{key:"getRenderingIntent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y.ENABLE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=2,r=Sa;switch(t){case"any":a=1;break;case"display":break;case"print":a=4;break;default:lt("getRenderingIntent - invalid intent: ".concat(t))}switch(e){case Y.DISABLE:a+=64;break;case Y.ENABLE:break;case Y.ENABLE_FORMS:a+=16;break;case Y.ENABLE_STORAGE:r=(4&(a+=32)&&n instanceof Fa?n:this.annotationStorage).serializable;break;default:lt("getRenderingIntent - invalid annotationMode: ".concat(e))}return i&&(a+=256),{renderingIntent:a,cacheKey:"".concat(a,"_").concat(r.hash),annotationStorageSerializable:r}}},{key:"destroy",value:function(){var t,e=this;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),null===(t=A(Co,this))||void 0===t||t.reject(new Error("Worker was destroyed during onPassword callback"));var n,i=[],a=R(A(Eo,this).values());try{for(a.s();!(n=a.n()).done;){var r=n.value;i.push(r._destroy())}}catch(t){a.e(t)}finally{a.f()}A(Eo,this).clear(),A(Mo,this).clear(),A(So,this).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();var s=this.messageHandler.sendWithPromise("Terminate",null);return i.push(s),Promise.all(i).then((function(){var t;e.commonObjs.clear(),e.fontLoader.clear(),A(xo,e).clear(),e.filterFactory.destroy(),js.cleanup(),null===(t=e._networkStream)||void 0===t||t.cancelAllRequests(new bt("Worker was terminated.")),e.messageHandler&&(e.messageHandler.destroy(),e.messageHandler=null),e.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}},{key:"setupMessageHandler",value:function(){var t=this,e=this.messageHandler,n=this.loadingTask;e.on("GetReader",(function(e,n){ut(t._networkStream,"GetReader - no `IPDFStream` instance available."),t._fullReader=t._networkStream.getFullReader(),t._fullReader.onProgress=function(e){t._lastProgress={loaded:e.loaded,total:e.total}},n.onPull=function(){t._fullReader.read().then((function(t){var e=t.value;t.done?n.close():(ut(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(e),1,[e]))})).catch((function(t){n.error(t)}))},n.onCancel=function(e){t._fullReader.cancel(e),n.ready.catch((function(e){if(!t.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(function(e){var i=Promise.withResolvers(),a=t._fullReader;return a.headersReady.then((function(){var e;a.isStreamingSupported&&a.isRangeSupported||(t._lastProgress&&(null===(e=n.onProgress)||void 0===e||e.call(n,t._lastProgress)),a.onProgress=function(t){var e;null===(e=n.onProgress)||void 0===e||e.call(n,{loaded:t.loaded,total:t.total})});i.resolve({isStreamingSupported:a.isStreamingSupported,isRangeSupported:a.isRangeSupported,contentLength:a.contentLength})}),i.reject),i.promise})),e.on("GetRangeReader",(function(e,n){ut(t._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var i=t._networkStream.getRangeReader(e.begin,e.end);i?(n.onPull=function(){i.read().then((function(t){var e=t.value;t.done?n.close():(ut(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(e),1,[e]))})).catch((function(t){n.error(t)}))},n.onCancel=function(e){i.cancel(e),n.ready.catch((function(e){if(!t.destroyed)throw e}))}):n.close()})),e.on("GetDoc",(function(e){var i=e.pdfInfo;t._numPages=i.numPages,t._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,n._capability.resolve(new ho(i,t))})),e.on("DocException",(function(t){var e;switch(t.name){case"PasswordException":e=new vt(t.message,t.code);break;case"InvalidPDFException":e=new gt(t.message);break;case"MissingPDFException":e=new yt(t.message);break;case"UnexpectedResponseException":e=new mt(t.message,t.status);break;case"UnknownErrorException":e=new pt(t.message,t.details);break;default:ht("DocException - expected a valid Error.")}n._capability.reject(e)})),e.on("PasswordRequest",(function(e){if(_(Co,t,Promise.withResolvers()),n.onPassword)try{n.onPassword((function(e){e instanceof Error?A(Co,t).reject(e):A(Co,t).resolve({password:e})}),e.code)}catch(e){A(Co,t).reject(e)}else A(Co,t).reject(new vt(e.message,e.code));return A(Co,t).promise})),e.on("DataLoaded",(function(e){var i;null===(i=n.onProgress)||void 0===i||i.call(n,{loaded:e.length,total:e.length}),t.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(function(e){t.destroyed||A(Eo,t).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(function(n){var i,a=T(n,3),r=a[0],s=a[1],o=a[2];if(t.destroyed)return null;if(t.commonObjs.has(r))return null;switch(s){case"Font":var l=t._params,h=l.disableFontFace,u=l.fontExtraProperties,c=l.pdfBug;if("error"in o){var d=o.error;lt("Error during font loading: ".concat(d)),t.commonObjs.resolve(r,d);break}var f=c&&null!==(i=globalThis.FontInspector)&&void 0!==i&&i.enabled?function(t,e){return globalThis.FontInspector.fontAdded(t,e)}:null,v=new Oa(o,{disableFontFace:h,inspectFont:f});t.fontLoader.bind(v).catch((function(){return e.sendWithPromise("FontFallback",{id:r})})).finally((function(){!u&&v.data&&(v.data=null),t.commonObjs.resolve(r,v)}));break;case"CopyLocalImage":var p=o.imageRef;ut(p,"The imageRef must be defined.");var g,y=R(A(Eo,t).values());try{for(y.s();!(g=y.n()).done;){var m,k=R(g.value.objs);try{for(k.s();!(m=k.n()).done;){var b=T(m.value,2)[1];if((null==b?void 0:b.ref)===p)return b.dataLen?(t.commonObjs.resolve(r,structuredClone(b)),b.dataLen):null}}catch(t){k.e(t)}finally{k.f()}}}catch(t){y.e(t)}finally{y.f()}break;case"FontPath":case"Image":case"Pattern":t.commonObjs.resolve(r,o);break;default:throw new Error("Got unknown common object type ".concat(s))}return null})),e.on("obj",(function(e){var n=T(e,4),i=n[0],a=n[1],r=n[2],s=n[3];if(!t.destroyed){var o,l=A(Eo,t).get(a);if(!l.objs.has(i))if(0!==l._intentStates.size)switch(r){case"Image":l.objs.resolve(i,s),(null==s?void 0:s.dataLen)>1e7&&(l._maybeCleanupAfterRender=!0);break;case"Pattern":l.objs.resolve(i,s);break;default:throw new Error("Got unknown object type ".concat(r))}else null==s||null===(o=s.bitmap)||void 0===o||o.close()}})),e.on("DocProgress",(function(e){var i;t.destroyed||null===(i=n.onProgress)||void 0===i||i.call(n,{loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",(function(e){return t.destroyed?Promise.reject(new Error("Worker was destroyed.")):t.cMapReaderFactory?t.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))})),e.on("FetchStandardFontData",(function(e){return t.destroyed?Promise.reject(new Error("Worker was destroyed.")):t.standardFontDataFactory?t.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))}))}},{key:"getData",value:function(){return this.messageHandler.sendWithPromise("GetData",null)}},{key:"saveDocument",value:function(){var t,e,n=this;this.annotationStorage.size<=0&&lt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");var i=this.annotationStorage.serializable,a=i.map,r=i.transfer;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:null!==(t=null===(e=this._fullReader)||void 0===e?void 0:e.filename)&&void 0!==t?t:null},r).finally((function(){n.annotationStorage.resetModified()}))}},{key:"getPage",value:function(t){var e=this;if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));var n=t-1,i=A(Mo,this).get(n);if(i)return i;var a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:n}).then((function(i){if(e.destroyed)throw new Error("Transport destroyed");i.refStr&&A(So,e).set(i.refStr,t);var a=new vo(n,i,e,e._params.pdfBug);return A(Eo,e).set(n,a),a}));return A(Mo,this).set(n,a),a}},{key:"getPageIndex",value:function(t){return ro(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}},{key:"getAnnotations",value:function(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}},{key:"getFieldObjects",value:function(){return C(To,this,Lo).call(this,"GetFieldObjects")}},{key:"hasJSActions",value:function(){return C(To,this,Lo).call(this,"HasJSActions")}},{key:"getCalculationOrderIds",value:function(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}},{key:"getDestinations",value:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)}},{key:"getDestination",value:function(t){return"string"!=typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}},{key:"getPageLabels",value:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}},{key:"getPageLayout",value:function(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}},{key:"getPageMode",value:function(){return this.messageHandler.sendWithPromise("GetPageMode",null)}},{key:"getViewerPreferences",value:function(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}},{key:"getOpenAction",value:function(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}},{key:"getAttachments",value:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)}},{key:"getDocJSActions",value:function(){return C(To,this,Lo).call(this,"GetDocJSActions")}},{key:"getPageJSActions",value:function(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}},{key:"getStructTree",value:function(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}},{key:"getOutline",value:function(){return this.messageHandler.sendWithPromise("GetOutline",null)}},{key:"getOptionalContentConfig",value:function(t){return C(To,this,Lo).call(this,"GetOptionalContentConfig").then((function(e){return new Ur(e,t)}))}},{key:"getPermissions",value:function(){return this.messageHandler.sendWithPromise("GetPermissions",null)}},{key:"getMetadata",value:function(){var t=this,e="GetMetadata",n=A(xo,this).get(e);if(n)return n;var i=this.messageHandler.sendWithPromise(e,null).then((function(e){var n,i,a,r;return{info:e[0],metadata:e[1]?new Fr(e[1]):null,contentDispositionFilename:null!==(n=null===(i=t._fullReader)||void 0===i?void 0:i.filename)&&void 0!==n?n:null,contentLength:null!==(a=null===(r=t._fullReader)||void 0===r?void 0:r.contentLength)&&void 0!==a?a:null}}));return A(xo,this).set(e,i),i}},{key:"getMarkInfo",value:function(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}},{key:"startCleanup",value:(t=S(E().mark((function t(){var e,n,i,a,r=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]&&r[0],!this.destroyed){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.messageHandler.sendWithPromise("Cleanup",null);case 5:n=R(A(Eo,this).values()),t.prev=6,n.s();case 8:if((i=n.n()).done){t.next=15;break}if((a=i.value).cleanup()){t.next=13;break}throw new Error("startCleanup: Page ".concat(a.pageNumber," is currently rendering."));case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:this.commonObjs.clear(),e||this.fontLoader.clear(),A(xo,this).clear(),this.filterFactory.destroy(!0),js.cleanup();case 28:case"end":return t.stop()}}),t,this,[[6,17,20,23]])}))),function(){return t.apply(this,arguments)})},{key:"cachedPageNumber",value:function(t){var e;if(!ro(t))return null;var n=0===t.gen?"".concat(t.num,"R"):"".concat(t.num,"R").concat(t.gen);return null!==(e=A(So,this).get(n))&&void 0!==e?e:null}}]);var t}();function Lo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=A(xo,this).get(t);if(n)return n;var i=this.messageHandler.sendWithPromise(t,e);return A(xo,this).set(t,i),i}var Po=Symbol("INITIAL_DATA"),Io=new WeakMap,Fo=new WeakSet,Do=function(){return F((function t(){N(this,t),m(this,Fo),k(this,Io,Object.create(null))}),[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var n=C(Fo,this,No).call(this,t);return n.promise.then((function(){return e(n.data)})),null}var i=A(Io,this)[t];if(!i||i.data===Po)throw new Error("Requesting object that isn't resolved yet ".concat(t,"."));return i.data}},{key:"has",value:function(t){var e=A(Io,this)[t];return!!e&&e.data!==Po}},{key:"resolve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=C(Fo,this,No).call(this,t);n.data=e,n.resolve()}},{key:"clear",value:function(){for(var t in A(Io,this)){var e,n=A(Io,this)[t].data;null==n||null===(e=n.bitmap)||void 0===e||e.close()}_(Io,this,Object.create(null))}},{key:Symbol.iterator,value:E().mark((function t(){var e,n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=E().keys(A(Io,this));case 1:if((t.t1=t.t0()).done){t.next=10;break}if(e=t.t1.value,(n=A(Io,this)[e].data)!==Po){t.next=6;break}return t.abrupt("continue",1);case 6:return t.next=8,[e,n];case 8:t.next=1;break;case 10:case"end":return t.stop()}}),t,this)}))}])}();function No(t){var e;return(e=A(Io,this))[t]||(e[t]=v(v({},Promise.withResolvers()),{},{data:Po}))}var Oo=new WeakMap,Wo=function(){return F((function t(e){N(this,t),k(this,Oo,null),_(Oo,this,e),this.onContinue=null}),[{key:"promise",get:function(){return A(Oo,this).capability.promise}},{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;A(Oo,this).cancel(null,t)}},{key:"separateAnnots",get:function(){var t=A(Oo,this).operatorList.separateAnnots;if(!t)return!1;var e=A(Oo,this).annotationCanvasMap;return t.form||t.canvas&&(null==e?void 0:e.size)>0}}])}(),Bo=function(){return F((function t(e){var n=e.callback,i=e.params,a=e.objs,r=e.commonObjs,s=e.annotationCanvasMap,o=e.operatorList,l=e.pageIndex,h=e.canvasFactory,u=e.filterFactory,c=e.useRequestAnimationFrame,d=void 0!==c&&c,f=e.pdfBug,v=void 0!==f&&f,p=e.pageColors,g=void 0===p?null:p;N(this,t),this.callback=n,this.params=i,this.objs=a,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=h,this.filterFactory=u,this._pdfBug=v,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Wo(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=i.canvasContext.canvas}),[{key:"completed",get:function(){return this.capability.promise.catch((function(){}))}},{key:"initializeGraphics",value:function(t){var e,n,i=t.transparency,a=void 0!==i&&i,r=t.optionalContentConfig;if(!this.cancelled){if(this._canvas){if(Ho._.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ho._.add(this._canvas)}this._pdfBug&&null!==(e=globalThis.StepperManager)&&void 0!==e&&e.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var s=this.params,o=s.canvasContext,l=s.viewport,h=s.transform,u=s.background;this.gfx=new mr(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:r},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:h,viewport:l,transparency:a,background:u}),this.operatorListIdx=0,this.graphicsReady=!0,null===(n=this.graphicsReadyCallback)||void 0===n||n.call(this)}}},{key:"cancel",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,null===(t=this.gfx)||void 0===t||t.endDrawing(),Ho._.delete(this._canvas),this.callback(e||new de("Rendering cancelled, page ".concat(this._pageIndex+1),n))}},{key:"operatorListChanged",value:function(){var t;this.graphicsReady?(null===(t=this.stepper)||void 0===t||t.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}},{key:"_continue",value:function(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}},{key:"_scheduleNext",value:function(){var t=this;this._useRequestAnimationFrame?window.requestAnimationFrame((function(){t._nextBound().catch(t._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}},{key:"_next",value:(t=S(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cancelled){t.next=2;break}return t.abrupt("return");case 2:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ho._.delete(this._canvas),this.callback()));case 4:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})}]);var t}(),Ho={_:new WeakSet},jo="4.3.136",zo="0cec64437";function Go(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function Vo(t){return Math.max(0,Math.min(255,255*t))}var qo=function(){return F((function t(){N(this,t)}),null,[{key:"CMYK_G",value:function(t){var e=T(t,4),n=e[0],i=e[1],a=e[2],r=e[3];return["G",1-Math.min(1,.3*n+.59*a+.11*i+r)]}},{key:"G_CMYK",value:function(t){return["CMYK",0,0,0,1-T(t,1)[0]]}},{key:"G_RGB",value:function(t){var e=T(t,1)[0];return["RGB",e,e,e]}},{key:"G_rgb",value:function(t){var e=T(t,1)[0];return[e=Vo(e),e,e]}},{key:"G_HTML",value:function(t){var e=Go(T(t,1)[0]);return"#".concat(e).concat(e).concat(e)}},{key:"RGB_G",value:function(t){var e=T(t,3);return["G",.3*e[0]+.59*e[1]+.11*e[2]]}},{key:"RGB_rgb",value:function(t){return t.map(Vo)}},{key:"RGB_HTML",value:function(t){return"#".concat(t.map(Go).join(""))}},{key:"T_HTML",value:function(){return"#00000000"}},{key:"T_rgb",value:function(){return[null]}},{key:"CMYK_RGB",value:function(t){var e=T(t,4),n=e[0],i=e[1],a=e[2],r=e[3];return["RGB",1-Math.min(1,n+r),1-Math.min(1,a+r),1-Math.min(1,i+r)]}},{key:"CMYK_rgb",value:function(t){var e=T(t,4),n=e[0],i=e[1],a=e[2],r=e[3];return[Vo(1-Math.min(1,n+r)),Vo(1-Math.min(1,a+r)),Vo(1-Math.min(1,i+r))]}},{key:"CMYK_HTML",value:function(t){var e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}},{key:"RGB_CMYK",value:function(t){var e=T(t,3),n=1-e[0],i=1-e[1],a=1-e[2];return["CMYK",n,i,a,Math.min(n,i,a)]}}])}(),Uo=function(){return F((function t(){N(this,t)}),null,[{key:"setupStorage",value:function(t,e,n,i,a){var r=i.getValue(e,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(t.textContent=r.value),"print"===a)break;t.addEventListener("input",(function(t){i.setValue(e,{value:t.target.value})}));break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?t.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&t.removeAttribute("checked"),"print"===a)break;t.addEventListener("change",(function(t){i.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})}))}else{if(null!==r.value&&t.setAttribute("value",r.value),"print"===a)break;t.addEventListener("input",(function(t){i.setValue(e,{value:t.target.value})}))}break;case"select":if(null!==r.value){t.setAttribute("value",r.value);var s,o=R(n.children);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.attributes.value===r.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}}catch(t){o.e(t)}finally{o.f()}}t.addEventListener("input",(function(t){var n=t.target.options,a=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(e,{value:a})}))}}},{key:"setAttributes",value:function(t){var e=t.html,n=t.element,i=t.storage,a=void 0===i?null:i,r=t.intent,s=t.linkService,o=n.attributes,l=e instanceof HTMLAnchorElement;"radio"===o.type&&(o.name="".concat(o.name,"-").concat(r));for(var h=0,u=Object.entries(o);h<u.length;h++){var c=T(u[h],2),d=c[0],f=c[1];if(null!=f)switch(d){case"class":f.length&&e.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",f);break;case"style":Object.assign(e.style,f);break;case"textContent":e.textContent=f;break;default:(!l||"href"!==d&&"newWindow"!==d)&&e.setAttribute(d,f)}}l&&s.addLinkAttributes(e,o.href,o.newWindow),a&&o.dataId&&this.setupStorage(e,o.dataId,n,a)}},{key:"render",value:function(t){var e=t.annotationStorage,n=t.linkService,i=t.xfaHtml,a=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:a,linkService:n});var s="richText"!==a,o=t.div;if(o.append(r),t.viewport){var l="matrix(".concat(t.viewport.transform.join(","),")");o.style.transform=l}s&&o.setAttribute("class","xfaLayer xfaFont");var h=[];if(0===i.children.length){if(i.value){var u=document.createTextNode(i.value);r.append(u),s&&Zs.shouldBuildText(i.name)&&h.push(u)}return{textDivs:h}}for(var c=[[i,-1,r]];c.length>0;){var d,f,v=T(c.at(-1),3),p=v[0],g=v[1],y=v[2];if(g+1!==p.children.length){var m=p.children[++c.at(-1)[1]];if(null!==m){var k=m.name;if("#text"!==k){var b=null!=m&&null!==(d=m.attributes)&&void 0!==d&&d.xmlns?document.createElementNS(m.attributes.xmlns,k):document.createElement(k);if(y.append(b),m.attributes&&this.setAttributes({html:b,element:m,storage:e,intent:a,linkService:n}),(null===(f=m.children)||void 0===f?void 0:f.length)>0)c.push([m,-1,b]);else if(m.value){var w=document.createTextNode(m.value);s&&Zs.shouldBuildText(k)&&h.push(w),b.append(w)}}else{var A=document.createTextNode(m.value);h.push(A),y.append(A)}}}else c.pop()}var _,x=R(o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"));try{for(x.s();!(_=x.n()).done;)_.value.setAttribute("readOnly",!0)}catch(t){x.e(t)}finally{x.f()}return{textDivs:h}}},{key:"update",value:function(t){var e="matrix(".concat(t.viewport.transform.join(","),")");t.div.style.transform=e,t.div.hidden=!1}}])}(),Xo=1e3,Ko=new WeakSet;function Yo(t){return{width:t[2]-t[0],height:t[3]-t[1]}}var Qo=function(){return F((function t(){N(this,t)}),null,[{key:"create",value:function(t){switch(t.data.annotationType){case 2:return new al(t);case 1:return new ll(t);case 20:switch(t.data.fieldType){case"Tx":return new ul(t);case"Btn":return t.data.radioButton?new fl(t):t.data.checkBox?new dl(t):new vl(t);case"Ch":return new pl(t);case"Sig":return new cl(t)}return new hl(t);case 16:return new gl(t);case 3:return new Xl(t);case 4:return new Yl(t);case 5:return new Jl(t);case 6:return new $l(t);case 8:return new eh(t);case 14:return new ih(t);case 15:return new rh(t);case 7:return new nh(t);case 9:return new sh(t);case 10:return new oh(t);case 11:return new lh(t);case 12:return new hh(t);case 13:return new uh(t);case 17:return new fh(t);default:return new el(t)}}}])}(),Jo=new WeakMap,Zo=new WeakMap,$o=new WeakMap,tl=new WeakSet,el=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.isRenderable,a=void 0!==i&&i,r=n.ignoreBorder,s=void 0!==r&&r,o=n.createQuadrilaterals,l=void 0!==o&&o;N(this,t),m(this,tl),k(this,Jo,null),k(this,Zo,!1),k(this,$o,null),this.isRenderable=a,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,a&&(this.container=this._createContainer(s)),l&&this._createQuadrilaterals()}return F(t,[{key:"hasPopupData",get:function(){return t._hasPopupData(this.data)}},{key:"updateEdited",value:function(t){var e;if(this.container){A(Jo,this)||_(Jo,this,{rect:this.data.rect.slice(0)});var n=t.rect;n&&C(tl,this,nl).call(this,n),null===(e=A($o,this))||void 0===e||e.popup.updateEdited(t)}}},{key:"resetEdited",value:function(){var t;A(Jo,this)&&(C(tl,this,nl).call(this,A(Jo,this).rect),null===(t=A($o,this))||void 0===t||t.popup.resetEdited(),_(Jo,this,null))}},{key:"_createContainer",value:function(t){var e=this.data,n=this.parent,i=n.page,a=n.viewport,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),this instanceof hl||(r.tabIndex=Xo);var s=r.style;if(s.zIndex=this.parent.zIndex++,e.popupRef&&r.setAttribute("aria-haspopup","dialog"),e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof gl){var o=e.rotation;return e.hasOwnCanvas||0===o||this.setRotation(o,r),r}var l=Yo(e.rect),h=l.width,u=l.height;if(!t&&e.borderStyle.width>0){s.borderWidth="".concat(e.borderStyle.width,"px");var c=e.borderStyle.horizontalCornerRadius,d=e.borderStyle.verticalCornerRadius;if(c>0||d>0){var f="calc(".concat(c,"px * var(--scale-factor)) / calc(").concat(d,"px * var(--scale-factor))");s.borderRadius=f}else if(this instanceof fl){var v="calc(".concat(h,"px * var(--scale-factor)) / calc(").concat(u,"px * var(--scale-factor))");s.borderRadius=v}switch(e.borderStyle.style){case 1:s.borderStyle="solid";break;case 2:s.borderStyle="dashed";break;case 3:lt("Unimplemented border style: beveled");break;case 4:lt("Unimplemented border style: inset");break;case 5:s.borderBottomStyle="solid"}var p=e.borderColor||null;p?(_(Zo,this,!0),s.borderColor=Mt.makeHexColor(0|p[0],0|p[1],0|p[2])):s.borderWidth=0}var g=Mt.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),y=a.rawDims,m=y.pageWidth,k=y.pageHeight,b=y.pageX,w=y.pageY;s.left="".concat(100*(g[0]-b)/m,"%"),s.top="".concat(100*(g[1]-w)/k,"%");var A=e.rotation;return e.hasOwnCanvas||0===A?(s.width="".concat(100*h/m,"%"),s.height="".concat(100*u/k,"%")):this.setRotation(A,r),r}},{key:"setRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(this.data.rect){var n,i,a=this.parent.viewport.rawDims,r=a.pageWidth,s=a.pageHeight,o=Yo(this.data.rect),l=o.width,h=o.height;t%180==0?(n=100*l/r,i=100*h/s):(n=100*h/r,i=100*l/s),e.style.width="".concat(n,"%"),e.style.height="".concat(i,"%"),e.setAttribute("data-main-rotation",(360-t)%360)}}},{key:"_commonActions",get:function(){var t=this,e=function(e,n,i){var a=i.detail[e],r=a[0],s=a.slice(1);i.target.style[n]=qo["".concat(r,"_HTML")](s),t.annotationStorage.setValue(t.data.id,x({},n,qo["".concat(r,"_rgb")](s)))};return dt(this,"_commonActions",{display:function(e){var n=e.detail.display,i=n%2==1;t.container.style.visibility=i?"hidden":"visible",t.annotationStorage.setValue(t.data.id,{noView:i,noPrint:1===n||2===n})},print:function(e){t.annotationStorage.setValue(t.data.id,{noPrint:!e.detail.print})},hidden:function(e){var n=e.detail.hidden;t.container.style.visibility=n?"hidden":"visible",t.annotationStorage.setValue(t.data.id,{noPrint:n,noView:n})},focus:function(t){setTimeout((function(){return t.target.focus({preventScroll:!1})}),0)},userName:function(t){t.target.title=t.detail.userName},readonly:function(t){t.target.disabled=t.detail.readonly},required:function(e){t._setRequired(e.target,e.detail.required)},bgColor:function(t){e("bgColor","backgroundColor",t)},fillColor:function(t){e("fillColor","backgroundColor",t)},fgColor:function(t){e("fgColor","color",t)},textColor:function(t){e("textColor","color",t)},borderColor:function(t){e("borderColor","borderColor",t)},strokeColor:function(t){e("strokeColor","borderColor",t)},rotation:function(e){var n=e.detail.rotation;t.setRotation(n),t.annotationStorage.setValue(t.data.id,{rotation:n})}})}},{key:"_dispatchEventFromSandbox",value:function(t,e){for(var n=this._commonActions,i=0,a=Object.keys(e.detail);i<a.length;i++){var r=a[i],s=t[r]||n[r];null==s||s(e)}}},{key:"_setDefaultPropertiesFromJS",value:function(t){if(this.enableScripting){var e=this.annotationStorage.getRawValue(this.data.id);if(e)for(var n=this._commonActions,i=0,a=Object.entries(e);i<a.length;i++){var r=T(a[i],2),s=r[0],o=r[1],l=n[s];l&&(l({detail:x({},s,o),target:t}),delete e[s])}}}},{key:"_createQuadrilaterals",value:function(){if(this.container){var t=this.data.quadPoints;if(t){var e=T(this.data.rect,4),n=e[0],i=e[1],a=e[2],r=e[3];if(1===t.length){var s=T(t[0],3),o=s[1],l=o.x,h=o.y,u=s[2],c=u.x,d=u.y;if(a===l&&r===h&&n===c&&i===d)return}var f,v=this.container.style;if(A(Zo,this)){var p=v.borderColor,g=v.borderWidth;v.borderWidth=0,f=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">','<g fill="transparent" stroke="'.concat(p,'" stroke-width="').concat(g,'">')],this.container.classList.add("hasBorder")}var y=a-n,m=r-i,k=this.svgFactory,b=k.createElement("svg");b.classList.add("quadrilateralsContainer"),b.setAttribute("width",0),b.setAttribute("height",0);var w=k.createElement("defs");b.append(w);var _=k.createElement("clipPath"),x="clippath_".concat(this.data.id);_.setAttribute("id",x),_.setAttribute("clipPathUnits","objectBoundingBox"),w.append(_);var E,M=R(t);try{for(M.s();!(E=M.n()).done;){var S,C=T(E.value,3),L=C[1],P=L.x,I=L.y,F=C[2],D=F.x,N=F.y,O=k.createElement("rect"),W=(D-n)/y,B=(r-I)/m,H=(P-D)/y,j=(I-N)/m;O.setAttribute("x",W),O.setAttribute("y",B),O.setAttribute("width",H),O.setAttribute("height",j),_.append(O),null===(S=f)||void 0===S||S.push('<rect vector-effect="non-scaling-stroke" x="'.concat(W,'" y="').concat(B,'" width="').concat(H,'" height="').concat(j,'"/>'))}}catch(t){M.e(t)}finally{M.f()}A(Zo,this)&&(f.push("</g></svg>')"),v.backgroundImage=f.join("")),this.container.append(b),this.container.style.clipPath="url(#".concat(x,")")}}}},{key:"_createPopup",value:function(){var t=this.container,e=this.data;t.setAttribute("aria-haspopup","dialog");var n=_($o,this,new gl({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:"popup_".concat(e.id),rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(n.render())}},{key:"render",value:function(){ht("Abstract method `AnnotationElement.render` called")}},{key:"_getElementsByName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[];if(this._fieldObjects){var i=this._fieldObjects[t];if(i){var a,r=R(i);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=s.page,l=s.id,h=s.exportValues;if(-1!==o&&l!==e){var u="string"==typeof h?h:null,c=document.querySelector('[data-element-id="'.concat(l,'"]'));!c||Ko.has(c)?n.push({id:l,exportValue:u,domElement:c}):lt("_getElementsByName - element not allowed: ".concat(l))}}}catch(t){r.e(t)}finally{r.f()}}return n}var d,f=R(document.getElementsByName(t));try{for(f.s();!(d=f.n()).done;){var v=d.value,p=v.exportValue,g=v.getAttribute("data-element-id");g!==e&&Ko.has(v)&&n.push({id:g,exportValue:p,domElement:v})}}catch(t){f.e(t)}finally{f.f()}return n}},{key:"show",value:function(){var t;this.container&&(this.container.hidden=!1),null===(t=this.popup)||void 0===t||t.maybeShow()}},{key:"hide",value:function(){var t;this.container&&(this.container.hidden=!0),null===(t=this.popup)||void 0===t||t.forceHide()}},{key:"getElementsToTriggerPopup",value:function(){return this.container}},{key:"addHighlightArea",value:function(){var t=this.getElementsToTriggerPopup();if(Array.isArray(t)){var e,n=R(t);try{for(n.s();!(e=n.n()).done;)e.value.classList.add("highlightArea")}catch(t){n.e(t)}finally{n.f()}}else t.classList.add("highlightArea")}},{key:"_isEditable",get:function(){return!1}},{key:"_editOnDoubleClick",value:function(){var t=this;if(this._isEditable){var e=this.annotationEditorType,n=this.data.id;this.container.addEventListener("dblclick",(function(){var i;null===(i=t.linkService.eventBus)||void 0===i||i.dispatch("switchannotationeditormode",{source:t,mode:e,editId:n})}))}}}],[{key:"_hasPopupData",value:function(t){var e=t.titleObj,n=t.contentsObj,i=t.richText;return!!(null!=e&&e.str||null!=n&&n.str||null!=i&&i.str)}}])}();function nl(t){var e=this.container.style,n=this.data,i=n.rect,a=n.rotation,r=this.parent.viewport.rawDims,s=r.pageWidth,o=r.pageHeight,l=r.pageX,h=r.pageY;null==i||i.splice.apply(i,[0,4].concat(y(t)));var u=Yo(t),c=u.width,d=u.height;e.left="".concat(100*(t[0]-l)/s,"%"),e.top="".concat(100*(o-t[3]+h)/o,"%"),0===a?(e.width="".concat(100*c/s,"%"),e.height="".concat(100*d/o,"%")):this.setRotation(a)}var il=new WeakSet,al=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return N(this,e),m(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!(null==i||!i.ignoreBorder),createQuadrilaterals:!0}]),il),n.isTooltipOnly=t.data.isTooltipOnly,n}return H(e,t),F(e,[{key:"render",value:function(){var t=this.data,e=this.linkService,n=document.createElement("a");n.setAttribute("data-element-id",t.id);var i=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(n,t.action),i=!0):t.attachment?(C(il,this,sl).call(this,n,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(C(il,this,ol).call(this,n,t.setOCGState),i=!0):t.dest?(this._bindLink(n,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),i=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(n),this.container}},{key:"_bindLink",value:function(t,e){var n=this;t.href=this.linkService.getDestinationHash(e),t.onclick=function(){return e&&n.linkService.goToDestination(e),!1},(e||""===e)&&C(il,this,rl).call(this)}},{key:"_bindNamedAction",value:function(t,e){var n=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return n.linkService.executeNamedAction(e),!1},C(il,this,rl).call(this)}},{key:"_bindJSAction",value:function(t,e){var n=this;t.href=this.linkService.getAnchorUrl("");for(var i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]),a=function(){var a=s[r],o=i.get(a);if(!o)return 1;t[o]=function(){var t;return null===(t=n.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:n,detail:{id:e.id,name:a}}),!1}},r=0,s=Object.keys(e.actions);r<s.length;r++)a();t.onclick||(t.onclick=function(){return!1}),C(il,this,rl).call(this)}},{key:"_bindResetFormAction",value:function(t,e){var n=this,i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),C(il,this,rl).call(this),!this._fieldObjects)return lt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(i||(t.onclick=function(){return!1}));t.onclick=function(){null==i||i();var t=e.fields,a=e.refs,r=e.include,s=[];if(0!==t.length||0!==a.length){var o,l=new Set(a),h=R(t);try{for(h.s();!(o=h.n()).done;){var u,c=o.value,d=R(n._fieldObjects[c]||[]);try{for(d.s();!(u=d.n()).done;){var f=u.value.id;l.add(f)}}catch(t){d.e(t)}finally{d.f()}}}catch(t){h.e(t)}finally{h.f()}for(var v=0,p=Object.values(n._fieldObjects);v<p.length;v++){var g,m=R(p[v]);try{for(m.s();!(g=m.n()).done;){var k=g.value;l.has(k.id)===r&&s.push(k)}}catch(t){m.e(t)}finally{m.f()}}}else for(var b=0,w=Object.values(n._fieldObjects);b<w.length;b++){var A=w[b];s.push.apply(s,y(A))}for(var _,x=n.annotationStorage,E=[],M=0,S=s;M<S.length;M++){var C=S[M],T=C.id;switch(E.push(T),C.type){case"text":var L=C.defaultValue||"";x.setValue(T,{value:L});break;case"checkbox":case"radiobutton":var P=C.defaultValue===C.exportValues;x.setValue(T,{value:P});break;case"combobox":case"listbox":var I=C.defaultValue||"";x.setValue(T,{value:I});break;default:continue}var F=document.querySelector('[data-element-id="'.concat(T,'"]'));F&&(Ko.has(F)?F.dispatchEvent(new Event("resetform")):lt("_bindResetFormAction - element not allowed: ".concat(T)))}return n.enableScripting&&(null===(_=n.linkService.eventBus)||void 0===_||_.dispatch("dispatcheventinsandbox",{source:n,detail:{id:"app",ids:E,name:"ResetForm"}})),!1}}}])}(el);function rl(){this.container.setAttribute("data-internal-link","")}function sl(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=function(){var t;return null===(t=n.downloadManager)||void 0===t||t.openOrDownloadData(e.content,e.filename,i),!1},C(il,this,rl).call(this)}function ol(t,e){var n=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return n.linkService.executeSetOCGState(e),!1},C(il,this,rl).call(this)}var ll=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0}])}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add("textAnnotation");var t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}])}(el),hl=function(t){function e(){return N(this,e),O(this,e,arguments)}return H(e,t),F(e,[{key:"render",value:function(){return this.container}},{key:"showElementAndHideCanvas",value:function(t){var e;this.data.hasOwnCanvas&&("CANVAS"===(null===(e=t.previousSibling)||void 0===e?void 0:e.nodeName)&&(t.previousSibling.hidden=!0),t.hidden=!1)}},{key:"_getKeyModifier",value:function(t){return xt.platform.isMac?t.metaKey:t.ctrlKey}},{key:"_setEventListener",value:function(t,e,n,i,a){var r=this;n.includes("mouse")?t.addEventListener(n,(function(t){var e;null===(e=r.linkService.eventBus)||void 0===e||e.dispatch("dispatcheventinsandbox",{source:r,detail:{id:r.data.id,name:i,value:a(t),shift:t.shiftKey,modifier:r._getKeyModifier(t)}})})):t.addEventListener(n,(function(t){var s;if("blur"===n){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===n){if(e.focused)return;e.focused=!0}a&&(null===(s=r.linkService.eventBus)||void 0===s||s.dispatch("dispatcheventinsandbox",{source:r,detail:{id:r.data.id,name:i,value:a(t)}}))}))}},{key:"_setEventListeners",value:function(t,e,n,i){var a,r=R(n);try{for(r.s();!(a=r.n()).done;){var s,o,l,h=T(a.value,2),u=h[0],c=h[1];("Action"===c||null!==(s=this.data.actions)&&void 0!==s&&s[c])&&("Focus"!==c&&"Blur"!==c||e||(e={focused:!1}),this._setEventListener(t,e,u,c,i),"Focus"!==c||null!==(o=this.data.actions)&&void 0!==o&&o.Blur?"Blur"!==c||null!==(l=this.data.actions)&&void 0!==l&&l.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null))}}catch(t){r.e(t)}finally{r.f()}}},{key:"_setBackgroundColor",value:function(t){var e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":Mt.makeHexColor(e[0],e[1],e[2])}},{key:"_setTextStyle",value:function(t){var e,n=this.data.defaultAppearanceData.fontColor,i=this.data.defaultAppearanceData.fontSize||9,a=t.style,r=function(t){return Math.round(10*t)/10};if(this.data.multiLine){var s=Math.abs(this.data.rect[3]-this.data.rect[1]-2),o=s/(Math.round(s/(K*i))||1);e=Math.min(i,r(o/K))}else{var l=Math.abs(this.data.rect[3]-this.data.rect[1]-2);e=Math.min(i,r(l/K))}a.fontSize="calc(".concat(e,"px * var(--scale-factor))"),a.color=Mt.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(a.textAlign=["left","center","right"][this.data.textAlignment])}},{key:"_setRequired",value:function(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}])}(el),ul=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue}])}return H(e,t),F(e,[{key:"setPropertyOnSiblings",value:function(t,e,n,i){var a,r=this.annotationStorage,s=R(this._getElementsByName(t.name,t.id));try{for(s.s();!(a=s.n()).done;){var o=a.value;o.domElement&&(o.domElement[e]=n),r.setValue(o.id,x({},i,n))}}catch(t){s.e(t)}finally{s.f()}}},{key:"render",value:function(){var t=this,e=this.annotationStorage,n=this.data.id;this.container.classList.add("textWidgetAnnotation");var i=null;if(this.renderForms){var a,r=e.getValue(n,{value:this.data.fieldValue}),s=r.value||"",o=e.getValue(n,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));var l=r.formattedValue||(null===(a=this.data.textContent)||void 0===a?void 0:a.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));var h,u,c={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((i=document.createElement("textarea")).textContent=null!==(h=l)&&void 0!==h?h:s,this.data.doNotScroll&&(i.style.overflowY="hidden")):((i=document.createElement("input")).type="text",i.setAttribute("value",null!==(u=l)&&void 0!==u?u:s),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),Ko.add(i),i.setAttribute("data-element-id",n),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=Xo,this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",(function(a){e.setValue(n,{value:a.target.value}),t.setPropertyOnSiblings(i,"value",a.target.value,"value"),c.formattedValue=null})),i.addEventListener("resetform",(function(e){var n,a=null!==(n=t.data.defaultFieldValue)&&void 0!==n?n:"";i.value=c.userValue=a,c.formattedValue=null}));var d=function(t){var e=c.formattedValue;null!=e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var f;i.addEventListener("focus",(function(e){var n;if(!c.focused){var i=e.target;c.userValue&&(i.value=c.userValue),c.lastCommittedValue=i.value,c.commitKey=1,null!==(n=t.data.actions)&&void 0!==n&&n.Focus||(c.focused=!0)}})),i.addEventListener("updatefromsandbox",(function(i){t.showElementAndHideCanvas(i.target);var a={value:function(t){var i;c.userValue=null!==(i=t.detail.value)&&void 0!==i?i:"",e.setValue(n,{value:c.userValue.toString()}),t.target.value=c.userValue},formattedValue:function(t){var i=t.detail.formattedValue;c.formattedValue=i,null!=i&&t.target!==document.activeElement&&(t.target.value=i),e.setValue(n,{formattedValue:i})},selRange:function(t){var e;(e=t.target).setSelectionRange.apply(e,y(t.detail.selRange))},charLimit:function(i){var a,r=i.detail.charLimit,s=i.target;if(0!==r){s.setAttribute("maxLength",r);var o=c.userValue;!o||o.length<=r||(o=o.slice(0,r),s.value=c.userValue=o,e.setValue(n,{value:o}),null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:o,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}else s.removeAttribute("maxLength")}};t._dispatchEventFromSandbox(a,i)})),i.addEventListener("keydown",(function(e){var i;c.commitKey=1;var a=-1;if("Escape"===e.key?a=0:"Enter"!==e.key||t.data.multiLine?"Tab"===e.key&&(c.commitKey=3):a=2,-1!==a){var r=e.target.value;c.lastCommittedValue!==r&&(c.lastCommittedValue=r,c.userValue=r,null===(i=t.linkService.eventBus)||void 0===i||i.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:r,willCommit:!0,commitKey:a,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}}));var v=d;d=null,i.addEventListener("blur",(function(e){var i;if(c.focused&&e.relatedTarget){null!==(i=t.data.actions)&&void 0!==i&&i.Blur||(c.focused=!1);var a,r=e.target.value;c.userValue=r,c.lastCommittedValue!==r&&(null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:r,willCommit:!0,commitKey:c.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}})),v(e)}})),null!==(f=this.data.actions)&&void 0!==f&&f.Keystroke&&i.addEventListener("beforeinput",(function(e){var i;c.lastCommittedValue=null;var a=e.data,r=e.target,s=r.value,o=r.selectionStart,l=r.selectionEnd,h=o,u=l;switch(e.inputType){case"deleteWordBackward":var d=s.substring(0,o).match(/\w*[^\w]*$/);d&&(h-=d[0].length);break;case"deleteWordForward":var f=s.substring(o).match(/^[^\w]*\w*/);f&&(u+=f[0].length);break;case"deleteContentBackward":o===l&&(h-=1);break;case"deleteContentForward":o===l&&(u+=1)}e.preventDefault(),null===(i=t.linkService.eventBus)||void 0===i||i.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:s,change:a||"",willCommit:!1,selStart:h,selEnd:u}})})),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.value}))}if(d&&i.addEventListener("blur",d),this.data.comb){var p=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing="calc(".concat(p,"px * var(--scale-factor) - 1ch)")}}else(i=document.createElement("div")).textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}])}(hl),cl=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!!t.data.hasOwnCanvas}])}return H(e,t),F(e)}(hl),dl=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:t.renderForms}])}return H(e,t),F(e,[{key:"render",value:function(){var t=this,e=this.annotationStorage,n=this.data,i=n.id,a=e.getValue(i,{value:n.exportValue===n.fieldValue}).value;"string"==typeof a&&(a="Off"!==a,e.setValue(i,{value:a})),this.container.classList.add("buttonWidgetAnnotation","checkBox");var r=document.createElement("input");return Ko.add(r),r.setAttribute("data-element-id",i),r.disabled=n.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=n.fieldName,a&&r.setAttribute("checked",!0),r.setAttribute("exportValue",n.exportValue),r.tabIndex=Xo,r.addEventListener("change",(function(a){var r,s=a.target,o=s.name,l=s.checked,h=R(t._getElementsByName(o,i));try{for(h.s();!(r=h.n()).done;){var u=r.value,c=l&&u.exportValue===n.exportValue;u.domElement&&(u.domElement.checked=c),e.setValue(u.id,{value:c})}}catch(t){h.e(t)}finally{h.f()}e.setValue(i,{value:l})})),r.addEventListener("resetform",(function(t){var e=n.defaultFieldValue||"Off";t.target.checked=e===n.exportValue})),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",(function(n){var a={value:function(t){t.target.checked="Off"!==t.detail.value,e.setValue(i,{value:t.target.checked})}};t._dispatchEventFromSandbox(a,n)})),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.checked}))),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}])}(hl),fl=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:t.renderForms}])}return H(e,t),F(e,[{key:"render",value:function(){var t=this;this.container.classList.add("buttonWidgetAnnotation","radioButton");var e=this.annotationStorage,n=this.data,i=n.id,a=e.getValue(i,{value:n.fieldValue===n.buttonValue}).value;if("string"==typeof a&&(a=a!==n.buttonValue,e.setValue(i,{value:a})),a){var r,s=R(this._getElementsByName(n.fieldName,i));try{for(s.s();!(r=s.n()).done;){var o=r.value;e.setValue(o.id,{value:!1})}}catch(t){s.e(t)}finally{s.f()}}var l=document.createElement("input");if(Ko.add(l),l.setAttribute("data-element-id",i),l.disabled=n.readOnly,this._setRequired(l,this.data.required),l.type="radio",l.name=n.fieldName,a&&l.setAttribute("checked",!0),l.tabIndex=Xo,l.addEventListener("change",(function(n){var a,r=n.target,s=r.name,o=r.checked,l=R(t._getElementsByName(s,i));try{for(l.s();!(a=l.n()).done;){var h=a.value;e.setValue(h.id,{value:!1})}}catch(t){l.e(t)}finally{l.f()}e.setValue(i,{value:o})})),l.addEventListener("resetform",(function(t){var e=n.defaultFieldValue;t.target.checked=null!=e&&e===n.buttonValue})),this.enableScripting&&this.hasJSActions){var h=n.buttonValue;l.addEventListener("updatefromsandbox",(function(n){var a={value:function(n){var a,r=h===n.detail.value,s=R(t._getElementsByName(n.target.name));try{for(s.s();!(a=s.n()).done;){var o=a.value,l=r&&o.id===i;o.domElement&&(o.domElement.checked=l),e.setValue(o.id,{value:l})}}catch(t){s.e(t)}finally{s.f()}}};t._dispatchEventFromSandbox(a,n)})),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.checked}))}return this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}])}(hl),vl=function(t){function e(t){return N(this,e),O(this,e,[t,{ignoreBorder:t.data.hasAppearance}])}return H(e,t),F(e,[{key:"render",value:function(){var t=this,n=g(B(e.prototype),"render",this).call(this);n.classList.add("buttonWidgetAnnotation","pushButton");var i=n.lastChild;return this.enableScripting&&this.hasJSActions&&i&&(this._setDefaultPropertiesFromJS(i),i.addEventListener("updatefromsandbox",(function(e){t._dispatchEventFromSandbox({},e)}))),n}}])}(al),pl=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:t.renderForms}])}return H(e,t),F(e,[{key:"render",value:function(){var t=this;this.container.classList.add("choiceWidgetAnnotation");var e=this.annotationStorage,n=this.data.id,i=e.getValue(n,{value:this.data.fieldValue}),a=document.createElement("select");Ko.add(a),a.setAttribute("data-element-id",n),a.disabled=this.data.readOnly,this._setRequired(a,this.data.required),a.name=this.data.fieldName,a.tabIndex=Xo;var r=this.data.combo&&this.data.options.length>0;this.data.combo||(a.size=this.data.options.length,this.data.multiSelect&&(a.multiple=!0)),a.addEventListener("resetform",(function(e){var n,i=t.data.defaultFieldValue,r=R(a.options);try{for(r.s();!(n=r.n()).done;){var s=n.value;s.selected=s.value===i}}catch(t){r.e(t)}finally{r.f()}}));var s,o=R(this.data.options);try{for(o.s();!(s=o.n()).done;){var l=s.value,h=document.createElement("option");h.textContent=l.displayValue,h.value=l.exportValue,i.value.includes(l.exportValue)&&(h.setAttribute("selected",!0),r=!1),a.append(h)}}catch(t){o.e(t)}finally{o.f()}var u=null;if(r){var c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),a.prepend(c),u=function(){c.remove(),a.removeEventListener("input",u),u=null},a.addEventListener("input",u)}var d=function(t){var e=t?"value":"textContent",n=a.options;return a.multiple?Array.prototype.filter.call(n,(function(t){return t.selected})).map((function(t){return t[e]})):-1===n.selectedIndex?null:n[n.selectedIndex][e]},f=d(!1),v=function(t){var e=t.target.options;return Array.prototype.map.call(e,(function(t){return{displayValue:t.textContent,exportValue:t.value}}))};return this.enableScripting&&this.hasJSActions?(a.addEventListener("updatefromsandbox",(function(i){var r={value:function(t){var i;null===(i=u)||void 0===i||i();var r,s=t.detail.value,o=new Set(Array.isArray(s)?s:[s]),l=R(a.options);try{for(l.s();!(r=l.n()).done;){var h=r.value;h.selected=o.has(h.value)}}catch(t){l.e(t)}finally{l.f()}e.setValue(n,{value:d(!0)}),f=d(!1)},multipleSelection:function(t){a.multiple=!0},remove:function(t){var i=a.options,r=t.detail.remove;if(i[r].selected=!1,a.remove(r),i.length>0){var s=Array.prototype.findIndex.call(i,(function(t){return t.selected}));-1===s&&(i[0].selected=!0)}e.setValue(n,{value:d(!0),items:v(t)}),f=d(!1)},clear:function(t){for(;0!==a.length;)a.remove(0);e.setValue(n,{value:null,items:[]}),f=d(!1)},insert:function(t){var i=t.detail.insert,r=i.index,s=i.displayValue,o=i.exportValue,l=a.children[r],h=document.createElement("option");h.textContent=s,h.value=o,l?l.before(h):a.append(h),e.setValue(n,{value:d(!0),items:v(t)}),f=d(!1)},items:function(t){for(var i=t.detail.items;0!==a.length;)a.remove(0);var r,s=R(i);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=o.displayValue,h=o.exportValue,u=document.createElement("option");u.textContent=l,u.value=h,a.append(u)}}catch(t){s.e(t)}finally{s.f()}a.options.length>0&&(a.options[0].selected=!0),e.setValue(n,{value:d(!0),items:v(t)}),f=d(!1)},indices:function(t){var i,a=new Set(t.detail.indices),r=R(t.target.options);try{for(r.s();!(i=r.n()).done;){var s=i.value;s.selected=a.has(s.index)}}catch(t){r.e(t)}finally{r.f()}e.setValue(n,{value:d(!0)}),f=d(!1)},editable:function(t){t.target.disabled=!t.detail.editable}};t._dispatchEventFromSandbox(r,i)})),a.addEventListener("input",(function(i){var a,r=d(!0),s=d(!1);e.setValue(n,{value:r}),i.preventDefault(),null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:f,change:s,changeEx:r,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(a,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(function(t){return t.target.value}))):a.addEventListener("input",(function(t){e.setValue(n,{value:d(!0)})})),this.data.combo&&this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}])}(hl),gl=function(t){function e(t){var n;N(this,e);var i=t.data,a=t.elements;return(n=O(this,e,[t,{isRenderable:el._hasPopupData(i)}])).elements=a,n.popup=null,n}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add("popupAnnotation");var t,e=this.popup=new Ol({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[],i=R(this.elements);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.popup=e,n.push(a.data.id),a.addHighlightArea()}}catch(t){i.e(t)}finally{i.f()}return this.container.setAttribute("aria-controls",n.map((function(t){return"".concat(Pt).concat(t)})).join(",")),this.container}}])}(el),yl=new WeakMap,ml=new WeakMap,kl=new WeakMap,bl=new WeakMap,wl=new WeakMap,Al=new WeakMap,_l=new WeakMap,xl=new WeakMap,El=new WeakMap,Ml=new WeakMap,Sl=new WeakMap,Cl=new WeakMap,Tl=new WeakMap,Rl=new WeakMap,Ll=new WeakMap,Pl=new WeakMap,Il=new WeakMap,Fl=new WeakMap,Dl=new WeakMap,Nl=new WeakSet,Ol=function(){return F((function t(e){var n=e.container,i=e.color,a=e.elements,r=e.titleObj,s=e.modificationDate,o=e.contentsObj,l=e.richText,h=e.parent,u=e.rect,c=e.parentRect,d=e.open;N(this,t),m(this,Nl),k(this,yl,C(Nl,this,zl).bind(this)),k(this,ml,C(Nl,this,Ul).bind(this)),k(this,kl,C(Nl,this,ql).bind(this)),k(this,bl,C(Nl,this,Vl).bind(this)),k(this,wl,null),k(this,Al,null),k(this,_l,null),k(this,xl,null),k(this,El,null),k(this,Ml,null),k(this,Sl,null),k(this,Cl,!1),k(this,Tl,null),k(this,Rl,null),k(this,Ll,null),k(this,Pl,null),k(this,Il,null),k(this,Fl,null),k(this,Dl,!1),_(Al,this,n),_(Il,this,r),_(_l,this,o),_(Pl,this,l),_(Ml,this,h),_(wl,this,i),_(Ll,this,u),_(Sl,this,c),_(El,this,a),_(xl,this,Ae.toDateObject(s)),this.trigger=a.flatMap((function(t){return t.getElementsToTriggerPopup()}));var f,v=R(this.trigger);try{for(v.s();!(f=v.n()).done;){var p=f.value;p.addEventListener("click",A(bl,this)),p.addEventListener("mouseenter",A(kl,this)),p.addEventListener("mouseleave",A(ml,this)),p.classList.add("popupTriggerArea")}}catch(t){v.e(t)}finally{v.f()}var g,y=R(a);try{for(y.s();!(g=y.n()).done;){var b;null===(b=g.value.container)||void 0===b||b.addEventListener("keydown",A(yl,this))}}catch(t){y.e(t)}finally{y.f()}A(Al,this).hidden=!0,d&&C(Nl,this,Vl).call(this)}),[{key:"render",value:function(){if(!A(Tl,this)){var t=_(Tl,this,document.createElement("div"));if(t.className="popup",A(wl,this)){var e=t.style.outlineColor=Mt.makeHexColor.apply(Mt,y(A(wl,this)));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor="color-mix(in srgb, ".concat(e," 30%, white)"):t.style.backgroundColor=Mt.makeHexColor.apply(Mt,y(A(wl,this).map((function(t){return Math.floor(.7*(255-t)+t)}))))}var n=document.createElement("span");n.className="header";var i=document.createElement("h1");n.append(i);var a=A(Il,this);if(i.dir=a.dir,i.textContent=a.str,t.append(n),A(xl,this)){var r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),r.setAttribute("data-l10n-args",JSON.stringify({date:A(xl,this).toLocaleDateString(),time:A(xl,this).toLocaleTimeString()})),n.append(r)}var s=w(Nl,this,Wl);if(s)Uo.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{var o=this._formatContents(A(_l,this));t.append(o)}A(Al,this).append(t)}}},{key:"_formatContents",value:function(t){var e=t.str,n=t.dir,i=document.createElement("p");i.classList.add("popupContent"),i.dir=n;for(var a=e.split(/(?:\r\n?|\n)/),r=0,s=a.length;r<s;++r){var o=a[r];i.append(document.createTextNode(o)),r<s-1&&i.append(document.createElement("br"))}return i}},{key:"updateEdited",value:function(t){var e,n=t.rect,i=t.popupContent;A(Fl,this)||_(Fl,this,{contentsObj:A(_l,this),richText:A(Pl,this)}),n&&_(Rl,this,null),i&&(_(Pl,this,C(Nl,this,jl).call(this,i)),_(_l,this,null)),null===(e=A(Tl,this))||void 0===e||e.remove(),_(Tl,this,null)}},{key:"resetEdited",value:function(){var t;if(A(Fl,this)){var e=A(Fl,this);p(_,[_l,this])._=e.contentsObj,p(_,[Pl,this])._=e.richText,_(Fl,this,null),null===(t=A(Tl,this))||void 0===t||t.remove(),_(Tl,this,null),_(Rl,this,null)}}},{key:"forceHide",value:function(){_(Dl,this,this.isVisible),A(Dl,this)&&(A(Al,this).hidden=!0)}},{key:"maybeShow",value:function(){A(Dl,this)&&(A(Tl,this)||C(Nl,this,ql).call(this),_(Dl,this,!1),A(Al,this).hidden=!1)}},{key:"isVisible",get:function(){return!1===A(Al,this).hidden}}])}();function Wl(t){var e=A(Pl,t),n=A(_l,t);return null==e||!e.str||null!=n&&n.str&&n.str!==e.str?null:A(Pl,t).html||null}function Bl(t){var e;return(null===(e=w(Nl,t,Wl))||void 0===e||null===(e=e.attributes)||void 0===e||null===(e=e.style)||void 0===e?void 0:e.fontSize)||0}function Hl(t){var e;return(null===(e=w(Nl,t,Wl))||void 0===e||null===(e=e.attributes)||void 0===e||null===(e=e.style)||void 0===e?void 0:e.color)||null}function jl(t){var e,n=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:n}]}},a={style:{color:w(Nl,this,Hl),fontSize:w(Nl,this,Bl)?"calc(".concat(w(Nl,this,Bl),"px * var(--scale-factor))"):""}},r=R(t.split("\n"));try{for(r.s();!(e=r.n()).done;){var s=e.value;n.push({name:"span",value:s,attributes:a})}}catch(t){r.e(t)}finally{r.f()}return i}function zl(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&A(Cl,this))&&C(Nl,this,Vl).call(this)}function Gl(){if(null===A(Rl,this)){var t,e=A(Ml,this),n=e.page.view,i=e.viewport.rawDims,a=i.pageWidth,r=i.pageHeight,s=i.pageX,o=i.pageY,l=!!A(Sl,this),h=A(l?Sl:Ll,this),u=R(A(El,this));try{for(u.s();!(t=u.n()).done;){var c=t.value;if(!h||null!==Mt.intersect(c.data.rect,h)){h=c.data.rect,l=!0;break}}}catch(t){u.e(t)}finally{u.f()}var d=Mt.normalizeRect([h[0],n[3]-h[1]+n[1],h[2],n[3]-h[3]+n[1]]),f=l?h[2]-h[0]+5:0,v=d[0]+f,p=d[1];_(Rl,this,[100*(v-s)/a,100*(p-o)/r]);var g=A(Al,this).style;g.left="".concat(A(Rl,this)[0],"%"),g.top="".concat(A(Rl,this)[1],"%")}}function Vl(){_(Cl,this,!A(Cl,this)),A(Cl,this)?(C(Nl,this,ql).call(this),A(Al,this).addEventListener("click",A(bl,this)),A(Al,this).addEventListener("keydown",A(yl,this))):(C(Nl,this,Ul).call(this),A(Al,this).removeEventListener("click",A(bl,this)),A(Al,this).removeEventListener("keydown",A(yl,this)))}function ql(){A(Tl,this)||this.render(),this.isVisible?A(Cl,this)&&A(Al,this).classList.add("focused"):(C(Nl,this,Gl).call(this),A(Al,this).hidden=!1,A(Al,this).style.zIndex=parseInt(A(Al,this).style.zIndex)+1e3)}function Ul(){A(Al,this).classList.remove("focused"),!A(Cl,this)&&this.isVisible&&(A(Al,this).hidden=!0,A(Al,this).style.zIndex=parseInt(A(Al,this).style.zIndex)-1e3)}var Xl=function(t){function e(t){var n;return N(this,e),(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}])).textContent=t.data.textContent,n.textPosition=t.data.textPosition,n.annotationEditorType=Q.FREETEXT,n}return H(e,t),F(e,[{key:"render",value:function(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){var t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");var e,n=R(this.textContent);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=document.createElement("span");a.textContent=i,t.append(a)}}catch(t){n.e(t)}finally{n.f()}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},{key:"_isEditable",get:function(){return this.data.hasOwnCanvas}}])}(el),Kl=new WeakMap,Yl=function(t){function e(t){var n;return N(this,e),k(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),Kl,null),n}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add("lineAnnotation");var t=this.data,e=Yo(t.rect),n=e.width,i=e.height,a=this.svgFactory.create(n,i,!0),r=_(Kl,this,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),a.append(r),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return A(Kl,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(el),Ql=new WeakMap,Jl=function(t){function e(t){var n;return N(this,e),k(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),Ql,null),n}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add("squareAnnotation");var t=this.data,e=Yo(t.rect),n=e.width,i=e.height,a=this.svgFactory.create(n,i,!0),r=t.borderStyle.width,s=_(Ql,this,this.svgFactory.createElement("svg:rect"));return s.setAttribute("x",r/2),s.setAttribute("y",r/2),s.setAttribute("width",n-r),s.setAttribute("height",i-r),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return A(Ql,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(el),Zl=new WeakMap,$l=function(t){function e(t){var n;return N(this,e),k(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),Zl,null),n}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add("circleAnnotation");var t=this.data,e=Yo(t.rect),n=e.width,i=e.height,a=this.svgFactory.create(n,i,!0),r=t.borderStyle.width,s=_(Zl,this,this.svgFactory.createElement("svg:ellipse"));return s.setAttribute("cx",n/2),s.setAttribute("cy",i/2),s.setAttribute("rx",n/2-r/2),s.setAttribute("ry",i/2-r/2),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return A(Zl,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(el),th=new WeakMap,eh=function(t){function e(t){var n;return N(this,e),k(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),th,null),n.containerClassName="polylineAnnotation",n.svgElementName="svg:polyline",n}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var t,e=this.data,n=Yo(e.rect),i=n.width,a=n.height,r=this.svgFactory.create(i,a,!0),s=[],o=R(e.vertices);try{for(o.s();!(t=o.n()).done;){var l=t.value,h=l.x-e.rect[0],u=e.rect[3]-l.y;s.push(h+","+u)}}catch(t){o.e(t)}finally{o.f()}s=s.join(" ");var c=_(th,this,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",s),c.setAttribute("stroke-width",e.borderStyle.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return A(th,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(el),nh=function(t){function e(t){var n;return N(this,e),(n=O(this,e,[t])).containerClassName="polygonAnnotation",n.svgElementName="svg:polygon",n}return H(e,t),F(e)}(eh),ih=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}])}return H(e,t),F(e,[{key:"render",value:function(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}])}(el),ah=new WeakMap,rh=function(t){function e(t){var n;return N(this,e),k(n=O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),ah,[]),n.containerClassName="inkAnnotation",n.svgElementName="svg:polyline",n.annotationEditorType=Q.INK,n}return H(e,t),F(e,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var t,e=this.data,n=Yo(e.rect),i=n.width,a=n.height,r=this.svgFactory.create(i,a,!0),s=R(e.inkLists);try{for(s.s();!(t=s.n()).done;){var o,l=t.value,h=[],u=R(l);try{for(u.s();!(o=u.n()).done;){var c=o.value,d=c.x-e.rect[0],f=e.rect[3]-c.y;h.push("".concat(d,",").concat(f))}}catch(t){u.e(t)}finally{u.f()}h=h.join(" ");var v=this.svgFactory.createElement(this.svgElementName);A(ah,this).push(v),v.setAttribute("points",h),v.setAttribute("stroke-width",e.borderStyle.width||1),v.setAttribute("stroke","transparent"),v.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),r.append(v)}}catch(t){s.e(t)}finally{s.f()}return this.container.append(r),this.container}},{key:"getElementsToTriggerPopup",value:function(){return A(ah,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(el),sh=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return H(e,t),F(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}])}(el),oh=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return H(e,t),F(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}])}(el),lh=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return H(e,t),F(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}])}(el),hh=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return H(e,t),F(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}])}(el),uh=function(t){function e(t){return N(this,e),O(this,e,[t,{isRenderable:!0,ignoreBorder:!0}])}return H(e,t),F(e,[{key:"render",value:function(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}])}(el),ch=new WeakMap,dh=new WeakSet,fh=function(t){function e(t){var n,i;N(this,e),m(i=O(this,e,[t,{isRenderable:!0}]),dh),k(i,ch,null);var a=i.data.file;return i.filename=a.filename,i.content=a.content,null===(n=i.linkService.eventBus)||void 0===n||n.dispatch("fileattachmentannotation",v({source:i},a)),i}return H(e,t),F(e,[{key:"render",value:function(){var t=this;this.container.classList.add("fileAttachmentAnnotation");var e,n=this.container,i=this.data;i.hasAppearance||0===i.fillAlpha?e=document.createElement("div"):((e=document.createElement("img")).src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(i.name)?"paperclip":"pushpin",".svg"),i.fillAlpha&&i.fillAlpha<1&&(e.style="filter: opacity(".concat(Math.round(100*i.fillAlpha),"%);"))),e.addEventListener("dblclick",C(dh,this,vh).bind(this)),_(ch,this,e);var a=xt.platform.isMac;return n.addEventListener("keydown",(function(e){"Enter"===e.key&&(a?e.metaKey:e.ctrlKey)&&C(dh,t,vh).call(t)})),!i.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),n.append(e),n}},{key:"getElementsToTriggerPopup",value:function(){return A(ch,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(el);function vh(){var t;null===(t=this.downloadManager)||void 0===t||t.openOrDownloadData(this.content,this.filename)}var ph=new WeakMap,gh=new WeakMap,yh=new WeakMap,mh=new WeakSet,kh=function(){return F((function t(e){var n=e.div,i=e.accessibilityManager,a=e.annotationCanvasMap,r=e.annotationEditorUIManager,s=e.page,o=e.viewport;N(this,t),m(this,mh),k(this,ph,null),k(this,gh,null),k(this,yh,new Map),this.div=n,_(ph,this,i),_(gh,this,a),this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r}),[{key:"render",value:(t=S(E().mark((function t(e){var n,i,a,r,s,o,l,h,u,c,d,f,v,p,g,y;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.annotations,Se(i=this.div,this.viewport),a=new Map,r={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new ue,annotationStorage:e.annotationStorage||new La,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null},s=R(n),t.prev=6,s.s();case 8:if((o=s.n()).done){t.next=34;break}if(!(l=o.value).noHTML){t.next=12;break}return t.abrupt("continue",32);case 12:if(h=16===l.annotationType){t.next=19;break}if(u=Yo(l.rect),c=u.width,d=u.height,!(c<=0||d<=0)){t.next=17;break}return t.abrupt("continue",32);case 17:t.next=23;break;case 19:if(f=a.get(l.id)){t.next=22;break}return t.abrupt("continue",32);case 22:r.elements=f;case 23:if(r.data=l,(v=Qo.create(r)).isRenderable){t.next=27;break}return t.abrupt("continue",32);case 27:!h&&l.popupRef&&((p=a.get(l.popupRef))?p.push(v):a.set(l.popupRef,[v])),g=v.render(),l.hidden&&(g.style.visibility="hidden"),C(mh,this,bh).call(this,g,l.id),v.annotationEditorType>0&&(A(yh,this).set(v.data.id,v),null===(y=this._annotationEditorUIManager)||void 0===y||y.renderAnnotationElement(v));case 32:t.next=8;break;case 34:t.next=39;break;case 36:t.prev=36,t.t0=t.catch(6),s.e(t.t0);case 39:return t.prev=39,s.f(),t.finish(39);case 42:C(mh,this,wh).call(this);case 43:case"end":return t.stop()}}),t,this,[[6,36,39,42]])}))),function(e){return t.apply(this,arguments)})},{key:"update",value:function(t){var e=t.viewport,n=this.div;this.viewport=e,Se(n,{rotation:e.rotation}),C(mh,this,wh).call(this),n.hidden=!1}},{key:"getEditableAnnotations",value:function(){return Array.from(A(yh,this).values())}},{key:"getEditableAnnotation",value:function(t){return A(yh,this).get(t)}}]);var t}();function bh(t,e){var n,i=t.firstChild||t;i.id="".concat(Pt).concat(e),this.div.append(t),null===(n=A(ph,this))||void 0===n||n.moveElementInDOM(this.div,t,i,!1)}function wh(){if(A(gh,this)){var t,e=this.div,n=R(A(gh,this));try{for(n.s();!(t=n.n()).done;){var i=T(t.value,2),a=i[0],r=i[1],s=e.querySelector('[data-annotation-id="'.concat(a,'"]'));if(s){r.className="annotationContent";var o=s.firstChild;o?"CANVAS"===o.nodeName?o.replaceWith(r):o.classList.contains("annotationContent")?o.after(r):o.before(r):s.append(r)}}}catch(t){n.e(t)}finally{n.f()}A(gh,this).clear()}}var Ah=/\r\n?|\n/g,_h=new WeakMap,xh=new WeakMap,Eh=new WeakMap,Mh=new WeakMap,Sh=new WeakMap,Ch=new WeakMap,Th=new WeakMap,Rh=new WeakMap,Lh=new WeakMap,Ph=new WeakMap,Ih=new WeakSet,Fh=function(t){function e(t){var n;return N(this,e),m(n=O(this,e,[v(v({},t),{},{name:"freeTextEditor"})]),Ih),k(n,_h,n.editorDivBlur.bind(n)),k(n,xh,n.editorDivFocus.bind(n)),k(n,Eh,n.editorDivInput.bind(n)),k(n,Mh,n.editorDivKeydown.bind(n)),k(n,Sh,n.editorDivPaste.bind(n)),k(n,Ch,void 0),k(n,Th,""),k(n,Rh,"".concat(n.id,"-editor")),k(n,Lh,void 0),k(n,Ph,null),_(Ch,n,t.color||e._defaultColor||oa._defaultLineColor),_(Lh,n,t.fontSize||e._defaultFontSize),n}return H(e,t),F(e,[{key:"updateParams",value:function(t,e){switch(t){case J.FREETEXT_SIZE:C(Ih,this,Dh).call(this,e);break;case J.FREETEXT_COLOR:C(Ih,this,Nh).call(this,e)}}},{key:"propertiesToUpdate",get:function(){return[[J.FREETEXT_SIZE,A(Lh,this)],[J.FREETEXT_COLOR,A(Ch,this)]]}},{key:"_translateEmpty",value:function(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}},{key:"getInitialTranslation",value:function(){var t=this.parentScale;return[-e._internalPadding*t,-(e._internalPadding+A(Lh,this))*t]}},{key:"rebuild",value:function(){this.parent&&(g(B(e.prototype),"rebuild",this).call(this),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}},{key:"enableEditMode",value:function(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(Q.FREETEXT),g(B(e.prototype),"enableEditMode",this).call(this),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",A(Mh,this)),this.editorDiv.addEventListener("focus",A(xh,this)),this.editorDiv.addEventListener("blur",A(_h,this)),this.editorDiv.addEventListener("input",A(Eh,this)),this.editorDiv.addEventListener("paste",A(Sh,this)))}},{key:"disableEditMode",value:function(){this.isInEditMode()&&(this.parent.setEditingState(!0),g(B(e.prototype),"disableEditMode",this).call(this),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",A(Rh,this)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",A(Mh,this)),this.editorDiv.removeEventListener("focus",A(xh,this)),this.editorDiv.removeEventListener("blur",A(_h,this)),this.editorDiv.removeEventListener("input",A(Eh,this)),this.editorDiv.removeEventListener("paste",A(Sh,this)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(g(B(e.prototype),"focusin",this).call(this,t),t.target!==this.editorDiv&&this.editorDiv.focus())}},{key:"onceAdded",value:function(){var t;this.width||(this.enableEditMode(),this.editorDiv.focus(),null!==(t=this._initialOptions)&&void 0!==t&&t.isCentered&&this.center(),this._initialOptions=null)}},{key:"isEmpty",value:function(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}},{key:"remove",value:function(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),g(B(e.prototype),"remove",this).call(this)}},{key:"commit",value:function(){var t=this;if(this.isInEditMode()){g(B(e.prototype),"commit",this).call(this),this.disableEditMode();var n=A(Th,this),i=_(Th,this,C(Ih,this,Oh).call(this).trimEnd());if(n!==i){var a=function(e){_(Th,t,e),e?(C(Ih,t,Hh).call(t),t._uiManager.rebuild(t),C(Ih,t,Wh).call(t)):t.remove()};this.addCommands({cmd:function(){a(i)},undo:function(){a(n)},mustExec:!1}),C(Ih,this,Wh).call(this)}}}},{key:"shouldGetKeyboardEvents",value:function(){return this.isInEditMode()}},{key:"enterInEditMode",value:function(){this.enableEditMode(),this.editorDiv.focus()}},{key:"dblclick",value:function(t){this.enterInEditMode()}},{key:"keydown",value:function(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}},{key:"editorDivKeydown",value:function(t){e._keyboardManager.exec(this,t)}},{key:"editorDivFocus",value:function(t){this.isEditing=!0}},{key:"editorDivBlur",value:function(t){this.isEditing=!1}},{key:"editorDivInput",value:function(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}},{key:"disableEditing",value:function(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}},{key:"enableEditing",value:function(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}},{key:"render",value:function(){var t,n,i=this;if(this.div)return this.div;this.width&&(t=this.x,n=this.y),g(B(e.prototype),"render",this).call(this),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",A(Rh,this)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),oa._l10nPromise.get("pdfjs-free-text-default-content").then((function(t){var e;return null===(e=i.editorDiv)||void 0===e?void 0:e.setAttribute("default-content",t)})),this.editorDiv.contentEditable=!0;var a=this.editorDiv.style;if(a.fontSize="calc(".concat(A(Lh,this),"px * var(--scale-factor))"),a.color=A(Ch,this),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ke(this,this.div,["dblclick","keydown"]),this.width){var r=T(this.parentDimensions,2),s=r[0],o=r[1];if(this.annotationElementId){var l=A(Ph,this).position,h=T(this.getInitialTranslation(),2),u=h[0],c=h[1],d=T(this.pageTranslationToScreen(u,c),2);u=d[0],c=d[1];var f,v,p=T(this.pageDimensions,2),y=p[0],m=p[1],k=T(this.pageTranslation,2),b=k[0],w=k[1];switch(this.rotation){case 0:f=t+(l[0]-b)/y,v=n+this.height-(l[1]-w)/m;break;case 90:f=t+(l[0]-b)/y,v=n-(l[1]-w)/m;var _=[c,-u];u=_[0],c=_[1];break;case 180:f=t-this.width+(l[0]-b)/y,v=n-(l[1]-w)/m;var x=[-u,-c];u=x[0],c=x[1];break;case 270:f=t+(l[0]-b-this.height*m)/y,v=n+(l[1]-w-this.width*y)/m;var E=[-c,u];u=E[0],c=E[1]}this.setAt(f*s,v*o,u,c)}else this.setAt(t*s,n*o,this.width*s,this.height*o);C(Ih,this,Hh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}},{key:"editorDivPaste",value:function(t){var n=t.clipboardData||window.clipboardData,i=n.types;if(1!==i.length||"text/plain"!==i[0]){t.preventDefault();var a=zh.call(e,n.getData("text")||"").replaceAll(Ah,"\n");if(a){var r=window.getSelection();if(r.rangeCount){this.editorDiv.normalize(),r.deleteFromDocument();var s=r.getRangeAt(0);if(!a.includes("\n"))return s.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),void r.collapseToStart();var o=s.startContainer,l=s.startOffset,h=[],u=[];if(o.nodeType===Node.TEXT_NODE){var c=o.parentElement;if(u.push(o.nodeValue.slice(l).replaceAll(Ah,"")),c!==this.editorDiv){var d,f=h,v=R(this.editorDiv.childNodes);try{for(v.s();!(d=v.n()).done;){var p=d.value;p!==c?f.push(Bh.call(e,p)):f=u}}catch(t){v.e(t)}finally{v.f()}}h.push(o.nodeValue.slice(0,l).replaceAll(Ah,""))}else if(o===this.editorDiv){var g,y=h,m=0,k=R(this.editorDiv.childNodes);try{for(k.s();!(g=k.n()).done;){var b=g.value;m++===l&&(y=u),y.push(Bh.call(e,b))}}catch(t){k.e(t)}finally{k.f()}}_(Th,this,"".concat(h.join("\n")).concat(a).concat(u.join("\n"))),C(Ih,this,Hh).call(this);var w,A=new Range,x=h.reduce((function(t,e){return t+e.length}),0),E=R(this.editorDiv.childNodes);try{for(E.s();!(w=E.n()).done;){var M=w.value.firstChild;if(M.nodeType===Node.TEXT_NODE){var S=M.nodeValue.length;if(x<=S){A.setStart(M,x),A.setEnd(M,x);break}x-=S}}}catch(t){E.e(t)}finally{E.f()}r.removeAllRanges(),r.addRange(A)}}}}},{key:"contentDiv",get:function(){return this.editorDiv}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};var n=e._internalPadding*this.parentScale,i=this.getRect(n,n),a=oa._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:A(Ch,this)),r={annotationType:Q.FREETEXT,color:a,fontSize:A(Lh,this),value:C(Ih,this,jh).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?r:this.annotationElementId&&!C(Ih,this,Gh).call(this,r)?null:(r.id=this.annotationElementId,r)}},{key:"renderAnnotationElement",value:function(t){var n=g(B(e.prototype),"renderAnnotationElement",this).call(this,t);if(this.deleted)return n;var i=n.style;i.fontSize="calc(".concat(A(Lh,this),"px * var(--scale-factor))"),i.color=A(Ch,this),n.replaceChildren();var a,r=R(A(Th,this).split("\n"));try{for(r.s();!(a=r.n()).done;){var s=a.value,o=document.createElement("div");o.append(s?document.createTextNode(s):document.createElement("br")),n.append(o)}}catch(t){r.e(t)}finally{r.f()}var l=e._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(l,l),popupContent:A(Th,this)}),n}},{key:"resetAnnotationElement",value:function(t){g(B(e.prototype),"resetAnnotationElement",this).call(this,t),t.resetEdited()}}],[{key:"_keyboardManager",get:function(){var t=e.prototype,n=function(t){return t.isEmpty()},i=oi.TRANSLATE_SMALL,a=oi.TRANSLATE_BIG;return dt(this,"_keyboardManager",new cn([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:n}]]))}},{key:"initialize",value:function(t,e){oa.initialize(t,e,{strings:["pdfjs-free-text-default-content"]});var n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}},{key:"updateDefaultParams",value:function(t,n){switch(t){case J.FREETEXT_SIZE:e._defaultFontSize=n;break;case J.FREETEXT_COLOR:e._defaultColor=n}}},{key:"defaultPropertiesToUpdate",get:function(){return[[J.FREETEXT_SIZE,e._defaultFontSize],[J.FREETEXT_COLOR,e._defaultColor||oa._defaultLineColor]]}},{key:"deserialize",value:function(t,n,i){var a=null;if(t instanceof Xl){var r=t,s=r.data,o=s.defaultAppearanceData,l=o.fontSize,h=o.fontColor,u=s.rect,c=s.rotation,d=s.id,f=r.textContent,v=r.textPosition,p=r.parent.page.pageNumber;if(!f||0===f.length)return null;a=t={annotationType:Q.FREETEXT,color:Array.from(h),fontSize:l,value:f.join("\n"),position:v,pageIndex:p-1,rect:u.slice(0),rotation:c,id:d,deleted:!1}}var m=g(B(e),"deserialize",this).call(this,t,n,i);return _(Lh,m,t.fontSize),_(Ch,m,Mt.makeHexColor.apply(Mt,y(t.color))),_(Th,m,zh.call(e,t.value)),m.annotationElementId=t.id||null,_(Ph,m,a),m}}])}(oa);function Dh(t){var e=this,n=function(t){e.editorDiv.style.fontSize="calc(".concat(t,"px * var(--scale-factor))"),e.translate(0,-(t-A(Lh,e))*e.parentScale),_(Lh,e,t),C(Ih,e,Wh).call(e)},i=A(Lh,this);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function Nh(t){var e=this,n=function(t){_(Ch,e,e.editorDiv.style.color=t)},i=A(Ch,this);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function Oh(){var t=[];this.editorDiv.normalize();var e,n=R(this.editorDiv.childNodes);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push(Bh.call(s,i))}}catch(t){n.e(t)}finally{n.f()}return t.join("\n")}function Wh(){var t,e=T(this.parentDimensions,2),n=e[0],i=e[1];if(this.isAttachedToDOM)t=this.div.getBoundingClientRect();else{var a=this.currentLayer,r=this.div,s=r.style.display,o=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",a.div.append(this.div),t=r.getBoundingClientRect(),r.remove(),r.style.display=s,r.classList.toggle("hidden",o)}this.rotation%180==this.parentRotation%180?(this.width=t.width/n,this.height=t.height/i):(this.width=t.height/n,this.height=t.width/i),this.fixAndSetPosition()}function Bh(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ah,"")}function Hh(){if(this.editorDiv.replaceChildren(),A(Th,this)){var t,e=R(A(Th,this).split("\n"));try{for(e.s();!(t=e.n()).done;){var n=t.value,i=document.createElement("div");i.append(n?document.createTextNode(n):document.createElement("br")),this.editorDiv.append(i)}}catch(t){e.e(t)}finally{e.f()}}}function jh(){return A(Th,this).replaceAll(" "," ")}function zh(t){return t.replaceAll(" "," ")}function Gh(t){var e=A(Ph,this),n=e.value,i=e.fontSize,a=e.color,r=e.pageIndex;return this._hasBeenMoved||t.value!==n||t.fontSize!==i||t.color.some((function(t,e){return t!==a[e]}))||t.pageIndex!==r}s=Fh,x(Fh,"_freeTextDefaultContent",""),x(Fh,"_internalPadding",0),x(Fh,"_defaultColor",null),x(Fh,"_defaultFontSize",10),x(Fh,"_type","freetext"),x(Fh,"_editorType",Q.FREETEXT);var Vh=new WeakMap,qh=new WeakMap,Uh=new WeakMap,Xh=new WeakSet,Kh=function(){return F((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];N(this,t),m(this,Xh),k(this,Vh,void 0),k(this,qh,[]),k(this,Uh,[]);var r,s=1/0,o=-1/0,l=1/0,h=-1/0,u=Math.pow(10,-4),c=R(e);try{for(c.s();!(r=c.n()).done;){var d=r.value,f=d.x,v=d.y,p=d.width,g=d.height,y=Math.floor((f-n)/u)*u,b=Math.ceil((f+p+n)/u)*u,w=Math.floor((v-n)/u)*u,x=Math.ceil((v+g+n)/u)*u,E=[y,w,x,!0],M=[b,w,x,!1];A(qh,this).push(E,M),s=Math.min(s,y),o=Math.max(o,b),l=Math.min(l,w),h=Math.max(h,x)}}catch(t){c.e(t)}finally{c.f()}var S,C=o-s+2*i,L=h-l+2*i,P=s-i,I=l-i,F=A(qh,this).at(a?-1:-2),D=[F[0],F[2]],O=R(A(qh,this));try{for(O.s();!(S=O.n()).done;){var W=S.value,B=T(W,3),H=B[0],j=B[1],z=B[2];W[0]=(H-P)/C,W[1]=(j-I)/L,W[2]=(z-I)/L}}catch(t){O.e(t)}finally{O.f()}_(Vh,this,{x:P,y:I,width:C,height:L,lastPoint:D})}),[{key:"getOutlines",value:function(){A(qh,this).sort((function(t,e){return t[0]-e[0]||t[1]-e[1]||t[2]-e[2]}));var t,e=[],n=R(A(qh,this));try{for(n.s();!(t=n.n()).done;){var i=t.value;i[3]?(e.push.apply(e,y(C(Xh,this,$h).call(this,i))),C(Xh,this,Jh).call(this,i)):(C(Xh,this,Zh).call(this,i),e.push.apply(e,y(C(Xh,this,$h).call(this,i))))}}catch(t){n.e(t)}finally{n.f()}return C(Xh,this,Yh).call(this,e)}}])}();function Yh(t){var e,n=[],i=new Set,a=R(t);try{for(a.s();!(e=a.n()).done;){var r=e.value,s=T(r,3),o=s[0],l=s[1],h=s[2];n.push([o,l,r],[o,h,r])}}catch(t){a.e(t)}finally{a.f()}n.sort((function(t,e){return t[1]-e[1]||t[0]-e[0]}));for(var u=0,c=n.length;u<c;u+=2){var d=n[u][2],f=n[u+1][2];d.push(f),f.push(d),i.add(d),i.add(f)}for(var v,p=[];i.size>0;){var g=i.values().next().value,y=T(g,5),m=y[0],k=y[1],b=y[2],w=y[3],_=y[4];i.delete(g);var x=m,E=k;for(v=[m,b],p.push(v);;){var M=void 0;if(i.has(w))M=w;else{if(!i.has(_))break;M=_}i.delete(M);var S=T(M,5);m=S[0],k=S[1],b=S[2],w=S[3],_=S[4],x!==m&&(v.push(x,E,m,E===k?k:b),x=m),E=E===k?b:k}v.push(x,E)}return new iu(p,A(Vh,this))}function Qh(t){for(var e=A(Uh,this),n=0,i=e.length-1;n<=i;){var a=n+i>>1,r=e[a][0];if(r===t)return a;r<t?n=a+1:i=a-1}return i+1}function Jh(t){var e=T(t,3),n=e[1],i=e[2],a=C(Xh,this,Qh).call(this,n);A(Uh,this).splice(a,0,[n,i])}function Zh(t){for(var e=T(t,3),n=e[1],i=e[2],a=C(Xh,this,Qh).call(this,n),r=a;r<A(Uh,this).length;r++){var s=T(A(Uh,this)[r],2),o=s[0],l=s[1];if(o!==n)break;if(o===n&&l===i)return void A(Uh,this).splice(r,1)}for(var h=a-1;h>=0;h--){var u=T(A(Uh,this)[h],2),c=u[0],d=u[1];if(c!==n)break;if(c===n&&d===i)return void A(Uh,this).splice(h,1)}}function $h(t){for(var e=T(t,3),n=e[0],i=e[1],a=e[2],r=[[n,i,a]],s=C(Xh,this,Qh).call(this,a),o=0;o<s;o++)for(var l=T(A(Uh,this)[o],2),h=l[0],u=l[1],c=0,d=r.length;c<d;c++){var f=T(r[c],3),v=f[1],p=f[2];if(!(u<=v||p<=h))if(v>=h)if(p>u)r[c][1]=u;else{if(1===d)return[];r.splice(c,1),c--,d--}else r[c][2]=h,p>u&&r.push([n,u,p])}return r}var tu=function(){return F((function t(){N(this,t)}),[{key:"toSVGPath",value:function(){throw new Error("Abstract method `toSVGPath` must be implemented.")}},{key:"box",get:function(){throw new Error("Abstract getter `box` must be implemented.")}},{key:"serialize",value:function(t,e){throw new Error("Abstract method `serialize` must be implemented.")}},{key:"free",get:function(){return this instanceof Ru}}])}(),eu=new WeakMap,nu=new WeakMap,iu=function(t){function e(t,n){var i;return N(this,e),k(i=O(this,e),eu,void 0),k(i,nu,void 0),_(nu,i,t),_(eu,i,n),i}return H(e,t),F(e,[{key:"toSVGPath",value:function(){var t,e=[],n=R(A(nu,this));try{for(n.s();!(t=n.n()).done;){var i=t.value,a=T(i,2),r=a[0],s=a[1];e.push("M".concat(r," ").concat(s));for(var o=2;o<i.length;o+=2){var l=i[o],h=i[o+1];l===r?(e.push("V".concat(h)),s=h):h===s&&(e.push("H".concat(l)),r=l)}e.push("Z")}}catch(t){n.e(t)}finally{n.f()}return e.join(" ")}},{key:"serialize",value:function(t,e){var n,i=T(t,4),a=i[0],r=i[1],s=i[2],o=i[3],l=[],h=s-a,u=o-r,c=R(A(nu,this));try{for(c.s();!(n=c.n()).done;){for(var d=n.value,f=new Array(d.length),v=0;v<d.length;v+=2)f[v]=a+d[v]*h,f[v+1]=o-d[v+1]*u;l.push(f)}}catch(t){c.e(t)}finally{c.f()}return l}},{key:"box",get:function(){return A(eu,this)}}])}(tu),au=new WeakMap,ru=new WeakMap,su=new WeakMap,ou=new WeakMap,lu=new WeakMap,hu=new WeakMap,uu=new WeakMap,cu=new WeakMap,du=new WeakMap,fu=new WeakMap,vu=new WeakMap,pu=new WeakMap,gu=new WeakMap,yu=new WeakSet,mu=function(){return F((function t(e,n,i,a,r){var s=e.x,o=e.y,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;N(this,t),m(this,yu),k(this,au,void 0),k(this,ru,[]),k(this,su,void 0),k(this,ou,void 0),k(this,lu,[]),k(this,hu,new Float64Array(18)),k(this,uu,void 0),k(this,cu,void 0),k(this,du,void 0),k(this,fu,void 0),k(this,vu,void 0),k(this,pu,void 0),k(this,gu,[]),_(au,this,n),_(pu,this,a*i),_(ou,this,r),A(hu,this).set([NaN,NaN,NaN,NaN,s,o],6),_(su,this,l),_(fu,this,bu._*i),_(du,this,wu._*i),_(vu,this,i),A(gu,this).push(s,o)}),[{key:"free",get:function(){return!0}},{key:"isEmpty",value:function(){return isNaN(A(hu,this)[8])}},{key:"add",value:function(t){var e,n=t.x,i=t.y;_(uu,this,n),_(cu,this,i);var a=T(A(au,this),4),r=a[0],s=a[1],o=a[2],l=a[3],h=T(A(hu,this).subarray(8,12),4),u=h[0],c=h[1],d=h[2],f=h[3],v=n-d,p=i-f,g=Math.hypot(v,p);if(g<A(du,this))return!1;var y=g-A(fu,this),m=y/g,k=m*v,b=m*p,w=u,x=c;u=d,c=f,d+=k,f+=b,null===(e=A(gu,this))||void 0===e||e.push(n,i);var E=k/y,M=-b/y*A(pu,this),S=E*A(pu,this);if(A(hu,this).set(A(hu,this).subarray(2,8),0),A(hu,this).set([d+M,f+S],4),A(hu,this).set(A(hu,this).subarray(14,18),12),A(hu,this).set([d-M,f-S],16),isNaN(A(hu,this)[6]))return 0===A(lu,this).length&&(A(hu,this).set([u+M,c+S],2),A(lu,this).push(NaN,NaN,NaN,NaN,(u+M-r)/o,(c+S-s)/l),A(hu,this).set([u-M,c-S],14),A(ru,this).push(NaN,NaN,NaN,NaN,(u-M-r)/o,(c-S-s)/l)),A(hu,this).set([w,x,u,c,d,f],6),!this.isEmpty();if(A(hu,this).set([w,x,u,c,d,f],6),Math.abs(Math.atan2(x-c,w-u)-Math.atan2(b,k))<Math.PI/2){var C=T(A(hu,this).subarray(2,6),4);u=C[0],c=C[1],d=C[2],f=C[3],A(lu,this).push(NaN,NaN,NaN,NaN,((u+d)/2-r)/o,((c+f)/2-s)/l);var R=T(A(hu,this).subarray(14,18),4);return u=R[0],c=R[1],w=R[2],x=R[3],A(ru,this).push(NaN,NaN,NaN,NaN,((w+u)/2-r)/o,((x+c)/2-s)/l),!0}var L=T(A(hu,this).subarray(0,6),6);w=L[0],x=L[1],u=L[2],c=L[3],d=L[4],f=L[5],A(lu,this).push(((w+5*u)/6-r)/o,((x+5*c)/6-s)/l,((5*u+d)/6-r)/o,((5*c+f)/6-s)/l,((u+d)/2-r)/o,((c+f)/2-s)/l);var P=T(A(hu,this).subarray(12,18),6);return d=P[0],f=P[1],u=P[2],c=P[3],w=P[4],x=P[5],A(ru,this).push(((w+5*u)/6-r)/o,((x+5*c)/6-s)/l,((5*u+d)/6-r)/o,((5*c+f)/6-s)/l,((u+d)/2-r)/o,((c+f)/2-s)/l),!0}},{key:"toSVGPath",value:function(){if(this.isEmpty())return"";var t=A(lu,this),e=A(ru,this),n=A(hu,this).subarray(4,6),i=A(hu,this).subarray(16,18),a=T(A(au,this),4),r=a[0],s=a[1],o=a[2],l=a[3],h=T(C(yu,this,ku).call(this),4),u=h[0],c=h[1],d=h[2],f=h[3];if(isNaN(A(hu,this)[6])&&!this.isEmpty())return"M".concat((A(hu,this)[2]-r)/o," ").concat((A(hu,this)[3]-s)/l," L").concat((A(hu,this)[4]-r)/o," ").concat((A(hu,this)[5]-s)/l," L").concat(u," ").concat(c," L").concat(d," ").concat(f," L").concat((A(hu,this)[16]-r)/o," ").concat((A(hu,this)[17]-s)/l," L").concat((A(hu,this)[14]-r)/o," ").concat((A(hu,this)[15]-s)/l," Z");var v=[];v.push("M".concat(t[4]," ").concat(t[5]));for(var p=6;p<t.length;p+=6)isNaN(t[p])?v.push("L".concat(t[p+4]," ").concat(t[p+5])):v.push("C".concat(t[p]," ").concat(t[p+1]," ").concat(t[p+2]," ").concat(t[p+3]," ").concat(t[p+4]," ").concat(t[p+5]));v.push("L".concat((n[0]-r)/o," ").concat((n[1]-s)/l," L").concat(u," ").concat(c," L").concat(d," ").concat(f," L").concat((i[0]-r)/o," ").concat((i[1]-s)/l));for(var g=e.length-6;g>=6;g-=6)isNaN(e[g])?v.push("L".concat(e[g+4]," ").concat(e[g+5])):v.push("C".concat(e[g]," ").concat(e[g+1]," ").concat(e[g+2]," ").concat(e[g+3]," ").concat(e[g+4]," ").concat(e[g+5]));return v.push("L".concat(e[4]," ").concat(e[5]," Z")),v.join(" ")}},{key:"getOutlines",value:function(){for(var t,e,n=A(lu,this),i=A(ru,this),a=A(hu,this),r=a.subarray(4,6),s=a.subarray(16,18),o=T(A(au,this),4),l=o[0],h=o[1],u=o[2],c=o[3],d=new Float64Array((null!==(t=null===(e=A(gu,this))||void 0===e?void 0:e.length)&&void 0!==t?t:0)+2),f=0,v=d.length-2;f<v;f+=2)d[f]=(A(gu,this)[f]-l)/u,d[f+1]=(A(gu,this)[f+1]-h)/c;d[d.length-2]=(A(uu,this)-l)/u,d[d.length-1]=(A(cu,this)-h)/c;var p=T(C(yu,this,ku).call(this),4),g=p[0],y=p[1],m=p[2],k=p[3];if(isNaN(a[6])&&!this.isEmpty()){var b=new Float64Array(36);return b.set([NaN,NaN,NaN,NaN,(a[2]-l)/u,(a[3]-h)/c,NaN,NaN,NaN,NaN,(a[4]-l)/u,(a[5]-h)/c,NaN,NaN,NaN,NaN,g,y,NaN,NaN,NaN,NaN,m,k,NaN,NaN,NaN,NaN,(a[16]-l)/u,(a[17]-h)/c,NaN,NaN,NaN,NaN,(a[14]-l)/u,(a[15]-h)/c],0),new Ru(b,d,A(au,this),A(vu,this),A(su,this),A(ou,this))}for(var w=new Float64Array(A(lu,this).length+24+A(ru,this).length),_=n.length,x=0;x<_;x+=2)isNaN(n[x])?w[x]=w[x+1]=NaN:(w[x]=n[x],w[x+1]=n[x+1]);w.set([NaN,NaN,NaN,NaN,(r[0]-l)/u,(r[1]-h)/c,NaN,NaN,NaN,NaN,g,y,NaN,NaN,NaN,NaN,m,k,NaN,NaN,NaN,NaN,(s[0]-l)/u,(s[1]-h)/c],_),_+=24;for(var E=i.length-6;E>=6;E-=6)for(var M=0;M<6;M+=2)isNaN(i[E+M])?(w[_]=w[_+1]=NaN,_+=2):(w[_]=i[E+M],w[_+1]=i[E+M+1],_+=2);return w.set([NaN,NaN,NaN,NaN,i[4],i[5]],_),new Ru(w,d,A(au,this),A(vu,this),A(su,this),A(ou,this))}}])}();function ku(){var t=A(hu,this).subarray(4,6),e=A(hu,this).subarray(16,18),n=T(A(au,this),4),i=n[0],a=n[1],r=n[2],s=n[3];return[(A(uu,this)+(t[0]-e[0])/2-i)/r,(A(cu,this)+(t[1]-e[1])/2-a)/s,(A(uu,this)+(e[0]-t[0])/2-i)/r,(A(cu,this)+(e[1]-t[1])/2-a)/s]}var bu={_:8},wu={_:bu._+2},Au=new WeakMap,_u=new WeakMap,xu=new WeakMap,Eu=new WeakMap,Mu=new WeakMap,Su=new WeakMap,Cu=new WeakMap,Tu=new WeakSet,Ru=function(t){function e(t,n,i,a,r,s){var o;N(this,e),m(o=O(this,e),Tu),k(o,Au,void 0),k(o,_u,null),k(o,xu,void 0),k(o,Eu,void 0),k(o,Mu,void 0),k(o,Su,void 0),k(o,Cu,void 0),_(Cu,o,t),_(Mu,o,n),_(Au,o,i),_(Su,o,a),_(xu,o,r),_(Eu,o,s),C(Tu,o,Iu).call(o,s);for(var l=A(_u,o),h=l.x,u=l.y,c=l.width,d=l.height,f=0,v=t.length;f<v;f+=2)t[f]=(t[f]-h)/c,t[f+1]=(t[f+1]-u)/d;for(var p=0,g=n.length;p<g;p+=2)n[p]=(n[p]-h)/c,n[p+1]=(n[p+1]-u)/d;return o}return H(e,t),F(e,[{key:"toSVGPath",value:function(){for(var t=["M".concat(A(Cu,this)[4]," ").concat(A(Cu,this)[5])],e=6,n=A(Cu,this).length;e<n;e+=6)isNaN(A(Cu,this)[e])?t.push("L".concat(A(Cu,this)[e+4]," ").concat(A(Cu,this)[e+5])):t.push("C".concat(A(Cu,this)[e]," ").concat(A(Cu,this)[e+1]," ").concat(A(Cu,this)[e+2]," ").concat(A(Cu,this)[e+3]," ").concat(A(Cu,this)[e+4]," ").concat(A(Cu,this)[e+5]));return t.push("Z"),t.join(" ")}},{key:"serialize",value:function(t,e){var n,i,a=T(t,4),r=a[0],s=a[1],o=a[2],l=a[3],h=o-r,u=l-s;switch(e){case 0:n=C(Tu,this,Lu).call(this,A(Cu,this),r,l,h,-u),i=C(Tu,this,Lu).call(this,A(Mu,this),r,l,h,-u);break;case 90:n=C(Tu,this,Pu).call(this,A(Cu,this),r,s,h,u),i=C(Tu,this,Pu).call(this,A(Mu,this),r,s,h,u);break;case 180:n=C(Tu,this,Lu).call(this,A(Cu,this),o,s,-h,u),i=C(Tu,this,Lu).call(this,A(Mu,this),o,s,-h,u);break;case 270:n=C(Tu,this,Pu).call(this,A(Cu,this),o,l,-h,-u),i=C(Tu,this,Pu).call(this,A(Mu,this),o,l,-h,-u)}return{outline:Array.from(n),points:[Array.from(i)]}}},{key:"box",get:function(){return A(_u,this)}},{key:"getNewOutline",value:function(t,e){for(var n=A(_u,this),i=n.x,a=n.y,r=n.width,s=n.height,o=T(A(Au,this),4),l=o[0],h=o[1],u=o[2],c=o[3],d=r*u,f=s*c,v=i*u+l,p=a*c+h,g=new mu({x:A(Mu,this)[0]*d+v,y:A(Mu,this)[1]*f+p},A(Au,this),A(Su,this),t,A(Eu,this),null!=e?e:A(xu,this)),y=2;y<A(Mu,this).length;y+=2)g.add({x:A(Mu,this)[y]*d+v,y:A(Mu,this)[y+1]*f+p});return g.getOutlines()}}])}(tu);function Lu(t,e,n,i,a){for(var r=new Float64Array(t.length),s=0,o=t.length;s<o;s+=2)r[s]=e+t[s]*i,r[s+1]=n+t[s+1]*a;return r}function Pu(t,e,n,i,a){for(var r=new Float64Array(t.length),s=0,o=t.length;s<o;s+=2)r[s]=e+t[s+1]*i,r[s+1]=n+t[s]*a;return r}function Iu(t){for(var e=A(Cu,this),n=e[4],i=e[5],a=n,r=i,s=n,o=i,l=n,h=i,u=t?Math.max:Math.min,c=6,d=e.length;c<d;c+=6){if(isNaN(e[c]))a=Math.min(a,e[c+4]),r=Math.min(r,e[c+5]),s=Math.max(s,e[c+4]),o=Math.max(o,e[c+5]),h<e[c+5]?(l=e[c+4],h=e[c+5]):h===e[c+5]&&(l=u(l,e[c+4]));else{var f=Mt.bezierBoundingBox.apply(Mt,[n,i].concat(y(e.slice(c,c+6))));a=Math.min(a,f[0]),r=Math.min(r,f[1]),s=Math.max(s,f[2]),o=Math.max(o,f[3]),h<f[3]?(l=f[2],h=f[3]):h===f[3]&&(l=u(l,f[2]))}n=e[c+4],i=e[c+5]}var v=a-A(xu,this),p=r-A(xu,this),g=s-a+2*A(xu,this),m=o-r+2*A(xu,this);_(_u,this,{x:v,y:p,width:g,height:m,lastPoint:[l,h]})}var Fu=new WeakMap,Du=new WeakMap,Nu=new WeakMap,Ou=new WeakMap,Wu=new WeakMap,Bu=new WeakMap,Hu=new WeakMap,ju=new WeakMap,zu=new WeakMap,Gu=new WeakMap,Vu=new WeakMap,qu=new WeakMap,Uu=new WeakSet,Xu=function(){function t(e){var n,i=e.editor,a=void 0===i?null:i,r=e.uiManager,s=void 0===r?null:r;N(this,t),m(this,Uu),k(this,Fu,C(Uu,this,Qu).bind(this)),k(this,Du,C(Uu,this,Zu).bind(this)),k(this,Nu,null),k(this,Ou,null),k(this,Wu,void 0),k(this,Bu,null),k(this,Hu,!1),k(this,ju,!1),k(this,zu,null),k(this,Gu,void 0),k(this,Vu,null),k(this,qu,void 0),a?(_(ju,this,!1),_(qu,this,J.HIGHLIGHT_COLOR),_(zu,this,a)):(_(ju,this,!0),_(qu,this,J.HIGHLIGHT_DEFAULT_COLOR)),_(Vu,this,(null==a?void 0:a._uiManager)||s),_(Gu,this,A(Vu,this)._eventBus),_(Wu,this,(null==a?void 0:a.color)||(null===(n=A(Vu,this))||void 0===n?void 0:n.highlightColors.values().next().value)||"#FFFF98")}return F(t,[{key:"renderButton",value:function(){var t=_(Nu,this,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0),t.addEventListener("click",C(Uu,this,Ju).bind(this)),t.addEventListener("keydown",A(Fu,this));var e=_(Ou,this,document.createElement("span"));return e.className="swatch",e.setAttribute("aria-hidden",!0),e.style.backgroundColor=A(Wu,this),t.append(e),t}},{key:"renderMainDropdown",value:function(){var t=_(Bu,this,C(Uu,this,Ku).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}},{key:"_colorSelectFromKeyboard",value:function(t){if(t.target!==A(Nu,this)){var e=t.target.getAttribute("data-color");e&&C(Uu,this,Yu).call(this,e,t)}else C(Uu,this,Ju).call(this,t)}},{key:"_moveToNext",value:function(t){var e,n;w(Uu,this,$u)?t.target!==A(Nu,this)?null===(e=t.target.nextSibling)||void 0===e||e.focus():null===(n=A(Bu,this).firstChild)||void 0===n||n.focus():C(Uu,this,Ju).call(this,t)}},{key:"_moveToPrevious",value:function(t){var e,n;t.target!==(null===(e=A(Bu,this))||void 0===e?void 0:e.firstChild)&&t.target!==A(Nu,this)?(w(Uu,this,$u)||C(Uu,this,Ju).call(this,t),null===(n=t.target.previousSibling)||void 0===n||n.focus()):w(Uu,this,$u)&&this._hideDropdownFromKeyboard()}},{key:"_moveToBeginning",value:function(t){var e;w(Uu,this,$u)?null===(e=A(Bu,this).firstChild)||void 0===e||e.focus():C(Uu,this,Ju).call(this,t)}},{key:"_moveToEnd",value:function(t){var e;w(Uu,this,$u)?null===(e=A(Bu,this).lastChild)||void 0===e||e.focus():C(Uu,this,Ju).call(this,t)}},{key:"hideDropdown",value:function(){var t;null===(t=A(Bu,this))||void 0===t||t.classList.add("hidden"),window.removeEventListener("pointerdown",A(Du,this))}},{key:"_hideDropdownFromKeyboard",value:function(){var t;A(ju,this)||(w(Uu,this,$u)?(this.hideDropdown(),A(Nu,this).focus({preventScroll:!0,focusVisible:A(Hu,this)})):null===(t=A(zu,this))||void 0===t||t.unselect())}},{key:"updateColor",value:function(t){if(A(Ou,this)&&(A(Ou,this).style.backgroundColor=t),A(Bu,this)){var e,n=A(Vu,this).highlightColors.values(),i=R(A(Bu,this).children);try{for(i.s();!(e=i.n()).done;)e.value.setAttribute("aria-selected",n.next().value===t)}catch(t){i.e(t)}finally{i.f()}}}},{key:"destroy",value:function(){var t,e;null===(t=A(Nu,this))||void 0===t||t.remove(),_(Nu,this,null),_(Ou,this,null),null===(e=A(Bu,this))||void 0===e||e.remove(),_(Bu,this,null)}}],[{key:"_keyboardManager",get:function(){return dt(this,"_keyboardManager",new cn([[["Escape","mac+Escape"],t.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],t.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],t.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],t.prototype._moveToPrevious],[["Home","mac+Home"],t.prototype._moveToBeginning],[["End","mac+End"],t.prototype._moveToEnd]]))}}])}();function Ku(){var t=document.createElement("div");t.addEventListener("contextmenu",be),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");var e,n=R(A(Vu,this).highlightColors);try{for(n.s();!(e=n.n()).done;){var i=T(e.value,2),a=i[0],r=i[1],s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",r),s.title=a,s.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-".concat(a));var o=document.createElement("span");s.append(o),o.className="swatch",o.style.backgroundColor=r,s.setAttribute("aria-selected",r===A(Wu,this)),s.addEventListener("click",C(Uu,this,Yu).bind(this,r)),t.append(s)}}catch(t){n.e(t)}finally{n.f()}return t.addEventListener("keydown",A(Fu,this)),t}function Yu(t,e){e.stopPropagation(),A(Gu,this).dispatch("switchannotationeditorparams",{source:this,type:A(qu,this),value:t})}function Qu(t){o._keyboardManager.exec(this,t)}function Ju(t){if(w(Uu,this,$u))this.hideDropdown();else if(_(Hu,this,0===t.detail),window.addEventListener("pointerdown",A(Du,this)),A(Bu,this))A(Bu,this).classList.remove("hidden");else{var e=_(Bu,this,C(Uu,this,Ku).call(this));A(Nu,this).append(e)}}function Zu(t){var e;null!==(e=A(Bu,this))&&void 0!==e&&e.contains(t.target)||this.hideDropdown()}function $u(t){return A(Bu,t)&&!A(Bu,t).classList.contains("hidden")}o=Xu;var tc=new WeakMap,ec=new WeakMap,nc=new WeakMap,ic=new WeakMap,ac=new WeakMap,rc=new WeakMap,sc=new WeakMap,oc=new WeakMap,lc=new WeakMap,hc=new WeakMap,uc=new WeakMap,cc=new WeakMap,dc=new WeakMap,fc=new WeakMap,vc=new WeakMap,pc=new WeakMap,gc=new WeakMap,yc=new WeakMap,mc=new WeakMap,kc=new WeakSet,bc=function(t){function e(t){var n;return N(this,e),m(n=O(this,e,[v(v({},t),{},{name:"highlightEditor"})]),kc),k(n,tc,null),k(n,ec,0),k(n,nc,void 0),k(n,ic,null),k(n,ac,null),k(n,rc,null),k(n,sc,null),k(n,oc,0),k(n,lc,null),k(n,hc,null),k(n,uc,null),k(n,cc,!1),k(n,dc,C(kc,n,Tc).bind(n)),k(n,fc,null),k(n,vc,void 0),k(n,pc,null),k(n,gc,""),k(n,yc,void 0),k(n,mc,""),n.color=t.color||e._defaultColor,_(yc,n,t.thickness||e._defaultThickness),_(vc,n,t.opacity||e._defaultOpacity),_(nc,n,t.boxes||null),_(mc,n,t.methodOfCreation||""),_(gc,n,t.text||""),n._isDraggable=!1,t.highlightId>-1?(_(cc,n,!0),C(kc,n,Ac).call(n,t),C(kc,n,Sc).call(n)):(_(tc,n,t.anchorNode),_(ec,n,t.anchorOffset),_(sc,n,t.focusNode),_(oc,n,t.focusOffset),C(kc,n,wc).call(n),C(kc,n,Sc).call(n),n.rotate(n.rotation)),n}return H(e,t),F(e,[{key:"telemetryInitialData",get:function(){return{action:"added",type:A(cc,this)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:A(yc,this),methodOfCreation:A(mc,this)}}},{key:"telemetryFinalData",get:function(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}},{key:"translateInPage",value:function(t,e){}},{key:"toolbarPosition",get:function(){return A(fc,this)}},{key:"updateParams",value:function(t,e){switch(t){case J.HIGHLIGHT_COLOR:C(kc,this,_c).call(this,e);break;case J.HIGHLIGHT_THICKNESS:C(kc,this,xc).call(this,e)}}},{key:"propertiesToUpdate",get:function(){return[[J.HIGHLIGHT_COLOR,this.color||e._defaultColor],[J.HIGHLIGHT_THICKNESS,A(yc,this)||e._defaultThickness],[J.HIGHLIGHT_FREE,A(cc,this)]]}},{key:"addEditToolbar",value:(n=S(E().mark((function t(){var n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(B(e.prototype),"addEditToolbar",this).call(this);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:return this._uiManager.highlightColors&&(_(ac,this,new Xu({editor:this})),n.addColorPicker(A(ac,this))),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"disableEditing",value:function(){g(B(e.prototype),"disableEditing",this).call(this),this.div.classList.toggle("disabled",!0)}},{key:"enableEditing",value:function(){g(B(e.prototype),"enableEditing",this).call(this),this.div.classList.toggle("disabled",!1)}},{key:"fixAndSetPosition",value:function(){return g(B(e.prototype),"fixAndSetPosition",this).call(this,C(kc,this,Lc).call(this))}},{key:"getBaseTranslation",value:function(){return[0,0]}},{key:"getRect",value:function(t,n){return g(B(e.prototype),"getRect",this).call(this,t,n,C(kc,this,Lc).call(this))}},{key:"onceAdded",value:function(){this.parent.addUndoableEditor(this),this.div.focus()}},{key:"remove",value:function(){C(kc,this,Mc).call(this),this._reportTelemetry({action:"deleted"}),g(B(e.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent&&(g(B(e.prototype),"rebuild",this).call(this),null!==this.div&&(C(kc,this,Sc).call(this),this.isAttachedToDOM||this.parent.add(this)))}},{key:"setParent",value:function(t){var n=!1;if(this.parent&&!t)C(kc,this,Mc).call(this);else if(t){var i;C(kc,this,Sc).call(this,t),n=!this.parent&&(null===(i=this.div)||void 0===i?void 0:i.classList.contains("selectedEditor"))}g(B(e.prototype),"setParent",this).call(this,t),this.show(this._isVisible),n&&this.select()}},{key:"rotate",value:function(t){var n,i=this.parent.drawLayer;A(cc,this)?(t=(t-this.rotation+360)%360,n=Cc.call(e,A(hc,this).box,t)):n=Cc.call(e,this,t),i.rotate(A(uc,this),t),i.rotate(A(pc,this),t),i.updateBox(A(uc,this),n),i.updateBox(A(pc,this),Cc.call(e,A(rc,this).box,t))}},{key:"render",value:function(){if(this.div)return this.div;var t=g(B(e.prototype),"render",this).call(this);A(gc,this)&&(t.setAttribute("aria-label",A(gc,this)),t.setAttribute("role","mark")),A(cc,this)?t.classList.add("free"):this.div.addEventListener("keydown",A(dc,this));var n=_(lc,this,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=A(ic,this);var i=T(this.parentDimensions,2),a=i[0],r=i[1];return this.setDims(this.width*a,this.height*r),Ke(this,A(lc,this),["pointerover","pointerleave"]),this.enableEditing(),t}},{key:"pointerover",value:function(){this.parent.drawLayer.addClass(A(pc,this),"hovered")}},{key:"pointerleave",value:function(){this.parent.drawLayer.removeClass(A(pc,this),"hovered")}},{key:"_moveCaret",value:function(t){switch(this.parent.unselect(this),t){case 0:case 2:C(kc,this,Rc).call(this,!0);break;case 1:case 3:C(kc,this,Rc).call(this,!1)}}},{key:"select",value:function(){var t,n;g(B(e.prototype),"select",this).call(this),A(pc,this)&&(null===(t=this.parent)||void 0===t||t.drawLayer.removeClass(A(pc,this),"hovered"),null===(n=this.parent)||void 0===n||n.drawLayer.addClass(A(pc,this),"selected"))}},{key:"unselect",value:function(){var t;g(B(e.prototype),"unselect",this).call(this),A(pc,this)&&(null===(t=this.parent)||void 0===t||t.drawLayer.removeClass(A(pc,this),"selected"),A(cc,this)||C(kc,this,Rc).call(this,!1))}},{key:"_mustFixPosition",get:function(){return!A(cc,this)}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;g(B(e.prototype),"show",this).call(this,t),this.parent&&(this.parent.drawLayer.show(A(uc,this),t),this.parent.drawLayer.show(A(pc,this),t))}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||t)return null;var e=this.getRect(0,0),n=oa._colorManager.convert(this.color);return{annotationType:Q.HIGHLIGHT,color:n,opacity:A(vc,this),thickness:A(yc,this),quadPoints:C(kc,this,Pc).call(this),outlines:C(kc,this,Ic).call(this,e),pageIndex:this.pageIndex,rect:e,rotation:C(kc,this,Lc).call(this),structTreeParentId:this._structTreeParentId}}}],[{key:"_keyboardManager",get:function(){var t=e.prototype;return dt(this,"_keyboardManager",new cn([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}},{key:"computeTelemetryFinalData",value:function(t){return{numberOfColors:t.get("color").size}}},{key:"initialize",value:function(t,n){var i;oa.initialize(t,n),e._defaultColor||(e._defaultColor=(null===(i=n.highlightColors)||void 0===i?void 0:i.values().next().value)||"#fff066")}},{key:"updateDefaultParams",value:function(t,n){switch(t){case J.HIGHLIGHT_DEFAULT_COLOR:e._defaultColor=n;break;case J.HIGHLIGHT_THICKNESS:e._defaultThickness=n}}},{key:"defaultPropertiesToUpdate",get:function(){return[[J.HIGHLIGHT_DEFAULT_COLOR,e._defaultColor],[J.HIGHLIGHT_THICKNESS,e._defaultThickness]]}},{key:"startHighlighting",value:function(t,n,i){var a=this,r=i.target,s=i.x,o=i.y,l=r.getBoundingClientRect(),h=l.x,u=l.y,c=l.width,d=l.height,f=function(n){C(e,a,Fc).call(a,t,n)},v={capture:!0,passive:!1},p=function(t){t.preventDefault(),t.stopPropagation()},g=function n(i){r.removeEventListener("pointermove",f),window.removeEventListener("blur",n),window.removeEventListener("pointerup",n),window.removeEventListener("pointerdown",p,v),window.removeEventListener("contextmenu",be),C(e,a,Dc).call(a,t,i)};window.addEventListener("blur",g),window.addEventListener("pointerup",g),window.addEventListener("pointerdown",p,v),window.addEventListener("contextmenu",be),r.addEventListener("pointermove",f),this._freeHighlight=new mu({x:s,y:o},[h,u,c,d],t.scale,this._defaultThickness/2,n,.001);var y=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0);this._freeHighlightId=y.id,this._freeHighlightClipId=y.clipPathId}},{key:"deserialize",value:function(t,n,i){var a=g(B(e),"deserialize",this).call(this,t,n,i),r=T(t.rect,4),s=r[0],o=r[1],l=r[2],h=r[3],u=t.color,c=t.quadPoints;a.color=Mt.makeHexColor.apply(Mt,y(u)),_(vc,a,t.opacity);var d=T(a.pageDimensions,2),f=d[0],v=d[1];a.width=(l-s)/f,a.height=(h-o)/v;for(var p=_(nc,a,[]),m=0;m<c.length;m+=8)p.push({x:(c[4]-l)/f,y:(h-(1-c[m+5]))/v,width:(c[m+2]-c[m])/f,height:(c[m+5]-c[m+1])/v});return C(kc,a,wc).call(a),a}},{key:"canCreateNewEmptyEditor",value:function(){return!1}}]);var n}(oa);function wc(){var t=new Kh(A(nc,this),.001);_(hc,this,t.getOutlines());var e=A(hc,this).box;this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height;var n=new Kh(A(nc,this),.0025,.001,"ltr"===this._uiManager.direction);_(rc,this,n.getOutlines());var i=A(rc,this).box.lastPoint;_(fc,this,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])}function Ac(t){var e=t.highlightOutlines,n=t.highlightId,i=t.clipPathId;if(_(hc,this,e),_(rc,this,e.getNewOutline(A(yc,this)/2+1.5,.0025)),n>=0)_(uc,this,n),_(ic,this,i),this.parent.drawLayer.finalizeLine(n,e),_(pc,this,this.parent.drawLayer.highlightOutline(A(rc,this)));else if(this.parent){var a=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(A(uc,this),e),this.parent.drawLayer.updateBox(A(uc,this),Cc.call(l,A(hc,this).box,(a-this.rotation+360)%360)),this.parent.drawLayer.updateLine(A(pc,this),A(rc,this)),this.parent.drawLayer.updateBox(A(pc,this),Cc.call(l,A(rc,this).box,a))}var r=e.box,s=r.x,o=r.y,h=r.width,u=r.height;switch(this.rotation){case 0:this.x=s,this.y=o,this.width=h,this.height=u;break;case 90:var c=T(this.parentDimensions,2),d=c[0],f=c[1];this.x=o,this.y=1-s,this.width=h*f/d,this.height=u*d/f;break;case 180:this.x=1-s,this.y=1-o,this.width=h,this.height=u;break;case 270:var v=T(this.parentDimensions,2),p=v[0],g=v[1];this.x=1-o,this.y=s,this.width=h*g/p,this.height=u*p/g}var y=A(rc,this).box.lastPoint;_(fc,this,[(y[0]-s)/h,(y[1]-o)/u])}function _c(t){var e=this,n=function(t){var n,i;e.color=t,null===(n=e.parent)||void 0===n||n.drawLayer.changeColor(A(uc,e),t),null===(i=A(ac,e))||void 0===i||i.updateColor(t)},i=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}function xc(t){var e=this,n=A(yc,this),i=function(t){_(yc,e,t),C(kc,e,Ec).call(e,t)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}function Ec(t){if(A(cc,this)){C(kc,this,Ac).call(this,{highlightOutlines:A(hc,this).getNewOutline(t/2)}),this.fixAndSetPosition();var e=T(this.parentDimensions,2),n=e[0],i=e[1];this.setDims(this.width*n,this.height*i)}}function Mc(){null!==A(uc,this)&&this.parent&&(this.parent.drawLayer.remove(A(uc,this)),_(uc,this,null),this.parent.drawLayer.remove(A(pc,this)),_(pc,this,null))}function Sc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;if(null===A(uc,this)){var e=t.drawLayer.highlight(A(hc,this),this.color,A(vc,this));p(_,[uc,this])._=e.id,p(_,[ic,this])._=e.clipPathId,_(pc,this,t.drawLayer.highlightOutline(A(rc,this))),A(lc,this)&&(A(lc,this).style.clipPath=A(ic,this))}}function Cc(t,e){var n=t.x,i=t.y,a=t.width,r=t.height;switch(e){case 90:return{x:1-i-r,y:n,width:r,height:a};case 180:return{x:1-n-a,y:1-i-r,width:a,height:r};case 270:return{x:i,y:1-n-a,width:r,height:a}}return{x:n,y:i,width:a,height:r}}function Tc(t){l._keyboardManager.exec(this,t)}function Rc(t){if(A(tc,this)){var e=window.getSelection();t?e.setPosition(A(tc,this),A(ec,this)):e.setPosition(A(sc,this),A(oc,this))}}function Lc(){return A(cc,this)?this.rotation:0}function Pc(){if(A(cc,this))return null;var t,e=T(this.pageDimensions,2),n=e[0],i=e[1],a=A(nc,this),r=new Array(8*a.length),s=0,o=R(a);try{for(o.s();!(t=o.n()).done;){var l=t.value,h=l.x,u=l.y,c=l.width,d=l.height,f=h*n,v=(1-u-d)*i;r[s]=r[s+4]=f,r[s+1]=r[s+3]=v,r[s+2]=r[s+6]=f+c*n,r[s+5]=r[s+7]=v+d*i,s+=8}}catch(t){o.e(t)}finally{o.f()}return r}function Ic(t){return A(hc,this).serialize(t,C(kc,this,Lc).call(this))}function Fc(t,e){this._freeHighlight.add(e)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}function Dc(t,e){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}l=bc,x(bc,"_defaultColor",null),x(bc,"_defaultOpacity",1),x(bc,"_defaultThickness",12),x(bc,"_l10nPromise",void 0),x(bc,"_type","highlight"),x(bc,"_editorType",Q.HIGHLIGHT),x(bc,"_freeHighlightId",-1),x(bc,"_freeHighlight",null),x(bc,"_freeHighlightClipId","");var Nc=new WeakMap,Oc=new WeakMap,Wc=new WeakMap,Bc=new WeakMap,Hc=new WeakMap,jc=new WeakMap,zc=new WeakMap,Gc=new WeakMap,Vc=new WeakMap,qc=new WeakMap,Uc=new WeakMap,Xc=new WeakMap,Kc=new WeakMap,Yc=new WeakMap,Qc=new WeakMap,Jc=new WeakSet,Zc=function(t){function e(t){var n;return N(this,e),m(n=O(this,e,[v(v({},t),{},{name:"inkEditor"})]),Jc),k(n,Nc,0),k(n,Oc,0),k(n,Wc,n.canvasPointermove.bind(n)),k(n,Bc,n.canvasPointerleave.bind(n)),k(n,Hc,n.canvasPointerup.bind(n)),k(n,jc,n.canvasPointerdown.bind(n)),k(n,zc,null),k(n,Gc,new Path2D),k(n,Vc,!1),k(n,qc,!1),k(n,Uc,!1),k(n,Xc,null),k(n,Kc,0),k(n,Yc,0),k(n,Qc,null),n.color=t.color||null,n.thickness=t.thickness||null,n.opacity=t.opacity||null,n.paths=[],n.bezierPath2D=[],n.allRawPaths=[],n.currentPath=[],n.scaleFactor=1,n.translationX=n.translationY=0,n.x=0,n.y=0,n._willKeepAspectRatio=!0,n}return H(e,t),F(e,[{key:"updateParams",value:function(t,e){switch(t){case J.INK_THICKNESS:C(Jc,this,$c).call(this,e);break;case J.INK_COLOR:C(Jc,this,td).call(this,e);break;case J.INK_OPACITY:C(Jc,this,ed).call(this,e)}}},{key:"propertiesToUpdate",get:function(){var t;return[[J.INK_THICKNESS,this.thickness||e._defaultThickness],[J.INK_COLOR,this.color||e._defaultColor||oa._defaultLineColor],[J.INK_OPACITY,Math.round(100*(null!==(t=this.opacity)&&void 0!==t?t:e._defaultOpacity))]]}},{key:"rebuild",value:function(){this.parent&&(g(B(e.prototype),"rebuild",this).call(this),null!==this.div&&(this.canvas||(C(Jc,this,fd).call(this),C(Jc,this,vd).call(this)),this.isAttachedToDOM||(this.parent.add(this),C(Jc,this,pd).call(this)),C(Jc,this,xd).call(this)))}},{key:"remove",value:function(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,A(zc,this)&&(clearTimeout(A(zc,this)),_(zc,this,null)),A(Xc,this).disconnect(),_(Xc,this,null),g(B(e.prototype),"remove",this).call(this))}},{key:"setParent",value:function(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&null===t&&this._uiManager.addShouldRescale(this),g(B(e.prototype),"setParent",this).call(this,t)}},{key:"onScaleChanging",value:function(){var t=T(this.parentDimensions,2),e=t[0],n=t[1],i=this.width*e,a=this.height*n;this.setDimensions(i,a)}},{key:"enableEditMode",value:function(){A(Vc,this)||null===this.canvas||(g(B(e.prototype),"enableEditMode",this).call(this),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",A(jc,this)))}},{key:"disableEditMode",value:function(){this.isInEditMode()&&null!==this.canvas&&(g(B(e.prototype),"disableEditMode",this).call(this),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",A(jc,this)))}},{key:"onceAdded",value:function(){this._isDraggable=!this.isEmpty()}},{key:"isEmpty",value:function(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}},{key:"commit",value:function(){A(Vc,this)||(g(B(e.prototype),"commit",this).call(this),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),_(Vc,this,!0),this.div.classList.add("disabled"),C(Jc,this,xd).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(g(B(e.prototype),"focusin",this).call(this,t),this.enableEditMode())}},{key:"canvasPointerdown",value:function(t){0===t.button&&this.isInEditMode()&&!A(Vc,this)&&(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),C(Jc,this,ad).call(this,t.offsetX,t.offsetY))}},{key:"canvasPointermove",value:function(t){t.preventDefault(),C(Jc,this,rd).call(this,t.offsetX,t.offsetY)}},{key:"canvasPointerup",value:function(t){t.preventDefault(),C(Jc,this,dd).call(this,t)}},{key:"canvasPointerleave",value:function(t){C(Jc,this,dd).call(this,t)}},{key:"isResizable",get:function(){return!this.isEmpty()&&A(Vc,this)}},{key:"render",value:function(){if(this.div)return this.div;var t,n;this.width&&(t=this.x,n=this.y),g(B(e.prototype),"render",this).call(this),this.div.setAttribute("data-l10n-id","pdfjs-ink");var i=T(C(Jc,this,nd).call(this),4),a=i[0],r=i[1],s=i[2],o=i[3];if(this.setAt(a,r,0,0),this.setDims(s,o),C(Jc,this,fd).call(this),this.width){var l=T(this.parentDimensions,2),h=l[0],u=l[1];this.setAspectRatio(this.width*h,this.height*u),this.setAt(t*h,n*u,this.width*h,this.height*u),_(Uc,this,!0),C(Jc,this,pd).call(this),this.setDims(this.width*h,this.height*u),C(Jc,this,cd).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return C(Jc,this,vd).call(this),this.div}},{key:"setDimensions",value:function(t,e){var n=Math.round(t),i=Math.round(e);if(A(Kc,this)!==n||A(Yc,this)!==i){_(Kc,this,n),_(Yc,this,i),this.canvas.style.visibility="hidden";var a=T(this.parentDimensions,2),r=a[0],s=a[1];this.width=t/r,this.height=e/s,this.fixAndSetPosition(),A(Vc,this)&&C(Jc,this,gd).call(this,t,e),C(Jc,this,pd).call(this),C(Jc,this,cd).call(this),this.canvas.style.visibility="visible",this.fixDims()}}},{key:"serialize",value:function(){if(this.isEmpty())return null;var t=this.getRect(0,0),e=oa._colorManager.convert(this.ctx.strokeStyle);return{annotationType:Q.INK,color:e,thickness:this.thickness,opacity:this.opacity,paths:C(Jc,this,wd).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}],[{key:"initialize",value:function(t,e){oa.initialize(t,e)}},{key:"updateDefaultParams",value:function(t,n){switch(t){case J.INK_THICKNESS:e._defaultThickness=n;break;case J.INK_COLOR:e._defaultColor=n;break;case J.INK_OPACITY:e._defaultOpacity=n/100}}},{key:"defaultPropertiesToUpdate",get:function(){return[[J.INK_THICKNESS,e._defaultThickness],[J.INK_COLOR,e._defaultColor||oa._defaultLineColor],[J.INK_OPACITY,Math.round(100*e._defaultOpacity)]]}},{key:"deserialize",value:function(t,n,i){if(t instanceof rh)return null;var a=g(B(e),"deserialize",this).call(this,t,n,i);a.thickness=t.thickness,a.color=Mt.makeHexColor.apply(Mt,y(t.color)),a.opacity=t.opacity;var r=T(a.pageDimensions,2),s=r[0],o=r[1],l=a.width*s,h=a.height*o,u=a.parentScale,c=t.thickness/2;_(Vc,a,!0),_(Kc,a,Math.round(l)),_(Yc,a,Math.round(h));var d,f=t.paths,v=t.rect,p=t.rotation,m=R(f);try{for(m.s();!(d=m.n()).done;){var k=d.value.bezier;k=bd.call(e,k,v,p);var b=[];a.paths.push(b);for(var w=u*(k[0]-c),A=u*(k[1]-c),x=2,E=k.length;x<E;x+=6){var M=u*(k[x]-c),S=u*(k[x+1]-c),L=u*(k[x+2]-c),P=u*(k[x+3]-c),I=u*(k[x+4]-c),F=u*(k[x+5]-c);b.push([[w,A],[M,S],[L,P],[I,F]]),w=I,A=F}var D=C(e,this,md).call(this,b);a.bezierPath2D.push(D)}}catch(t){m.e(t)}finally{m.f()}var N=C(Jc,a,Ad).call(a);return _(Oc,a,Math.max(oa.MIN_SIZE,N[2]-N[0])),_(Nc,a,Math.max(oa.MIN_SIZE,N[3]-N[1])),C(Jc,a,gd).call(a,l,h),a}}])}(oa);function $c(t){var e=this,n=function(t){e.thickness=t,C(Jc,e,xd).call(e)},i=this.thickness;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}function td(t){var e=this,n=function(t){e.color=t,C(Jc,e,cd).call(e)},i=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function ed(t){var e=this,n=function(t){e.opacity=t,C(Jc,e,cd).call(e)};t/=100;var i=this.opacity;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:J.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}function nd(){var t=this.parentRotation,e=T(this.parentDimensions,2),n=e[0],i=e[1];switch(t){case 90:return[0,i,i,n];case 180:return[n,i,n,i];case 270:return[n,0,i,n];default:return[0,0,n,i]}}function id(){var t=this.ctx,e=this.color,n=this.opacity,i=this.thickness,a=this.parentScale,r=this.scaleFactor;t.lineWidth=i*a/r,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle="".concat(e).concat(function(t){return Math.round(Math.min(255,Math.max(1,255*t))).toString(16).padStart(2,"0")}(n))}function ad(t,e){var n,i=this;this.canvas.addEventListener("contextmenu",be),this.canvas.addEventListener("pointerleave",A(Bc,this)),this.canvas.addEventListener("pointermove",A(Wc,this)),this.canvas.addEventListener("pointerup",A(Hc,this)),this.canvas.removeEventListener("pointerdown",A(jc,this)),this.isEditing=!0,A(Uc,this)||(_(Uc,this,!0),C(Jc,this,pd).call(this),this.thickness||(this.thickness=h._defaultThickness),this.color||(this.color=h._defaultColor||oa._defaultLineColor),null!==(n=this.opacity)&&void 0!==n||(this.opacity=h._defaultOpacity)),this.currentPath.push([t,e]),_(qc,this,!1),C(Jc,this,id).call(this),_(Qc,this,(function(){C(Jc,i,ld).call(i),A(Qc,i)&&window.requestAnimationFrame(A(Qc,i))})),window.requestAnimationFrame(A(Qc,this))}function rd(t,e){var n,i=T(this.currentPath.at(-1),2),a=i[0],r=i[1];if(!(this.currentPath.length>1&&t===a&&e===r)){var s,o,l=this.currentPath,h=A(Gc,this);if(l.push([t,e]),_(qc,this,!0),l.length<=2)return(s=h).moveTo.apply(s,y(l[0])),void h.lineTo(t,e);3===l.length&&(_(Gc,this,h=new Path2D),(o=h).moveTo.apply(o,y(l[0]))),(n=C(Jc,this,hd)).call.apply(n,[this,h].concat(y(l.at(-3)),y(l.at(-2)),[t,e]))}}function sd(){var t;if(0!==this.currentPath.length){var e=this.currentPath.at(-1);(t=A(Gc,this)).lineTo.apply(t,y(e))}}function od(t,e){var n,i=this;if(_(Qc,this,null),t=Math.min(Math.max(t,0),this.canvas.width),e=Math.min(Math.max(e,0),this.canvas.height),C(Jc,this,rd).call(this,t,e),C(Jc,this,sd).call(this),1!==this.currentPath.length)n=C(Jc,this,ud).call(this);else{var a=[t,e];n=[[a,a.slice(),a.slice(),a]]}var r=A(Gc,this),s=this.currentPath;this.currentPath=[],_(Gc,this,new Path2D),this.addCommands({cmd:function(){i.allRawPaths.push(s),i.paths.push(n),i.bezierPath2D.push(r),i._uiManager.rebuild(i)},undo:function(){i.allRawPaths.pop(),i.paths.pop(),i.bezierPath2D.pop(),0===i.paths.length?i.remove():(i.canvas||(C(Jc,i,fd).call(i),C(Jc,i,vd).call(i)),C(Jc,i,xd).call(i))},mustExec:!0})}function ld(){if(A(qc,this)){_(qc,this,!1);Math.ceil(this.thickness*this.parentScale);var t=this.currentPath.slice(-3),e=t.map((function(t){return t[0]})),n=t.map((function(t){return t[1]})),i=(Math.min.apply(Math,y(e)),Math.max.apply(Math,y(e)),Math.min.apply(Math,y(n)),Math.max.apply(Math,y(n)),this.ctx);i.save(),i.clearRect(0,0,this.canvas.width,this.canvas.height);var a,r=R(this.bezierPath2D);try{for(r.s();!(a=r.n()).done;){var s=a.value;i.stroke(s)}}catch(t){r.e(t)}finally{r.f()}i.stroke(A(Gc,this)),i.restore()}}function hd(t,e,n,i,a,r,s){var o=(e+i)/2,l=(n+a)/2,h=(i+r)/2,u=(a+s)/2;t.bezierCurveTo(o+2*(i-o)/3,l+2*(a-l)/3,h+2*(i-h)/3,u+2*(a-u)/3,h,u)}function ud(){var t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];var e,n=[],i=T(t[0],2),a=i[0],r=i[1];for(e=1;e<t.length-2;e++){var s=T(t[e],2),o=s[0],l=s[1],h=T(t[e+1],2),u=(o+h[0])/2,c=(l+h[1])/2,d=[a+2*(o-a)/3,r+2*(l-r)/3],f=[u+2*(o-u)/3,c+2*(l-c)/3];n.push([[a,r],d,f,[u,c]]),a=u,r=c}var v=T(t[e],2),p=v[0],g=v[1],y=T(t[e+1],2),m=y[0],k=y[1],b=[a+2*(p-a)/3,r+2*(g-r)/3],w=[m+2*(p-m)/3,k+2*(g-k)/3];return n.push([[a,r],b,w,[m,k]]),n}function cd(){if(this.isEmpty())C(Jc,this,yd).call(this);else{C(Jc,this,id).call(this);var t=this.canvas,e=this.ctx;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),C(Jc,this,yd).call(this);var n,i=R(this.bezierPath2D);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.stroke(a)}}catch(t){i.e(t)}finally{i.f()}}}function dd(t){var e=this;this.canvas.removeEventListener("pointerleave",A(Bc,this)),this.canvas.removeEventListener("pointermove",A(Wc,this)),this.canvas.removeEventListener("pointerup",A(Hc,this)),this.canvas.addEventListener("pointerdown",A(jc,this)),A(zc,this)&&clearTimeout(A(zc,this)),_(zc,this,setTimeout((function(){_(zc,e,null),e.canvas.removeEventListener("contextmenu",be)}),10)),C(Jc,this,od).call(this,t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}function fd(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}function vd(){var t=this;_(Xc,this,new ResizeObserver((function(e){var n=e[0].contentRect;n.width&&n.height&&t.setDimensions(n.width,n.height)}))),A(Xc,this).observe(this.div)}function pd(){if(A(Uc,this)){var t=T(this.parentDimensions,2),e=t[0],n=t[1];this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*n),C(Jc,this,yd).call(this)}}function gd(t,e){var n=C(Jc,this,_d).call(this),i=(t-n)/A(Oc,this),a=(e-n)/A(Nc,this);this.scaleFactor=Math.min(i,a)}function yd(){var t=C(Jc,this,_d).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}function md(t){for(var e=new Path2D,n=0,i=t.length;n<i;n++){var a=T(t[n],4),r=a[0],s=a[1],o=a[2],l=a[3];0===n&&e.moveTo.apply(e,y(r)),e.bezierCurveTo(s[0],s[1],o[0],o[1],l[0],l[1])}return e}function kd(t,e,n){var i=T(e,4),a=i[0],r=i[1],s=i[2],o=i[3];switch(n){case 0:for(var l=0,h=t.length;l<h;l+=2)t[l]+=a,t[l+1]=o-t[l+1];break;case 90:for(var u=0,c=t.length;u<c;u+=2){var d=t[u];t[u]=t[u+1]+a,t[u+1]=d+r}break;case 180:for(var f=0,v=t.length;f<v;f+=2)t[f]=s-t[f],t[f+1]+=r;break;case 270:for(var p=0,g=t.length;p<g;p+=2){var y=t[p];t[p]=s-t[p+1],t[p+1]=o-y}break;default:throw new Error("Invalid rotation")}return t}function bd(t,e,n){var i=T(e,4),a=i[0],r=i[1],s=i[2],o=i[3];switch(n){case 0:for(var l=0,h=t.length;l<h;l+=2)t[l]-=a,t[l+1]=o-t[l+1];break;case 90:for(var u=0,c=t.length;u<c;u+=2){var d=t[u];t[u]=t[u+1]-r,t[u+1]=d-a}break;case 180:for(var f=0,v=t.length;f<v;f+=2)t[f]=s-t[f],t[f+1]-=r;break;case 270:for(var p=0,g=t.length;p<g;p+=2){var y=t[p];t[p]=o-t[p+1],t[p+1]=s-y}break;default:throw new Error("Invalid rotation")}return t}function wd(t,e,n,i){var a,r=[],s=this.thickness/2,o=t*e+s,l=t*n+s,u=R(this.paths);try{for(u.s();!(a=u.n()).done;){for(var c=a.value,d=[],f=[],v=0,p=c.length;v<p;v++){var g=T(c[v],4),y=g[0],m=g[1],k=g[2],b=g[3];if(y[0]===b[0]&&y[1]===b[1]&&1===p){var w=t*y[0]+o,A=t*y[1]+l;d.push(w,A),f.push(w,A);break}var _=t*y[0]+o,x=t*y[1]+l,E=t*m[0]+o,M=t*m[1]+l,S=t*k[0]+o,C=t*k[1]+l,L=t*b[0]+o,P=t*b[1]+l;0===v&&(d.push(_,x),f.push(_,x)),d.push(E,M,S,C,L,P),f.push(E,M),v===p-1&&f.push(L,P)}r.push({bezier:kd.call(h,d,i,this.rotation),points:kd.call(h,f,i,this.rotation)})}}catch(t){u.e(t)}finally{u.f()}return r}function Ad(){var t,e=1/0,n=-1/0,i=1/0,a=-1/0,r=R(this.paths);try{for(r.s();!(t=r.n()).done;){var s,o=R(t.value);try{for(o.s();!(s=o.n()).done;){var l=T(s.value,4),h=l[0],u=l[1],c=l[2],d=l[3],f=Mt.bezierBoundingBox.apply(Mt,y(h).concat(y(u),y(c),y(d)));e=Math.min(e,f[0]),i=Math.min(i,f[1]),n=Math.max(n,f[2]),a=Math.max(a,f[3])}}catch(t){o.e(t)}finally{o.f()}}}catch(t){r.e(t)}finally{r.f()}return[e,i,n,a]}function _d(){return A(Vc,this)?Math.ceil(this.thickness*this.parentScale):0}function xd(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty())if(A(Vc,this)){var e=C(Jc,this,Ad).call(this),n=C(Jc,this,_d).call(this);_(Oc,this,Math.max(oa.MIN_SIZE,e[2]-e[0])),_(Nc,this,Math.max(oa.MIN_SIZE,e[3]-e[1]));var i=Math.ceil(n+A(Oc,this)*this.scaleFactor),a=Math.ceil(n+A(Nc,this)*this.scaleFactor),r=T(this.parentDimensions,2),s=r[0],o=r[1];this.width=i/s,this.height=a/o,this.setAspectRatio(i,a);var l=this.translationX,h=this.translationY;this.translationX=-e[0],this.translationY=-e[1],C(Jc,this,pd).call(this),C(Jc,this,cd).call(this),_(Kc,this,i),_(Yc,this,a),this.setDims(i,a);var u=t?n/this.scaleFactor/2:0;this.translate(l-this.translationX-u,h-this.translationY-u)}else C(Jc,this,cd).call(this)}h=Zc,x(Zc,"_defaultColor",null),x(Zc,"_defaultOpacity",1),x(Zc,"_defaultThickness",1),x(Zc,"_type","ink"),x(Zc,"_editorType",Q.INK);var Ed=new WeakMap,Md=new WeakMap,Sd=new WeakMap,Cd=new WeakMap,Td=new WeakMap,Rd=new WeakMap,Ld=new WeakMap,Pd=new WeakMap,Id=new WeakMap,Fd=new WeakMap,Dd=new WeakMap,Nd=new WeakSet,Od=function(t){function e(t){var n;return N(this,e),m(n=O(this,e,[v(v({},t),{},{name:"stampEditor"})]),Nd),k(n,Ed,null),k(n,Md,null),k(n,Sd,null),k(n,Cd,null),k(n,Td,null),k(n,Rd,""),k(n,Ld,null),k(n,Pd,null),k(n,Id,null),k(n,Fd,!1),k(n,Dd,!1),_(Cd,n,t.bitmapUrl),_(Td,n,t.bitmapFile),n}return H(e,t),F(e,[{key:"remove",value:function(){var t,n;A(Md,this)&&(_(Ed,this,null),this._uiManager.imageManager.deleteId(A(Md,this)),null===(t=A(Ld,this))||void 0===t||t.remove(),_(Ld,this,null),null===(n=A(Pd,this))||void 0===n||n.disconnect(),_(Pd,this,null),A(Id,this)&&(clearTimeout(A(Id,this)),_(Id,this,null))),g(B(e.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent?(g(B(e.prototype),"rebuild",this).call(this),null!==this.div&&(A(Md,this)&&null===A(Ld,this)&&C(Nd,this,Hd).call(this),this.isAttachedToDOM||this.parent.add(this))):A(Md,this)&&C(Nd,this,Hd).call(this)}},{key:"onceAdded",value:function(){this._isDraggable=!0,this.div.focus()}},{key:"isEmpty",value:function(){return!(A(Sd,this)||A(Ed,this)||A(Cd,this)||A(Td,this)||A(Md,this))}},{key:"isResizable",get:function(){return!0}},{key:"render",value:function(){if(this.div)return this.div;var t,n;if(this.width&&(t=this.x,n=this.y),g(B(e.prototype),"render",this).call(this),this.div.hidden=!0,this.addAltTextButton(),A(Ed,this)?C(Nd,this,jd).call(this):C(Nd,this,Hd).call(this),this.width){var i=T(this.parentDimensions,2),a=i[0],r=i[1];this.setAt(t*a,n*r,this.width*a,this.height*r)}return this.div}},{key:"getImageForAltText",value:function(){return A(Ld,this)}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;var n={annotationType:Q.STAMP,bitmapId:A(Md,this),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:A(Fd,this),structTreeParentId:this._structTreeParentId};if(t)return n.bitmapUrl=C(Nd,this,qd).call(this,!0),n.accessibilityData=this.altTextData,n;var i=this.altTextData,a=i.decorative,r=i.altText;if(!a&&r&&(n.accessibilityData={type:"Figure",alt:r}),null===e)return n;e.stamps||(e.stamps=new Map);var s=A(Fd,this)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(e.stamps.has(A(Md,this))){if(A(Fd,this)){var o=e.stamps.get(A(Md,this));s>o.area&&(o.area=s,o.serialized.bitmap.close(),o.serialized.bitmap=C(Nd,this,qd).call(this,!1))}}else e.stamps.set(A(Md,this),{area:s,serialized:n}),n.bitmap=C(Nd,this,qd).call(this,!1);return n}}],[{key:"initialize",value:function(t,e){oa.initialize(t,e)}},{key:"supportedTypes",get:function(){return dt(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((function(t){return"image/".concat(t)})))}},{key:"supportedTypesStr",get:function(){return dt(this,"supportedTypesStr",this.supportedTypes.join(","))}},{key:"isHandlingMimeForPasting",value:function(t){return this.supportedTypes.includes(t)}},{key:"paste",value:function(t,e){e.pasteEditor(Q.STAMP,{bitmapFile:t.getAsFile()})}},{key:"deserialize",value:function(t,n,i){if(t instanceof uh)return null;var a=g(B(e),"deserialize",this).call(this,t,n,i),r=t.rect,s=t.bitmapUrl,o=t.bitmapId,l=t.isSvg,h=t.accessibilityData;o&&i.imageManager.isValidId(o)?_(Md,a,o):_(Cd,a,s),_(Fd,a,l);var u=T(a.pageDimensions,2),c=u[0],d=u[1];return a.width=(r[2]-r[0])/c,a.height=(r[3]-r[1])/d,h&&(a.altTextData=h),a}}])}(oa);function Wd(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(_(Ed,this,t.bitmap),e||(_(Md,this,t.id),_(Fd,this,t.isSvg)),t.file&&_(Rd,this,t.file.name),C(Nd,this,jd).call(this)):this.remove()}function Bd(){_(Sd,this,null),this._uiManager.enableWaiting(!1),A(Ld,this)&&this.div.focus()}function Hd(){var t=this;if(A(Md,this))return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(A(Md,this)).then((function(e){return C(Nd,t,Wd).call(t,e,!0)})).finally((function(){return C(Nd,t,Bd).call(t)}));if(A(Cd,this)){var e=A(Cd,this);return _(Cd,this,null),this._uiManager.enableWaiting(!0),void _(Sd,this,this._uiManager.imageManager.getFromUrl(e).then((function(e){return C(Nd,t,Wd).call(t,e)})).finally((function(){return C(Nd,t,Bd).call(t)})))}if(A(Td,this)){var n=A(Td,this);return _(Td,this,null),this._uiManager.enableWaiting(!0),void _(Sd,this,this._uiManager.imageManager.getFromFile(n).then((function(e){return C(Nd,t,Wd).call(t,e)})).finally((function(){return C(Nd,t,Bd).call(t)})))}var i=document.createElement("input");i.type="file",i.accept=u.supportedTypesStr,_(Sd,this,new Promise((function(e){i.addEventListener("change",S(E().mark((function n(){var a;return E().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i.files&&0!==i.files.length){n.next=4;break}t.remove(),n.next=9;break;case 4:return t._uiManager.enableWaiting(!0),n.next=7,t._uiManager.imageManager.getFromFile(i.files[0]);case 7:a=n.sent,C(Nd,t,Wd).call(t,a);case 9:e();case 10:case"end":return n.stop()}}),n)})))),i.addEventListener("cancel",(function(){t.remove(),e()}))})).finally((function(){return C(Nd,t,Bd).call(t)}))),i.click()}function jd(){var t=this.div,e=A(Ed,this),n=e.width,i=e.height,a=T(this.pageDimensions,2),r=a[0],s=a[1],o=.75;if(this.width)n=this.width*r,i=this.height*s;else if(n>o*r||i>o*s){var l=Math.min(o*r/n,o*s/i);n*=l,i*=l}var h=T(this.parentDimensions,2),u=h[0],c=h[1];this.setDims(n*u/r,i*c/s),this._uiManager.enableWaiting(!1);var d=_(Ld,this,document.createElement("canvas"));t.append(d),t.hidden=!1,C(Nd,this,Vd).call(this,n,i),C(Nd,this,Ud).call(this),A(Dd,this)||(this.parent.addUndoableEditor(this),_(Dd,this,!0)),this._reportTelemetry({action:"inserted_image"}),A(Rd,this)&&d.setAttribute("aria-label",A(Rd,this))}function zd(t,e){var n,i=this,a=T(this.parentDimensions,2),r=a[0],s=a[1];this.width=t/r,this.height=e/s,this.setDims(t,e),null!==(n=this._initialOptions)&&void 0!==n&&n.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==A(Id,this)&&clearTimeout(A(Id,this)),_(Id,this,setTimeout((function(){_(Id,i,null),C(Nd,i,Vd).call(i,t,e)}),200))}function Gd(t,e){for(var n=A(Ed,this),i=n.width,a=n.height,r=A(Ed,this);i>2*t||a>2*e;){var s=i,o=a;i>2*t&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));var l=new OffscreenCanvas(i,a);l.getContext("2d").drawImage(r,0,0,s,o,0,0,i,a),r=l.transferToImageBitmap()}return r}function Vd(t,e){var n=this;t=Math.ceil(t),e=Math.ceil(e);var i=A(Ld,this);if(i&&(i.width!==t||i.height!==e)){i.width=t,i.height=e;var a=A(Fd,this)?A(Ed,this):C(Nd,this,Gd).call(this,t,e);if(this._uiManager.hasMLManager&&!this.hasAltText()){var r=new OffscreenCanvas(t,e).getContext("2d");r.drawImage(a,0,0,a.width,a.height,0,0,t,e),this._uiManager.mlGuess({service:"image-to-text",request:{data:r.getImageData(0,0,t,e).data,width:t,height:e,channels:4}}).then((function(t){var e=(null==t?void 0:t.output)||"";n.parent&&e&&!n.hasAltText()&&(n.altTextData={altText:e,decorative:!1})}))}var s=i.getContext("2d");s.filter=this._uiManager.hcmFilter,s.drawImage(a,0,0,a.width,a.height,0,0,t,e)}}function qd(t){if(t){if(A(Fd,this)){var e=this._uiManager.imageManager.getSvgUrl(A(Md,this));if(e)return e}var n=document.createElement("canvas"),i=A(Ed,this);return n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(A(Ed,this),0,0),n.toDataURL()}if(A(Fd,this)){var a=T(this.pageDimensions,2),r=a[0],s=a[1],o=Math.round(this.width*r*Bt.PDF_TO_CSS_UNITS),l=Math.round(this.height*s*Bt.PDF_TO_CSS_UNITS),h=new OffscreenCanvas(o,l);return h.getContext("2d").drawImage(A(Ed,this),0,0,A(Ed,this).width,A(Ed,this).height,0,0,o,l),h.transferToImageBitmap()}return structuredClone(A(Ed,this))}function Ud(){var t=this;_(Pd,this,new ResizeObserver((function(e){var n=e[0].contentRect;n.width&&n.height&&C(Nd,t,zd).call(t,n.width,n.height)}))),A(Pd,this).observe(this.div)}u=Od,x(Od,"_type","stamp"),x(Od,"_editorType",Q.STAMP);var Xd=new WeakMap,Kd=new WeakMap,Yd=new WeakMap,Qd=new WeakMap,Jd=new WeakMap,Zd=new WeakMap,$d=new WeakMap,tf=new WeakMap,ef=new WeakMap,nf=new WeakMap,af=new WeakMap,rf=new WeakMap,sf=new WeakMap,of=new WeakSet,lf=function(){return F((function t(e){var n=e.uiManager,i=e.pageIndex,a=e.div,r=e.accessibilityManager,s=e.annotationLayer,o=e.drawLayer,l=e.textLayer,h=e.viewport,u=e.l10n;N(this,t),m(this,of),k(this,Xd,void 0),k(this,Kd,!1),k(this,Yd,null),k(this,Qd,null),k(this,Jd,null),k(this,Zd,null),k(this,$d,null),k(this,tf,new Map),k(this,ef,!1),k(this,nf,!1),k(this,af,!1),k(this,rf,null),k(this,sf,void 0);var c=y(vf._.values());if(!t._initialized){t._initialized=!0;var d,f=R(c);try{for(f.s();!(d=f.n()).done;)d.value.initialize(u,n)}catch(t){f.e(t)}finally{f.f()}}n.registerEditorTypes(c),_(sf,this,n),this.pageIndex=i,this.div=a,_(Xd,this,r),_(Yd,this,s),this.viewport=h,_(rf,this,l),this.drawLayer=o,A(sf,this).addLayer(this)}),[{key:"isEmpty",get:function(){return 0===A(tf,this).size}},{key:"isInvisible",get:function(){return this.isEmpty&&A(sf,this).getMode()===Q.NONE}},{key:"updateToolbar",value:function(t){A(sf,this).updateToolbar(t)}},{key:"updateMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A(sf,this).getMode();switch(C(of,this,ff).call(this),t){case Q.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case Q.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case Q.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);var e,n=this.div.classList,i=R(vf._.values());try{for(i.s();!(e=i.n()).done;){var a=e.value;n.toggle("".concat(a._type,"Editing"),t===a._editorType)}}catch(t){i.e(t)}finally{i.f()}this.div.hidden=!1}},{key:"hasTextLayer",value:function(t){var e;return t===(null===(e=A(rf,this))||void 0===e?void 0:e.div)}},{key:"addInkEditorIfNeeded",value:function(t){if(A(sf,this).getMode()===Q.INK){if(!t){var e,n=R(A(tf,this).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.isEmpty())return void i.setInBackground()}}catch(t){n.e(t)}finally{n.f()}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}}},{key:"setEditingState",value:function(t){A(sf,this).setEditingState(t)}},{key:"addCommands",value:function(t){A(sf,this).addCommands(t)}},{key:"togglePointerEvents",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!t)}},{key:"toggleAnnotationLayerPointerEvents",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(t=A(Yd,this))||void 0===t||t.div.classList.toggle("disabled",!e)}},{key:"enable",value:function(){this.div.tabIndex=0,this.togglePointerEvents(!0);var t,e=new Set,n=R(A(tf,this).values());try{for(n.s();!(t=n.n()).done;){var i=t.value;i.enableEditing(),i.show(!0),i.annotationElementId&&(A(sf,this).removeChangedExistingAnnotation(i),e.add(i.annotationElementId))}}catch(t){n.e(t)}finally{n.f()}if(A(Yd,this)){var a,r=R(A(Yd,this).getEditableAnnotations());try{for(r.s();!(a=r.n()).done;){var s=a.value;if(s.hide(),!A(sf,this).isDeletedAnnotationElement(s.data.id)&&!e.has(s.data.id)){var o=this.deserialize(s);o&&(this.addOrRebuild(o),o.enableEditing())}}}catch(t){r.e(t)}finally{r.f()}}}},{key:"disable",value:function(){_(af,this,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);var t,e=new Map,n=new Map,i=R(A(tf,this).values());try{for(i.s();!(t=i.n()).done;){var a,r=t.value;r.disableEditing(),r.annotationElementId&&(null===r.serialize()?(n.set(r.annotationElementId,r),null===(a=this.getEditableAnnotation(r.annotationElementId))||void 0===a||a.show(),r.remove()):e.set(r.annotationElementId,r))}}catch(t){i.e(t)}finally{i.f()}if(A(Yd,this)){var s,o=R(A(Yd,this).getEditableAnnotations());try{for(o.s();!(s=o.n()).done;){var l=s.value,h=l.data.id;if(!A(sf,this).isDeletedAnnotationElement(h)){var u=n.get(h);u?(u.resetAnnotationElement(l),u.show(!1),l.show()):((u=e.get(h))&&(A(sf,this).addChangedExistingAnnotation(u),u.renderAnnotationElement(l),u.show(!1)),l.show())}}}catch(t){o.e(t)}finally{o.f()}}C(of,this,ff).call(this),this.isEmpty&&(this.div.hidden=!0);var c,d=this.div.classList,f=R(vf._.values());try{for(f.s();!(c=f.n()).done;){var v=c.value;d.remove("".concat(v._type,"Editing"))}}catch(t){f.e(t)}finally{f.f()}this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),_(af,this,!1)}},{key:"getEditableAnnotation",value:function(t){var e;return(null===(e=A(Yd,this))||void 0===e?void 0:e.getEditableAnnotation(t))||null}},{key:"setActiveEditor",value:function(t){A(sf,this).getActive()!==t&&A(sf,this).setActiveEditor(t)}},{key:"enableTextSelection",value:function(){var t;this.div.tabIndex=-1,null!==(t=A(rf,this))&&void 0!==t&&t.div&&!A(Zd,this)&&(_(Zd,this,C(of,this,hf).bind(this)),A(rf,this).div.addEventListener("pointerdown",A(Zd,this)),A(rf,this).div.classList.add("highlighting"))}},{key:"disableTextSelection",value:function(){var t;this.div.tabIndex=0,null!==(t=A(rf,this))&&void 0!==t&&t.div&&A(Zd,this)&&(A(rf,this).div.removeEventListener("pointerdown",A(Zd,this)),_(Zd,this,null),A(rf,this).div.classList.remove("highlighting"))}},{key:"enableClick",value:function(){A(Jd,this)||(_(Jd,this,this.pointerdown.bind(this)),_(Qd,this,this.pointerup.bind(this)),this.div.addEventListener("pointerdown",A(Jd,this)),this.div.addEventListener("pointerup",A(Qd,this)))}},{key:"disableClick",value:function(){A(Jd,this)&&(this.div.removeEventListener("pointerdown",A(Jd,this)),this.div.removeEventListener("pointerup",A(Qd,this)),_(Jd,this,null),_(Qd,this,null))}},{key:"attach",value:function(t){A(tf,this).set(t.id,t);var e=t.annotationElementId;e&&A(sf,this).isDeletedAnnotationElement(e)&&A(sf,this).removeDeletedAnnotationElement(t)}},{key:"detach",value:function(t){var e;A(tf,this).delete(t.id),null===(e=A(Xd,this))||void 0===e||e.removePointerInTextLayer(t.contentDiv),!A(af,this)&&t.annotationElementId&&A(sf,this).addDeletedAnnotationElement(t)}},{key:"remove",value:function(t){this.detach(t),A(sf,this).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,A(nf,this)||this.addInkEditorIfNeeded(!1)}},{key:"changeParent",value:function(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(A(sf,this).addDeletedAnnotationElement(t.annotationElementId),oa.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),null===(e=t.parent)||void 0===e||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}},{key:"add",value:function(t){if(t.parent!==this||!t.isAttachedToDOM){if(this.changeParent(t),A(sf,this).addEditor(t),this.attach(t),!t.isAttachedToDOM){var e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),A(sf,this).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}},{key:"moveEditorInDOM",value:function(t){var e,n=this;if(t.isAttachedToDOM){var i=document.activeElement;t.div.contains(i)&&!A($d,this)&&(t._focusEventsAllowed=!1,_($d,this,setTimeout((function(){_($d,n,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",(function(){t._focusEventsAllowed=!0}),{once:!0}),i.focus())}),0))),t._structTreeParentId=null===(e=A(Xd,this))||void 0===e?void 0:e.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}}},{key:"addOrRebuild",value:function(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}},{key:"addUndoableEditor",value:function(t){this.addCommands({cmd:function(){return t._uiManager.rebuild(t)},undo:function(){t.remove()},mustExec:!1})}},{key:"getNextId",value:function(){return A(sf,this).getId()}},{key:"canCreateNewEmptyEditor",value:function(){var t;return null===(t=w(of,this,uf))||void 0===t?void 0:t.canCreateNewEmptyEditor()}},{key:"pasteEditor",value:function(t,e){A(sf,this).updateToolbar(t),A(sf,this).updateMode(t);var n=C(of,this,df).call(this),i=n.offsetX,a=n.offsetY,r=this.getNextId(),s=C(of,this,cf).call(this,v({parent:this,id:r,x:i,y:a,uiManager:A(sf,this),isCentered:!0},e));s&&this.add(s)}},{key:"deserialize",value:function(t){var e,n;return(null===(e=vf._.get(null!==(n=t.annotationType)&&void 0!==n?n:t.annotationEditorType))||void 0===e?void 0:e.deserialize(t,this,A(sf,this)))||null}},{key:"createAndAddNewEditor",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getNextId(),a=C(of,this,cf).call(this,v({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:A(sf,this),isCentered:e},n));return a&&this.add(a),a}},{key:"addNewEditor",value:function(){this.createAndAddNewEditor(C(of,this,df).call(this),!0)}},{key:"setSelected",value:function(t){A(sf,this).setSelected(t)}},{key:"toggleSelected",value:function(t){A(sf,this).toggleSelected(t)}},{key:"isSelected",value:function(t){return A(sf,this).isSelected(t)}},{key:"unselect",value:function(t){A(sf,this).unselect(t)}},{key:"pointerup",value:function(t){var e=xt.platform.isMac;0!==t.button||t.ctrlKey&&e||t.target===this.div&&A(ef,this)&&(_(ef,this,!1),A(Kd,this)?A(sf,this).getMode()!==Q.STAMP?this.createAndAddNewEditor(t,!1):A(sf,this).unselectAll():_(Kd,this,!0))}},{key:"pointerdown",value:function(t){if(A(sf,this).getMode()===Q.HIGHLIGHT&&this.enableTextSelection(),A(ef,this))_(ef,this,!1);else{var e=xt.platform.isMac;if(!(0!==t.button||t.ctrlKey&&e)&&t.target===this.div){_(ef,this,!0);var n=A(sf,this).getActive();_(Kd,this,!n||n.isEmpty())}}}},{key:"findNewParent",value:function(t,e,n){var i=A(sf,this).findParent(e,n);return null!==i&&i!==this&&(i.changeParent(t),!0)}},{key:"destroy",value:function(){var t;(null===(t=A(sf,this).getActive())||void 0===t?void 0:t.parent)===this&&(A(sf,this).commitOrRemove(),A(sf,this).setActiveEditor(null)),A($d,this)&&(clearTimeout(A($d,this)),_($d,this,null));var e,n=R(A(tf,this).values());try{for(n.s();!(e=n.n()).done;){var i,a=e.value;null===(i=A(Xd,this))||void 0===i||i.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove()}}catch(t){n.e(t)}finally{n.f()}this.div=null,A(tf,this).clear(),A(sf,this).removeLayer(this)}},{key:"render",value:function(t){var e=t.viewport;this.viewport=e,Se(this.div,e);var n,i=R(A(sf,this).getEditors(this.pageIndex));try{for(i.s();!(n=i.n()).done;){var a=n.value;this.add(a),a.rebuild()}}catch(t){i.e(t)}finally{i.f()}this.updateMode()}},{key:"update",value:function(t){var e=t.viewport;A(sf,this).commitOrRemove(),C(of,this,ff).call(this);var n=this.viewport.rotation,i=e.rotation;if(this.viewport=e,Se(this.div,{rotation:i}),n!==i){var a,r=R(A(tf,this).values());try{for(r.s();!(a=r.n()).done;)a.value.rotate(i)}catch(t){r.e(t)}finally{r.f()}}this.addInkEditorIfNeeded(!1)}},{key:"pageDimensions",get:function(){var t=this.viewport.rawDims;return[t.pageWidth,t.pageHeight]}},{key:"scale",get:function(){return A(sf,this).viewParameters.realScale}}])}();function hf(t){var e=this;if(A(sf,this).unselectAll(),t.target===A(rf,this).div){var n=xt.platform.isMac;if(0!==t.button||t.ctrlKey&&n)return;A(sf,this).showAllEditors("highlight",!0,!0),A(rf,this).div.classList.add("free"),bc.startHighlighting(this,"ltr"===A(sf,this).direction,t),A(rf,this).div.addEventListener("pointerup",(function(){A(rf,e).div.classList.remove("free")}),{once:!0}),t.preventDefault()}}function uf(t){return vf._.get(A(sf,t).getMode())}function cf(t){var e=w(of,this,uf);return e?new e.prototype.constructor(t):null}function df(){var t=this.div.getBoundingClientRect(),e=t.x,n=t.y,i=t.width,a=t.height,r=Math.max(0,e),s=Math.max(0,n),o=(r+Math.min(window.innerWidth,e+i))/2-e,l=(s+Math.min(window.innerHeight,n+a))/2-n,h=T(this.viewport.rotation%180==0?[o,l]:[l,o],2);return{offsetX:h[0],offsetY:h[1]}}function ff(){_(nf,this,!0);var t,e=R(A(tf,this).values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isEmpty()&&n.remove()}}catch(t){e.e(t)}finally{e.f()}_(nf,this,!1)}x(lf,"_initialized",!1);var vf={_:new Map([Fh,Zc,Od,bc].map((function(t){return[t._editorType,t]})))},pf=new WeakMap,gf=new WeakMap,yf=new WeakMap,mf=new WeakMap,kf=new WeakSet,bf=function(){function t(e){var n=e.pageIndex;N(this,t),m(this,kf),k(this,pf,null),k(this,gf,0),k(this,yf,new Map),k(this,mf,new Map),this.pageIndex=n}return F(t,[{key:"setParent",value:function(t){if(A(pf,this)){if(A(pf,this)!==t){if(A(yf,this).size>0){var e,n=R(A(yf,this).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.remove(),t.append(i)}}catch(t){n.e(t)}finally{n.f()}}_(pf,this,t)}}else _(pf,this,t)}},{key:"highlight",value:function(e,n,i){var a,r,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=(_(gf,this,(a=A(gf,this),r=a++,a)),r),l=C(kf,this,Af).call(this,e.box);l.classList.add("highlight"),e.free&&l.classList.add("free");var h=t._svgFactory.createElement("defs");l.append(h);var u=t._svgFactory.createElement("path");h.append(u);var c="path_p".concat(this.pageIndex,"_").concat(o);u.setAttribute("id",c),u.setAttribute("d",e.toSVGPath()),s&&A(mf,this).set(o,u);var d=C(kf,this,_f).call(this,h,c),f=t._svgFactory.createElement("use");return l.append(f),l.setAttribute("fill",n),l.setAttribute("fill-opacity",i),f.setAttribute("href","#".concat(c)),A(yf,this).set(o,l),{id:o,clipPathId:"url(#".concat(d,")")}}},{key:"highlightOutline",value:function(e){var n,i,a=(_(gf,this,(n=A(gf,this),i=n++,n)),i),r=C(kf,this,Af).call(this,e.box);r.classList.add("highlightOutline");var s=t._svgFactory.createElement("defs");r.append(s);var o=t._svgFactory.createElement("path");s.append(o);var l,h="path_p".concat(this.pageIndex,"_").concat(a);if(o.setAttribute("id",h),o.setAttribute("d",e.toSVGPath()),o.setAttribute("vector-effect","non-scaling-stroke"),e.free){r.classList.add("free");var u=t._svgFactory.createElement("mask");s.append(u),l="mask_p".concat(this.pageIndex,"_").concat(a),u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");var c=t._svgFactory.createElement("rect");u.append(c),c.setAttribute("width","1"),c.setAttribute("height","1"),c.setAttribute("fill","white");var d=t._svgFactory.createElement("use");u.append(d),d.setAttribute("href","#".concat(h)),d.setAttribute("stroke","none"),d.setAttribute("fill","black"),d.setAttribute("fill-rule","nonzero"),d.classList.add("mask")}var f=t._svgFactory.createElement("use");r.append(f),f.setAttribute("href","#".concat(h)),l&&f.setAttribute("mask","url(#".concat(l,")"));var v=f.cloneNode();return r.append(v),f.classList.add("mainOutline"),v.classList.add("secondaryOutline"),A(yf,this).set(a,r),a}},{key:"finalizeLine",value:function(t,e){var n=A(mf,this).get(t);A(mf,this).delete(t),this.updateBox(t,e.box),n.setAttribute("d",e.toSVGPath())}},{key:"updateLine",value:function(t,e){A(yf,this).get(t).firstChild.firstChild.setAttribute("d",e.toSVGPath())}},{key:"removeFreeHighlight",value:function(t){this.remove(t),A(mf,this).delete(t)}},{key:"updatePath",value:function(t,e){A(mf,this).get(t).setAttribute("d",e.toSVGPath())}},{key:"updateBox",value:function(e,n){wf.call(t,A(yf,this).get(e),n)}},{key:"show",value:function(t,e){A(yf,this).get(t).classList.toggle("hidden",!e)}},{key:"rotate",value:function(t,e){A(yf,this).get(t).setAttribute("data-main-rotation",e)}},{key:"changeColor",value:function(t,e){A(yf,this).get(t).setAttribute("fill",e)}},{key:"changeOpacity",value:function(t,e){A(yf,this).get(t).setAttribute("fill-opacity",e)}},{key:"addClass",value:function(t,e){A(yf,this).get(t).classList.add(e)}},{key:"removeClass",value:function(t,e){A(yf,this).get(t).classList.remove(e)}},{key:"remove",value:function(t){null!==A(pf,this)&&(A(yf,this).get(t).remove(),A(yf,this).delete(t))}},{key:"destroy",value:function(){_(pf,this,null);var t,e=R(A(yf,this).values());try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}A(yf,this).clear()}}],[{key:"_svgFactory",get:function(){return dt(this,"_svgFactory",new ue)}}])}();function wf(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.x,i=void 0===n?0:n,a=e.y,r=void 0===a?0:a,s=e.width,o=void 0===s?1:s,l=e.height,h=void 0===l?1:l,u=t.style;u.top="".concat(100*r,"%"),u.left="".concat(100*i,"%"),u.width="".concat(100*o,"%"),u.height="".concat(100*h,"%")}function Af(t){var e=c._svgFactory.create(1,1,!0);return A(pf,this).append(e),e.setAttribute("aria-hidden",!0),wf.call(c,e,t),e}function _f(t,e){var n=c._svgFactory.createElement("clipPath");t.append(n);var i="clip_".concat(e);n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");var a=c._svgFactory.createElement("use");return n.append(a),a.setAttribute("href","#".concat(e)),a.classList.add("clip"),i}c=bf})();
