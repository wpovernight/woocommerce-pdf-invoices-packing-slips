(function(){function a(...a){o&&console.log("[WPO IPS Peppol]",...a)}function b(a){const b=document.querySelector(a);return b?((b.value||"")+"").trim():""}function c(){try{const a=window.wp?.data?.select?.("wc/store/cart");if(a&&"function"==typeof a.getCustomerData){const b=a.getCustomerData()||{},c=b.billingAddress?.country||b.billing_address?.country||b.customer?.billingAddress?.country||b.customer?.billing_address?.country;if(c)return(c+"").trim()}}catch(a){}return b(p)}function d(a){const b=((a||"")+"").toUpperCase();return n.includes(b)}function e(a){return((a||"")+"").replace(/\s+/g,"").toUpperCase().trim()}function f(a,b){const c=r[a];if(!c)return"";const d=e(b);if(c.vat_regex)try{const a=new RegExp((c.vat_regex+"").replace(/^\/|\/[gimuy]*$/g,""));if(!a.test(d))return""}catch(a){return""}if(c.vat_digits){const a=d.replace(/^[A-Z]{2}/,"").replace(/\D+/g,"");return a.length===+c.vat_digits?c.eas?c.eas+":"+a:"":""}return c.prefix?c.prefix+""+d:""}function g(a,b){if(!a)return!1;const c=(b??"")+"";return!((a.value??"")+""!==c)||(a.value=c,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),!0)}function h(){if(!document.getElementById("wpo-ips-peppol-lock-styles")){const a=document.createElement("style");a.id="wpo-ips-peppol-lock-styles",a.textContent=`
			/* Locked look */
			.wpo-is-locked {
				opacity: 0.75;
				cursor: not-allowed;
			}

			/* Make wrapper look disabled (Blocks uses wrapper divs) */
			.wpo-ips-locked-wrap {
				opacity: 0.75;
			}
			.wpo-ips-locked-wrap input {
				background: rgba(0,0,0,0.04);
			}

			/* Override link */
			.wpo-ips-override {
				display: block;
				margin-top: 6px;
				font-size: 12px;
				text-decoration: underline;
				cursor: pointer;
				user-select: none;
			}
			.wpo-ips-override:hover {
				text-decoration: none;
			}
		`,document.head.appendChild(a)}}function i(a,b,c){if(!a)return;let d=a.querySelector(".wpo-ips-override");return c?d?d:(d=document.createElement("a"),d.href="#",d.className="wpo-ips-override",d.textContent=m.override_link_text||"Unlock",d.addEventListener("click",a=>{a.preventDefault(),u=!0,k("override-click"),b&&b.focus()}),a.appendChild(d),d):void(d&&d.remove())}function j(a,b,c){a.readOnly=c,a.style.pointerEvents=c?"none":"",a.setAttribute("aria-disabled",c?"true":"false"),a.classList.toggle("wpo-is-locked",c),b&&b.classList.toggle("wpo-ips-locked-wrap",c)}function k(e="unknown"){z=!1,h();const k=document.querySelector(s),l=document.querySelector(t);if(!l)return;const m=c().toUpperCase(),n=b(q);(m!==w||n!==v)&&(u=!1,w=m,v=n);const o=d(m)&&""!==n,p=o&&!u,r=""===n?"":f(m,n);o&&!u&&r&&g(l,r);p===x&&l===y||(i(k,l,p),j(l,k,p),x=p,y=l,a("lock state applied",{source:e,country:m,vatValue:n,locked:p,manualOverride:u}))}function l(a){z||(z=!0,requestAnimationFrame(()=>k(a)))}const m=window.wpoIpsPeppol||{},n=Array.isArray(m.countries)?m.countries.map(a=>(a+"").toUpperCase()):[],o=!!m.debug,p="#billing-country, select[name=\"billing_country\"], .wc-block-components-address-form__country select, .wc-block-components-country-input select",q=m.vat_field_selector,r=m.vat_mappings&&"object"==typeof m.vat_mappings?m.vat_mappings:{},s=".wc-block-components-address-form__wpo-ips-edi-peppol-endpoint-id",t=s+" input";let u=!1,v=null,w=null,x=null,y=null,z=!1;const A=document.querySelector("#order-fields")||document.querySelector(".wc-block-checkout")||document.documentElement;new MutationObserver(()=>l("mutation")).observe(A,{childList:!0,subtree:!0}),document.addEventListener("input",a=>{(a.target?.matches(p)||a.target?.matches(q))&&l("input")}),window.wp?.data?.subscribe&&window.wp.data.subscribe(()=>l("store")),l("init")})();